/*!
* Data Aquarium Framework - If This Than That + Kiosk UI
* Copyright 2020 Code On Time LLC; Licensed MIT; http://codeontime.com/license
*/
(function(){function w(n,t,i){var r=n.id;return r||(r=n.id="flow"+gu++),t=r+"_"+t,arguments.length<3?vr[t]:vr[t]=i}function pr(n,t,i){var r=w(n,t);return r==null&&(r=i,w(n,t,r)),r}function k(t,i,r){n.notify(arguments.length>1?{text:t,force:i,duration:r}:t)}function d(){return n.busy()||n.isInTransition()}function wr(){return $.mobile.activePage||$()}function o(n){return $('<div class="'+n+'"><\/div>')}function ri(){return!1}function ht(n){s.barcode(":always",n)}function pt(){return r&&!r.nextAll(".ui-page-active").length}function g(i){if(arguments.length)i?(ht(!r||pt()),t&&t.input.barcode&&$(document.activeElement).blur(),s.valid()&&(ti||(ti=rt("ui.transitions.style")),rt("ui.transitions.style","none"),v.addClass("app-ui-automation"),wr().addClass("app-ui-automation-root"))):(ht(pt()),$(".app-ui-automation,.app-ui-automation-root").removeClass("app-ui-automation app-ui-automation-root"),s.barcode(":peek")==null&&n.resetUI(),rt("ui.transitions.style",ti));else return v.is(".app-ui-automation")}function wt(n){n===!0?(v.addClass("app-ui-automation-system"),rt("ui.transitions.style",ti)):(v.removeClass("app-ui-automation-system"),rt("ui.transitions.style","none"))}function br(){wt();r&&ht(!0)}function a(n){return n="ui.automation."+n,rt.apply(this,arguments)}function ct(n){n&&e.error(n);st&&st.resolve()}function wi(){st&&st.reject()}function ui(n){return JSON.stringify(n).replace(/","/g,'", "')}function kr(n){return new RegExp(RegExp.escape(n).replace(/\\\+/g,".+?"),"i")}function h(n,t,i){var o=t&&t.length,u,e,r,f;if(n&&n._extended)return n;if(o===1&&typeof n=="object"&&!("selector"in n)){n._extended||(n._extended={});for(e in n)vi.indexOf(e)<0&&(n.selector=e,u=n[e],u instanceof nt&&(n[e]=u=u.unwrap()),n._extended.mapped||(n.value=u,n._extended.mapped=!0))}return n==null&&(n=""),typeof n=="string"&&(n={selector:n,_extended:{}}),r=n.regex,r||(r=n.selector,r==null&&(r=""),r instanceof RegExp||(r=r.toString(),r!=null&&r.match(/^@/)?(r=r.substring(1),n.identifier=r):r=kr(r)),n.regex=r),t&&(o>1&&(u=t[1],u instanceof nt&&(u=t[1]=u.unwrap()),n.value=u,i===2&&(n.in=u)),o>2&&(n.in=t[2])),n.in&&(f={selector:n.in},f=h(f),f.identifier?n.inIdentifier=f.identifier:n.inRegex=f.regex),n}function bi(n){var i=n&&n._survey,t=i&&i.context;return t&&typeof t=="object"&&"model"in t&&"search"in t&&(n=u.find(t.id)),n}function ki(){var i=r&&!g()?yt(r.prevAll(".ui-page-active,.ui-page").first().attr("id")):n.dataView(),f,t;return i=r&&!g()?r.prevAll(".ui-page-active").length?n.dataView():yt(r.prevAll(".ui-page:first").attr("id")):n.dataView(),i||(f=$("#Main .app-echo:first"),f.length&&(i=yt(f.data("for")))),i||(t=n.pageInfo(yr),$app.survey({controller:t.id,id:t.id,show:!1,questions:[{name:"text"}]}),i=t.dataView=u.findDataView(t.id),t.page||(t.page=$(".ui-page-active")),t.initialized=!1,n.pageInit(i._id)),i}function bt(n){var t=ki(),i;return t&&(t=bi(t),n.in&&(n.inIdentifier?i=t.findField(n.inIdentifier):t._allFields.every(function(t){return t.HeaderText.match(n.inRegex)&&(i=t),!i}),t=i?u.find(i._dataViewId):null)),t}function dr(n,t,i,r){!n._allFields||n._busy()||ri()?setTimeout(dr,32,n,t,i,r):gr(n,t,i,r)}function gr(n,i,r,u){if(r)u(n,i)!==!1&&(t.error?i.reject():setTimeout(e._wait,it,i));else{var f=u(n,i);f&&f.then||(f?i.resolve(f):i.reject())}}function di(n,t,i,r){var f=ki(),o,e;return f&&(f=bi(f),n.in&&(n.inIdentifier?e=f.findField(n.inIdentifier):f._allFields.every(function(t){return t.HeaderText.match(n.inRegex)&&(e=t),!e}),e?(f=u.find(e._dataViewId),o=!f._allFields||f._busy()):f=null)),r&&(o?(s.focus({field:e}),dr(f,t,i,r)):gr(f,t,i,r)),f}function b(n,t){var i,r=n.identifier;return t||(t=bt(n)),t&&(r?i=t.findField(r):t._allFields.every(function(t){return t.HeaderText.match(n.regex)&&(i=t),!i})),i}function nu(n,t){var u={},i,r,f=[];if(n._extended.mapped)for(r in n)vi.indexOf(r)<0&&(i=b(h({selector:r,"in":n.in})),i?u[i.Name]=n[r]:f.push(r));else i=b(n),i?u[i.Name]=n.value:f.push(n.selector);return f.length&&(e.error(t+': "'+f.join('", "')+'" not found.'),ct(!1),u=null),u}function gi(t,i,r){var u,o=n.contextScope(),e=i.identifier,f;return t&&(f=!t.get_isForm(),r||(r=[]),r.length||(n.contextScope(t),n.navContext(r),n.contextScope(o)),r.every(function(n){var r=n.text;return(e==null||n.path!==e)&&(!r||n.system&&!i.system||n.command==="New"&&f&&(n.argument===t._viewId||!n.argument)||n.command==="Edit"&&f&&(n.argument===t._viewId||!n.argument)||!r.match(i.regex))||(u=n),!u})),u}function tu(n,t,i,r){var u=[],e=[],o,s;if(r.method==="filter"){u=null;for(o in i)s=n.findField(o),s&&e.push(s.Name+":=%js%"+JSON.stringify(i[o]))}else n._allFields.forEach(function(n){n.IsPrimaryKey&&(u.push(t[n.Name]),e.push(n.Name+":=%js%"+JSON.stringify(t[n.Name])))});r.filter&&!f&&(n._syncFilter=!0,n.set_filter(e));n.sync(u);n._syncFilter=!1}function nt(n){this._deferred=$.Deferred();this._pending=n?n._pending.slice():[]}function tf(){var c=$app.userName(),i=$('<span class="app-avatar"/>').attr("data-title",c).appendTo(r),e=Web.Menu.currentNode,l=a("kiosk.copyright"),y,s,h,t;for(y=$('<span class="app-logo"/>').appendTo(r).html(n.appName()),e&&n.icon("material-icon-chevron-right",$('<span class="app-page-title"/>').appendTo(y.attr("data-title",e.description)).text(e.title)),$('<span class="app-btn-menu ui-btn ui-btn-icon-notext ui-btn-left ui-icon-bars"/>').appendTo(r).attr("data-title",ft.Menu),s=$('<span class="app-btn-context ui-btn ui-btn-icon-notext ui-btn-left ui-icon-bars"/>').appendTo(r).attr("data-title",ft.More),u.AccountManager.avatar(c,$('<i class="app-icon-avatar"/>').text(n.initials(u.userName())).appendTo(i)),u.userName()?s=i:(i.hide(),v.data("public")||$('<span class="app-login ui-btn"><\/span>').appendTo(r).attr("data-title",Web.MembershipResources.Bar.LoginLink)),f=o("app-display").appendTo(r),l!==!1&&o("app-copyright app-acc-footer").appendTo(r.addClass("app-has-copyright")).html(l||$("#PageFooterBar,footer small").html()),h=r.width()-s.offset().left-28,t=1;t<3;t++)h+=50,$('<span class="ui-btn ui-btn-icon-notext ui-btn-left app-btn app-btn'+t+'"><i class="app-icon material-icon"><\/i><\/span>').css("right",h).appendTo(r).hide()}function kt(n){if(f)if(n===!0){var i=f.data("config"),t;navigator.userAgent.match(/Edge/)&&(t=$(".app-kiosk > .ui-btn,.app-kiosk > .app-logo").hide());vu();f.empty();ir(i);t&&t.show()}else clearTimeout(hr),hr=setTimeout(kt,200,!0)}function dt(n){if(f)if(n){var t=n.dataView._id,i=et.indexOf(t);i===-1&&et.push(n.dataView._id);setTimeout(dt)}else d()?setTimeout(dt,it):et.length&&lu()}function rf(n){return'&nbsp;<i class="app-icon material-icon" aria-hidden="true">expand_'+(n?"less":"more")+"<\/i >"}function uf(){return 8}function ff(n){return n.toString()}function ef(){return this._config.columns||8}function fi(n,t){n&&(n._dataView=t,n.val=t?of:null)}function of(n){var r=this,u=r._dataView,t,i;return n&&(n.match(/^@/)?n=n.substring(1):t=n instanceof RegExp?n:kr(n)),u._allFields.every(function(r){return(t&&r.HeaderText.match(t)||r.Name===n)&&(i=r.Name),!i}),r[i]}function iu(n){var t=n._inDataView;return n._hasFields&&!t.get_isForm()&&n._count>1}function ru(n){return{width:n[0].offsetWidth-n[0].clientWidth+1,height:n[0].offsetHeight-n[0].clientHeight+1}}function nr(n,t){var r=t==="fill",i;return t!=null&&(i=o("app-container-content").attr("tabindex",0).appendTo(n.toggleClass("app-container-autosize",r)),i.css({"margin-right":i[0].clientWidth-i[0].offsetWidth-1-parseInt(n.css("paddingRight")),height:!r&&t!==!1?t:null})),i}function tr(n){var t=n.perform;return"barcode"in n||t&&(typeof t=="function"||t.show||t.hide||typeof t.pick=="string")}function sf(n){var i=[],t=a("numPad.buttons"),r=n.label;return t||(t=standardNumPadButtons,n.compact&&(t=JSON.parse(JSON.stringify(t)),t[1][3]=t[3][2],t[2][3]=t[4][0],t[2][3].tall=!0,t.splice(t.length-1))),i.push('<div class="app-numpad">'),r&&i.push('<div class="app-label">'+u.htmlEncode(r)+"<\/div>"),i.push('<div class="app-text app-null"><span class="app-value"/><i class="app-icon material-icon" aria-hidden="true" title="'+ft.ClearText+'" data-key="Clear">clear<\/i><\/span><\/div>'),t.forEach(function(n){var t=0,r;n.forEach(function(n){t+=n.width||1;n.tall&&(r=!0)});i.push('<div class="app-row'+(r?" app-tall":"")+'">');n.forEach(function(n){var f=n.icon,e=n.font,r=n.key,u=n.test;typeof r=="function"&&(r=r());u&&yi.push(u);i.push('<span class="app-btn app-feedback'+(n.accent?" app-accent":"")+(n.dark?" app-dark":"")+(n.tall?" app-tall":"")+'" style="width:'+(n.width||1)/t*100+"%;"+(e?"font-size:"+e+";":"")+'" data-key="'+r+'"'+(u?' data-test="'+(yi.length-1)+'"':"")+">");i.push(f?'<i class="app-icon material-icon" aria-hidden="true">'+f+"<\/i>":n.text||r);i.push("<\/span>")});i.push("<\/div>")}),i.push("<\/div>"),i.join("")}function uu(n,t,i,r,f){function d(){if(w){var n=e.parent(),r,t=n.outerHeight(),s=t<=rt,u=n.find("h1>.material-icon,h2>.material-icon,h3>.material-icon,h4>.material-icon,h5>.material-icon,h6>.material-icon").first(),f=k.icon,i;s&&(n.is(".app-align-top,.app-align-bottom")||n.addClass("app-align-center"),t=rt-(t-e.outerHeight(!0)),n.height(t));w=null;f!==!1&&(i=Math.min(n.width(),n.height()),typeof f=="string"?$('<i class="material-icon"/>').text(f).insertBefore(e).css({transform:"scale("+i/24+")",right:i/2}):u.length&&(u=u.clone().insertBefore(e).css("transform","scale("+i*.6/24+")")));s&&k.sticky&&(r=o("app-sticky-hero-container").insertBefore(n),n.appendTo(r).addClass("app-spacing-none app-hero-sticky").find(".app-hero-content").appendTo(o("app-hero").toggleClass("app-spacing-none",k.spacing===!1).height(t).appendTo(r)))}}var g;t.data("created")||(t.data("created",new Date),n.forEach(function(n){delete n._lastResult}));tt(n,function(n){fu(n);tt(n,function(n){fu(n)},!1)},!1);var nt=ki(),c=i,s,v,y,it,l,p,e,w,k,rt=t.height();ur(n,t);n.forEach(function(t,rt){var yt=t.in,at,vt=t.background,ui=vt&&vt.fluid,bi=t.fluid,ki=t.jumbo,et=t.hero,gt,pt,wt,ni,ei,dt,ii,oi,si,hi,ht,ci,li,yi,st;if(et!=null&&(et=typeof et=="object"?et:{id:et},"id"in et||(et.id=!0)),yt?(yt=b(h({"in":yt})),yt?(at=yt._dataView,t._inDataView=at):g='Invalid DataView field "'+t.in+'".'):(at=nt,t._inDataView=nt),!t.hidden){t._count=t.count||10;t._newRow&&(v=ui?o("app-row-container").appendTo(i):i,s=o("app-row").appendTo(v),et?(gt=et.id,pt=et.background,(gt===!0||gt!==w)&&(d(),k=et,w=gt,e=o("app-hero-content").appendTo(o("app-hero").toggleClass("app-spacing-none",et.spacing===!1).css("background-color",pt?pt.color:null).appendTo(i)),et.align==="top"&&e.parent().addClass("app-align-top"),et.align==="bottom"&&e.parent().addClass("app-align-bottom")),s.appendTo(e),v=e,pt&&e.parent().addClass("app-has-background").toggleClass("app-background-accent",pt.accent===!0)):d(),f&&!bi&&s.css({maxWidth:f,minWidth:f,marginLeft:"auto",marginRight:"auto"}),ki&&(ui&&!et?v:s).addClass("app-jumbo"),vt&&(ui&&!et?v:s).addClass("app-has-background").toggleClass("app-background-accent",vt.accent===!0));t._newCol&&(c=o("app-column").appendTo(s),wt=t._width,t.isContent&&f&&wt<1&&t._newRow&&(rt===n.length-1||n[rt+1]._newRow)?(ni=f*wt,t.fluid?lt(s,wt).css({marginLeft:"auto",marginRight:"auto"}):s.css({width:ni,minWidth:ni,maxWidth:ni}),lt(c,1)):lt(c,wt),!t._newRow&&vt&&c.addClass("app-has-background").toggleClass("app-background-accent",vt.accent===!0));var bt=t.append?c.find(".app-container:last"):null,ut=bt?bt.length?bt:c:o("app-container").attr("data-index",rt).appendTo(c).data(t).toggleClass("app-spacing-none",t.spacing===!1),ft,kt,ct=t.tab,vi=ct||t.label,ti,fi=t.height;if(ct?y&&(kt=y):(y=null,l=null),vi!=null&&(kt||(kt=o("app-header").appendTo(ut)),ct!=null&&ct===it&&l?(ti=l,p=l.data("tab")):(ti=o("app-text").text(vi).data("config",t).appendTo(kt),ct!=null&&(p=[],l=ti.data("tab",p))),ct!=null&&(it=ct,y=kt.addClass("app-tabset"),l=ti,p.push(ut))),at)if(ei=[],tt(t,function(n,i){var e=n.type,r,u,f;n.expression?(t._hasFields=!0,u=!0):tr(n)||(i==="numpad"?f=sf(n):i==="#"?("tall"in n||(n.tall=dt?dt.tall:!0),n.field={Name:"#",HeaderText:"#",Type:"Int32",_config:n,format:ff,toColumns:ef},u=!0):i===">"?(n.tall=dt?dt.tall:!0,n.field={Name:">",Type:"Boolean",HtmlEncode:!1,_config:n,format:rf,toColumns:uf},n.label=!1,u=!0):(r=e==="field"||!e?b(h(n.clone||i),at):null,r&&(n.field=at._allFields[r.AliasIndex],t._hasFields=!0,u=!0)));n.dense&&(n.density="condensed");n._label=n.label!=null?n.label:r?r.HeaderText:i;ei.push({html:f?f:'<div data-type="'+(u?"field":"button")+'" data-name="'+i+'"'+(r?' data-field="'+r.Name+'"':"")+">"+(u?'<span class="app-label"/><span class="app-value"/>':'<span class="app-button app-feedback"><span class="app-text"/><\/span>')+"<\/div>",obj:n});dt=n}),t._propCount)t._items=ei,iu(t)?(ii=0,oi=[],tt(t,function(n,i,r){var u=n.field;if((!n.flow||!r&&n.flow==="row")&&u)n._grid=!0,i===">"&&(t.expand=!0,t._expanded=pr(t,"expanded",{})),oi.push(n),si=u.toColumns(),n._columns=si,ii+=si;else return!1}),ii&&(hi=o("app-row-header").appendTo(ut),oi.forEach(function(n){var t=n.field,i=n._label;n._width=n._columns/ii;$('<span class="app-text"/>').appendTo(lt($('<span class="app-column-header"/>'),n._width).appendTo(hi).attr("data-name",t.Name).attr("data-type",t.Type).toggleClass("app-field-type-numeric",t.Type.match(u._numericTypeRegex)!=null)).text(i!==!1?i:"")})),ur(t,hi||ut),nr(ut,fi||!1),t.letters&&o("app-letters").data("config",t).appendTo(ut.addClass("app-has-letters"))):(fi!=null?ft=nr(ut,fi):(ft=ut,bt&&(ft=ut.find(".app-container-content"),ft.length||(ft=ut))),ur(t,ft),eu(t,ft));else if(bt&&(ft=ut.find(".app-container-content"),ft.length&&(ut=ft),ut=o("").appendTo(ut)),t.isContent){if(ut=nr(ut,t.height)||ut,ft=t.content,ht=t.as,st=t.icon,st&&(typeof st=="string"&&(st={header:st}),typeof st=="object"&&(st.header&&(ft=ft.replace(/(<h1.*?>)/i,'$1<i class="material-icon">'+st.header+"<\/i>")),st.subheader&&(ft=ft.replace(/(<h[2-6].*?>)/i,'$1<i class="material-icon">'+st.subheader+"<\/i>")))),yi=$(ft).appendTo(ut),ht){typeof ht=="string"&&ht.match(/c#|csharp|vb|visualbasic|html|javascript|json/i)&&(ht={code:ht});for(li in ht)ci=u.display.as[li],ci&&(yi=ci.render(ht[li],ut,ft))}}else{var ai=t.image,ot=t.content,ri=ai!=null||ot!=null?!1:t.gapColor||a("kiosk.gapColor"),di=ri!==!1&&t.gapAccent,pi=t.dense?"condensed":t.density,wi=t._gap=ut.addClass("app-gap").toggleClass("app-accent",t.gapAccent===!0).toggleClass("app-gap-bkg",ri===!0).css({height:ai||ot?"":t._vertGap?"100%":rr(t),"background-color":di||ri===!1?null:t.gapColor||ri});ai?ot=$("<img/>").appendTo(wi).attr("src",u.resolveClientUrl(t.image)):ot!=null&&(ot.match(/^\s*<\w+/)||(ot='<div class="app-html">'+ot+"<\/div>"),ot=$(ot).appendTo(wi),parseInt(ot.css("font-size"))||ot.addClass("app-html"),pi&&ot.addClass("app-density-"+pi));ot&&(r||(r=ru(i)),ot.css({"max-width":t.fluid?null:ut.width(),"max-height":i.height()-r.height}))}return!g}});d()}function ir(t){var h,l,u,i,e,s;if(!arguments.length||typeof t!="string"&&!t.length)return"[Invalid display]";for(f.data("config")!==t&&f.removeData("created"),f.data("config",t),c=o("app-display-content app-display-flow").attr("tabindex",0).appendTo(f),typeof t=="string"?t={other:t}:Array.isArray(t)&&(t={other:t}),f.css({width:"",height:"",left:"","margin-left":"",display:""}),l=n.toWidth(f.width()),u=y.indexOf(l),ut=u;u>=0;)if(i=t[y[u]],i)break;else i=null,u--;return i||(i=t.other),e=Math.min(Math.max(r.width(),n.toWidth(l)),a("kiosk.maxWidth")||n.toWidth("xxl")),s=ru(c),f.css({width:e,height:f.height(),left:"50%","margin-left":-e/2+1}),c.css("width",e+s.width),c.css("height",f.height()+s.height),typeof i=="string"?o("app-content app-text").appendTo(c).html(i):h=uu(i,f,c,s),h||(fr(),et.splice(0),lu(!1),f.find(".app-tabset .app-text:first").each(function(){var n=$(this),t=n.parent().find(".app-text"),i=pr(n.data("config"),"selectedTab",0);$(t[i<t.length?i:0]).trigger("vclick")}),ei(),si()),h}function ei(n,t,i){n||(n=f);t||(t=c);var o=t.find(".app-container-autosize:not(.app-hidden)"),r,u,e,s=96;o.length&&o.each(function(){var f=$(this),o=f.show().find(".app-container-content"),c,l,a,v,h;o.data("sized")&&!i||o.is(".app-hidden")||(e=o.height("").is(":empty"),e&&(f.data("altered")||f.data("altered",!0).css({"padding-top":0,"padding-bottom":0}),f.show()),r==null&&(r=n.offset().top+n.height(),u=t.children().last()),o.data("sized",!0),c=f.parent(),l=c.children().filter(":visible").last(),a=c.offset().top+c.height()-(l.offset().top+l.outerHeight(!0)),v=r-(u.offset().top+u.outerHeight(!0)),h=o.height()+v+a,e&&(s=-1,h=Math.max(h,f.height(),0),h?f.show():f.hide()),h>s&&o.height(h))})}function fu(n){var i=n.alter,e=i,r,h,t,o,l,a,s,u,c,p=["_lastResult"],v=[];for(t in n)t.match(/^_/)&&p.indexOf(t)<0&&v.push(t);if(v.forEach(function(t){delete n[t]}),i){s=e.remove||{};for(t in s)delete n[t];u=e.restore||{};for(t in u)n[t]=u[t];r=i.portrait;r&&f.width()<f.height()?i=r:(r=i.landscape,r&&f.width()>f.height()&&(i=r));for(t in i)if(o=t.match(ku),o&&(l=y.indexOf(o[1]||y[0]),a=y.indexOf(o[3]||y[y.length-1]),l<=ut&&ut<=a)){h=i[t];for(t in h)t in n?u[t]=n[t]:s[t]=!0,c=h[t],c==null?delete n[t]:n[t]=c;e.remove=s;e.restore=u;break}}}function rr(n){var t=n.gapSize,i=t!=null?t:a("kiosk.gapSize");return i==null?f?12:16:i}function gt(n){return!n._propCount&&n.content==null&&n.image==null}function ur(n,t){var f=[],r,u,o=t.width(),i,e;tt(n,function(t){var s=Array.isArray(n)&&typeof n=="object",o;s&&tt(t);o=t.flow;t._grid||(o!=="row"&&r?o==="column"&&(e=!0,u=[],r.push(u),gt(t)&&s&&(t.width==null&&(t.width=rr(t)),t._vertGap=!0)):(s&&(o==="column"||o==="row"&&(!i||i.flow==="row"&&gt(i)))&&gt(t)&&(t.width==null?t.width=rr(t):t._keepWidth=!0,t._vertGap=!0),r=[],u=[],f.push(r),r.push(u)),u.push(t),!o&&t._propCount&&i&&gt(i)&&i._vertGap&&(i._keepWidth&&delete i.width,delete i._vertGap));i=t});f.forEach(function(n){var r=0,i=0,t=n[0][0];n.length===1&&n[0].length===1&&(gt(t)||!e)?(delete t._vertGap,t._keepWidth||t.isContent||delete t.width,t._width=1,t._newCol=!0,t._newRow=!0):n.forEach(function(t,u){var e=t[0].width,s,h;e!=null&&e!=="auto"?(typeof e=="string"&&(e.match(/%$/)?e=parseFloat(e)/100:e.match(/^\d+x$/)?(vt||(s=$('<div class="app-container"><div data-type="button"><div class="app-button app-no-text"><\/div><\/div><\/div>').appendTo(c),h=s.find(".app-button"),vt={w:h.width(),g:parseInt(h.css("margin-left"))},s.remove()),e=parseInt(e)*(vt.w+vt.g)+vt.g):e=parseInt(e)),t[0]._width=e=e<=1&&t[0].width!==1?e:e/o,r+=e):(i++,t[0]._width=null);(n.length>1||f.length>1)&&(u||(t[0]._newRow=!0),t[0]._newCol=!0)});i&&n.forEach(function(n){n[0]._width==null&&(n[0]._width=(1-r)/i)})})}function lt(n,t){return t=t!=null?t*100+"%":"",n.toggleClass("app-full-width",t==="100%"),n.css({width:t,minWidth:t,maxWidth:t})}function oi(n,t){return typeof n=="function"&&(n=n(t)),n}function eu(n,t){var s=n._items,f=t,i=0,r,h=0,e;s.forEach(function(c){var l=c.obj,y=c.html,a,p=l._grid,v=l.darkest?.75:l.dark,k=l._width,w=l._newRow,b=0;if((w||!r&&p)&&(e=!1,f=r=o("app-row").toggleClass("app-collapsed",n.expand&&h>0).appendTo(t),w&&i--)){while(i>=0)b+=s[i--].obj._width;r.css("margin-left",b*100+"%")}l.field&&!e&&(e=!0,h++);l._newCol&&(f=lt(o("app-column"),k).appendTo(r||t));(p||l._label===!1)&&(y=y.replace('<span class="app-label"/>',""));a=l.item=$(y).appendTo(f);p&&(a.toggleClass("app-field-type-numeric",l.field.Type.match(u._numericTypeRegex)!=null),l.tall&&i++);v!=null&&(v===!0&&(v=.5),au(a.find(".app-button"),1-v));tr(l)&&a.find(".app-button").data("obj",l)})}function tt(n,t,i){var u,r,e,f=0;for(u in n)if(du.indexOf(u)===-1&&!u.match(/^_/)&&u!=="alter"&&(r=n[u],typeof r=="function"&&(r=n[u]={expression:r}),r!=null&&typeof r=="object"&&(!r.hidden||r.visible||i===!1)&&(e=t?t(r,u,f++):++f,e===!1)))return;n._propCount==null&&(n._propCount=f)}function ou(t,i,r){var u=t._inDataView,e=u.get_isForm(),f;tt(t,function(o,s){var c=o.field,tt=o.expression,v,it,g,a=o.item,ft=a,b,k,p=o.tooltip,nt,ut;if((c||tt)&&r){var y=tt?tt.apply(r,[r]):r[c.Name],et=y==null,l,ht=o.text!==!1,ot=o._label,st=!nt&&ot===!1,ct=c?c.HtmlEncode:!0,d=a.find(".app-value"),at=a.find(".app-label");et?l=bu:y.getMonth&&rt("ui.smartDates")?(l=n.toSmartDate(y,new Date),d.attr({"data-smart-type":c?c.Type:"DateTime","data-smart-value":JSON.stringify(y),"data-title":c?c.format(y):String.format("{0:"+$app.dateFormatStrings["{0:g}"]+"}",y)})):l=c?c.format(y):y.toString();ct?d.text(l):d.html(l);nt=o._grid;d.toggleClass("app-medium",o.medium===!0||o.mediumValue===!0).toggleClass("app-large",o.large===!0||o.largeValue===!0).toggleClass("app-accent",o.accent===!0||o.accentValue===!0).toggleClass("app-nowrap",!nt&&o.wrap===!1).css("color",oi(o.colorValue,r));ut=o._width;ut&&nt?lt(a.addClass("app-cell").toggleClass("app-nowrap",o.wrap===!1),ut):at.text(ot).toggleClass("app-medium",o.medium===!0||o.mediumLabel===!0).toggleClass("app-large",o.large===!0||o.largeLabel===!0).toggleClass("app-accent",o.accent===!0||o.accentLabel===!0).css("color",oi(o.colorLabel,r));a.toggleClass("app-label-hidden",st).toggleClass("app-null",et).toggleClass("app-medium",o.medium===!0||o.mediumValue===!0||o.mediumLabel===!0).toggleClass("app-large",o.large===!0||o.largeValue===!0||o.largeLabel===!0);(st&&c||p!=null)&&a.attr("data-title",p!=null?p:c.HeaderText);o.density&&a.addClass("app-density-"+o.density);o.align&&a.addClass("app-align-"+o.align);c&&c.Name===">"&&d.attr("data-title",y?ar.Minimize:ar.Maximize);c&&e&&a.css("display",$("#"+t._inDataView._id+' [data-field="'+u._allFields[c.OriginalIndex].Name+'"]').is(":visible")?"":"none")}else ft=v=a.find(".app-button"),it=v.find(".app-text"),g=w(o,"checked"),ht&&(l=o.text),l==null&&(l=s),tr(o)?it.text(l):(f=i[u._id],f||(i[u._id]=f=[]),b=gi(u,h(s),f),b?(v.show().data({obj:o,contextItem:b}),l=b.text,p=b.tooltip,it.text(l)):v.hide()),p==null&&(p=l),k=o.icon||(b?b.icon:null),v.find("i").remove(),k&&n.icon(k,v),v.toggleClass("app-no-icon",k===!1||k==null).toggleClass("app-wide",o.wide===!0),g!==!0&&(typeof g!="function"||!g(r))||n.icon("material-icon-check-circle",v).addClass("app-checked"),o.text===!1&&(v.addClass("app-no-text"),l=null),p!==l&&v.attr("data-title",p);ft.css({backgroundColor:oi(o.colorBackground,r),color:oi(o.color,r)});o.when&&a.css("display",r&&o.when(r)?"":"none")})}function su(n,t){var r=[],u=[],i;return n._lastResult.primaryKey.forEach(function(n){i=t[n.Name];r[n.Index]=i;u.push(i)}),{row:r,key:u}}function hu(t,i,r){t._lastResult=r;var v=t._inDataView,k={},y,c=i.find(".app-container-content").empty(),e,u=r.pageIndex,f=r.pageSize,s=r.totalRowCount,p=t._expanded,h,l,a=r.letters,b=[],d=w(t,"beginsWithLetter");r.list.forEach(function(n,i){n["#"]=u*f+i+1;h=o("app-item app-feedback").appendTo(c).data({id:v._id,obj:n,config:t});eu(t,h);var r=su(t,n);p&&(l=p[r.key.toString()]===!0,n[">"]=l,l||h.addClass("app-collapsed"));fi(n,v);ou(t,k,n);fi(n);y||t._inDataView.rowIsSelected(r.row)&&(y=!0,h.addClass("app-selected"))});f<s&&(e=o("app-row-pager").appendTo(c).data("config",t),n.icon("material-icon-navigate-before",$('<span class="app-btn app-feedback app-prev"/>').appendTo(e).attr("data-title",ai.Previous).toggleClass("app-disabled",!u)),n.icon("material-icon-navigate-next",$('<span class="app-btn app-feedback app-next"/>').appendTo(e).attr("data-title",ai.Next).toggleClass("app-disabled",u===Math.ceil(s/f)-1)),$('<span class="app-info"/>').appendTo(e).html(String.format(ai.ShowingItems,u*f+1,Math.min(s,(u+1)*f),s)));si(c);t.letters&&a&&(a.list.forEach(function(n){b.push('<span title="'+n+'"'+(d===n?' class="app-selected"':"")+">"+n+"<\/span > ")}),i.find(".app-letters").html(b.join("")).data("letters",a))}function si(n){if(n){var r=n.find(".app-selected"),t,i;r.length&&(i=r[0].getBoundingClientRect(),t=n[0].getBoundingClientRect(),(i.top<t.top||i.bottom>t.bottom)&&n.scrollTop(i.top-t.top+n.scrollTop()-(t.height-i.height)/2))}else $(".app-display .app-row-header+.app-container-content").each(function(){si($(this))})}function cu(n,t,i){var f=n._inDataView,e=n.letters,r,s=i==null,o=n.loadOnStart;o===!1&&delete n.loadOnStart;i=i||0;e&&(r=w(n,"beginsWithFilter"));u.execute({from:f,as:"list",pageSize:n._count,pageIndex:i,requiresRowCount:!0,_filter:r?[r]:null,sync:s?f._selectedKey:null,requiresData:o==null,letters:e&&i===0}).then(function(i){hu(n,t,i)})}function lu(n){var i=f.data("config"),r={},u={},o={},t,e;typeof i!="string"&&(t=c.children().last(),t&&(e=t.offset().top),i.forEach(function(n,t){var i=n._inDataView,l=et.length,s=s=f.find('.app-container[data-index="'+t+'"]'),a=i._dataViewFieldOwnerId||i._id,h=u[i._id],c,e;(h==null&&(h=u[a]=$("#"+a+".ui-page-active").length>0||!hi("ontop")),h)&&(!l||et.indexOf(i._id)>=0)&&(iu(n)?(c=n._lastResult,n.loadOnStart!==!1||n.letters?!l&&c?hu(n,s,c):cu(n,s):delete n.loadOnStart):(e=r[i._id],e===undefined&&(e=r[i._id]=i.data()),e=i.commandRow()?e:null,n._hasFields&&s.css("display",e?"":"none"),fi(e,i),ou(n,o,e),fi(e)))}),et.splice(0),e!==t.offset().top&&n!==!1&&ei())}function au(n,t){var i=n.css("background-color").match(/^rgba?\((\d+,\s*\d+,\s*\d+)/);i&&n.css("background-color",typeof t=="number"?"rgba("+i[1]+","+t+")":"rgb("+i[1]+")")}function fr(){c&&c.focus()}function vu(){var t=n.screen();t.isVirtual&&r.css({left:t.left,top:t.top,width:t.width,height:t.height})}function er(i){var f=e.error(),r=f,u,o=t.runOnce;i=r?!1:typeof i=="boolean"?i:!0;t.input.barcode!=null&&(i||(u=t.input.barcode,r=r?u+" > "+r:u));t=null;r!=null&&k(r,!0,f?3e4:null);g(!1);s.barcode(!0);s.barcode().length||(o?(clearTimeout(lr),n.kiosk()?n.kiosk("focus"):lr=setTimeout(s.focus,200,{lastFocused:!0})):ot({runOnce:!0}))}function or(){if(t.error)d()||t.discarding?setTimeout(or,it):er();else{t.index++;var n=(new Date).getTime();n-ci>16?(ci=n,setTimeout(ni,it)):ni()}}function ni(i){var s=u.ifThisThenThat(),h,f,r,o;if(i){if(t&&!s.length)return;if(r=n.dataView(),o=i.id,f=d(),bi(r)!==r&&(ri(!0)?(f=!0,i._notified||(k(ft.Reading,!0,3e4),i._notified=!0)):i.input.barcode&&(k(!1),n.goBack(),f=!0)),r&&r._inlineEditor)if(ri(!0))f=!0;else{r.tag("discard-changes-prompt-none");n.goBack(function(){setTimeout(ni,it,i)});return}if(f){setTimeout(ni,it,i);return}t=i;o&&s.every(function(n,i){return n.id===o&&(t.index=i),t.index==null});t.index==null&&(ci=(new Date).getTime(),t.index=0);g(!0)}else if(!t)return;if(t.context=new nt,t.index<s.length)if(h=s[t.index],h.background||o&&h.id===o){st=$.Deferred();$.when(st).then(er).fail(or);try{h.execute(e,t.context).done(ct).fail(wi)}catch(c){ct(c)}}else or();else er(!1),ot()}function ot(n){n||(n={});var f=n.id||n.input||n.runOnce,i=u.ifThisThenThat._interval,r;n.input||(n.input={});"numpad"in n||(p=sr(p),n.input.numpad=p,String.isNullOrEmpty(p)||(r=parseFloat(p),n.input["numpad.number"]=isNaN(r)?null:r,n.input["numpad.date"]=Date.tryParseFuzzyDate(p),n.input["numpad.time"]=Date.tryParseFuzzyTime(p)));clearTimeout(li);f?li=d()||t?setTimeout(ot,96,n):setTimeout(ni,n.interval||0,n):i&&(n.interval=i,i&&ot(n))}function hf(){var f=u.odp.offline("icon"),r=[],t,i,e;if(n.navContext(r),f)for(t=0;t<r.length;t++)if(i=r[t],i.icon===f){e=!0;break}e?i.callback(i.context):u.alert(at.ODP.SaveAndSync)}function cf(){k("Not supported.")}function lf(){var n=[],t;u.odp.offline()&&(pi.icon=u.odp.offline("icon")||"material-icon-cloud",pi.tooltip=u.odp.offline("tooltip"),n.push(pi));u.host&&n.push(nf);r.find("> .app-btn").each(function(i){var u=$(this),r=n[i];i<n.length?(u.data("btn",r).show().attr("data-title",r.tooltip).find("i").css("transform",r.transform||"").text(r.icon.replace("material-icon-","").replace("-","_")),t=u):u.hide()});t&&r.find(".app-logo").css("right",r.width()-t.offset().left)}function af(){l.one("touchinit.app",function(){v.data("kiosk")&&a("kiosk.enabled",!0);n.kiosk(a("kiosk.enabled"))}).on("pagereadycomplete.app",function(){if(r)if(ii){var i=n.pageInfo();i&&!i.home||t?ht(pt()):l.trigger("ifttt.app")}else ir(""),ii=!0;else ii=!0}).on("barcode.app",function(n){if(!n.isDefaultPrevented()&&u.ifThisThenThat().length)return t?s.barcode().push(n.text):ot({input:{barcode:n.text}}),!1}).on("ifttt.app",function(n,t){var i=n.ifThis||t;ot({id:i,runOnce:i==null});cr=!0}).on("vclick",".app-kiosk .app-avatar",function(){return setTimeout(function(){$(".app-bar-toolbar .app-avatar").trigger("vclick")}),!1}).on("vclick",".app-kiosk .app-btn-context",function(){return setTimeout(function(){$(".app-bar-toolbar .app-btn-context").trigger("vclick")}),!1}).on("vclick",".app-kiosk .app-logo",function(){return setTimeout(function(){$(".app-bar-toolbar .app-btn-menu").trigger("vclick")}),!1}).on("vclick",".app-kiosk .app-login",function(){return n.showAccountManager(null,!0),!1}).on("vclick",".app-kiosk .app-button",function(){var t=$(this);return d()||g()||(n.callWithFeedback(t),setTimeout(yf,0,t)),!1}).on("vclick",".app-kiosk .app-numpad .app-btn, .app-kiosk .app-numpad .app-text i",function(){var t=$(this);return d()||g()||(n.callWithFeedback(t),setTimeout(wf,0,t)),!1}).on("vclick",".app-kiosk .app-item",function(t){var i=$(this),o=$(t.target).closest('[data-name=">"]'),f,u,r,e;return o.length?(f=i.data("config"),u=i.data("obj"),r=!u[">"],u[">"]=r,f._expanded[su(f,u).key.toString()]=r,i.toggleClass("app-collapsed",!r),e=o.find(".app-value"),e.find("i").text("expand_"+(r?"less":"more")),n.toggleTooltip(e,r)):(n.callWithFeedback(i),d()||g()||(i.is(".app-selected")?si(i.parent()):setTimeout(vf,0,i))),!1}).on("vclick",".app-kiosk .app-tabset .app-text",function(){var n=$(this),r=n.parent().find(".app-text"),t=[n.addClass("app-selected")],i=n.prevAll(".app-text"),u=i.length?i.last():n;return r.each(function(i){var r=$(this);r.is(n)?w(u.data("config"),"selectedTab",i):t.push(r.removeClass("app-selected"))}),t.forEach(function(n,t){var i=!n.prev().length;n.data("tab").forEach(function(r,u){var f=i&&!u?n.parent().nextAll():r;f.toggleClass("app-hidden",!!t)})}),ei(),!1}).on("vclick",".app-row-pager .app-btn",function(){var t=$(this);return d()||g()||t.is(".app-disabled")||(n.callWithFeedback(t),setTimeout(pf,0,t)),!1}).on("vclick",".app-kiosk .app-letters span",function(){var r=$(this),u=r.parent(),i=u.data("config"),e=u.data("letters"),n,o=w(i,"beginsWithLetter"),t=i._inDataView,f=e.field;return u.find(".app-selected").removeClass("app-selected"),r.addClass("app-selected"),t&&(n=r.text(),n===o&&(n=null),w(i,"beginsWithFilter",n==null?null:f+":$beginswith$%js%"+JSON.stringify(n)),w(i,"beginsWithLetter",n),t.removeFromFilter(f),n==null?t.sync():t.applyFilter(t.findField(f),"$beginswith$",n)),!1}).on("vclick",".app-kiosk > .app-btn",function(){var n=$(this).data("btn");return setTimeout(n.exec),!1}).on("dataviewrefresh.app datainputbroadcast.app",dt).on("themechanged.app",kt).on("useravatarchanged.app",function(){r&&u.AccountManager.avatar(u.userName(),r.find("> .app-avatar i"))});wu.on("throttledresize",kt)}function vf(n){n.parent().find(".app-item").removeClass("app-selected");n.addClass("app-selected");tu(yt(n.data("id")),n.data("obj"),{},{})}function yu(n){var t;return tt(f.data("config"),function(i){return tt(i,function(i,r){if(r===n)return t=i,!1},!1),t?!1:void 0},!1),t}function yf(n){var r=n.data("obj"),a=n.data("contextItem"),p=r.barcode,u=r.perform,f,e,o,c,i,t,l,v,y;a?a.callback(a.context):(u&&(typeof u=="function"?u(r):(e=u.pick,o=u.show,c=u.hide,e&&(t=b(h({selector:e})),t&&(v=t.Type.match(/^Date/),t=t._dataView._allFields[t.OriginalIndex],(t.ItemsStyle||v)&&(f=!0,s.focus({field:t}),l=$('.ui-page-active [data-field="'+t.Name+'"]'),y=l.find(".app-data-input-button"),v?(l.trigger("vclick"),setTimeout(k,0,r._label||t.HeaderText,!0)):y.length?y.trigger("vclick"):s.methods.lookup.click($.Event("vclick",{target:l})))),f||k("pick: "+e,!0)),!f&&o&&(i=yu(o),i&&!i.visible&&(i.visible=!0,w(r,"checked",c!=null?!0:null),kt(!0),f=!0)),!f&&c&&(i=yu(c),i&&i.visible&&(i.visible=!1,w(r,"checked",o!=null?!1:null),kt(!0),f=!0)))),p!=null&&s.barcode(p))}function pf(n){var r=n.closest(".app-row-pager"),u=n.closest(".app-container"),t=r.data("config"),i=t._lastResult.pageIndex;cu(t,u,n.is(".app-next")?++i:--i)}function wf(n){n=$(n);var f=n.closest(".app-numpad"),i=n.data("key"),e=n.data("test"),t=f.data("text"),u,r,o;t==null&&(t="");u=$.Event("numpadkey.app",{numPad:f,key:i,text:t});l.trigger(u);u.isDefaultPrevented()||(i=u.key,t=u.text,r=t.length,i==="BackSpace"?t.length&&(t=t.substring(0,r-1)):i==="Enter"?r&&(t!==sr(t)?t=sr(t):(s.barcode(t),t="")):i==="PlusMinus"?r<1?t="-":(o=t[r-1],t.match(/\W$/)?t=t.substring(0,r-1)+(o==="+"?"-":"+"):t+="+"):i==="*"?r&&(t.match(/\W$/)?t=t.substring(0,r-1)+"*":t+="*"):i==="abc"||(i==="Clear"?t="":i!=null&&(e==null||yi[e](t))&&(t+=i)),pu(t))}function sr(n){var u=0,f=/((-|\+).+?)(-|\+|$)/,t,e,r,o=/(\*(.+?))(\*|$)/,i;if(!String.isNullOrEmpty(n)&&n.substring(1).match(/(-|\+|\*)/)){for(n.match(/^(-|\+)/)||(n="+"+n),t=n.match(f);t;){for(r=1,t=t[1],n=n.substring(t.length),e=t[0]==="+"?1:-1,t=t.substring(1),t.match(/^\*/)||(t="*"+t),i=t.match(o);i;)i=i[1],t=t.substring(i.length),i=i.substring(1),r*=Number.parseLocale(i),i=t.match(o);u+=e*r;t=n.match(f)}n=u.toString()}return n}function pu(n){n==null&&(n="");p=n.toString();c.find(".app-numpad").data("text",p).find(".app-text").toggleClass("app-null",!p.length).find(".app-value").text(p)}var e,u=$app,n,s,hi,st,t,it=16,ci,v=$("body"),l=$(document),wu=$(window),ti,ii,li,hr,cr,r,f,c,ut,y,lr,at=Web.DataViewResources,ft=at.Mobile,ai=at.Pager,ar=at.Form,bu=at.Data.NullValueInForms,ku=/^(tn|xxs|xs|sm|md|lg|xl|xxl)?(_)?(tn|xxs|xs|sm|md|lg|xl|xxl)?$/,vi=["selector","value","regex","inSelector","inRegex","qualifier","_extended"],du=["as","background","border","hero","icon"],et=[],vt,rt,p,yi=[],gu=0,vr={},yt=u.findDataView,pi={exec:hf},nf={icon:"line_weight",tooltip:"Scan",transform:"rotate(270deg)",exec:cf},yr;standardNumPadButtons=[[{key:"7"},{key:"8"},{key:"9"},{key:"BackSpace",icon:"backspace",dark:!0}],[{key:"4"},{key:"5"},{key:"6"},{key:"PlusMinus",text:String.fromCharCode(177),dark:!0}],[{key:"3"},{key:"2"},{key:"1"},{key:"*",dark:!0}],[{key:"0",width:2},{key:function(){return Sys.CultureInfo.CurrentCulture.numberFormat.NumberDecimalSeparator},test:function(n){return!n.match(/(\.|\.\d+)$/)}},{key:"abc",font:"1em",dark:!0}],[{key:"Enter",icon:"keyboard_return",accent:!0}]];nt.prototype={deferred:function(n,t){var i=this._deferred;if(n&&n.match(/^:/))return n=n.substring(1),i.state()===n;if(n==="resolve")i.resolve(t);else if(n==="reject")i.reject(t);else if(n==="pending")this._deferred=$.Deferred();else return i},_generic:function(n,t,i){var r=this,f=r._andNot,u;return r.deferred(":rejected")||(r=new nt(r),n=h(n,i),u=t(n,r),u&&u.then?r.pending(u):(f&&(u=!u,r._andNot=!1),u?r.deferred("resolve",u):r.deferred("reject",n))),r},pending:function(n){if(arguments.length)this._pending.push(n);else return this._pending},not:function(){var n=this;return n._andNot=!0,n},page:function(n){return this._generic(n,function(n){var i=Web.Menu.currentNode,t=n.identifier,r,f;if(i){if(r=i.title,t)i.url===u.resolveClientUrl(t)&&(f=!0);else if(r!=null)try{f=r.match(n.regex)}catch(e){}}else if(typeof t=="string")return location.pathname===u.resolveClientUrl(t);return f})},controller:function(n){return this._generic(n,function(n){var i,r=n.identifier,t=bt(n);return t&&(i=r?t._controller===r:t.get_view().Label.match(n.regex)),i})},view:function(n){return this._generic(n,function(n){var i,r=n.identifier,t=bt(n),u=n.selector;return t&&(i=r?t._viewId===r:u.match(/^:/)?t.extension().viewStyle().toLowerCase()===u.substring(1).toLowerCase():t.get_view().Label.match(n.regex)),i})},form:function(){return this.view(":form")},list:function(){return this.not().form()},field:function(n){return this._generic(n,function(n){return b(n)})},action:function(n){n=h(n,arguments,2);var t=this._andNot;return this._generic(n,function(n,i){var r=i.deferred();return di(n,r,!1,function(i){var r=gi(i,n);return t&&(r=!r),r==null?!1:r}),r.promise()})},input:function(n,i){return n!=null&&(arguments.length<2?i=n.test:n.test=i),!i||i instanceof RegExp||typeof i=="function"||(i=new RegExp(RegExp.escape(i),"i")),this._generic(n,function(n){var r,u=n.selector,f;if(u==="")for(f in t.input){u=f;break}return t&&(r=t.input[u],i&&(typeof i=="function"?r=i(r):r!=null&&typeof r=="string"&&(r=r.match(i)))),r})},barcode:function(n){var t={selector:"barcode"};return arguments.length>0&&(t.test=n),this.input(t)},display:function(n){return this._generic({},function(){return typeof n=="string"&&(n={id:n}),f!=null&&n===f.data("display")})},reading:function(n){return this.not().editing(n)},editing:function(t){return this._generic(t,function(){var t=n.dataView();return t&&t._id!=="-confirm"&&t.get_isForm()&&t.editing()})},inserting:function(t){return this._generic(t,function(){var t=n.dataView();return t&&t._id!=="-confirm"&&t.get_isForm()&&t.inserting()})},val:function(n,t){var r=this,i;return n!=null&&(arguments.length<2?(i=typeof n=="object"&&"test"in n,t=n.test):(n.test=t,i=!0)),r._generic(n,function(n){var r,u=b(n),f;return u&&(f=u._dataView.data(),r=f[u.Name],i&&(t instanceof RegExp?r!=null&&(r=r.toString().match(t)):t==null?r=r==null:typeof t=="function"?r=t(r):retult=r===t)),r})},row:function(n){var i=this._andNot;return this._generic(n,function(n,r){var f=r.deferred();return di(n,f,!1,function(r,f){var o={},s;if(r){if(o=nu(n,"context:row"),!o)return!1;if(s=t.input[JSON.stringify(o)],s)return s;u.execute({controller:r._controller,view:r._viewId,externalFilter:r.get_externalFilter(),filter:o,odp:!0}).done(function(u){var e=u[r._controller],s=n._extended.mapped?n.qualifier:n.selector,c,h;if(s=s?s+=".":"",e&&e.length){e=e[0];t.input[JSON.stringify(o)]=e;for(c in e)t.input[s+c]=e[c];h=e}i&&(h=!h);h?f.resolve(e):f.reject()}).fail(function(t){e.error("context.row: "+t.get_message()+"\n"+ui(n));ct(!1)})}else e.error("context.row: Data view "+(n.in||"")+" is not found."),wi(!1);return f}),f},arguments)},confirm:function(i){return this._generic(i,function(i,r){function e(n){var t=n.text===s;return setTimeout(function(){t?u.action({path:"form/submit"}):history.go(-1)}),!1}var f=r.deferred(),o=i.selector,s=t.context.barcode().unwrap();s&&(o+="\r\n"+ft.ScanToConfirm);l.on("barcodebefore.app",e);return wt(!0),n.whenPageShown(br),u.confirm(o).then(function(){l.off("barcodebefore.app",e);f.resolve()}).fail(function(){l.off("barcodebefore.app",e);f.reject()}),f})},key:function(n){return typeof n=="string"&&(n={"in":n}),this._generic(n,function(n){var i,r=bt(n),t;return r&&(t=r.get_selectedKey(),t.length&&(i=t.length===1?t[0]:t)),i})},unwrap:function(){var t=this.deferred(),n;return $.when(t).then(function(t){n=t}),n},toString:function(){return this.unwrap()}};e={"if":function(){function h(){t.context._andNot=null;f.resolve()}function e(){f.reject()}for(var n,s,u,r=!0,f=$.Deferred(),i=[],o=0;o<arguments.length;o++)if(n=arguments[o],n instanceof nt)if(n.deferred(":rejected")){r=!1;break}else s=n.pending(),s.length&&(i=i.concat(s));else if(n&&n.promise)i.push(n);else if(typeof n=="function"){if(u=n(),u&&u.promise)i.push(u);else if(!u){r=!1;break}}else if(!n){r=!1;break}return r?i.length?$.when.apply($,i).then(function(){for(var n=0;n<i.length;n++)if(i[n].state()!=="resolved"){r=!1;break}r?h():e()}).fail(function(){e()}):h():e(),f.promise()},resolve:function(){return ct(),$.when(!0)},reject:function(){return wi(),$.when(!0)},discard:function(i){var r=$(".app-ui-automation-root").attr("id");return t.error=i,t.discarding=!0,e._exec(function(i){function u(){var f=n.dataView(),e;f?f._id===r?(dt({dataView:f}),t.discarding=!1,i.resolve()):(e=f._parentDataViewId,e&&dt({dataView:yt(e)}),f.get_isForm()&&f.tag("discard-changes-prompt-none"),n.goBack(u)):i.resolve()}return u(),!1})},notify:function(n,t){return n instanceof nt&&(n=n.unwrap()),typeof n!="object"&&(n={text:n,force:!0,duration:t}),e._exec(function(){k(n)})},_wait:function(n){n.resolve&&(n={deferred:n,attempts:0});var r=n.deferred,i=ri();if(d()||i)i&&!n.notified&&(t.confirmed?t.confirmed=!1:s.barcode().length&&(k(ft.Reading,!0,3e4),n.notified=!0)),n.attempts++,setTimeout(e._wait,it,n);else{n.notified&&k(!1);try{r.resolve()}catch(u){ct(u)}}},_exec:function(n){var i=$.Deferred(),r=arguments.length>1&&arguments[0];return r?di(r,i,!0,arguments[1]):n(i)!==!1&&(t.error?i.reject():setTimeout(e._wait,it,i)),i.promise()},error:function(n){if(arguments.length)typeof n=="object"&&n.message&&(n=n.message+"\n"+n.stack),typeof n=="string"&&(n={error:n}),t&&(t.error=n.error);else return t.error},action:function(n){return n=h(n,arguments,2),e._exec(n,function(t){var i=gi(t,n),r=i&&i.callback;r?r(i.context):e.error('app.action: "'+n.selector+'" is not available in the context'+(n.in?' "'+n.in+'"':"")+".")})},_countBarcodes:function(n){var r=1,t;if(n!=null){for(n instanceof nt&&(n=n.unwrap()),t=s.barcode(),i=0;i<t.length&&t[i++]===n;)r++;t.splice(0,r-1)}return r},inc:function(n,t){n=h(n);var r=b(n),u,i,f=n._method||"inc";if(r)return u=r._dataView.data(),n=r.Name,i=u[n],i==null&&(i=0),i+=e._countBarcodes(t)*(f==="inc"?1:-1),e.val(n,i);e.error("app."+f+": Failed to change "+ui(n))},dec:function(n){return arguments[0]=n=h(n),n._method="dec",e.inc.apply(e,arguments)},val:function(n){return n=h(n,arguments),delete n.in,e._exec(function(t){function y(n,t,i){n.map[t]=i;n.reverseMap[i]=t;a[t]=n}function p(n){s.execute(i);n!==!1&&t.resolve(i)}var o=b(n),c,l,i=[],r=[],a={},v=[],f;if(o){if(l=o._dataView,n._extended.mapped)for(f in n)vi.indexOf(f)<0&&(c=b(h({selector:f})),c?i.push({field:c,value:n[f]}):r.push('"'+f+'"'));else i.push({field:o,value:n.value});if(i.forEach(function(n){n.value instanceof nt&&$.when(n.value.deferred()).done(function(t){n.value=t})}),!r.length){if(l._allFields.forEach(function(n){if(n.ItemsStyle&&n.ItemsDataController){var i={field:n,map:{},reverseMap:{}},r=n.Copy,t,f=u._fieldMapRegex;if(y(i,n.Name,n.ItemsDataValueField),y(i,l._allFields[n.AliasIndex].Name,n.ItemsDataTextField),r)for(t=f.exec(r);t;)y(i,t[1],t[2]),t=f.exec(r)}}),i.forEach(function(n){var r=a[n.field.Name],o,s,h,c={},f,l;r&&!r.pending&&(o=r.field,s=o.ItemsDataController,ItemsDataView=o.ItemsDataView,i.forEach(function(n){a[n.field.Name]===r&&(c[r.map[n.field.Name]]=n.value)}),f={controller:s,filter:c,odp:!0},h&&(f.view=h),l=ui(f),r.pending=u.execute(f).done(function(n){var u=n[s],f;if(u&&u.length)for(f in r.reverseMap)i.push({field:r.reverseMap[f],value:u[0][f]});else e.error("app.val: failed to lookup \n"+l),t.reject(i)}),v.push(r.pending))}),v.length)return $.when.apply($,v).done(p).fail(function(n){i.forEach(function(n){var t=n.field.Name;t&&(n.field=t)});e.error("app.val: failed to lookup - "+n.get_message()+"\n"+ui(i));t.reject(i)}),!1;p(!1)}}else r.push('"'+n.selector+'"');r.length&&e.error("app.val: "+r.join(", ")+" not found.")})},focus:function(n,t){return n=h(n),arguments.length>1?n.message=t:t=n.message,e._exec(function(){var i=b(n);i?(i=i._dataView._allFields[i.OriginalIndex],i.Type!=="DataView"&&wt(!0),s.focus({field:i,message:t}),wt()):e.error("app.focus: field "+n.selector+" not found.")})},confirm:function(i){var r=t.context.barcode().unwrap(),o,f;if(r&&(f=s.barcode(),f.length))for(o=!0;f[0]===r;)f.splice(0,1);return e._exec(function(f){function s(i){var f=i.text===r;return t.confirmed=!0,setTimeout(function(){n.isInTransition()||(f?u.action({path:"form/submit"}):history.go(-1))}),!1}if(o)return!0;if(wt(!0),n.whenPageShown(br),r){l.on("barcodebefore.app",s);i+="\n\n"+ft.ScanToConfirm}return u.confirm(i).then(function(){l.off("barcodebefore.app",s);f.resolve(i)}).fail(function(){l.off("barcodebefore.app",s);e.resolve();f.reject(i)}),!1})},row:function(n){return n=h(n,arguments),e._exec(function(){function a(){s.focus({field:o})}var c=n._extended,u=c.method||"row",v=u==="filter",f=nu(n,u),i,o,h,r;if(!f)return!1;if(h=JSON.stringify(f),r=t.input[h],!r&&v&&(r={}),r){if(i=bt(n),i&&(tu(i,r,f,c),o=i._dataViewFieldName,o))if(i._busy())l.one("dataviewrefresh.app",a);else a();return i}e.error("app."+u+": This method requires a data row in the input.\n Specify 'app.if(context.row("+h+"))' in the activity. Use the same filter when invoking '"+u+"' method.")})},rowFilter:function(n){return n=h(n,arguments),n._extended.method="rowFilter",n._extended.filter=!0,this.row(n)},filter:function(n){return n=h(n,arguments),n._extended.method="filter",n._extended.filter=!0,this.row(n)},input:function(n,i){var u=n,f,e;u==null&&(u={});typeof n!="object"&&(u={},u[n]=i);for(f in u)e=u[f],t.input[f]=e,f==="numpad"&&r&&pu(e)},display:function(t){function i(){u.resolve()}function s(n){e.error("app.display: "+n);u.reject()}var u=$.Deferred(),o,h;return arguments.length?f&&t===f.data("display")?f.is(":visible")?i():f.fadeIn("fast",i):(h=r!=null,a("kiosk.enabled")!==!1?(n.kiosk(!0),f.empty().data("display",t),o=ir(t),h?(f.hide(),f.fadeIn("fast")):(r.hide(),r.fadeIn("fast")),o?s(o):i()):i()):s("Missing display configuration."),u.promise()},page:function(n){function r(f){f.every(function(f){var e=f.title;if(i)f.url===u.resolveClientUrl(i)&&(t=f);else if(e!=null)try{e.match(n.regex)&&(t=f)}catch(o){}return!t&&f.children&&r(f.children),!t})}var i=n.identifier,t;return n=h(n),i=n.identifier,r(Web.Menu.nodes),t&&t.url&&(location.href=t.url),t}};u.display=function(t){function s(){var e=i.scrollTop(),o=u!=null||f!=null&&e>0;uu(t.flow,i,r.empty(),null,n.toWidth(y[ut]));o&&i.scrollTop(e);ei(i,r,!0)}if(arguments.length||(t=[{flow:"row",content:".app-page-content > *"}]),Array.isArray(t))l.one("displayflow.app",function(n){typeof t=="string"&&(t=[{content:t}]);var i=n.page,f=i.find(".app-wrapper"),r={},u={flow:t};yr=i.attr("id");t.forEach(function(n){var f=n.content,t;f!=null&&(n.isContent=!0,f.match(/^(#|\.)[\w-]+/)&&(t=r[f],t==null&&(t=[],i.find(f).remove().each(function(){t.push(this.innerHTML)}),t=r[f]=t.join("")),n.content=t));n.hero&&(u.trackHeight=!0)});f.data("displayFlow",u).find(".app-page-content").addClass("app-display-flow")});else{var i=$(t),r,e,o=n.screen().height,u,f;t=t.data("displayFlow");t&&(e=n.toWidth(i.width()),r=i.find(".app-page-content"),ut=Math.min(y.indexOf(v.data("content-width")||n.settings("ui.content.width")||"xl"),y.indexOf(e)),u=t.breakpoint,f=t.lastHeight,(u!==ut||f!==o)&&(t.breakpoint=ut,t.lastHeight=o,s()))}};u.display.as={code:{render:function(n,t){typeof n=="string"&&(n={type:n});t.addClass("app-render-as-code");var f=t.find("h1,h2,h3,h4,h5,h6").remove(),u=t.find("pre code").first(),r,i=n.type;i&&(i.match(/javascript/i)?i="text/javascript":i.match(/c#|csharp/i)?i="text/x-csharp":i.match(/html/i)&&(i={name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null}]}));r=$("<div/>").appendTo(t.empty());CodeMirror(r[0],{lineNumbers:!0,tabSize:4,matchBrackets:!0,readOnly:!0,mode:i,scrollbarStyle:null,value:u.text().trim()})}}};hi=function(){var p=arguments,t,h,i=p[0],u,e,w,l,y;if(p.length&&a("kiosk.enabled")!==!1)if(u=i,e=typeof u=="number"&&u>0&&u<=1?u:!1,e!==!1&&(u=!0),typeof u=="boolean")i?(r||(ht(!0),w=!0,r=o("app-kiosk").attr("tabindex",0).toggleClass("app-fullscreen",a("kiosk.fullscreen")===!0),vu(),l=a("kiosk.density"),l&&r.addClass("app-density-"+l),y=wr(),y.length?r.insertAfter(y):r.appendTo(v),tf(),v.addClass("app-is-kiosk")),e!==!1&&au(r,e),fr(),cr&&w&&!g()&&ot({runOnce:!0})):r&&(ht(!1),r.remove(),r=null,f=null,c=null,_displayId=null,v.removeClass("app-is-kiosk"),n.resetUI(),$(".ui-page-active .app-wrapper").focus(),s.focus({lastFocused:!0}));else if(typeof i=="string"&&r){if(i==="get")return!ii||v.is(".app-ui-automation:not(.app-ui-automation-system)")?r:null;if(i==="ontop")return pt();i==="focus"?(t=pt(),t||(h=n.pageInfo(),h&&h.home&&(t=!0)),t&&fr()):i==="refresh"&&lf()}return t==null&&(t=r!=null),t};l.on("beforetouchinit.app",function(){n=u.touch;s=u.input;n.kiosk=hi;rt=n.settings;y=n.toWidth();n&&a("enabled")===!0&&af()})})();