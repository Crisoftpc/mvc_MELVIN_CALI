/*!
* Data Aquarium Framework - Touch UI
* Copyright 2008-2020 Code On Time LLC; Licensed MIT; http://codeontime.com/license
*/
(function(){function ui(n){var t=vh.stack,r=vh.activeIndex,i;switch(n){case"length":i=t.length;break;case"list":i=t;break;case"next":i=t[r+1];break;case"prev":i=t[r-1];break;case"index":i=r;break;case"last":i=t[t.length-1];break;case"reduce":t.splice(--vh.activeIndex,1);break;default:i=t[arguments.length?n:r]}return i}function gi(){return $(this).is(":visible")}function od(n){n.trigger("vclick")}function ph(n,t){if(!ru)return ru=!0,t==="forceclose"?n.panel("close",!0):n.panel(t||"toggle"),n}function po(n,t){return ph(n,t?"forceclose":"close")}function ft(){var t=arguments;if(t.length)n.busy(t[0]);else return n.busy()}function sd(){var t=n._menuButton,i=t[0].scrollWidth;i!==t.width()?(o.addClass("app-ensure-font"),setTimeout(sd,16)):o.removeClass("app-ensure-font")}function tf(n){si("focus")||oi({container:n,lastFocused:!0})}function hd(){var n=nt().closest(".app-page-inlineeditor").length;ar().blur();setTimeout(function(){n&&tt.activate();tf()})}function dl(n){var t,r,i,u;n&&(typeof n=="string"?t=n:(t=n.address,r=n.zoom,i=n.api,baseMap=n.type),r||(r=16),i||(i="search"),t=encodeURIComponent(t),u=sr||ny?"http://maps.apple.com/?"+(i==="dir"?"daddr":"q")+"="+t:"https://www.google.com/maps/"+i+"/?api=1&zoom="+r+(i==="dir"?"&destination":"&query")+"="+t,rs("_blank:"+u))}function vy(t){var u=t.config,b=yy(u),e=t.data,s,l=p(t.dataView),f,a,v,y=e.components,i={},k,h,r,o,c,w;for(h in u)h.match(/^_/)||(v=u[h],o=v.field,r=h.toLowerCase(),r in e?(b&&(f=l.findField(o),f._geocode?(a||(a=l.row()),a[f.Index]==null&&(f=null)):f=null),f||(i[o]=e[r])):r.match(/^component/)&&y&&(r=r.substring(9),r in y&&(i[o]=y[r])),s=i[o],!v.trigger||e._reset||s!=null&&(typeof s!="string"||s.length)||(k=!0));b&&"map"in u&&!(u.map.field in e)&&(c=u.map.field,i[c]=null);k?(w=eo,i=c?{}:null,i&&(i[c]=null)):w=t.data.name;i&&fi({dataView:l,values:i,autoFill:!1});t.focus&&tf();t.notify&&n.notify(w)}function yy(n){return!!n._type.match(/^(address|geocode)$/)}function cd(n,t){yy(n)&&"map"in n&&fi({dataView:t,values:[{name:n.map.field}],autoFill:!1})}function ld(t,i,u,f){var l=u._type,e,o="_canceled"in u,s,h,c;if(!u._canceled&&yy(u))if(n.busy())setTimeout(function(){ld(t,i,u,f)},100);else{e={autofill:l};s=t._controller;for(fname in u)fname.match(/^_/)||(h=u[fname],c=i[h.index],e[fname]=c,c==null||h.trigger||(o=!0));u._supported!==!1?r.execute({controller:s,view:t._viewId,command:"AutoFill",trigger:JSON.stringify(e)}).done(function(i){var l=i[s].AutoFill,h=l!=null,c=h?JSON.parse(l):[],a=c.length,e,r;a?a>1||o?(e=[],r=f.find('[data-field="'+u[u._fields[0]].field+'"][data-control="field"]'),c.forEach(function(n){e.push({text:n.name,context:{config:u,dataView:t._id,data:n,focus:!0},callback:vy})}),o&&e.push({},{text:ul.CancelButton,callback:function(){u._canceled=!0}}),pi({anchor:r,arrow:r.length>0,x:r.length?r.offset().left:null,items:e})):vy({config:u,dataView:t,data:c[0],notify:!0}):h?n.notify(eo):(u._supported=h,cd(u,t))}):cd(u,t)}}function ad(n,t){var e=n._autoFill,o=e&&e[t],u,s,f;if(!o&&!e){n._autoFill={};u={};s=new RegExp(rk.source,"g");n._allFields.forEach(function(n){var i=n.Tag,t;if(i)for(t=s.exec(i);t;)t[1]in u||(u[t[1]]=t[3]),t=s.exec(i)});for(f in u){var h=u[f],c=new RegExp(RegExp.escape(f)+"\\-(\\w+)"),i=n._autoFill[f]={_type:h,_fields:[]},r=[];n._allFields.forEach(function(n){var u=n.Tag,o=n.Name,e=u?u.match(c):null,t;e&&(t=e[1],i[t]={field:o,index:n.Index},u.indexOf(f+"-trigger")!==-1&&r.push(t),i._fields.push(t))});r.length||(h==="address"&&"address1"in i?r.push("address1"):h==="geocode"&&("latitude"in i&&r.push("latitude"),"longitude"in i&&r.push("longitude")));r.forEach(function(n){i[n].trigger=!0})}o=n._autoFill[t]}return o}function gl(n,t,i,r,u){var s,h,l;if(n&&n.length){if(s=0,i&&!ot(i).length)if(h=i.prev(),h.is(".dv-item")||h.is(".app-group")&&h.prev().is(".dv-item"))s=v(i,"margin-bottom");else{t.scrollTop(0);return}t||(t=d(n));var c=t.data("sticky-header"),f=n[0].getBoundingClientRect(),e=t[0].getBoundingClientRect(),y=c?c[0].getBoundingClientRect():e,a=Math.max(e.top,c?y.bottom:e.top),o;if(f.bottom+s>e.bottom){if(o=f.bottom+s-e.bottom+4,f.height>e.height){if(f.top<e.bottom)return;o-=f.height-e.height+7}}else f.top<a&&(o=f.top-a-4);o&&(!u||o>f.height*u)&&(l=t.scrollTop()+o,r===!1?wu(t,l):t.scrollTop(l))}}function gut(t){function s(t){n.pageInfo().deleted=!0;o=f.commandRow();f.commandRow(t);f.headerText(t);f.command(t,i.editing()?"Edit":"Select",u._viewId);vi(function(){f.commandRow(o)})}var u=yt(),i,f,o,e;if(u&&u._parentDataViewId&&!ft()&&(i=p(u._parentDataViewId),i&&i._controller===u._controller&&i.get_isGrid()))return f=i.extension(),e={controller:i._controller,view:i._viewId,odp:i._odp,_filter:i._filter,sort:i._sortExpression,requiresAggregates:!1,sync:u.get_selectedKey(),pageSize:3,includeRawResponse:!0},r.execute(e).then(function(n){var u=-1,f=n.rawResponse.Rows;f.forEach(function(n,t){i.rowIsSelected(n)&&(u=t)});u!==-1&&t==="right"&&(u===2?(e.sync=null,e.pageIndex=n.pageIndex+1,e.requiresRowCount=!1,r.execute(e).then(function(n){s(n.rawResponse.Rows[0])})):n.pageSize*n.pageIndex+u<n.totalRowCount-1&&s(f[u+1]))}),!0}function na(){return ei.appName||"Code On Time"}function tr(){return!!i.isVirtual}function nft(){window.webkit?window.webkit.messageHandlers.invoke.postMessage({method:"exit",args:{}}):l.location.href="cloudontime://exit/?{}"}function si(){return n.kiosk.apply(this,arguments)}function vd(n,t,i){var r=!!$(n.relatedTarget).find('[data-layout="form"]').length;return r&&(clearTimeout(ak),t&&(i?ak=setTimeout(t,i):t())),r}function ar(){return $(document.activeElement)}function yd(){return!!l.location.host.match(/^localhost\b/)}function tft(){return!!$(".designer-frame").length}function wo(){return o.is(".designer")}function wh(){var t=l.location.host+"_DevToolsDevice",n;if(arguments.length)r.storage.set(t,JSON.stringify(arguments[0]));else return n=r.storage.get(t),n&&!wo()&&(n=JSON.parse(n)),n||{name:"Responsive"}}function pd(n,t){var i=0;return n[2]<t[2]?i=1:n[2]>t[2]&&(i=-1),i}function wd(n){var t=n.text();return t.length>300&&(t=t.substring(0,300)+"..."),t.match(/</)&&(t=yu(t)),t}function bd(n){var t,i,u,r;t=d(n);i=t.offset();r=n.offset();r.top<i.top?u=-(i.top-r.top+8):r.top+n.outerHeight()>i.top+t.height()&&(u=r.top+n.outerHeight()-(i.top+t.height())+8);u!=null&&t.scrollTop(t.scrollTop()+u)}function ta(n,t){(n||(n=it($(".app-data-input")).data("field"),n))&&(n&&typeof n!="string"&&(n=n.Name),t||(t=y()),t.data("last-focused-field",n))}function kd(n){var i=n.field,u=n.lookupInfo,f=n.row,e=w().dataView,r=t.methods.lookup._rowToValues(i,e,f);r&&yr(function(){w(i._dataView._id).autoFocus=!1;u.change(r)})}function ift(n){yt().extension().executeInContext("New",n.ItemsNewDataView,!0)}function rft(){ir._defaultUseCase="ObjectRef";yt().extension().executeInContext("Select","editForm1",!0)}function ia(n){var i=n.is("iframe"),t=i?n[0].contentDocument.body.innerHTML.trim():n.val();return i&&t.match(/^(\s*(&nbsp;|<\/?(p|br)\/?>)\s*)+$/)&&(t=""),t}function ra(){var t=n.promo(),i,r;return!g||!t.length||!t.is(":visible")?!1:(i=g.offset(),r=t.offset(),!(i.left+g.outerWidth()<r.left||i.left>r.left+t.outerWidth()))}function dd(n){var i=y(),t;return i.is(".app-page-modal")?!1:(t=i.find(".app-bar-footer"),t.find(".app-bar-tabs").is(":visible")&&(!n||n(t)))}function ua(){return y(".app-bar-footer")}function uft(){var n=$(".app-page-modal-root .app-bar-footer");return n.length&&n.css("transform")!=="none"?n:null}function fa(n){var t={transition:"",transform:""};n?n.css(t):ua().css(t)}function py(){var t,b,tt;if(!g){g=$('<div class="app-bar-notify app-hidden"><\/div>').appendTo(o).on("vclick",function(t){function i(){var f=n.promo(),u=g.outerHeight(),e=dd(function(n){return n.css("transform")!=="none"}),o={transition:"transform 200ms ease-in",transform:"translate3d(0,"+u+"px,0)"},i=uft(),s=ra(),c=gt(),h=$(t.target),r=h.is(".ui-btn")?g.data("notify"):null;s&&f.css({transition:"transform 200ms ease-in",transform:"translate3d(0,"+u+"px,0)"});e&&ua().css(o);i&&i.css(o);r&&h.addClass("ui-btn-active");g.data("busy",!0).css({transform:"translate3d(0,"+u+"px,0)"}).one("transitionend",function(){setTimeout(function(){if(g.removeData("busy shown").addClass("app-hidden"),e&&fa(),s&&(f.css({transition:"",transform:""}),c===gt()&&n.promo(!0)),i&&fa(i),r){var t=$.Event(r.buttonEvent);t.notifyData=r;$(document).trigger(t)}})})}return g.is(".app-hidden")||(uu?setTimeout(function(){g.trigger("vclick")},100):i()),hi(),!1});e("ui.notify.transparent")===!0&&g.addClass("app-bar-notify-transparent");$(document).on("notifymore.app",function(n){r.alert(n.notifyData.text)})}if(t=yl[0],g.data("busy")||g.data("shown")&&(!t||t.force!==!0)||uu||!al&&!t.force)setTimeout(py,100);else if(t){var u=t.text,a=t.buttonText||(t.buttonEvent?ki:null),s=t.duration,v,y=n.promo(),it=y.is(":visible"),k=dd(),p,h=i.width>568&&!k||pu()||si(),w=h&&e("ui.notify.location")==="left",l=i.left+(c.left.visible?c.left.width:0),d=g.data("notify"),nt=u===!1;if(yl.splice(0,1),d&&d.text===u&&g.is(":visible")||nt){nt&&g.trigger("vclick");return}g.data({busy:!0,shown:!0,notify:t}).addClass("app-hidden").css("transition-property","none");g.toggleClass("app-bar-notify-center",h).toggleClass("app-bar-notify-left",w).css("left","");it&&n.promo(!0);fa();g.removeClass("app-hidden");u=ls(u).trim();u.length>250&&(u=u.substring(0,250)+"...",t.buttonEvent||(t.buttonEvent="notifymore.app",a=f.More));u=u.replace(/\n\s*/g,"<br/>");b=ur();a?($('<span class="ui-btn"/>').text(a).appendTo(g.empty()),$('<span class="app-text"/>').html(u).appendTo(g)):g.html(u);g.data("timestamp",b).css({bottom:i.bottom+(w?16:0),left:h?w?l+(c.left.visible?-8:16):l+(i.width-g.outerWidth())/2:l>0?l:"",right:h?"":i.right});v=g.outerHeight();g.css({transform:"translate3d(0,"+v+"px,0)",bottom:i.bottom});s==null&&(s="short");s==="short"?s=e("ui.notify.duration.short")||2500:s==="medium"?s=e("ui.notify.duration.medium")||5e3:s==="long"&&(s=e("ui.notify.duration.long")||1e4);typeof s=="string"&&(s=2500);p=ra();tt=gt();setTimeout(function(){p&&y.css({transition:"transform 200ms ease-in",transform:"translate3d(0,-"+v+"px,0)"});k&&wy();g.css({transform:"","transition-property":"transform"}).one("transitionend",function(){g.removeData("busy");g.css("transition-property","");p&&tt===gt()&&(n.promo(!0),y.css({transform:"",transition:""}));setTimeout(function(){g.data("timestamp")===b&&g.trigger("vclick")},s)})},16)}}function wy(n){var t="transform 200ms ease-in",i;g&&g.is(":visible")&&!y().is(".app-page-modal")&&!g.is(".app-bar-notify-center,.app-bar-notify-left")&&(i=ua().css({transition:n?"":t,transform:"translate3d(0,-"+g.outerHeight()+"px,0)"}),n&&i.css("transiton",t))}function by(n){var t=n.sidebar||ga();t.length&&(tr()?t.css({minHeight:i.height,height:i.height,left:i.left,top:i.top}):t.css({minHeight:"",height:"",left:"",top:""}))}function gd(n){var t=n.accountManager||uf();t.length&&(tr()?t.css({left:i.left,top:i.top,right:i.right,bottom:i.bottom}):t.css({left:"",top:"",right:"",bottom:""}))}function ky(t){var u=t.toolbar||(n?n._toolbar:$(".app-bar-tools")),r;i.toolbarHeight||(i.toolbarHeight=u.outerHeight());r=i.toolbarWidth;r&&(r+=pt.divider);tr()?u.css({left:i.left,top:i.top,width:r||i.width}):u.css({left:"",top:"",width:r||""})}function ae(t){var h,r=ou.width(),u=ou.height(),s=wo()?null:e("ui.banner.height"),c,a;t||(tr()?(h=wh(),t={isVirtual:!0,width:h.width||r,height:h.height||u},h.name==="Responsive"&&s&&(t.width=r,t.height=u,i.deviceWidth=i.deviceHeight=null)):t={width:i.width,height:i.height});t.isVirtual==null&&(t.isVirtual=tr());t.width||(t.width=i.width);t.height||(t.height=i.height);var f=$(".app-virtual-screen-bar"),l=i.isVirtual=t.isVirtual,v=t.width==="auto";if(s&&!l&&(l=t.isVirtual=i.isVirtual=!0,t.width=i.deviceWidth=r,t.height=i.deviceHeight=u),l){if(v?(t.width=i.deviceWidth=r-60,t.height=i.deviceHeight=u-60):(i.deviceWidth&&(t.width=i.deviceWidth,t.deviceWidth=null),i.deviceHeight&&(t.height=i.deviceHeight,t.deviceHeight=null),t.width>r&&(i.deviceWidth=t.width,t.width=r-40),t.height>u&&(i.deviceHeight=t.height,t.height=u-40)),i.width=t.width,i.height=t.height,i.physicalWidth=r,i.physicalHeight=u,i.left=Math.ceil((r-t.width)/2),i.top=Math.ceil((u-t.height)/2),i.right=r-i.left-i.width,i.bottom=u-i.top-i.height,s&&(c=$("#app-banner"),c.length||(c=$('<div id="app-banner"><\/div>').appendTo(o)),c.css({left:i.left,top:i.top,width:i.width,height:s,minHeight:s,maxHeight:s}),i.top+=s,i.height-=s),ky(t),!f.length)for(a=0;a<6;a++)$('<div class="app-virtual-screen-bar"><\/div>').appendTo(o);f=$(".app-virtual-screen-bar");s&&r===t.width?f.remove():($(f[0]).css({width:i.left-1,right:"auto"}).addClass("app-left"),$(f[1]).css({width:i.right-1,left:"auto"}).addClass("app-right"),$(f[2]).css({height:i.top-1,bottom:"auto"}).addClass("app-top"),$(f[3]).css({height:i.bottom-1,top:"auto"}).addClass("app-bottom"),$(f[4]).css({width:i.left-1,right:"auto"}).addClass("app-left2"),$(f[5]).css({width:i.right-1,left:"auto"}).addClass("app-right2"));by(t)}else i.width=r,i.height=u,i.physicalWidth=r,i.physicalHeight=u,i.left=0,i.top=0,i.right=0,i.bottom=0,ky(t),f.remove();i.portrait=i.width<i.height;by(t);gd(t);o.toggleClass("app-virtual-screen",tr());g&&g.is(":visible")&&(wi(!1),n.notify(g.addClass("app-hidden").removeData("busy shown").data("notify")));n.indicator("reset")}function e(n,t){var f,o=arguments.length;if(o===1&&(f=wl[n],f!==undefined||n in wl))return f;for(var s=n.split(/\./g),e=s.length,r,i=ei,u=0;u<e;u++)if(r=s[u],o===2)u===e-1?(i[r]=t,wl[n]=t):i=i[r]==null?i[r]={}:i[r];else{if(u===e-1)return f=i[r],wl[n]=f,f;if(i[r]!=null)i=i[r];else if(u<e-1)i[r]={},i=i[r];else return null}}function ct(n){return e(n)!==!1}function ng(n){return n.tagName==="DIV"&&!n.className.match(/app\-drop\-box/)}function tg(n,t,i){return(n.ctrlKey===t.ctrlKey||i&&n.ctrlKey===t.metaKey)&&n.altKey===t.altKey&&n.shiftKey===t.shiftKey&&n.metaKey===t.metaKey}function bo(i,r,u){var l=i.keyCode||i.which,f,e,o,s,c;if(r)for(o=0;o<h.list.length;o++)if(e=h.list[o],e.key&&(f=e.shortcut,f||(f=e.shortcut=ig(e.key,e)),f.which===l&&tg(f,i,e.metaKey)))return i.preventDefault(),i.stopPropagation(),u||h.range("exec",{command:e.command,argument:e.argument,validate:!0}),!0;if(iu.list.length&&!u&&(s=iu.keyCodes.indexOf(l),s!==-1&&(f=iu.list[s],tg(f,i)&&!(f.which===13&&nt().is("iframe,textarea")))))return t.popup(":visible")&&f.shortcut==="Enter"?!1:(c=[],n.navContext(c),$(c).each(function(){var n=this;if(n.shortcut===f.shortcut)return n.inspect||wo()||vf(!0),setTimeout(bu,100,n),!1}),i.preventDefault(),i.stopPropagation(),!0)}function ig(n,t){for(var u,i={shortcut:n,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},e=n.split(/\s*\+\s*/g),f=0;f<e.length;f++)if(u=e[f].toLowerCase(),u.length>1)switch(u){case"ctrl":i.ctrlKey=!0;break;case"alt":i.altKey=!0;break;case"shift":i.shiftKey=!0;break;case"meta":i.metaKey=!0;break;default:i.which=r.keyCode[u];i.which||(i.invalid=!0)}else i.which=t&&t.which!=null?t.which:u.toUpperCase().charCodeAt(0);return iu.cache[n]=i,i}function ve(n,t){var i=$(".app-popup");if(i.length&&(!t||i.is(t)))return i.popup("close",n),!0}function vf(n){var t=$(".ui-panel-open");return t.length?(po(t,n),!0):ve(n)}function dy(n){var t=n.tooltip||n.text,i=n.shortcut;return i&&(t+=" ("+i+")"),t}function ea(n,t){r.AccountManager.avatar(n,t)}function fft(n){yh=ee(n)}function eft(n){var t=$(this),i;yh&&(i=ee(n),yh.y<i.y?(t[0].scrollHeight<t.height()||t.scrollTop()==0)&&n.preventDefault():yh.y>i.y&&(t[0].scrollHeight<t.height()||t.outerHeight()+t.scrollTop()>=t[0].scrollHeight)&&n.preventDefault(),yh=null)}function bh(n,t){var i=n.is(".ui-panel-inner,.app-wrapper")?n:n.find(".ui-panel-inner");if(sr)if(t)i.off("touchstart touchmove");else i.on("touchstart",fft).on("touchmove",eft);i.is(".ui-panel-inner")}function gy(){wi(!1);setTimeout(wi,250)}function wi(n){arguments.length||(n=!0);uu=!n}function oft(n){et.navigate("#"+n);ui().pageUrl=n}function kh(n){n=n.split(/@/g);n=n[0];n=n.split(/\\/g);n=n[n.length>1?1:0];var t=n.replace(/\W/g," ").trim(),i,u="",r;for(t||(t=n),t=t.split(/\b/g),r=0;r<t.length;r++)if(i=t[r],i&&(i=i.trim()),i&&(u+=i.substring(0,1)),u.length===2)break;return u}function sft(n,t){var u,i,f=/(\w+)(\s*=\s*(\w+))?/g,r=n.ContextFields;if(r)for(i=f.exec(r);i;){if(i[1]==t.Name){u=n._dataView.findField(i[3]?i[3]:i[1]);break}i=f.exec(r)}return u}function np(n){return n.match(/^(=|<>|<|>|<=|>=|(\$(between|in|notin|beginswith|doesnotbeginwith|contains|doesnotcontain|endswith|doesnotendwith)))$/)!=null}function ko(n){var i=n._dataView,t=ip(i,n,[]);return t=t.length?JSON.stringify(t):"",n.Name+"_listOfValues_"+t.toLowerCase().replace(/\W+/g,"_")}function tp(n){var t=n._dataView;t.session(n.Name+"_listCache",null);t.sessionRemove(ko(n))}function ip(n,t,i){for(var h=n.get_contextFilter(t,n.extension().collect()),o=0,u,e,y=t.ItemsStyle||"",l=n.editRow(),a,s,c;o<h.length;)if(u=h[o],u.Literal)o++;else{e=sft(t,u);var p=n.findField(e.Name+"_op2"),v=n.findField(e.Name+"_op"),f=null,w;p&&(f=l[p.Index]);f==null&&v&&(f=l[v.Index]);f==null&&(f="=");w=np(f);f.match(/^\$/)&&(f+="$");u.Value==null?v?(h.splice(o,1),f&&!w&&i.push(u.Name+":"+f)):(o++,i.push(u.Name+":=null")):e&&(e.ItemsTargetController||e.ItemsStyle=="CheckBoxList"?(h.splice(o,1),a=r.csv.toArray(u.Value),a.forEach(function(t,i){a[i]=n.convertFieldValueToString(e,t)}),f=="="&&(f="$in$"),i.push(u.Name+":"+f+a.join("$or$"))):(f=="$between$"&&(u.Value2=l[n.findField(e.Name+"_v2").Index],u.Value2==null?f=">=":u.Value>u.Value2&&(u.Value=[u.Value2,u.Value2=u.Value][0])),u.Value=n.convertFieldValueToString(e,u.Value),u.Value2!=null&&(u.Value2=n.convertFieldValueToString(e,u.Value2)),f=="="?(o++,i.push(u.Name+":="+u.Value)):(h.splice(o,1),i.push(u.Name+":"+f+(u.Value!=null?u.Value:"")+(u.Value2!=null?"$and$"+u.Value2:"")))))}return(y.match(/^(AutoComplete|Lookup)$/)&&t.ItemsTargetController||y=="CheckBoxList")&&(s=l[t.Index],s!=null&&(s=r.csv.toArray(s.toString()),s.forEach(function(n,t){s[t]="%js%"+r.serializer.serialize(n)}),i.push(t.Name+":$notin$"+s.join("$or$")))),c=t.Extended,c&&c.filter&&(c.filter.forEach(function(n){var r=n.match(/^(.+?)\:/);r&&r[1]!=t.Name&&i.push(n)}),c.search.forEach(function(n){i.push(n)})),h}function rf(n){var e=n[0],t,r,u=e.className,o=c.left.visible?c.left.width:0,f=c.left.visible?c.right.width:0;return u.match(/\b(app\-wrapper)\b/)?(t=n.closest(".ui-page")[0].className,r=t.match(/\b(app\-page\-modal|app\-has\-panel)\b/)&&t.indexOf("app-page-modal-never")==-1?v(n,"width"):i.width-o-f):r=u.match(/\b(app\-bar\-tools)\b/)?i.width-f:n.outerWidth(),r}function rg(n){return n.ItemsDataController&&n.ItemsNewDataView}function oa(){return i.width>=ti(e("ui.modal.when")||"md")&&i.height>=ti("xs")||rp().length>0}function ug(){return i.width>420&&i.height>=600}function rp(){return $(".app-page-modal-root")}function fg(){return s&&(ar().is(":input")||ou.height()<i.height)}function dh(n,t){t||(t=y().prevAll(".ui-page").first().attr("id"));$(document).one("pagecanceled.app",function(i){if(i.namespace==="app"){var r=gt();t===r||r==="Main"?n():y().prevAll(".ui-page").filter(function(){return $(this).attr("id")===t}).length&&dh(n,t)}})}function vi(n){$(document).one("pagereadycomplete.app",function(){eg(n)})}function eg(n){document.readyState==="complete"?n():setTimeout(eg,32,n)}function yr(n){t.ignoreErrors=!0;n&&typeof n=="function"&&vi(n);rt=!0;bl.go(-1)}function hft(n){var t=n?n.page.find(".app-page-header").filter(function(){return!$(this).is(".app-page-header-fixed")}):null;o.is(".app-page-header-hidden")||n&&n.headerText==!1?wr(!1,t):wr(n&&n.headerText||n&&n.dataView&&n.dataView.get_view().Label||document.title,t)}function dt(){}function og(t){var i=typeof t=="string";n.infoView(p(i?t:t.id),i)}function cft(n,t){n.refresh_token&&r.userName()!=n.name?yv(n.name):st(t,function(){yv(n.name)})}function sa(){return l.location.pathname.match(/\/login(\.aspx|$)/i)}function sg(){function t(){n.showAccountManager(null,!0)}function i(){setTimeout(t,1e3)}if(n._started)t();else{r.AccountManager.count()&&uf(null,"loading");$(document).one("pagereadycomplete.app",ce&&(sr||ny)?i:t)}}function hg(){if(ct("splash.enabled")){if(sessionStorage){if(sessionStorage.spashShown)return;sessionStorage.spashShown=!0}var n=Math.max(1e3,e("splash.duration")||2500)-500;uf(null,"splash");setTimeout(function(){uf().find(".app-acc-close").trigger("vclick")},n)}}function lft(){var i=l.location.href.match(/(\?|&)_accMan=(\w+)/),c=n.returnUrl(),s=kp(".TOKEN"),a=kp(".PROVIDER"),v,e;if(s&&uet(".TOKEN",null,-1),sessionStorage&&(v=sessionStorage.signedOut,sessionStorage.removeItem("signedOut")),!le&&r.AccountManager.enabled()||i){var h=r.AccountManager.list(),t=h._lastUser&&h[h._lastUser],y=!i&&t&&!!t.refresh_token,u=i?i[2]:null,f=u==="loading"||u==="splash",p=u==="list";if(s&&(t={name:a,refresh_token:s,Handler:a},y=!0,f=!1),y||f){if(f&&!t&&(t={UserName:"Test"}),e=[],u!=="splash"&&(e.push({text:t.name,context:t}),e.push({text:vu})),uf(e,u),f)return;r.switchUser(t,function(){var n=o.data("public")?l.location.href:c||nf;i||l.location.replace(n)},function(){ft(!1);t.access_token=null;t.refresh_token=null;r.AccountManager.set(t);sg()})}else(p||c||v)&&!sa()?sg():le||hg()}else le||hg()}function uf(n,t){function a(n,t){t.match(/url\(/)?n.css("background",t):n.css("background-image","url("+t+")");n.css("text-indent","-9999px")}var i=$(".app-acc-man"),s,h,e,c,l,p;if(!arguments.length)return i;if(i.length)i.show().appendTo(o)[0].className="app-acc-man",s=i.find("ul").empty();else{i=$('<div class="app-acc-man"><div class="app-acc-space"><\/div><\/div>').appendTo(o);var u=$('<div class="app-acc-inner"><\/div>').appendTo(i),v=$('<div class="app-logo"><\/div>').appendTo(u).html(na()),y=$('<div class="app-acc-list"><\/div>').appendTo(u);gd({accountManager:i});h=$('<a class="app-acc-close"><i class="material-icon">close<\/i><\/a>').attr("title",ul.Close).prependTo(u);e=ei.splash;e&&(c=e.background,l=e.logo,c&&a(i.find(".app-acc-space"),r.resolveClientUrl(c)),l&&a(v,r.resolveClientUrl(l)));h.on("vclick",function(){st(h,function(){ve();o.removeClass("app-has-acc-man");i.fadeOut(bt)})});s=$("<ul/>").appendTo(y).on("vclick","a",function(n){var u=$(n.target),t=u.closest("a"),e=t.data("context"),i;return u.is(".app-btn-more")?(i=e.context.name,st(u,function(){pi({anchor:u,items:[{text:i,user:i,keepOpen:!0,callback:dt,selected:!0,depth:1},{},{text:cf.LoginButton,icon:"material-icon-arrow-forward",callback:function(){t.trigger("vclick")}},{text:f.Forget,icon:"material-icon-delete",callback:function(){r.AccountManager.remove(i,!0);i==r.userName()&&pv();t.remove()}}]})})):e.callback&&st(t,function(){e.callback(e.context,t)}),!1});p=$('<div class="app-acc-footer"><\/div>').appendTo(u).html($("#PageFooterBar,footer small").html());y.css({top:v.outerHeight(!0)+16,bottom:p.outerHeight(!0)})}o.addClass("app-has-acc-man");t&&t!=="loading"&&t!=="splash"&&!i.is(".app-acc-man-loading")&&i.hide().fadeIn();t&&i.removeClass("app-acc-man-loading app-acc-man-switch").addClass("app-acc-man-"+t);$(n).each(function(){var t=this,h=$("<li/>").appendTo(s),n=$("<a/>").appendTo(h),c=$('<div class="app-user-name"><\/div>').text(t.text).appendTo(n),u=t.context,i=u&&u.name,o,e;t.icon&&vt(t.icon,n);n.data("context",t);i&&(n.addClass("app-avatar"),c.text(i),e=u.Handler||u.email,e&&e!==i&&n.append($('<span class="app-user-email"><\/span>').text(e)),i===r.userName()?n.addClass("app-selected"):u.refresh_token||n.append($('<span class="app-user-signed-out"><\/span>').text(f.SignedOut)),o=$('<i class="app-icon-avatar">'+kh(i)+"<\/i>"),n.prepend(o),ea(i,o),t.callback&&$('<span class="app-icon material-icon app-btn-more"/>').appendTo(n).attr("title",ki));t.callback||n.addClass("app-link-disabled")})}function cg(n,t){n._syncKey=t;n._selectedKey=t}function lg(){return gs>=144}function go(n){n.type!=="taphold"&&(lr=ee(n))}function rr(n){return lr&&lr.x||n}function yf(n){return lr&&lr.y||n}function aft(n){var t=n.find(".ui-popup-arrow-container");return n.outerHeight()+(t.length?t.height()/2:0)+5}function gh(n,t,i){if(n.multiSelect()){var r;if(t||(t=(gt()===n._id?y():ot(n)).find(".app-listview .ui-btn.app-selected"),r=!0),!t.is(".app-checked"))return n._selectedKeyList.length&&rv(n,r),ow(n,t,i),!0}}function ag(n){var t=y(),i=v(t,"width"),r=v(t,"height"),u=v(t,"top"),f=v(n,"width"),e=v(n,"height"),o=v(n,"top");(i!==f||r!==e||u!==o)&&ci(n)}function pu(){return o.is(".app-ui-automation:not(.app-ui-automation-system)")}function up(n){return n.is(".app-page-modal-centered,.app-page-modal-fullscreen,.app-page-modal-fit-content,.app-page-modal-dock,.app-ui-automation-root")||si()}function ha(){return i.width>1200?80:i.width<500?25:35}function fp(n,t){var a,c,r,e,u,h,s,b=ha(),w=[],f=[],l,v,p;if(n||(n=y()),n.is(".app-page-modal")){for(c="#"+n.attr("id"),u=ui("length");u--;u>=0){if(v=ui(u),f.length)if(c=v.hash,c){if(r=$(c),!r.length||!r.is(".app-page-modal"))break}else break;else v.hash===c&&(r=n);r&&(f.push(r),up(r)&&(e=r))}for(l=f.length,e&&(u=f.indexOf(e),u<l-1&&(e=f[u+1])),u=0;u<l;u++){if(r=f[u],u>0)if(e)ag(r.addClass("app-page-modal-revealed"));else{if(t=f[u-1],a=i.physicalWidth-t.offset().left+b,a>i.physicalWidth*1.75||nu(r))break;ag(r.addClass("app-page-modal-partial"));r.css("right",a);s||(s=r)}e&&(p=r.css("width")+","+r.css("height"),l>1&&(w.indexOf(p)===-1?(e!==r&&r.addClass("app-page-modal-centered"),w.push(p)):r.addClass("app-page-modal-obscured")));e===r&&(e=null)}r=f[l-1];r&&nu(r)&&ci(r);h=$(".app-page-modal-glass-pane");h.length||(h=$('<div class="app-page-modal-glass-pane"><\/div>'),o.addClass("app-has-modal-glass-pane"));s&&f.indexOf(s)===1?(h.addClass("app-page-modal-glass-pane-partial").css({right:s.css("right"),top:s.css("top"),height:s.css("height")}).insertAfter(s),o.addClass("app-has-modal-glass-pane-partial")):(h.css({right:0,top:"",height:""}).removeClass("app-page-modal-glass-pane-partial").insertBefore(f[0]),o.removeClass("app-has-modal-glass-pane-partial"));nu(n)&&h.remove();pu()&&h.insertBefore(".app-ui-automation-root")}}function vg(i){var c,s,b,h,k;if(ei){if(ly=!1,wi(),yi(),htt(!1),c=n.pageTransitionCallback,c){n.pageTransitionCallback=null;ft(!1);setTimeout(c);return}ltt();al=!1;var r=i.toPageInfo||w(),l,a=i.options,e=a&&a.fromPage&&a.reverse;r&&r.initCallback&&(r.initCallback(),r.initCallback=null);ft(!1);var u=$(i.toPage),v=u.is(".app-page-modal"),f=$(i.prevPage),p=f.is(".app-page-modal");if(!rt&&r&&(l=r.dataView),u&&f&&u.attr("id")===f.attr("id"))return!1;art(u);ci(u);ui("index")>1&&ui().hash===ui("prev").hash&&ui("reduce");s=n._modalBackground;(!p||nu(f))&&v?(nu(f)||f.addClass("app-page-modal-root"),s||(s=n._modalBackground=$('<div class="app-page-modal-background"><\/div>')),s.insertBefore(u).show(),nu(u)&&s.hide()):p&&(!v||nu(u))&&s&&s.hide();b=l&&l.tagged("modal-background-transparent");o.toggleClass("app-has-modal-background-transparent",b);o.toggleClass("app-has-modal-glass-pane-transparent",b&&p&&u.prevAll(".ui-page").is(".app-page-modal"));$(".app-page-modal-partial").removeClass("app-page-modal-partial").css("right","");$(".app-page-modal-revealed,.app-page-modal-centered,.app-page-modal-obscured").removeClass("app-page-modal-revealed app-page-modal-centered app-page-modal-obscured");v?fp(u,f,e):(u.removeClass("app-page-modal-root"),$(".app-page-modal-glass-pane").remove(),o.removeClass("app-has-modal-glass-pane"));fa();h=r&&r.scrollable||d(u);ff(h.find(".app-listview"));ne(h);df(u);pr(h);fc(h);vp();eu&&!cy&&n._toolbar.css("visibility",gt()==="Main"||y()&&y().is(".app-page-modal")?"hidden":"");hu(r?r.page:null);t.popup("hide");$(document).trigger($.Event("scrollablepageready.app",{scrollable:h}));e=ui("index")<vh.previousIndex;wy(!0);be()!=="slide"||(!f||f.is(".app-transition-none")||!e)&&(u.is(".app-transition-none")||e)?(k=r&&r.dynamic&&!r.delayed,k?(r.delayed=!0,setTimeout(ep,0,r,e)):ep(r,e)):yft(f,u,e,function(){ep(r,e)})}}function ep(t,i){var o=t?t.scrollable:d(),p=$.Event("pageready.app"),w,u,r,h,b,l,a,f,v,c,e;t&&(r=p.dataView=t.dataView,vft(t));ue(100);ft(!1);$(document).trigger(p);is(t?t.dataView:null);bt(!1,0);du(null,null,t?t.scrollable.find(".app-echo"):null);t&&(w=t.autoFocus,t.autoFocus=!0,u=t.calculate,u&&(delete t.calculate,u=r.findField(u),r._raiseCalculate(u,u)));n.garbageCollector();i&&n.syncData(t);h=y();l=h.data("inputExecute");al=!0;i&&(b=n.syncWithOdp(r));l&&(h.removeData("inputExecute"),fi(l));r&&r._inlineEditor&&yc();gu.trigger($.Event("pagereadycomplete.app",{dataView:r,reverse:i,page:h}));b||rt||o&&o.length&&(!ar().closest("[data-control]").length||i)&&(hi(o),s||w===!1||oi({container:o,lastFocused:i===!0}));i&&(a=ui("next"),f=a&&a.hash,f&&f.match(/^#/)&&(v=n.pageInfo(f.substring(1)),v&&($(f).trigger("pagecanceled.app"),c=v.dataView,e=c&&c._survey,e&&e.close&&gu.trigger($.Event(e.close,{dataView:c,survey:e})))))}function yg(n,t){var i=tt.syncKey(n)||n._syncKey,u=r.syncMap[n._controller],f;!i&&n.get_isGrid()&&u&&(f=n._id+"_"+n._viewId,i=u[f]===!0,u[f]=!1);i&&(i===!0?n.sync():(n.sync(i),t&&n.extension().notifyChildren()),n._syncKey=null)}function vft(n){n&&n.home&&!n.tabBar&&(n.tabBar=pg(),nc(n,!0))}function op(){n._tabBar||(n._tabBar=pg(),nc(null,!0))}function pg(){var t=n._tabBarItems,u,i,f,r;if(t||(t=n._tabBarItems=[],items=[],cu(items,!0),$(items).each(function(n){var i=this;if(i.icon&&i.context)t.push(i);else return t.splice(n),!1})),t.length>1&&e("ui.menu.tabbar")!==!1){if(u=n.bar("create",{type:"footer",page:y()}),!u.length)return null;i=$('<div class="app-bar-tabs" data-location="bottom"><\/div>').hide().appendTo(u);f=$("<ul>").appendTo(i);t.forEach(function(n){r=$('<li data-tooltip-location="above">').appendTo(f).data("item",n).css("width",Math.floor(100/t.length)-1+"%");vt(n.icon,r);$("<span/>").appendTo(r).text(n.text);r.attr("title",n.tooltip);var i=n.context.selected;i&&$(n.context.children).each(function(){this.selected&&(i=!1)});i&&r.addClass("app-selected")});i.data("items",i.find("li"))}return i}function wg(){var r=e("ui.menu.tabbar"),u=n._uiSideBarWhen,t=vc();return t&&(u==="Never"?t=!1:u==="Landscape"&&i.width<i.height&&(t=!1)),r===!0||r!==!1&&!c.left.visible&&!t}function nc(t,i){var r=t?t.tabBar:n._tabBar,o,u;if(r&&r.length){if(u=wg(),o=r.is(":visible"),(u&&!o||!u&&o)&&n.bar(u?"show":"hide",r),u&&i){var f,e=r.data("items"),h=e.first().outerWidth(),c=n._tabBarItems.length,s=Math.floor(r.width()/h);r.data("more")&&(r.data("more").remove(),r.removeData("more"),e.show());c>s&&(f=$('<li data-tooltip-location="above" class="app-has-icon">').appendTo(r.find("ul")).attr("title",ki),$('<i class="app-icon material-icon material-icon-more"><\/i>').appendTo(f),r.data("more",f),e.filter(":gt("+(s-2)+")").hide(),$("<span>").appendTo(f).text(ki),e.filter(gi).filter(".app-selected").length||f.addClass("app-selected"))}bg(u)}return u}function bg(n){n==null&&(n=wg());o.toggleClass("app-has-complete-tabbar",n&&fr.Menu.nodeCount===fr.Menu.nodesWithIcons.length)}function nu(n){return n.is(".app-reading-pane-detail")}function kg(){var n=fr.Menu.nodeCountInSidebar;n&&o.toggleClass("app-has-complete-toolbar-in-sidebar",c.left.visible&&fr.Menu.nodeCount===n)}function yft(t,r,u,f){function tt(){a--;a||(w&&w(),a||(f(),wi()))}function it(n,t){n.is(":visible")&&(a++,n.one("transitionend",tt).css(t))}function h(n){w=n.done;n.position();setTimeout(function(){n.transition();setTimeout(function(){$(n.run).each(function(){var n=this,i={};for(var t in n)t!=="element"&&(i[t]=n[t]);it(n.element,i)})},16)},16)}var nt=t.is(".app-page-modal"),g=r.is(".app-page-modal"),y,p,o,c,e=n._backText,w,a=0,b,k,s,d;ft(!0);bt(!0);nt?g?(prevPageIsSlide=t.is(".app-page-modal-partial"),y=up(t)||nu(t),p=up(r)||nu(r),u?y||p?h({position:function(){t.addClass("app-page-revealed").css({opacity:1})},transition:function(){t.addClass("app-transition-fade-out")},run:[{element:t,opacity:0}],done:function(){t.removeClass("app-transition-fade-out app-page-revealed").css({opacity:""})}}):(o=$(".app-page-modal-partial").add(r),c=v(r,"width")+ha(),b=v(t,"left")+c,h({position:function(){t.css("left",b).addClass("app-page-revealed");t.css({transform:"translate3d("+-c+"px,0,0)"});o.css({transform:"translate3d("+-c+"px,0,0)"})},transition:function(){o.addClass("app-transition-slide");t.addClass("app-transition-slide")},run:[{element:t,transform:"translate3d("+(i.physicalWidth-b+ha())+"px,0,0)"},{element:o,transform:""}],done:function(){o.removeClass("app-transition-slide").css({transform:"",transition:""});t.removeClass("app-transition-slide app-page-revealed").css({left:"",transform:"",transition:""})}})):p||y?(k=t.is(".app-page-modal-obscured"),h({position:function(){k&&t.toggleClass("app-page-modal-obscured app-page-modal-centered");r.css({opacity:0})},transition:function(){r.addClass("app-transition-fade-in")},run:[{element:r,opacity:""}],done:function(){r.removeClass("app-transition-fade-in");k&&t.toggleClass("app-page-modal-obscured app-page-modal-centered")}})):(o=$(".app-page-modal-partial").add(r),h({position:function(){c=v(r,"width")+ha();o.css({transform:"translate3d("+c+"px,0,0)"});o=$(o.get().reverse())},transition:function(){o.addClass("app-transition-slide")},run:[{element:o,transform:""}],done:function(){o.removeClass("app-transition-slide").css({transform:"",transition:""})}}))):(s=n._modalBackground,h({position:function(){s.show().css({opacity:1});t.addClass("app-page-revealed").css({opacity:1})},transition:function(){t.addClass("app-transition-fade-out");s.addClass("app-transition-fade-out")},run:[{element:t,opacity:0},{element:s,opacity:0}],done:function(){t.removeClass("app-transition-fade-out app-page-revealed").css({opacity:""});s.hide().removeClass("app-transition-fade-out").css({opacity:""})}})):g?(s=n._modalBackground,h({position:function(){r.css({opacity:0});s.css({opacity:0})},transition:function(){r.addClass("app-transition-fade-in");s.addClass("app-transition-fade-in")},run:[{element:r,opacity:""},{element:s,opacity:""}],done:function(){r.removeClass("app-transition-fade-in");s.removeClass("app-transition-fade-in")}})):t.length?t.is("#Main")&&!l.location.hash?f():(d=v(r,"width"),d>ti("md")?u?h({position:function(){r.addClass("app-transition-slide-background");t.addClass("app-page-revealed").css({transform:"translate3d(0,0,0)","z-index":2,opacity:1});e.css({transform:"translate3d(-"+v(e,"width")+"px,0,0)",opacity:0})},transition:function(){t.addClass("app-transition-slide-peel-out");e.addClass("app-transition-slide-and-reveal")},run:[{element:t,transform:"translate3d(200px,0,0)",opacity:0},{element:e,transform:"",opacity:""}],done:function(){r.removeClass("app-transition-slide-background");t.removeClass("app-transition-slide-peel-out app-page-revealed").css({transform:"","z-index":"",opacity:""});e.removeClass("app-transition-slide-and-reveal")}}):h({position:function(){r.css({transform:"translate3d(200px,0,0)"});t.addClass("app-transition-slide-background app-page-revealed");e.css({transform:"translate3d("+v(e,"width")+"px,0,0)",opacity:0})},transition:function(){r.addClass("app-transition-slide-peel-in");e.addClass("app-transition-slide-and-reveal")},run:[{element:r,transform:""},{element:e,transform:"",opacity:""}],done:function(){t.removeClass("app-transition-slide-background app-page-revealed");r.removeClass("app-transition-slide-peel-in").css({transform:"",transition:"","z-index":""});e.removeClass("app-transition-slide-and-reveal").css({transform:"",opacity:""})}}):h({position:function(){r.css({transform:"translate3d("+(u?-1:1)*d+"px,0,0)","z-index":2});t.addClass("app-page-revealed");e.css({transform:"translate3d("+(u?-1:1)*v(e,"width")+"px,0,0)",opacity:0})},transition:function(){e.addClass("app-transition-slide-and-reveal");t.addClass("app-transition-slide");r.addClass("app-transition-slide2")},run:[{element:r,transform:""},{element:t,transform:"translate3d("+(u?1:-1)*v(t,"width")+"px,0,0)"},{element:e,transform:"",opacity:""}],done:function(){t.removeClass("app-transition-slide app-page-revealed").css({transform:""});r.removeClass("app-transition-slide2").css({transform:"",transition:""});e.removeClass("app-transition-slide-and-reveal").css({transform:"",opacity:""})}})):f()}function dg(n,t){function u(t){if(!c){var r=[];$(n.get_actions("Custom")).each(function(){var t=this;n._isActionMatched(t,!0)&&r.push(t)});r.length&&(t&&i.push('<div data-container="collapsible" data-wrap="false" data-header-text="none">'),i.push('<div data-container="row">'),$(r).each(function(){i.push('<span data-control="action" data-action="'+this.Path+'"><span class="app-control-inner"/><\/span>')}),i.push("<\/div>"),t&&i.push("<\/div>"));c=!0}}var y=n.get_view(),o,i,f=[],s={},h,c,l=[],a=[],v=$.Event("generatelayout.dataview.app",{dataView:n,view:y}),e=n.tagged("clear-all");return($(document).trigger(v),i=v.layout,i)?i:($(n._expressions).each(function(){var n=this,t=n.Scope,i=n.Target;t===2&&l.push(i);t===3&&a.push(i)}),$(n._categories).each(function(n){var u=this,i=u.Wizard,e=!n||u.Flow==="NewRow",r,t;i?h:i=h?"_after_":"_before_";t=s[i];t||(t={text:i,rows:[]},s[i]=t,f.push(t),e=!0);e?(r={categories:[]},t.rows.push(r)):r=t.rows[t.rows.length-1];r.categories.push(u)}),$(f).each(function(){var t=this;$(t.rows).each(function(){var t=this,i=[],r={},u={};$(t.categories).each(function(){var n=this,e=n.Tab,t=r["t_"+e],f,o={id:n.Id,headerText:n.HeaderText,desc:n.Description,collapsed:n.Collapsed,fields:[],floating:n.Floating,wrap:n.Wrap,dataViewCount:0};t?n.Flow==="NewColumn"?(f={categories:[]},t.columns.push(f)):f=t.columns[t.columns.length-1]:(f={categories:[]},t={text:n.Tab,columns:[f]},r["t_"+e]=t,i.push(t));u[n.Index]=o;f.categories.push(o)});$(n._fields).each(function(){var n=this,t=u[n.CategoryIndex];t&&(t.fields.push(n),n.Type==="DataView"&&t.dataViewCount++)});t.tabList=i})}),i=['<div data-layout="form" data-layout-size="'+pf(t)+'">'],$(f).each(function(){var f=this,s=f.text,h=!s.match(/^\_(before|after)\_$/);h&&(i.push('<div data-container="wizard" data-wizard-step="'+r.htmlAttributeEncode(s)+'">'),u(!0));$(f.rows).each(function(){var h=this,s=h.tabList,f=s.length>1;f&&u(!0);f&&i.push('<div data-container="tabset">');$(s).each(function(){var h=this,c=h.columns,s=h.columns.length>1;f&&i.push('<div data-container="tab" data-tab-text="'+r.htmlAttributeEncode(h.text)+'">');$(c).each(function(){var r=this,h=100/c.length-1,v=s?t*h/100:t;s&&v<=ti("tn")&&(s=!1);s&&(u(!0),i.push('<div data-container="column" style="width:'+h+'%">'));$(r.categories).each(function(){var h=this,k=h.desc,d=' data-visibility="c:'+h.id+'"',y=f&&r.categories.length===1&&h.dataViewCount===h.fields.length,g=k&&k.replace(/\{([\w+\_]+)\}/g,'<span data-control="field" data-field="$1" data-read-only="true"><span class="app-control-inner">&#160;<\/span><\/span>'),tt=g&&n._formatViewText(fk.DefaultCategoryDescriptions[g],!0,g),w=h.wrap===!0||(s?v:t)<=ti("xs")&&h.wrap!==!1,nt=l.indexOf(h.id)!==-1;y?h.dataViewCount>1&&i.push('<div data-container="simple"'+(nt?d:"")+">"):i.push('<div data-category="'+h.id+'" data-container="collapsible" data-wrap="'+(w?"true":"false")+'" data-header-text="'+(h.headerText||"none")+'"'+(h.collapsed?'data-collapsed="true" ':"")+(nt?d:"")+(e?' class="app-has-clear-all'+(n._showClearAll?" app-form-clear-all-visible":"")+'"':"")+">");u();k&&(y||i.push('<div data-container="row">'),i.push('<div data-control="description"><span class="app-control-inner">'+tt+"<\/span><\/div>"),y||i.push("<\/div>"));var b=[],p=[],c=1;$(h.fields).each(function(){var n=this;n.Type==="DataView"?(p.length&&b.push(p),b.push([n]),p=[]):p.push(n)});!s&&h.floating&&(h.wrap?(ti("sm")<=t&&(c=2),ti("md")<=t&&(c=3),ti("lg")<=t&&(c=4)):(ti("md")<=t&&(c=2),ti("lg")<=t&&(c=3)),c=Math.min(c,h.fields.length));p.length&&b.push(p);$(b).each(function(){for(var r,f,t,v=this,g=v.length,p=Math.ceil(g/c),h=0;h<p;h++){for(y?i.push('<div data-container="simple"'):i.push('<div data-container="row"'+(c>1?' data-columns="'+c+'"':"")),r=[],f=0;f<c;f++)if(t=v[h+f*p],t){var b=t.Type==="DataView",u=t.Name,k=t.HeaderText,l=a.indexOf(u)!==-1,s=l?' data-visibility="f:'+u+'"':"";y?l?i.push(s):nt&&i.push(d):c===1&&l&&i.push(s);w&&c>1&&r.push('<span class="app-field-group">');b||w&&(!k||k==="&nbsp;")||r.push('<span data-control="label" data-field="'+u+'"'+(c>1?s:"")+'><span class="app-control-inner">'+u+"<\/span><\/span>");r.push('<span data-control="'+(b?"dataview":"field")+'" data-field="'+u+'"'+(c>1?s:"")+(t.is("focus-auto")?' data-focus="true"':"")+'><span class="app-control-inner">['+u+"]<\/span><\/span>");w&&c>1&&r.push("<\/span>");o||(o=t)}i.push(">");e&&(e=!1,i.push('<i class="material-icon app-form-clear-all" title="'+rh+'">clear<\/i>'),n._showClearAll=!0);$(r).each(function(){i.push(this)});i.push("<\/div>")}});y?h.dataViewCount>1&&i.push("<\/div>"):i.push("<\/div>")});s&&i.push("<\/div>")});f&&i.push("<\/div>")});f&&i.push("<\/div>")});h&&i.push("<\/div>")}),i.push("<\/div>"),i=i.join("\r\n"))}function pf(n){return n>=1366?"xxl":n>=1200?"xl":n>=992?"lg":n>=768?"md":n>=576?"sm":n>=480?"xs":n>=320?"xxs":"tn"}function pft(n){var t=fu.indexOf(n);return t===-1?i.width:ti(fu[Math.min(fu.length-1,t+1)])-1}function ti(n){switch(n){case"tn":return 280;case"xxs":return 320;case"xs":return 480;case"sm":return 576;case"md":return 768;case"lg":return 992;case"xl":return 1200;case"xxl":return 1366;default:return i.width}}function gg(n,t){var h=pf(t),c=n._controller+"_"+n._viewId+"_"+n._filterFields+"_layout_"+h+(oa(n)?"_m":""),u,l=$.Event("createlayout.dataview.app",{dataView:n,view:n._viewId}),e=n.survey(),f,i,o,s,a,v;return $(document).trigger(l),u=l.layout,u=u?{html:u}:r.cache[c],u||(f=n.get_view().Layout,f&&(o=$("<div>"+f+"<\/div>"),s=o.find("[data-layout]"),s.length?(v=fu.indexOf(h),s.each(function(){var t=$(this),r=t.attr("data-layout-size")||"tn",n=fu.indexOf(r);n!=-1&&n<=v&&(!i||n>a)&&(i=t,a=n)})):(i=$('<div data-layout="form"><\/div>'),$(o.html()).appendTo(i))),i?(i.find("[data-control]").each(function(){var n=$(this),t=n.contents().remove();t.appendTo($('<span class="app-control-inner"/>').appendTo(n))}),f=$("<div><\/div>").append(i.clone()).html()):f=dg(n,t),u={html:f},e&&(e.dynamic||!e.cache)||(r.cache[c]=u)),i=$(u.html),i.attr("data-input-container",n._id),n._isWizard=i.find('[data-container="wizard"]').length>0,i}function nn(n,i,r){function s(n,t,i){if(n.getAttribute){var v=n.getAttribute("data-control"),l=!v&&n.getAttribute("data-container"),a,y=n.childNodes,o,r;for(v&&t?(f.push(n),o=$(n),offset=o.offset(),r={self:o,parent:i,type:v,children:[]},c.push(r),i.children.push(r),o.data("node",r)):l&&(u.push(n),o=$(n),r={self:o,children:[],type:l},o.data("node",r),h.push(r),t?(r.parent=i,i.children.push(r)):e.push(r)),a=0;a<y.length;a++)s(y[a],l?n:t,l?r:i,null)}}var u=[],h=[],f=[],c=[],e=[],l=n.extension(),o=l.editing();r.data("prepared",!0);r.find("[data-visible-when]").each(function(t){var i=$(this),r=n._expressions,e=i.attr("data-visible-when"),u=i.parent().is('[data-container="wizard"]'),f={Scope:u?2:7,Target:t,Test:e,Type:1,ViewId:n._viewId};r||(r=n._expressions=[]);r.push(f);i.attr({"data-visible-when":null,"data-visibility":(u?"c:":"v:")+f.Target})});t.evaluate({dataView:n,row:i,container:r,ignoreDynamicButtons:!0});s(r[0]);u=$(u);f=$(f);r.data("rootNodes",e).attr("data-state",o?"write":"read");tn(n,i,o,e)}function tn(t,i,r,u){$(u).each(function(u){var f=this,e=f.self,o,h,v,c,l,a;!f.ready&&e.is(":visible")&&(f.ready=!0,f.type==="tabset"?(o=[],$(f.children).each(function(){var n=this;n.type==="tab"&&o.push({text:n.self.attr("data-tab-text"),content:n.self,context:n})}),o.length&&(f.tabs=o,n.tabs("create",{id:t._id+"_tabset_"+u,tabs:o,className:"app-tabs-layout",scope:t.get_selectedKey(),change:function(n){var i=n.content;tc({dataView:t,controls:n.context.children});br(null,i);lrt(i);!t.editing()||s||rt||oi({container:i})}}),$(o).each(function(){var n=this;if(n.active)return tc({dataView:t,row:i,editing:r,controls:n.context.children}),!1}))):(f.type==="collapsible"&&(h=e.attr("data-header-text"),a=e.attr("data-collapsed")==="true",h&&h!=="none"&&(v=e.contents(),c=$('<div data-container="toggle" class="app-feedback"><\/div>'),l=$('<div data-container="simple"><\/div>)'),v.appendTo(l),$('<span class="app-collapsible-toggle-text"/>').appendTo(c).text(h),$('<span class="app-collapsible-toggle-button"/>').appendTo(c).attr("data-title",a?uh:el),c.appendTo(e),l.appendTo(e),a&&e.addClass("app-container-collapsed"))),sp(t,i,r,f.children)))})}function sp(n,i,r,u){$(u).each(function(){var v=this,f=v.self,c,l,h,u,a,ut,g,it,rt,ct,ft,et,k,lt,at,ot,vt;if(v.children.length)tn(n,i,r,[v]);else{if(v.ready||!f.is(":visible"))return;if(v.ready=!0,h=f.attr("data-field"),c=v.type,h){if(l=f.find(".app-control-inner"),u=n.findField(h),u)if(u.AllowNulls||f.attr("data-required",!0),c==="label"||c==="header")u=n._allFields[u.AliasIndex],a=u.HeaderText,l.html(a),a&&a!=="&nbsp;"||f.attr("data-required",null);else if(c==="footer")ut=u.FooterText,ut?l.html(ut):f.addClass("app-hidden");else if(f.addClass("app-field-"+u.Name),c==="dataview"){if(u.Type==="DataView"&&u.DataViewController)if(n.extension().inserting()&&!n.odp)f.hide(),f.parent().is('[data-container="row"]')&&f.parent().hide();else{h=u.Name;var y=n.get_parentDataView(n),o=n._id+"_"+h,s,yt=0,nt,st=u.DataViewFilterFields,e,ht=i[u.Index],b,tt;for(y._controller!==n._controller&&(y=n),a=u.HeaderText,b=n._dataViewFields,b||(b=n._dataViewFields={}),b[h]?o+=b[h]++:b[h]=1,s=p(o);s&&s._dataViewFieldParentId!==y._id;)o=y._id+"_"+h+yt++,s=p(o);v.dataView=o;f.empty().attr("id",o+"_ph").attr("data-input","dataview");s?s._startPage=ht:(e={id:o,controller:u.DataViewController,viewId:u.DataViewId,filterFields:u.DataViewFilterFields,baseUrl:nf,servicePath:kl,showSearchBar:!0,autoHide:st?2:null,tag:u.Tag},e.startPage=ht,st&&(e.filterSource=n._id,u.DataViewFilterSource&&(g=n.findField(u.DataViewFilterSource),it=g._detailDataViews,g&&(e.filterSource=g._dataViewId,it||(it=g._detailDataViews=[]),it.push(o),rt=n._expressions,rt||(n._expressions=rt=[]),rt.every(function(t){return t.Scope===3&&t.Target===h&&t.ViewId===n._viewId&&(t._visChanged=!1,ct=t),!ct}),f.closest('[data-visibility="f:'+h+'"]').hide()))),e.showInSummary=!!u.DataViewShowInSummary,u.DataViewPageSize&&(e.pageSize=u.DataViewPageSize),e.selectionMode=u.DataViewMultiSelect?"Multiple":"Single",u.DataViewShowActionButtons&&(e.showActionButtons=u.DataViewShowActionButtons),e.showActionBar=u.DataViewShowActionBar!==!1,e.showDescription=u.DataViewShowDescription!==!1,e.showViewSelector=u.DataViewShowViewSelector!==!1,e.showSearchBar=u.DataViewShowSearchBar!==!1,e.showQuickFind=u.DataViewShowQuickFind!==!1,e.showRowNumber=!!u.DataViewShowRowNumber,u.DataViewShowPager&&(e.showPager=u.DataViewShowPager),e.showPageSize=u.DataViewShowPageSize!==!1,e.showModalForms=!!u.DataViewShowModalForms,e.searchOnStart=!!u.DataViewSearchOnStart,e.autoSelectFirstRow=!!u.DataViewAutoSelectFirstRow,e.autoHighlightFirstRow=!!u.DataViewAutoHighlightFirstRow,s=$create(ir,e,null,null,$("<p>")[0]),s._dataViewFieldName=h,u._dataViewId=o,s._dataViewFieldParentId=y._id,s._dataViewFieldOwnerId=u._dataView._id,s._filterSourceSelected(y),nt=w(o),nt.text=a,nt.headerText=a,nt.activator.text=a);ft=d(f);tt=ft.find('[data-for="'+o+'"]');tt.length||(tt=lw(o,ft).addClass("app-echo-embedded"));tt.width(f.width());s.get_startPage()&&(s._loadPage(),su(o))}}else c==="field"&&(u.ToolTip&&f.attr("title",u.ToolTip),t.render({container:f,inner:l,dataView:n,field:u,row:i,editing:r}))}else c==="description"?f.closest("[data-container]").addClass("app-has-description"):c==="action"&&(l=f.find(".app-control-inner"),et=f.attr("data-action"),k=n.findAction(et),k?(lt=$('<span class="app-action-column-button"/>').appendTo(l.empty().addClass("app-action-column")).text(k.HeaderText),ot=k.Description,ot&&lt.attr("title",ot),at=k&&n._isActionAvailable(k),at||f.addClass("app-disabled")):(vt=et+": "+l.text(),$('<span class="app-action-column-button"/>').appendTo(l.empty().addClass("app-action-column")).text(vt),f.addClass("app-disabled")))}})}function rn(n,i,r,u){$(u).each(function(){var u=this,f=u.self,e;if(!u.ready)if(f.is(":visible"))sp(n,i,r,[u]);else return!1;u.children.length?rn(n,i,r,u.children):u.ready&&u.dirty&&f.is(":visible")&&(e=t.elementToField(f),t.render({container:f,dataView:n,field:e,editing:r,row:i}),u.dirty=!1)})}function tc(n){var t=n.dataView,r=n.row,u=n.editing,i=n.controls;i&&i.length&&(t||(t=p($(i[0].self).closest("[data-input-container]").attr("data-input-container"))),r||(r=t.editRow()),u==null&&(u=t.editing()),sp(t,r,u,i),rn(t,r,u,i))}function pr(n,t){var e;if(t){clearTimeout(l._syncEmbeddedViewsTimeout);l._syncEmbeddedViewsTimeout=setTimeout(pr,0,n);return}n||(n=d());var r=[],u=ts(n),o=n.offset(),i,f;n.find('[data-control="dataview"]').each(function(){var t=$(this),u=t.data("node"),n=ot(u.dataView),i=v(n,"height")+v(n,"margin-top")+v(n,"margin-bottom")+v(n,"padding-top")+v(n,"padding-bottom");n.length&&i&&(i!==v(t,"height")&&t.height(i),r.push({p:t,e:n}))});$(r).each(function(){var t=this,s=t.p,r,h=s.width();h?(i==null&&(i=n.scrollTop(),f=u.length?u.offset().left:0),r=s.offset(),t.e.css("display")==="none"&&(e=!0,t.e.css("display","")),t.e.css({visibility:"",left:r.left-f,top:Math.round(r.top+i-o.top),width:h})):t.e.css({visibility:"hidden",left:-2e4,top:0})});e&&(ne(n),du())}function wft(n,t){for(var i=t.parent().hide().next();i.length&&!i.is(":visible");)i=i.show().next()}function ca(){return $("<style/>").appendTo($("head"))}function hp(n){return n._enumerateExpressions(fr.DynamicExpressionType.Any,fr.DynamicExpressionScope.ViewRowStyle,n.get_viewId())}function ns(n,t,i,r){var f,u;r||(r=hp(n));r&&r.length&&(f=n._evaluateJavaScriptExpressions(r,t,!0),i&&(u=[],$(r).each(function(){var n=this;n.Scope===1&&u.push(n.Result)}),u=u.join(" "),i.removeClass(u),f&&i.addClass(f)))}function la(n){var t=n.pageProp("frozenField");return!t&&n._hasKey()&&(t="_first_"),t||"_none_"}function aa(n){return n||(n=y()),n.find(".dv-heading")}function un(n){aa(n).remove()}function cp(n){var t=n.replace(/\.\w+$/,"").replace(/\W/g,"_").toLowerCase()||"page";return t.match(/^\_/)&&(t=t.substring(1)),t}function ic(){var n=i.width,t=i.height;return n<480&&t<640||t<480&&n<640}function wf(n){w(typeof n=="string"?n:n._id).echoChanged=!0}function it(n,i){return t.of(n,i)}function lp(){t.methods.lookup._hidePopup()}function d(n){var t;return n?typeof n=="string"?(n.match(/^\w/)&&(n="#"+n),$(n).find(".app-wrapper")):n.length&&n[0].className.indexOf("ui-page")!==-1?n.find(".app-wrapper"):(t=n.closest(".app-wrapper"),t.length||(t=d()),t):(t=y(".app-wrapper"),t?t:$())}function ts(n){return n?n.closest(".ui-page"):y()}function va(n){return n=n?$(n).closest(".app-wrapper"):ts(),n.find('.app-focus[data-input="dataview"]')}function fn(n){return p(n._filterSource)}function ot(n){var t,i;return typeof n=="string"?(n.match(/_ph$/)&&(n=n.substring(0,n.length-3)),n.match(/_echo$/)||(n+="_echo"),t=$("#"+n)):n!=null&&n._controller?(i=w(n),t=i.echo,t||(t=ot(i.id))):n!=null&&n._dataViewId?t=ot(n._dataViewId):(n=$(n),t=n.data("control")==="dataview"?ot(n.attr("id")):$(n).closest(".app-echo")),t}function hi(n){var t=ar().closest(".app-wrapper");return n=d(n),si("focus")||!n.length||t.length&&t[0]===n[0]||n.focus(),n}function ap(){var n=l.location.href,t=n.indexOf("#");t>=0&&(n=n.substr(0,t));l.location.reload(n)}function ye(){if(!yo){var n=e("ui.displayDensity.value");yo=16;n==="Compact"?yo=14:(n==="Condensed"||n==="Tiny")&&(yo=12)}return yo}function bft(t){var i=$(this),u,f=i.is(".app-bar-toolbar")?8:4,r=rr(t.clientX),e=yf(t.clientY);return i.find(".ui-btn-icon-notext").each(function(){var t=$(this),i,u,f;if(t.is(":visible")&&(t.is(".ui-icon-bars")?(i=0,u=v(n._backText,"left")):(i=t.offset().left,u=i+t.outerWidth()+8,i-=8),i<=r&&r<=u))return setTimeout(function(){t.trigger("vclick")}),f=!0,!1}),hi(),u}function wu(n,t){function r(){n.removeData("scrolling enableScrollEventsTimeout");gf(n)}n.data("scrolling",!0);n.scrollTop(t);var i=n.data("enableScrollEventsTimeout");i!=null&&clearTimeout(i);n.data("enableScrollEventsTimeout",setTimeout(r,300))}function pe(n,t){t||(t=ot(n));t.length&&t.find(".app-echo-toolbar .app-echo-controls").addClass("app-stale");var i=gt();clearTimeout(l._refreshEchoToolbar);l._refreshEchoToolbar=setTimeout(function(){i!==gt()||ft()||rt||du()},500)}function en(n){return!n&&ic()?ei.pageTransition!=="none"?"slideup":"none":s?"fade":"none"}function ya(n){return n&&typeof n=="string"&&n.match(iy)}function vt(n,t){var i=n.match(iy),r,u;return i?(r=i[1],u=r==="material-icon",$('<i class="app-icon '+r+" "+i[0]+'" aria-hidden="true">'+(u?i[2].replace(/-/g,"_"):"")+"<\/i>").appendTo(t.addClass("app-has-icon app-has-"+r))):null}function on(){return $(".ui-panel-open .ui-btn.app-animated")}function sn(){return $(".ui-popup-active .ui-btn.app-animated")}function hn(n){r.search("show",n.dataViewId)}function cn(n){$(n).find(".app-signature").each(function(){r.upload("resize",{container:this})})}function ln(n){var t=n.find(".Current"),i,r;t.length&&(r=n.offset(),i=t.offset(),n.scrollLeft(i.left-r.left-t.outerWidth(!0)/2))}function bf(n,t){function e(n){var t,r=i.steps[n];return r.isDynamic&&(t=!0,$(i.containers[n]).children().each(function(){var n=this;if(n.style.display!=="none")return t=!1,!1})),!t}function o(n,t){for(t==null&&(t=i.active),t+=n;t>=0&&t<i.steps.length;)if(e(t))break;else t+=n;return t}function k(n){$(i.steps).each(function(t){var r=this;r.text===n&&e(t)&&(i.active=t,l())})}function h(n,t){var t=o(n,t);return t>=0&&t<i.steps.length}function c(){ri();i.containers.removeClass("app-wizard-active");var n=i.active,t;n!==-1&&(t=$(i.containers[n]).addClass("app-wizard-active"),tc({controls:t.data("node").children}),br())}function l(){c();a();s||oi({container:$(i.containers[i.active])})}function a(){var n=u.closest(".ui-content"),t,i;n.length||(n=u.find(".ui-content"));t=n.find('[data-action-path="wizard-next"]');i=n.find('[data-action-path="wizard-prev"]');t.toggleClass("app-btn-disabled",!h(1));i.toggleClass("app-btn-disabled",!h(-1));b()}function b(){var e=r.closest(".ui-page"),t=e.find(".app-status-bar"),n,u,f,o;t.length&&(n=p(e.attr("id")),n._statusBarAuto&&(u=[n._controller+"."+n._viewId+"._wizard:"+i.active+"\n"],$(i.steps).each(function(n){var r=this,t,f=r.text;r.isDynamic&&(t=!0,$(i.containers[n]).children().each(function(){if(this.style.display!=="none")return t=!1,!1}));t||u.push((n===i.active?"["+f+"]":f)+" >")}),n._statusBarAuto=u.join("")),t.html(n.statusBar()),f=t.find("li.Segment"),o=f.length+10,f.each(function(n){this.style.zIndex=o-n}),ln(t))}var u,r,i,v,w,f;if(t||(t={}),u=t.container||y(),r=t.layout||u,r.is("[data-layout]")||(r=r.find("[data-layout]"),!r.length&&u&&(r=u.closest("[data-layout]"))),i=r.data("wizard-config"),i||(i={steps:[],active:0},i.containers=r.find('[data-container="wizard"]').each(function(){var n=$(this),t={text:n.attr("data-wizard-step"),isDynamic:n.find("> [data-visibility]").length>0};i.steps.push(t)}),r.data("wizard-config",i)),i.steps.length)switch(n){case"start":i.active=h(1,-1)?0:-1;c();b();break;case"status":a();break;case"select":k(t.text);break;case"next":v=o(1);v!==-1&&(i.active=v,l());break;case"prev":w=o(-1);w!==-1&&(i.active=w,l());break;case"visible":if(t.step)return t.step.is(".app-wizard-active")?!0:(f=t.step.prevAll('[data-container="wizard"]').length,e(f));break;case"show":t.step&&!t.step.is(".app-wizard-active")&&(f=t.step.prevAll('[data-container="wizard"]').length,f!==i.active&&e(f)&&(i.active=f,c(),a()))}}function is(t,r){function k(){var r=i.left,n=i.splitBottom,t=9;n&&(n+=pt.divider+t);h.css({left:o?c.left.visible?c.left.width+f:f:"auto",right:o?"auto":r+(c.right.visible?c.right.width+f:f)+(i.splitRight?i.splitRight+pt.divider:0),bottom:tr()?i.bottom+(n||t):n||""})}if(e("ui.actions.promote")){var h=n.promo(),b,l,a,v,u,s,o,p,f;t||(t=yt());t&&(b=t._id);t&&(l=t.extension().viewStyle(),a=!0,o=l==="Map",a&&r==null&&(r=y(".app-listview .ui-li-has-thumb").length>0),l!=="Map"&&(a&&r||t.get_showMultipleSelection()||t.inlineEditing()||!oet())&&(o=!1));h=n.promo();p=h.outerWidth();f=Math.floor(p/3);v=w(b);v?(u=v.page,u&&(u.is(".app-page-modal")?(s=u.offset(),u.is(".app-page-modal-fullscreen")||u.find(".app-listview.app-grid").length?h.css({left:o?s.left+f:"auto",right:o?"auto":i.physicalWidth-(s.left+u.outerWidth())+f,bottom:i.physicalHeight-(s.top+u.outerHeight()-f),"margin-bottom":0}):h.css({left:o?s.left+f:"auto",right:o?"auto":i.physicalWidth-(s.left+u.outerWidth())+f,bottom:i.physicalHeight-(s.top+u.outerHeight()+Math.ceil(p/2)),"margin-bottom":0})):k())):k()}}function vp(t){var r=n._title;(r.data("screen-width")!==i.width||t)&&r.data("screen-width",i.width).css("marginLeft",c.left.visible?c.left.width:n._logo.offset().left+n._logo.outerWidth())}function an(){var n=c.left.inner;c.left.width=n.css("width","").outerWidth();ht.width&&n.css({"overflow-y":"scroll",width:c.left.width-ht.width+2})}function pa(t){function a(){c.left.mini&&!r.match(/\bapp\-has\-minisidebar\-left\b/)?o.addClass("app-has-minisidebar-left"):!c.left.mini&&r.match(/\bapp\-has\-minisidebar\-left\b/)&&o.removeClass("app-has-minisidebar-left");r.match(/\bapp-has-sidebar-left\b/)||(o.addClass("app-has-sidebar-left"),c.left.visible=!0,an(),u=!0)}function v(){r.match(/\bapp\-has\-minisidebar\-left\b/)&&o.removeClass("app-has-minisidebar-left");r.match(/\bapp-has-sidebar-left\b/)&&(o.removeClass("app-has-sidebar-left"),c.left.visible=!1,c.left.width=0,u=!0)}var r,u,f,h,l,s;t&&o.removeClass("app-has-panel-right");r=document.body.className;eu||(e("ui.sidebar.when")==="Landscape"?vc()&&i.width>i.height?a():v():e("ui.sidebar.when")==="Never"?r.match(/\bapp-has-sidebar-left\b/)&&(o.removeClass("app-has-sidebar-left app-has-minisidebar-left"),c.left.visible=!1,c.left.width=0,u=!0):vc()?a():v());r.match(/\bapp-has-sidebar-right\b/)&&(o.removeClass("app-has-sidebar-right"),c.right.visible=!1,c.right.width=0,f=!0);u&&(vp(!0),kg(),hu(),is());h=$(".ui-page.app-has-panel-right").first();l=h.is(".app-has-panel");h.is(".app-page-modal")||(l&&!r.match(/\bapp-has-panel-right\b/)?f=!0:!l&&r.match(/\bapp-has-panel-right\b/)&&(f=!0));f&&(s=0,c.right.visible&&(s+=c.right.width+1),n._toolbar.css(s?{right:s,width:"auto"}:{right:"",width:""}),is());vn()}function vn(){if(c.left.visible){var n=c.left.inner,t=parseInt(n[0].style.bottom||"0");c.left.mini?t||n.css("bottom",n.next().outerHeight()-1):t&&c.left.inner.css("bottom","")}}function rs(n){yi();var i=n.match(/^(_\w+)\:(.+)$/),t;i&&i[1]?(u=i[2],t=i[1],t==="_blank"?r.host?r.host.invoke("navigate",{type:"external",url:u}):l.open(u,t,"modal=yes,alwaysRaised=yes,resizable=yes"):t==="_internal"?r.touch.openExternalUrl(u,!1)():l.open(u,t)):s||ny?l.location.href=n:l.open(n)}function ur(){return(new Date).getTime()}function v(n,t){return parseFloat(arguments.length===1?n:n.css(t))}function kft(n){return n.x!=null&&(n.x=Math.ceil(n.x)),n.y!=null&&(n.y=Math.ceil(n.y)),n}function dft(){var u=n._toolbarButtons,f=n._contextButton,o=Math.ceil(f.show().offset().left),s=v(f,"width")+2,e=ye(),t,r=u.length-1;for(t=v(n._toolbar,"width")-o+e,tr()&&(t+=i.left);r>=0;)btn=$(u[r]).css("right",t),t=t+s+e,r--}function yn(n,t,i,r){if(n.htmlEncode())if(n.TextMode==3){for(var u=yu(t).split(/\r?\n/),e,f=0;f<u.length;f++)e=u[f],m=e.match(/^\s+/),m&&(u[f]=Array(m[0].length*2).join("&nbsp;")+e.substring(m[0].length));t=u.join("<br/>");u.length>15?(i.html('<div class="app-text-collapsible"><\/div>').children().html(t),$('<span class="ui-btn ui-btn-icon-notext ui-btn-inline ui-icon-carat-d ui-inline ui-corner-all app-btn-toggle"/>').attr("data-title",uh).appendTo(i)):(i.html(t),r&&i.css("white-space","nowrap"))}else i.text(t);else i.html(t)}function pn(t,i,r){t.find("> .app-map, > .app-presenter-instruction").hide();r||(i._mapPageWindow=null);n.presenter("hide",{container:t})}function wa(){return!0}function pp(n,t,i){if(n._hasKey()){var r=$('<span class="app-btn-more">&nbsp;<\/span>').appendTo(t).attr("title",ki);i&&r.addClass("app-frozen")}}function gft(n,t){n.extension().quickFind(t)}function we(n){var t=[];return n&&n.asearch("active")&&(t=n.asearch("filter")),t}function wn(t){var i=t.extension().filterStatus(!0,!1);n.notify({dataView:t,text:i||f.FilterCleared})}function us(n){ps(n);kn(n);$(n._allFields).each(function(){delete this._listOfValues});gw(n);wn(n);n._forceSync();n.refreshData()}function ba(n,t){!t&&we(n).length&&n.asearch("filter",null);n.clearFilter(!0);us(n)}function bn(n){var i=n._filter,r=we(n),t;return r.length&&(n._filter=[],t=n.extension().filterStatus(!0),n._filter=i),t}function kn(n){var t=(n.get_filter()||[]).slice(0),r=[],u,i=0,f=$.Event("searching.app",{dataView:n});for($(n.get_externalFilter()).each(function(){r.push(this.Name)});i<t.length;)u=t[i],Array.indexOf(r,u.match(/^\w+/)[0])!==-1?t.splice(i,1):i++;n.viewProp("filter",t);$(document).trigger(f)}function dn(){var t=n._menuStrip;return t&&t.strip.is(":visible")}function uc(t){var r=n._menuStrip,i=r&&r.strip,u=n._title;i&&(arguments.length||(t=dn()),t?i.show():(i.hide(),n.refreshTitleState()))}function gn(n){n.length&&n[n.length-1].text&&n.push({})}function kf(n){var i=!0,t;if(n)setTimeout(kf,5);else try{l.getSelection?(t=l.getSelection(),t&&t.rangeCount>0&&t.removeAllRanges()):document.selection&&document.selection.empty()}catch(r){i=!1}return i}function ntt(){var n,t,i,u,r;return document.selection&&document.selection.createRange?(n=document.selection.createRange(),t=n.htmlText):window.getSelection&&(i=window.getSelection(),i.rangeCount>0&&(n=i.getRangeAt(0),u=n.cloneContents(),r=document.createElement("div"),r.appendChild(u),t=r.innerHTML)),t}function ttt(t){var r=n._menuStrip,i=r&&r.strip;i&&(i.hide(),arguments.length===1&&i.attr("data-enabled",t?"true":"false"))}function net(n,t){t==="Cards"?n.addClass("app-cardview").removeClass("app-grid app-onecolumnview"):t==="Grid"?n.addClass("app-grid").removeClass("app-cardview app-onecolumnview"):t==="List"&&n.addClass("app-onecolumnview").removeClass("app-cardview app-grid")}function fs(n,t,i){var r=p(n);ps(r);r.extension().viewStyle(t,i);wf(n);bt(!0);bt(!1,10)}function wp(n,t){if(t.instruction){var i=n.find("> .app-presenter-instruction"),r=t.instruction();i.length||(i=$('<div class="app-presenter-instruction"><\/div>').appendTo(n).hide());r?(i.show(),i.html(r)):i.hide();ec();itt(t.dataView(),n.closest(".ui-page"),!1,!0)}}function itt(n,t,i,r){var e,o,f,u;w(n).stickyHeader.hide();e=n.extension();e._instructed||n._totalRowCount===-1||(f=e.instruction(),u=aa(t),f||i?(u.empty(),e._instructed=!0,u.length||(u=$('<span class="dv-heading"/>').appendTo(t).hide()),f&&$('<span class="app-view-instruction"/>').appendTo(u).html(f.replace(/<a.*?<\/a>/gi,"")),u.attr("data-selector",r?".app-presenter-instruction:visible":"ul.app-listview li.app-list-instruction"),i&&(o=uv(n,u),f||o.addClass("app-grid-header-no-description")),hu(),(i||n.extension().viewStyle().match(/Cards|List/)&&n.get_groupExpression())&&$(document).trigger($.Event("scrollstop.app",{relatedTarget:d(t)}))):u.remove())}function tet(t){function i(i){var e=i.attr("data-presenter"),u=yt(),r=u?u._id:null,f=i.closest(".app-echo");f.length&&(r=f.attr("data-for"));r&&i.css("display")!=="none"&&n.presenter("show",{name:e,id:r,container:t||d(i)})}t?(t.find('div[data-role="presenter"]').each(function(){i($(this))}),$('.ui-page:not(.ui-page-active) div[data-role="presenter"]').each(function(){var n=$(this);n.closest(".app-echo-inner").length||n.addClass("app-stale")})):$('div[data-role="presenter"].app-stale').each(function(){var n=$(this);n.removeClass("app-stale");i(n)})}function bp(n){n.find("> .app-map").each(function(){var i=$(this),u=n.find("> .app-page-header").filter(gi),f=n.find("> .app-presenter-instruction").filter(gi),r=$(f.length&&f||u.length&&u),e=i.data("data-map"),t,o;i.css("top",r.length?r.position().top+r.outerHeight(!0):0);i.is(":visible")&&e&&(t=e.map,o=t.getCenter(),google.maps.event.trigger(t,"resize"),t.setCenter(o))})}function iet(){var u=e("ui.modal.max"),n,t=i.width,r;return u?n=Math.min(ti(u),t-30):(n=t,r=ti("sm"),n=n<=r?n-30:Math.max(r,Math.ceil(n/1.4)),n=Math.min(n,ti("md")),n>t&&(n=t<r?t:t-30)),n}function ret(){var n=i.height,t=Math.max(354,i.width<=ti("xxs")?n-30:Math.ceil(n*.8));return t>n-30&&(t=n-30),t}function rtt(n){var i=n.prev(),r,t;i.is(".app-page-header-fixed")&&(i.css("top",v(n,"top")),r=i.outerHeight(),n.data("header-height",r),t=i.prev(),t.is(".app-page-header-image")&&(t.css("height",""),t.css({top:v(n,"top"),height:t.height()+r})))}function utt(n,t){n.find('> .app-presenter > [data-fill-screen="true"]').each(function(){var i=$(this);i.height(t-(i.offset().top-n.offset().top))})}function ci(n){var bi=y(),t=n||bi,ei=t.attr("id")===bi.attr("id")||t.is(".app-page-modal-root"),fr=t.is(".app-page-modal"),wt=i.toolbarHeight,nt=wt,st,p=i.height-wt,ki=t.find(".ui-content"),di=ki.children().filter(function(){return $(this).is(".app-bar-header,.app-bar-actions,.app-tabs")}),oi=ki.find(".app-bar-footer"),si=ah&&t.find(ah.fixedTop.selector),hi=si&&si.css("position")==="fixed"&&si.outerHeight(),ci=ah&&t.find(ah.fixedBottom.selector),li=ci&&ci.css("position")==="fixed"&&ci.outerHeight(),ct=0,ai,gt=t.attr("class"),ii=w(t.attr("id")),bt=ii&&ii.dataView,tt=c.left.width,gi=pt.enabled&&!pu(),nr,ri,ti,ui,ir,rr,kt,fi;if(tt&&tt++,fr){var vi=gt.match(/\bapp-page-modal-max-(tn|xxs|xs|sm|md|lg|xl|xxl|any)\b/),b=gt.match(/\bapp-page-modal-dock-(top|left|right|bottom)\b/),h=i.width<480&&b&&!t.is(".app-page-modal-gap-required")||t.is(".app-page-modal-gap-none")?0:15,u=ret(),k=iet(),er=vi?pft(vi[1]):0;b&&(b=b[1]);vi&&(k=Math.min(i.width-h*2,er));ai=gt.match(/\bapp-page-modal-fullscreen\b/);ai&&(k=i.width-h*2,u=i.height-h*2);var l=d(t),it=0,f=(i.height-u)/2,a=(i.width-k)/2,ni,lt;gi&&gt.match(/\bapp-reading-pane-detail\b/)&&(i.splitLeft||i.splitBottom)?i.splitLeft?(f=0,a=tt+i.splitLeft+pt.divider,k=i.splitRight,u=i.height):(f=i.toolbarHeight+i.splitTop+pt.divider,a=tt,k=i.width-tt,u=i.splitBottom):b&&(b==="top"?f=i.width===k?0:h:b==="left"?(a=h,bt&&bt.tagged("modal-fit-content")||(f=h,lt=h,u=i.height-h*2)):b==="bottom"?(f="auto",lt=h):b==="right"&&(a="auto",ni=h,bt&&bt.tagged("modal-fit-content")||(f=h,lt=h,u=i.height-h*2)));tr()&&(f!=="auto"&&(f+=i.top),a!=="auto"&&(a+=i.left),lt!=null&&lt!=="auto"&&(lt+=i.bottom),ni!=null&&ni!=="auto"&&(ni+=i.right));f!=="auto"&&(f=Math.round(f));t.css({"padding-top":0,top:f,left:a,right:ni,bottom:lt,"min-width":k,"max-width":k,width:k,"min-height":u,"max-height":u,height:u});footerHeight=oi.length?oi.outerHeight():0;di.each(function(){var n=$(this);n.css("display")!=="none"&&(it+=n.outerHeight(!0))});nr=l.data("scrolling");l.data("scrolling",!0);t.find(".app-bar-actions,.app-bar-footer,.app-bar-header").each(function(){var n=$(this);n.width(Math.round(k-v(n,"padding-left")-v(n,"padding-right")))});it+=t.find(".app-page-modal-title").outerHeight();ri=k+ht.width;ti=u-footerHeight-it;l.css({top:it,left:0,"min-width":ri,"max-width":ri,width:ri,"min-height":ti,"max-height":ti,height:ti});utt(l,ti);!ai&&bt&&bt.tagged("modal-fit-content")&&(ui=l.find(".app-stub"),ui.length&&(ir=ui.position(),rr=Math.ceil(ir.top+ui.height()+l.scrollTop()),kt=l.height()-rr,kt>0&&(l.css({"min-height":u-footerHeight-it-kt,"max-height":u-footerHeight-it-kt,height:u-footerHeight-it-kt}),u-=kt,b!=="top"&&b!=="bottom"&&(f=i.top+(i.height-u)/2),t.css({top:f,"min-height":u,"max-height":u,height:u}))),t.addClass("app-page-modal-fit-content"));rtt(l);l.data("vscrollbar").css({height:u-footerHeight-it,right:0,top:it});bp(l);ei&&$app.display(l);nr||l.data("scrolling",!1)}else{if(t.css({"padding-top":nt}),nt=v(nt),eu&&!cy&&t.attr("id")==="Main"&&(nt=0,p+=wt),a=i.left+tt,st=i.width-tt,ii&&ii.home&&gi&&gt.match(/\bapp-reading-pane-master\b/)){var ft,or=i.portrait,et,ot,rt,ut,e=pt.divider,yi=pt.minLeft,pi=pt.minRight,ur=pt.minTop,wi=pt.minBottom,at=i.width-tt,vt=i.height-wt,dt,yt=pt.splitter,g=pt.bkg;or?(rt=gr("splitTop"),ut=rt?vt-rt-e:ut=Math.ceil(vt*.618),(vt-e-ut<ur||vt-e-rt<wi)&&(ut=vt-e-ur),vt-pt.minTop-e>=wi&&ut>=wi&&(p=rt=vt-ut-e,dt=!0)):(et=gr("splitLeft"),ot=et?at-et-e:Math.ceil(at*.618),(at-e-ot<yi||at-e-et<pi)&&(ot=at-e-yi),at-yi-e>=pi&&ot>=pi&&(st=et=at-ot-e,ft=et+tt));(et!==i.splitLeft||ot!==i.splitRight||rt!==i.splitTop||ut!==i.splitBottom)&&(i.toolbarWidth=ft,i.splitLeft=ft?et:null,i.splitRight=ft?ot:null,i.splitTop=dt?rt:null,i.splitBottom=dt?ut:null,ky({}),(ft||dt)&&(yt||(yt=pt.splitter=$('<span class="app-reading-pane-splitter" data-draggable="reading-pane"/>')),yt.insertAfter(t).show().toggleClass("app-bottom",dt!=null),ft?yt.css({left:a+st,top:i.top,height:p+i.toolbarHeight,width:""}):yt.css({left:a,top:i.top+wt+rt,width:st,height:""}),g&&(typeof g!="object"&&(typeof g=="string"&&(fi=r.resolveClientUrl(g),g.match(/\(/)||(fi="url("+fi+")")),g=pt.bkg=$('<span class="app-reading-pane-bkg"/>').css("background-image",fi)),g.insertAfter(t).show(),ft?g.css({left:a+st,top:i.top,height:p+i.toolbarHeight,width:e+ot}):g.css({left:a,top:i.top+wt+rt,width:st,height:e+ut}))));ft||dt||(yt&&yt.hide(),typeof g=="object"&&g.hide())}t.css({left:a,width:st,top:i.top,minHeight:i.splitTop||p});d(t).each(function(){var n=$(this),t=0,r=n.data("scrolling"),i;n.data("scrolling",!0);di.each(function(){var n=$(this);n.css("display")!=="none"&&(t+=n.outerHeight(!0))});oi.each(function(){var n=$(this);n.css("display")!=="none"&&(ct+=n.outerHeight(!0))});t&&(p=p-t,nt=nt+t);hi&&(p-=hi,nt+=hi);li&&(p-=li,ct+=li);ct&&(ct-=2);i=p-ct;n.css({top:nt,bottom:ct,"min-height":i});utt(n,i);ei&&n.css({height:i});ht.width&&n.css("width","").width(n.width()+ht.width);$(n.data("vscrollbar")).css({height:p-ct,right:0,top:nt});rtt(n);bp(n);ei&&$app.display(n);r||n.data("scrolling",!1)})}s&&o.scrollTop(0);t.data("trackPosition")&&$(document).trigger($.Event("pagepositionchanged.app",{page:t}))}function kp(n){var i=document.cookie.split(";"),r,t;for(r in i)if(t=i[r].trim(),t.startsWith(n+"="))return t.substring(n.length+1)}function uet(n,t,i){var u="",r;i&&(r=new Date,r.setTime(r.getTime()+i*864e5),u="; expires="+r.toGMTString());document.cookie=n+"="+t+u+"; path=/"}function fet(){function ot(n){return n&&(n=n.match(/Landscape|Always|Never/)),n?n[0]:"Landscape"}var d=e("ui.displayDensity.mobile"),ut=e("ui.displayDensity.desktop"),y=lu.Browser,g,p,nt,l=$("#PageHeader").parent(),h,w=$("div[data-content-framework]").first(),tt=kt("promoteActions"),it=kt("smartDates"),ft=ei.appInfo.split("|")[1],rt=kp(".COTTHEME"+ft),a,k,t,u;if(rt&&(a=rt.split("."),a.length>1&&(h={theme:a[0],accent:a[1]})),l.length||(l=o),e("membership.profile",e("membership.profile")||"view switch login logout"),e("ui.transitions.style",kt("transitions")||e("ui.transitions.style")||"slide"),n._uiSideBarWhen=kt("sidebar")||ot(e("ui.sidebar.when")),e("ui.sidebar.when",n._uiSideBarWhen||(vc()?"Always":"Landscape")),k=kt("minisidebar"),e("ui.sidebar.mini",k!=null?k:ct("ui.sidebar.mini")||e("ui.sidebar.mini")==null&&i.width<=ti("lg")),e("ui.menu.location",eu?"toolbar":e("ui.menu.location")?e("ui.menu.location"):"toolbar"),ei.bars={left:{visible:!1,width:0,content:[]},bottom:{visible:!1,height:0,content:[]},right:{visible:!1,width:0,content:[]}},e("ui.theme.name",kt("theme")||h&&h.theme||e("ui.theme.name")),e("ui.theme.accent",kt("accent")||h&&h.accent||e("ui.theme.accent")),e("ui.displayDensity.value",kt("displayDensity")||(gs<144?ut:d==="Auto"?gs>=240?"Comfortable":"Compact":d)),e("ui.list.labels.display",kt("labelsInList")||e("ui.list.labels.display")),e("ui.showSystemButtons",kt("showSystemButtons")||e("ui.showSystemButtons")||"Auto"),e("ui.actions.promote",tt!=null?tt:e("ui.actions.promote")),e("ui.list.initialMode",eu?"Summary":kt("initialListMode")||e("ui.list.initialMode")||"SeeAll"),e("ui.smartDates",it!=null?it:e("ui.smartDates")===!0),lf=e("ui.scrollbars.wide"),lf=lf===!0||lf==="pointer"&&!s,fd=e("ui.history.dataView")||"search filter sort group",nh=e("ui.autoCompleteMaxRowCount")||1e3,gc=e("ui.multiSelectMaxRowCount")||1e3,e("barcode.enabled")===!0&&(b.enabled=!0,b.enter=e("barcode.enter")||["Enter"],b.override=ct("barcode.override"),b.inputSpeed=e("barcode.inputSpeed")||30,b.slowInputSpeed=e("barcode.slowInputSpeed")||100,b.inventorySpeed=e("barcode.inventorySpeed")||500,b.frequency=e("barcode.frequency")||100,b.ignore=new RegExp(e("barcode.ignore")||"total.+?\\d+","i")),c=ei.bars,y.agent==y.InternetExplorer&&y.version<=9&&!(__settings.host||window.external)&&(o.hide(),ei.defaultUI?(g=(new Date).getDate()+365,p=new Date,p.setDate(g),nt=String.format("appfactorytouchui=false; expires={0}; path=/",p.toUTCString()),document.cookie=nt,location.reload(et.path.parseUrl(location.href).hrefNoHash)):alert(f.TouchUINotSupported)),sr&&(o.addClass("app-ios"),tk<8&&o.addClass("app-ios7"),document.addEventListener("touchmove",function(n){$(n.target).closest(uk).length&&n.preventDefault()},{passive:!1})),(kr||wrt)&&o.addClass("app-android"),(r.host||e("ui.native"))&&o.addClass("app-native"),e("ui.showSystemButtons")!=="Always"&&o.addClass("app-show-system-buttons-on-hover"),l.is(".Tall")&&o.addClass("app-page-header-hidden"),(l.is(".Wide")||e("ui.menu.location")!=="sidebar"&&w.length&&w.attr("data-sidebar")!=="true"||!w.length&&$('div[data-app-role="page"]').first().attr("data-sidebar")==="false")&&(e("ui.sidebar.when","Never"),e("settings.options.sidebar",!1)),eu){if(location.href.match(/_showNavigation=false/)||(o.addClass("app-hosted-show-navigation"),cy=!0,n._toolbar.css("visibility","")),location.hash){o.children().hide();location.reload(location.pathname+location.search);return}o.addClass("app-hosted")}$(document).trigger("init.app");et.defaultPageTransition="none";t=$('<div id="app-sidebar" class="ui-panel ui-panel-fixed app-sidebar app-sidebar-left app-sidebar"><div class="ui-panel-inner" tabindex="0"><ul/><\/div><div class="app-bar-toolbar-bottom"><\/div><\/div>').appendTo(o);u=t.find(".ui-panel-inner");by({sidebar:t});ht.width&&u.css({"overflow-y":"scroll",width:t.width()-v(u,"padding-left")-v(u,"padding-right")+ht.width});c.left.inner=u;c.left.toolbar=u.next();c.left.content.push(t.find("ul").listview());t=$('<div class="ui-panel ui-panel-fixed app-sidebar app-sidebar-right"><div class="ui-panel-inner" tabindex="0"><ul/><\/div><\/div>').appendTo(o);u=t.find(".ui-panel-inner");c.right.inner=u;c.right.content.push(t.find("ul").listview());ct("ui.sidebar.mini")&&(c.left.mini=!0);pa();e("ui.displayDensity.value")||e("ui.displayDensity.value",s?"Comfortable":"Compact");o.addClass(ib(e("ui.theme.name")));o.addClass("app-accent-"+e("ui.theme.accent"));o.addClass(tb(e("ui.displayDensity.value")));e("ui.list.labels.display")==="DisplayedAbove"&&o.addClass("app-labelsinlist-displayedabove");$(document).trigger("starting.app")}function df(t){n.tabs("fit",{page:t})}function ftt(n){n=$(n);d(n).each(function(){var n=$(this),t=n.data("scroll-top")});n.find(".app-echo-inner").each(function(){var n=$(this),t=n.data("scroll-left");n.parent().is(":visible")&&t&&n.scrollLeft()!=t&&n.scrollLeft(t)})}function dp(n){n=$(n);n.is(":visible")&&n.find(".app-echo-inner").each(function(){var n=$(this);n.parent().is(":visible")&&n.data("scroll-left",n.scrollLeft())})}function ett(n){var t=n.scrollTop();return{top:t*-1,height:n.height()+t,maxHeight:n[0].scrollHeight}}function ott(n){function f(){var n=t.scrollTop(),e=n!==r;e||ur()-u<100?(r=n,e&&(u=ur()),requestAnimationFrame(f)):(i=!1,wi(),t.data("scroll-stop-time",new Date))}var t=n.find(".ui-panel-inner"),i,r,u;if(t.length)t.on("scroll keydown keyup",function(){!rt&&s&&(i||(i=!0,r=t.scrollTop(),wi(!1),u=ur(),requestAnimationFrame(f)))})}function eet(n){n.find(".ui-panel-inner").off("scroll keydown keyup")}function fc(t,i){t||(t=d());gf(t,!1,i===!0);t.find(".app-data-list").each(function(){ka($(this))});ts(t).find(".app-hscrollbar2[data-view]").each(function(){var i=$(this),t=p(i.attr("data-view"));t.session("scroll-left")&&i.width()>=t.session("grid-avail-width")&&n.scrollGrid(t,0);es(t,i.find(".app-hscrollbar-handle"))})}function ka(n,t){n.length&&(t||(t=n,n.parent().attr("class").match(/\-outer/)&&(t=n.parent()),t=t.next().find(".app-hscrollbar-handle")));var r=n.scrollLeft(),u=n.width(),f=n[0].scrollWidth,i=Math.abs(u-f)<=2?1:u/f;t.parent().css("visibility",i===1?"hidden":"");i===1||n.find(".app-hidden").length?(t.css("display","none"),n.removeClass("app-inner-shadow-left app-inner-shadow-right app-inner-shadow-left-right")):(r<=0?n.addClass("app-inner-shadow-right").removeClass("app-inner-shadow-left app-inner-shadow-left-right"):r>=n[0].scrollWidth-n[0].clientWidth-1?n.addClass("app-inner-shadow-left").removeClass("app-inner-shadow-right app-inner-shadow-left-right"):n.addClass("app-inner-shadow-left-right").removeClass("app-inner-shadow-right app-inner-shadow-left"),t.css({left:r*i,width:u*i,display:""}))}function es(t,i){var c=t.sessionShared("isSummary"),o,y=t.session("scroll-left")||0,l=t.session("grid-avail-width"),r,a,u;if(c||(i=$("#"+t._id+" .app-bar-footer .app-hscrollbar-handle")),i||(a=ot(t),i=a.find(".app-hscrollbar-handle")),u=i.parent(),o=u.width(),r=Math.abs(o-l)<=2?1:o/l,r<1&&i.css({left:y*r,width:o*r}),c)u.css("visibility",r>=1?"hidden":"");else{var p=u.css("display"),f=r>=1?"none":"block",s=u.parent(),e,h,v;p!==f&&(u.css("display",f),n.bar(f==="block"?"show":"hide",s));e=s.parent();e.data("hsbInit")||(e.data("hsbInit",!0),h=s.prev(),v=s.next(),e.toggleClass("app-bar-footer-flat",f==="block"&&!h.length),e.toggleClass("app-bar-footer-scrollbar",f==="block"&&!h.length&&!v.length))}}function gf(n,t,i){var c;if(n.length)if(i)clearTimeout(l._updateVScrollbarTimeout),l._updateVScrollbarTimeout=setTimeout(gf,100,n,t);else{t||(t=n.next().find(".app-vscrollbar-handle"));var o=n[0].scrollHeight,u=n.height(),r=u/o,s=t.parent(),h=n.parent().parent();if(footer=s.next(),s.css("visibility",r===1?"hidden":""),r===1)t.css("display","none"),footer.addClass("app-bar-footer-no-scrolling"),h.removeClass("app-page-scrolled");else{var f=n.scrollTop(),e=u*r;e<16&&(e=16);t.css({top:f*r-0,height:e,display:""});o<=f+u?footer.addClass("app-bar-footer-no-scrolling"):footer.removeClass("app-bar-footer-no-scrolling");c=n.data("header-height");h.toggleClass("app-page-scrolled",f>(c||50))}}}function da(t,r){function p(){f=u.data("lastScrollTop");f==null&&(f=0);var t=u.data("scroll-dir"),i=u.scrollTop(),n=i<f?"up":i==f?"none":"down";n==="none"&&t==="none"&&(n="up");n!==t&&(u.data("scroll-dir",n),$(document).trigger($.Event("scrolldir.app",{relatedTarget:u})))}function w(){var n=u.scrollTop(),t=n!=f,i=ur();t||i-a<100?(f=n,t&&(a=i),requestAnimationFrame(w)):(clearInterval(u.data("scrollInterval")),p(),h=!1,wi(),u.data({"scroll-stop-time":new Date,lastScrollTop:n,scrollInterval:null}),e.removeClass("app-scrollbar-reveal"),$(document).trigger($.Event("scrollstop.app",{relatedTarget:u})))}var u=d(t),e,o,l,y,h,f,a,b,v;if(!u.length){if(l=t.find(".ui-content"),y=l.contents(),u=$('<div class="app-wrapper"><\/div>').appendTo(l),ht.width&&u.css("overflow-y","scroll"),b=i.width,u.toggleClass("app-display-tablet",b>=ti("sm")+(c.left.visible?c.left.width:0)),e=$('<div class="app-vscrollbar"><\/div>').toggleClass("app-scrollbar-wide",lf).insertAfter(u),o=$('<div class="app-vscrollbar-handle" data-draggable="vscrollbar"><\/div>').appendTo(e),u.data({vscrollbar:e,"vscrollbar-handle":o}),gf(u,o),bh(u,!1),v=n.pageInfo(t),v&&v.external&&e.css("display","none"),r===!1)u.on("scroll",function(){gf(u,o)});else u.on("scroll",function(){if(rt||u.data("scrolling")){clearInterval(u.data("scrollInterval"));u.data("lastScrollTop",u.scrollTop());h=!1;wi();return}gf(u,o);h?p():(h=!0,ri(),$(document).trigger($.Event("scrollstart.app",{relatedTarget:u})),wi(!1),e.addClass("app-scrollbar-reveal"),a=ur(),requestAnimationFrame(w))});s||u.attr("tabindex",0);$('<div class="app-page-header"><h2/><h1/><\/div><div class="app-page-header-divider"><\/div>').appendTo(u);y.appendTo(u)}return u}function yi(t){n.activeLink(t)}function st(n,t){t||(t=dt);n=$(n);var i=n.attr("class");i&&i.match(/\bapp-btn-/)?(n.addClass("ui-btn-active"),setTimeout(function(){n.removeClass("ui-btn-active");feedbackFrom="link";t(n)},ai)):(yi(n),setTimeout(function(){rt&&t===dt||(yi(),feedbackFrom="link",n&&n.is(".app-btn")&&(feedbackFrom="toolbar"),t(n))},ai))}function os(){li&&li._updateLastActivity()}function ga(){return ll&&ll.length||(ll=$(".app-sidebar").first()),ll}function oet(n){return ei.bars[n||"left"].visible}function bu(n,t,i){n&&(i||hi(),n.href?rs(n.href):n.callback&&n.callback(n.context,t))}function gp(n){var t=n.closest("ul").find(".app-focus");n.closest(".ui-panel-inner").focus();t.length&&(t.removeClass("app-focus ui-btn-active"),n.addClass("app-focus ui-btn-active"))}function stt(n,t){if(n.length){t||(t=n.closest(".ui-panel-inner"));var i=n.offset(),e=t.offset(),r,u=e.top,f=u+t.outerHeight()-1;i.top<u?r=i.top-u:i.top+n.outerHeight()>f&&(r=i.top+n.outerHeight()-f);r&&setTimeout(function(){t.scrollTop(t.scrollTop()+r)},10)}}function htt(n){var t=y();t&&t.find(".dv-load-at-top").css("visibility",n?"hidden":"");rt=n}function yt(){return n.dataView()}function y(n){var t=et.activePage;return arguments.length&&t?t.find(n):t}function gt(){var n=y();return n?n.attr("id"):"_"}function w(t){return n.pageInfo(t)}function ctt(){return gt()==="Main"}function nw(n,t){return"rg_"+n._id+"_v_"+n._viewId+(n._groupExpression?"_g_"+n._groupExpression.replace(/\W/g,"_"):"")+"_f_"+t.Name}function ss(n){return"rg_"+n._id+"_v_"+n._viewId+(n._groupExpression?"_g_"+n._groupExpression.replace(/\W/g,"_"):"")+"_scroll_"}function het(n,t){t||(t=ye());var i=n.cols!=null?n.cols:n.toColumns(),r=n.long?i*.5:i<11?i:i<21?Math.ceil(i*.5):10;return Math.ceil(t*(r<=3?1:.55)*r)}function ff(n){var t=Math.ceil(ye()*1);$(n||y(".app-listview")).each(function(){var u=$(this),y=u.parent(),c=u.closest(".ui-page"),ft,dt="w"+Math.ceil(v(c,"width")/t),r=dk[dt],nt,et,st,gt,ct,tt,lt=u.data("data-yardstick-class"),e=o.find("#app-yardstick"),ni=u.is(".app-grid"),it=y.is(".app-echo-inner"),ti,wi=it||y.is(".app-map-info"),ii,ri,at,bt,kt,fi,ei,oi,hi;if(r||(e.length||(e=$('<ul id="app-yardstick" class="app-listview"><li class="dv-item"><a><span>1<\/span><\/a><\/li><li><a class="dv-item">2<\/a><\/li><li><a class="dv-item">3<\/a><\/li><\/ul>').appendTo(o).listview()),it&&ni&&(y=d(y)),e.addClass("app-onecolumnview").appendTo(y).show(),nt=e.find("li").first(),at=u.closest(".ui-popup").length,ft=c.css("display"),ft==="block"||at||(c.css("display","block"),ci(c)),st=nt.outerWidth(),e.toggleClass("app-onecolumnview  app-cardview"),et=nt.outerWidth(),e.toggleClass("app-cardview app-grid"),gt=e.find("span").first(),ct=v(gt,"margin-left"),ht.gridColumnPadding=ct,ti=nt.outerWidth(),e.removeClass("app-grid"),ft==="block"||at||c.css("display",""),e.appendTo(o).hide(),ii=pf(st),ri=pf(et),r={listBreakpoint:ii,cardBreakpoint:ri,card:Math.floor(et/t),list:Math.floor(st/t),columnPadding:ct,grid:{},gridWidth:ti},dk[dt]=r),tt="app-listitem-"+(u.is(".app-cardview")?r.cardBreakpoint:r.listBreakpoint),tt!==lt&&(lt&&u.removeClass(lt),u.addClass("app-yardstick "+tt).data("data-yardstick-class",tt)),ni){var li=w(it?ot(u).attr("data-for"):c.attr("id")),n=li.dataView,p=n.session("grid-style"),s=vs(n);if(!p||n.session("grid-style-changed")||s&&n.session("window-width")!==i.width){n.session("grid-style-changed",null);var ai=n._fields,vi=n._allFields,vt=[],b,yi=0,l=n.get_showMultipleSelection(),f=u.is(":visible")?u.width():r.gridWidth,yt=n._hasKey(),pt=n.inlineEditing(),ui=(yt?22:0)+(l?38:0)+(pt?40:0)+ht.gridColumnPadding,rt=ui,ut,bi=2*t+r.columnPadding,a,k=n.gridSettings(),wt=new lu.StringBuilder;if($(ai).each(function(){var r=this,i=vi[this.AliasIndex];r.Hidden||i.GroupBy||r.OnDemand||r.Type==="DataView"||(b=i.toColumns(),ut=Math.ceil(Math.min(f*.5,b*t*(b<=3?1:.55))),k&&k.width[i.Name]&&(ut=k.width[i.Name]),rt+=ut+ht.gridColumnPadding,yi+=b,vt.push({name:i.Name,className:nw(n,i),cols:b,type:i.Type,ew:ut,long:i.ItemsTargeDataController||i.Type==="String"&&i.Rows>1}))}),n){if(n.session("avail-width",f),bt=n.session("grid-avail-width"),kt=ui,n.tagged("grid-fit-none")&&(s&&vs(n,!1),s=!1),k){for(a in k.width)ei=!0;ei&&(s&&vs(n,!1),s=!1)}bt==null||s?(f-=ht.gridColumnPadding+1,it&&(f-=ht.width),s&&(f<rt&&(oi=(f-(l?22:0))/rt,$(vt).each(function(){var n=this,i=het(n,t);n.ew=(n.ew+ht.gridColumnPadding)*oi-ht.gridColumnPadding;n.ew<i&&(n.ew=i,fi=!0);kt+=n.ew+ht.gridColumnPadding})),n.session("scroll-left",0)),fi?f=kt:s||(f=rt),n.session("grid-avail-width",Math.floor(f)),vs(n,s),n.session("window-width",i.width)):f=bt}var pi,h=0,g=la(n),si=g!=="_none_";$(vt).each(function(){a=this;var n=a.ew;a==pi&&(yt&&(n-=22),l&&(n-=22+r.columnPadding));g!=="_none_"&&(h+=n+r.columnPadding,(g===a.name||g==="_first_")&&(g="_none_"));wt.appendFormat(".{0} {{width:{1}px;max-width:{1}px}}",a.className,Math.floor(n));wt.appendLine()});hi=wt.toString();p||(p=ca(),n.session("grid-style",p));p.text(hi);h&&(h+=4);pt&&(h+=24+r.columnPadding);h=!si&&!l?0:Math.floor(h+(yt?26:4))+(l?22+(h>0?r.columnPadding:4):0);si||l||!pt||(h=40+r.columnPadding);n.session("grid-frozen-width",h)}}})}function cet(){var i=gt(),t=n._pages;return i==="Main"||t.length&&i===t[0].id&&t[0].home}function ltt(){var r=n._menuButton,c=y(),i,e,o;if(r&&n.toolbar().is(":visible")&&!c.is(".app-page-modal")&&!pu())if(cet()?r.removeClass("ui-icon-back ui-icon-bars "+nk).addClass("ui-icon-bars").attr({"data-action":"#app-btn-menu",title:f.Menu}):r.removeClass("ui-icon-bars "+nk).addClass("ui-icon-back").attr({"data-action":"#app-back",title:f.Back}),e=!r.is(".ui-icon-bars"),n.toolbar().toggleClass("app-has-back",e),o=n._backText,e){var u=ui("prev"),s=u&&u.hash,h=s?w(s.substring(1)):null,t=h?h.headerText:u&&u.title;i=w();(!t||i&&i.headerText===t)&&(i&&(t=i.backText),t||(t=f.Back));o.text(typeof t=="string"?t:t[0]).show()}else o.hide()}function tw(n){n.length&&n.closest(".app-sidebar").length&&(kk[gt()+"_"+n.attr("id")]=n.find(".ui-panel-inner").scrollTop())}function aet(n){n.find(".ui-panel-inner").scrollTop(n.length&&n.closest(".app-sidebar").length?kk[gt()+"_"+n.attr("id")]||0:0)}function iw(n){var i=$(n.target),t;return i.is(".app-btn-check")?!0:(t=i.closest(".ui-btn,.app-grid-header").find(".app-btn-check"),t.length>0&&rr(n.pageX)<=t.offset().left+t.outerWidth()+8)}function att(n,t){var u,i,f=rr(n.clientX),e=yf(n.clientY),o=$(n.target).closest(".ui-btn").find(".app-action-column"),r;return o.length&&o.find(".app-action-column-button").each(function(){var n=$(this),o=n.offset();if(f>=o.left-4&&f<=o.left+n.outerWidth()+3&&e>=o.top-6&&e<=o.top+n.outerHeight()+4)return u=!0,n.addClass("ui-btn-active"),setTimeout(function(){n.removeClass("ui-btn-active");i=ot(n);cw(i);tv(t).removeClass("app-selected ui-btn-active");r=n.closest(".ui-btn");t.extension().tap(r.data("data-context"),"none");i.length&&r.addClass("app-selected");var u=[],f=n.attr("data-action-path");no("ActionColumn",t,u,t.commandRow());$(u).each(function(){var n=this;if(n.path===f)return bu(n,r),!1});i.length?pe(t,i):wf(t._id)},ai),!1}),u}function vtt(n){var r=$(n.target),t;if(r.is(".app-btn-more"))return!0;var i=r.closest(".ui-btn").find(".app-btn-more"),u=rr(n.clientX),f=yf(n.clientY);return i.length?(t=i.offset(),t.left-8<=u&&u<=t.left+i.outerWidth(!0)+8&&t.top-8<=f&&f<=t.top+i.outerHeight(!0)+8):!1}function rw(n){return n.closest(".ui-btn").find(".app-btn-more")}function nv(n){return String.format("app-style-dv-{0} app-style-c-{1} app-style-cv-{1}-{2}",n._id,n._controller,n._viewId)}function tv(n){return w(n).page.find('ul[data-role="listview"] li a')}function ef(n){$(arguments).each(function(t){t&&(n?$(this).addClass("app-btn-check-selected").closest(".ui-btn").addClass("app-checked").parent().addClass("app-checked"):$(this).removeClass("app-btn-check-selected").closest(".ui-btn").removeClass("app-checked").parent().removeClass("app-checked"))})}function iv(n){n.is(".app-cardcolumn")&&(n=n.parent());n.find("a.app-selected").removeClass("app-selected ui-btn-active")}function uw(n,t){t==null||t.match(/^null\b/)||n.push(t)}function rv(t,i,u){function a(){e.length&&pe(t,e)}var f=t._selectedKeyList,s=!f.length,o=d().find(".app-style-dv-"+t._id),e=ot(o),h=o.find(".dv-item .ui-btn:not(.app-calculated) .app-btn-check"),v=(e.length?e:o.closest(".ui-page")).find(".app-grid-header .app-btn-check, .dv-heading .app-btn-check"),y=n.stickyHeaderBar().find(".app-grid-header .app-btn-check"),c,l;if(s&&t._totalRowCount>gc){r.alert(String.format(er.Presenters.Charts.DataWarning,gc),function(){e.length&&n.contextScope(t);ws({mode:"everything"});n.contextScope(null)});return}if(f.splice(0,f.length),ef(s,h,v,y),s)if(h.length&&!t.commandRow()&&(l=$(h[0]).closest(".ui-btn"),t.extension().tap(l.data("data-context"),"none"),e.length&&l.addClass("app-selected")),t._keyFields.length===1&&d(o).find(".dv-load-at-top,.dv-load-at-bottom,.dv-action-see-all").length){if(t._busy())return;c=t._createArgsForListOfValues(t._keyFields[0].Name);c.request.MaximumValueCount=gc;t._invoke("GetListOfValues",c,function(n){t._busy(!1);$(n).each(function(){uw(f,this.toString())});t.set_selectedValue(f.join(";"));ew(t);a()})}else o.find(".dv-item .ui-btn:not(.app-calculated)").each(function(){uw(f,t._createRowKey($(this).data("data-context").row))}),a();else i||(t.extension().clearSelection(!0),u&&aw(t));t.set_selectedValue(f.join(";"));e.length?(ef(s,w(t).page.find(".app-wrapper .app-listview .app-btn-check, .dv-heading .app-btn-check")),a()):(wf(t),bt());ew(t)}function fw(n){return n.closest(".ui-page").find(".app-grid-header .app-btn-check, .dv-heading .app-btn-check")}function ytt(n){return re(w(n).page).find(".app-grid-header .app-btn-check")}function ptt(n){var i=n._selectedKeyList,t=i.length;return Array.indexOf(i,"null")!==-1&&t--,t?" "+String.format(t>1?f.ItemsSelectedMany:f.ItemsSelectedOne,t)+".":""}function ew(n){var r=n._selectedKeyList.length,t=w(n),i=$.merge(t.page.find(".app-multi-select-instruction"),ot(n).find(".app-multi-select-instruction"));gt()===n._id&&$.merge(i,re(t.page).find(".app-multi-select-instruction"));i.text(ptt(n));r>1&&ec()}function ec(n){n||(n=re());n.find(".app-bar-text-instruction-hidden").removeClass("app-bar-text-instruction-hidden")}function ow(n,t,i){var c=n.extension(),a=t.find(".app-btn-check"),o=t.data("data-context"),r=n._selectedKeyList,v=r.slice(0),s=o?n._createRowKey(o.row):n.get_selectedKey().join(","),l=r.indexOf(s),u=t.closest(".ui-listview"),f=ot(u),y,w=ytt(n),h,e,b=t.is(".app-selected"),p;y=fw(u);l!==-1?(r.splice(l,1),ef(!1,a),b&&(iv(u),v.length>1?n._clearSelectedKey():(c.clearSelection(!0),aw(n)),e=u.find(".dv-item.app-checked .ui-btn").first(),e.length?(p=e.data("data-context"),s=n._createRowKey(p.row),r.splice(r.indexOf(s),1),f.length?e.trigger("vclick"):c.tap(e.data("data-context"),i)):r.length&&n.sync(r[0])),f.length?pe(n,f):wf(n)):(uw(r,s),ef(!0,a),iv(u),f.length?t.addClass("app-selected"):wf(n),o&&c.tap(o,i));ef(r.length,y,w);f.length&&(u=d(n._id).find(".app-listview"),u.length&&(h=t.data("data-context"),u.find(".ui-btn").each(function(){var t=$(this),i=t.data("data-context"),f=0;if(h&&($(n._keyFields).each(function(){var t=n.findField(this.Name);h.row&&i&&i.row&&h.row[t.Index]===i.row[t.Index]&&f++}),f===n._keyFields.length))return checkBox=t.find(".app-btn-check"),l!==-1?ef(!1,checkBox):(iv(u),ef(!0,checkBox),t.addClass("app-selected")),ef(u,r.length,fw(u)),!1})));r=r.join(";");n.set_selectedValue(r);v.join(";")!==r&&bt();ew(n)}function uv(n,t){var a=n._fields,v=n._allFields,h=!0,i=$('<div data-draggable="grid-header" class="app-grid-header app-grid-header-cv-'+n._id+"-"+n._viewId+'"><\/div>').appendTo(t).attr("data-for",n._id),c=ss(n),u=la(n),e=u==="_none_",y=0,l,o;return n.get_showMultipleSelection()&&(o=$('<span class="app-btn-check"><\/span>').appendTo(i).attr("title",f.LookupSelectAction),n._selectedKeyList.length&&o.addClass("app-btn-check-selected")),n.inlineEditing()&&$('<span class="app-row-status"><\/span>').appendTo(i),i.toggleClass("app-grid-header-inlineediting",n.inlineEditing()),(u!=="_none_"||o||n.inlineEditing())&&$('<span class="app-frozen-spacer '+c+'frozen_"/>').appendTo(i),$(a).each(function(){var o=this,t=v[o.AliasIndex],f,a,p,w,b,k;o.Hidden||t.GroupBy||o.OnDemand||o.Type==="DataView"||(f=$('<span data-draggable="grid-header-field"/>').addClass(nw(n,t)).attr("title",t.HeaderText).attr("data-field-name",t.Name).appendTo(i),t.Type.match(r._numericTypeRegex)?f.addClass("app-field-type-numeric"):t.Type==="Boolean"&&f.addClass("app-field-type-bool"),a=fe(n,t.Name),p=n.get_fieldFilter(t,!0),a||p?$('<b class="app-grid-header-text"/>').appendTo(f).text(t.HeaderText+" "):f.text(t.HeaderText),a&&vt("material-icon-arrow-"+(a.match(/^asc/i)?"upward":"downward"),f),p&&(k=vt("material-icon-filter-list",f),$(n._filter).each(function(){var n=this;if(n.startsWith(t.Name+":"))return w=n,!1}),w&&!s&&(b=n._filter,n._filter=[w],k.attr("title",n.extension().filterStatus(!0)),n._filter=b)),h&&(h=!1,pp(n,i)),l=$('<span class="app-field-separator" data-draggable="grid-header-separator"/>').appendTo(i),u!=="_none_"?(f.addClass("app-frozen"),t.Name===u||u==="_first_"?(e=!0,u="_none_"):l.addClass("app-frozen")):e&&(f.addClass(c+" app-scroll"),e=!1),y++)}),i}function wtt(n,t,i,r){if(n.get_showMultipleSelection()){var e=$('<span class="app-btn-check"><\/span>').appendTo(r).attr("title",f.LookupSelectAction),u;i||(u=n._createRowKey(t),n._selectedKeyList.indexOf(u)!==-1&&(e.addClass("app-btn-check-selected"),r.addClass("app-checked").parent().addClass("app-checked")))}n.inlineEditing()&&$('<span class="app-row-status"><\/span>').appendTo(r)}function fv(n,t){var i=n.HyperlinkFormatString,r;return i&&(r=n._dataView._parseLocation(i,t)),r}function oc(n,t,i,u,f){if(f)switch(t.Type){case"Date":case"DateTime":n.removeAttr("data-smart-type data-smart-value data-smart-text")}if(ei.ui.smartDates&&i!=null&&!t.is("smart-dates-disabled")){var e,o;switch(t.Type){case"Date":case"DateTime":e=ktt(n,t.Type,i,u,new Date);e&&(o=!0,n.attr({"data-smart-type":t.Type,"data-smart-value":JSON.stringify(i),"data-smart-text":u}));break;default:t._smartSize&&(e=r.sizeToText(i),n.text(e))}return e&&o&&!l.smartValueInterval&&(l.smartValueInterval=setTimeout(function(){btt();l.smartValueInterval=setInterval(btt,6e4)},6e4-(new Date).getSeconds()*1e3)),e}}function btt(n){n&&n.length||(n=$("[data-smart-value]"));var t=new Date;n.each(function(i){var r=n.eq(i),f=r.attr("data-smart-type"),u=JSON.parse(r.attr("data-smart-value")),e=r.attr("data-smart-text");switch(f){case"Date":case"DateTime":u=new Date(u)}ktt(r,f,u,e,t)})}function ktt(n,t,i,r,u){if(i)switch(t){case"Date":case"DateTime":var f=sw(i,u);return f?(n.text(f),!0):(n.removeAttr("data-smart-type").removeAttr("data-smart-value").removeAttr("data-smart-text").text(r),!1)}}function sw(n,t){var r,e;if(n==null)return null;var o=hf.AbbreviatedDayNames,i=f.Dates,s=t-n,h=s/864e5;if(h>=8||h<-14)return n.getYear()==t.getYear()?String.format("{0:"+hf.MonthDayPattern.replace(/M+/,"MMM")+"}",n)+hs(n):null;var c=new Date(t).setHours(0,0,0,0),l=new Date(n).setHours(0,0,0,0),u=(c-l)/864e5;return u>1?i.Last+" "+o[n.getDay()]+hs(n):u==1?i.Yesterday+hs(n):u==0?dtt(n)?i.Today:(r=s/6e4,e=r/60,r%=60,s>0)?e>1?String.format("{0:"+hf.ShortTimePattern+"}",n):e==1?i.OneHour:r>2?String.format(i.MinAgo,Math.floor(r)):r>1?i.AMinAgo:i.JustNow:e<=-1?String.format("{0:"+hf.ShortTimePattern+"}",n):r<=-59?i.InHour:r<-2?String.format(i.InMin,-Math.floor(r)):r<-1?i.InAMin:i.Now:u==-1?i.Tomorrow+hs(n):u>=-7?o[n.getDay()]+hs(n):i.Next+" "+o[n.getDay()]+hs(n)}function dtt(n){var t=n.getHours(),i=n.getMinutes(),r=n.getSeconds();return!t&&!i&&!r}function hs(n){if(!dtt(n)){var t=n.getSeconds(),i=n.getMinutes(),r=n.getHours();if(r||i||t)return", "+String.format("{0:"+(t?hf.LongTimePattern:hf.ShortTimePattern)+"}",n)}return""}function cs(n,t,i,u,f){var a=n._fields,v=n._allFields,c=ss(n),o,e=la(n),s=e==="_none_",l,h=!0,y=0;(e!=="_none_"||n.get_showMultipleSelection()||n.inlineEditing())&&$('<span class="app-frozen-spacer '+c+'frozen_"/>').appendTo(u);u.attr("data-draggable","data-item");wtt(n,t,f,u);$(a).each(function(a){var k=this,p=v[k.AliasIndex],nt=p.itemColumnClass||nw(n,p),w,b,g,tt,d=k.Items,it;k.Hidden||p.GroupBy||k.OnDemand||k.Type==="DataView"||(w=$('<span data-draggable="data-item"><\/span>').appendTo(u).addClass(nt+" app-field app-field-"+p.Name),p.itemColumnClass||(p.itemColumnClass=nt),it=b=t[f?k.Index:p.Index],b==null?(tt=!0,w.addClass("app-null")):g=fv(k,t),b=p.text(b,p.TextMode!==3),h&&pp(n,u,e!=="_none_"),p.Type.match(r._numericTypeRegex)&&w.addClass("app-field-type-numeric"),f?(o=f?f[a]:null,o&&(b=t[k.Index],b=String.localeFormat(k.DataFormatString||"{0:n0}",b),w.text(b),$('<div class="app-static-text"><\/div>').text(o).insertBefore(w.contents()),w.attr("title",p.HeaderText+"\n"+o+" "+b))):(p.Type==="Boolean"?(w.addClass("app-field-type-bool"),vt("material-icon-"+(!tt&&d&&d.length>=2&&d[d.length-1][1]==b?"check-box":"check-box-outline-blank"),w)):yn(p,b,w,!0),w.attr("title",p.HeaderText+":\n"+(p.Type==="Boolean"?b:wd(w))),g&&$("<span>").text(w.text()).attr("data-href",g).appendTo(w.empty())),oc(w,p,it,b),h&&i!=null&&$('<span class="app-item-number"/>').insertBefore(w.contents()).text(i+"."),f&&(l=$('<span class="app-field-separator"/>').appendTo(u)),e!=="_none_"?(w.addClass("app-frozen"),p.Name===e||e==="_first_"?(s=!0,e="_none_"):f&&l.addClass("app-frozen")):s&&(w.addClass(c),s=!1),p.TextMode===2&&w.addClass("app-field-data app-field-data-rtf"),y++,h=!1)})}function ls(n){var t=r._htmlConverter;return t||(t=r._htmlConverter=$("<p/>")),t.html(n.replace(/></g,"> <")).text()}function ku(n,t,i,u,f,e,s,h){var d=n._allFields,et=e.is("a"),g=$("<h3>").appendTo(e),rt=d[i.heading],c,ct=[],ut,lt,y,w,b,k;if(et&&wtt(n,t,null,e),i.thumb!=null&&(c=t[i.thumb],c&&c.toString().match(/^null/)?f.addClass("ui-li-has-thumb"):(ut=d[i.thumb],lt=$('<img class="ui-li-thumb app-field"/>').appendTo(e).addClass("app-field-"+ut.Name),r.odp.blob("init",{image:lt,field:ut,key:c,crop:ut.OnDemandStyle!==2}))),c=t[i.heading],c=rt.text(c),et&&e.attr("title",c),rt.HtmlEncode?g.text(c):g.html(c),g.addClass("app-field app-field-"+rt.Name).attr("title",rt.HeaderText+":\n"+g.text()),u&&$('<span class="app-item-number"/>').insertBefore(g.contents()).text(u+". "),g.contents().wrap('<span class="app-field-data"/>'),i.desc.length){var nt=$('<p class="app-para"/>').appendTo(e),tt=nt,l,at=1,a;$(i.desc).each(function(n){var v=this,r=d[v],g=i.descLabels[n],it=i.descPara[n],rt=i.descColumn[n],y,h,k=r.HeaderText,o,p,w,b;it&&(tt.is(".app-para")||(nt=$('<p class="app-para"/>'),l?nt.appendTo(e):nt.insertAfter(tt),tt=nt,at++),l=null);rt&&(l||f.addClass("app-has-column"),l=$('<span class="app-column"/>').addClass(l?"":"app-column-first"),y=100/i.descColumnCount+"%",l.css({minWidth:y,maxWidth:y}),ct.push(l));c=t[v];p=c==null;o=$('<span class="app-item-desc"/>').addClass("app-field app-field-"+r.Name);c=r.text(c);s?(a=$('<span class="app-field-data"/>').appendTo(o),r.TextMode===2&&a.addClass("app-field-data-rtf"),yn(r,c,a)):(a=$('<span class="app-field-data"/>').appendTo(o),r.TextMode===2?a.text(ls(c)):r.HtmlEncode||r.TextMode===3?a.text(c):a.html(c));s&&v===i.heading&&(o.addClass("app-item-heading"),u&&$('<span class="app-item-number"/>').insertBefore(a.contents()).text(u+". "));h=o.contents();o.attr("title",r.HeaderText+":\n"+wd(o));p||(i.descOriginal[n]!=null&&(r=d[i.descOriginal[n]]),w=fv(r,t),w&&(h=h.wrap("<span/>").attr("data-href",w)));g!=null&&((ei.ui.list.labels.display==="DisplayedAbove"||s)&&$('<span class="app-field-label-before"/>').insertBefore(h.first()).text(k),ei.ui.list.labels.display==="DisplayedBelow"&&$('<span class="app-field-label-after"/>').insertAfter(h.last()).text(k));b=h;p&&b.addClass("app-null");oc(b,r,t[v],c);l?o.appendTo(l):o.insertAfter(tt);tt=o});at>1&&f.addClass("app-para-multi");ct.forEach(function(n){$(n).appendTo(e)})}if(et){var ot=n.extension(),wt=ot._commandRow,st,vt=n.get_actionGroups("ActionColumn",!0),bt=0,yt=ye();if(vt.length&&h!==!0){st=$('<span class="app-action-column"/>').appendTo(e);var it=v(e,"padding-left"),ht=vt[0],pt=ht.groupText,p=ht.groupTextMaxWidth,ft;i.thumb!=null&&(c=t[i.thumb],c&&!c.toString().match(/^null/)&&(it+=70));i.thumb!=null&&(c=t[i.thumb],c&&!c.toString().match(/^null/)&&(it+=70));pt&&!p&&(p=0,ft=$('<span class="app-action-column"><span class="app-action-column-button"/><\/span>').appendTo(o).find("span"),$(pt).each(function(){ft.text(this);p=Math.max(p,ft.outerWidth())}),ft.parent().remove(),ht.groupTextMaxWidth=p);st.css({left:it,maxWidth:p});it+=p+yt;e.css("padding-left",it/yt+"em");ot._commandRow=t;$(n.actionGroups("ActionColumn")).each(function(){$(this.Actions).each(function(){var n=this;bt++;$('<span class="app-action-column-button"/>').appendTo(st).text(n.HeaderText).attr({title:n.Description,"data-action-scope":"ActionColumn","data-action-path":n.Path})})});ot._commandRow=wt}i.aside!=null&&(f.addClass("app-li-has-aside"),y=$('<p class="ui-li-aside"/>').appendTo(e),w=d[i.aside],c=t[i.aside],c=w.text(c),w.HtmlEncode?y.text(c):y.html(c),y.addClass("app-field app-field-"+w.Name).attr("title",w.HeaderText+":\n"+y.text()),oc(y,w,t[i.aside],c),i.asideLabel&&$('<span class="app-field-label"/>').insertBefore(y.contents()).text(w.HeaderText));i.count!=null&&(y==null||i.desc.length)&&(b=$('<span class="ui-li-count"/>').appendTo(e),k=d[i.count],c=t[i.count],c=k.text(c),k.HtmlEncode?b.text(c):b.html(c),b.addClass("app-field app-field-"+k.Name).attr("title",k.HeaderText+":\n"+b.text()),oc(b,k,t[i.count],c),i.countLabel&&$('<span class="app-field-label"/>').insertBefore(b.contents()).text(k.HeaderText));pp(n,e)}}function ev(n,t,i,r,u){if(n.inlineEditing()&&tt.supports(n,"New")){var a=n.extension(),v=a.viewStyle(),h=v==="Grid",o,y,c,l,e,s;r&&h&&(o=a.instruction(),(o||h)&&!t.find(".app-list-instruction").length&&(c=$('<li data-role="list-divider" class="app-list-instruction"/>').appendTo(t),o&&$('<span class="app-view-instruction"/>').appendTo(c).html(o),h&&(y=uv(n,c),o||y.addClass("app-grid-header-no-description")),c.toggleClass("app-no-records",n._totalRowCount<1)));l=new Array(n._allFields.length);e=$('<li class="dv-item dv-item-new" data-icon="false"/>');s=$('<a class="ui-btn"/>').appendTo(e).data("data-context",{row:l,pageIndex:-1});h?cs(n,l,null,s):ku(n,l,i,null,e,s,v==="List");s.find(".app-row-status").addClass("app-row-status-new").attr("title",f.LookupNewAction);s.find(".app-btn-more").css("visibility","hidden");u?e.insertAfter(u):e.appendTo(t);e.next().is(".dv-item")||(t.find(".ui-last-child").removeClass("ui-last-child"),e.addClass("ui-last-child"))}}function vet(n,t,i){var r=n._headerImageField,e="t",u,f,o;r&&(f=i[r.Index],o=r.tagged("header-image-original"),typeof f!="string"||f.match(/^null\|/)||(r.tagged("header-image-original")&&(e=pf(v(t,"width"))),u=w(n),u.dataImage={field:r,key:r.format(i[r.Index]),format:e,crop:!1},u.dataImageOriginal=o))}function gtt(n,t,i){for(var e=n._tag||"",u=[],f,r=nl.exec(e);r;)u.push(r),r=nl.exec(e);r=u[0];!r&&(n._lookupInfo||n._useCase==="seeAll")&&(r=["","material-icon-playlist-add-check"]);r&&(i.find(".app-icon").remove(),vt(r[1],i.addClass("app-has-icon")),f=t.find(".app-page-modal-title"),f.length&&vt(r[1],f.addClass("app-has-icon")),t.addClass("app-has-icon"),u.length>1&&(r=u[1]),vt(r[1],i).addClass("app-icon-background"))}function wr(t,i){function d(){var f,n,e,t;i.length>1&&(i=i.first());i.show().next().show();f=u.find(".app-wrapper");n=u.find(".app-page-header-fixed");n.is(".app-page-header")||(n=$('<div class="app-page-header app-page-header-fixed"><\/div>').insertBefore(f));n.html(i.html()).css("top",v(f,"top"));n.toggleClass("app-has-action-bar",i.is(".app-has-action-bar"));n.toggleClass("app-has-icon",i.is(".app-has-icon"));e=h&&h.dataImage;e&&(n.addClass("app-has-image"),i.addClass("app-has-image"),t=n.prev(),t.is(".app-page-header-image")||(t=$('<div class="app-page-header-image"><\/div>').insertBefore(n)),h.dataImageOriginal&&t.addClass("app-page-header-image-original"),r.odp.blob("init",e).done(function(n){r.odp.blob("url",n.src).done(function(n){t.css("background-image",'url("'+n+'")')})}))}function g(){i.hide().next().hide()}var s,u,c,p,l,f,e="",a,o,b,it,k,rt;if(i)u=i.first().closest(".ui-page");else{if(u=y(),!u)return;i=u.find(".app-page-header")}var nt=u.is(".app-page-modal"),tt=u.attr("id"),h=w(tt);if(p=i.find("h1"),l=i.find("h2"),c=u.attr("data-page-header")!=="false",typeof t=="boolean")t&&c?d():g();else return s=i.data("data-text"),t?(s&&typeof s!="string"&&typeof t=="string"&&(s[1]=t,t=s),i.data("data-text",t)):t=s,o=bi.currentNode,it=o&&o.showPageHeaderTitle,tt==="Main"&&o&&(o.showPageHeaderDescription&&(t=[t,o.description]),o.icon&&o.showPageHeaderIcon&&!i[0].className.match(/\bapp\-has\-icon\b/)&&(vt(o.icon,i.addClass("app-has-icon")),vt(o.icon,i).addClass("app-icon-background"))),t&&(typeof t=="string"?f=t.trim():(f=(t[0]||"").trim(),e=t[1].trim())),i.attr("data-locked")!=="true"&&(p.length&&(p[0].innerText=f,f&&(a=f)),l.length&&(l[0].innerText=e,e&&(a+=" / "+e),e||(l[0].innerHTML="")),f&&(nt?(b=u.find(".app-page-modal-title"),a=b.find(".app-text").text(f),e&&!b.next().is(".app-bar-actions")&&$("<span/>").appendTo(a).text(e)):(k=u.find(".app-page-header-placeholder"),k.length&&(rt=k.find(".app-text").text(f),e&&$("<span/>").appendTo(rt).text(e)))),h&&f&&(h.headerText=e?[f,e]:f,h.text=f)),(t!==n.title()||gt()==="Main"||it||nt)&&c||u.is(".app-page-header-show")?d():(g(),c&&u.attr("data-page-header","false")),t}function yet(n,t){var r=Math.ceil(i.width*.9);!t&&ic()?n.css({maxWidth:i.width-1,minWidth:i.width-1}):(r>800&&(r=800),n.css({maxWidth:r}))}function be(n){var t=e("ui.transitions.style");if(!arguments.length)return t;n?e("ui.transitions.style",e("ui.transitions.currentStyle")):(e("ui.transitions.currentStyle",t),e("ui.transitions.style","none"))}function pet(t){var r=t._hasSearchAction,u=[],f,e=t._totalRowCount,i;if(r&&(t._totalRowCount=0,f=n.contextScope(),n.contextScope(t),n.navContext(u),n.contextScope(f),t._totalRowCount=e,u.every(function(n){return n.path===r&&(i=n),i==null}),i))return t.get_searchOnStart()&&(t.set_searchOnStart(!1),t._requiresContextRefresh=!0),trt(i.context),!0}function hw(n,t,i){if(navigator.msSaveBlob)return navigator.msSaveBlob(new Blob(["﻿",t],{type:"data:attachment/text"}),n);var r=$('<a style="display: none;"/>').appendTo(o),u=URL.createObjectURL(new Blob(["﻿",t],{type:i||"text/csv"}));r.attr({download:n,href:u})[0].click();r.remove();URL.revokeObjectURL(u)}function as(n){n.find(".app-listview a").removeData();n.find('ul[data-role="listview"]').listview("destroy").remove()}function sc(t){var i=p(t);i._requiresContextRefresh=!0;n.notify({dataView:i,text:f.Refreshed});i.sync()}function wet(t,i){var e,r,u;t=p(t);u=t.multiSelect();r=t.extension().viewStyle();i.push({});r!=="Grid"||t.tagged("grid-fit-none")||(e=t.viewProp("grid-is-fitted")!==!1,i.push({text:f.FitToWidth,icon:e?"check":!1,callback:function(){var i=t.gridSettings();i&&(i.width={},t.gridSettings(i));vs(t,!e,!0);of(t);ff();n.scrollGrid(t,0);ne();pr()}}));r.match(/Grid|List|Cards/)&&!t.tagged("multi-select-none")&&(!t._lookupInfo||t._lookupInfo.multiSelect)&&(u&&i.push({}),i.push({text:f.MultiSelection,icon:u?"check":!1,context:t._id,callback:bet}));u&&i.push({text:cl.SelectAll,icon:!1,context:t._id,callback:ket},{});r.match(/Grid|List|Cards/)&&!t.tagged("inline-editing-option-none")&&ct("ui.inlineEditing.enabled")&&i.push({text:f.InlineEditing,icon:t.inlineEditing()?"check":!1,context:t._id,callback:det});i.push({text:oe.Refresh,icon:"refresh",context:t._id,callback:sc})}function bet(n){n=p(n);n.multiSelect(!n.multiSelect());n.sync();tt.detach()}function ket(n){n=p(n);n._selectedKeyList.length<n._totalRowCount&&(n._selectedKeyList=[]);rv(p(n),null,!0)}function det(n){var t=p(n);setTimeout(function(){t!==yt()||t.commandRow()||(ww(),wu(d(),0));$(document).trigger($.Event("inlineeditingmode.dataview.app",{dataView:t,inlineEditing:!t.inlineEditing()}));ne()},50)}function cw(n){n.find(".app-echo-inner .app-selected").removeClass("app-selected")}function ke(n,t){var i=ot(n),u,r;i.length&&(u=i.attr("data-for"),r=$("#"+u+"_ph").attr("data-field"),r&&oi({fieldName:r,container:d(i),scrollIntoView:t}))}function nit(n){function s(n){var f=parseInt(o.attr("data-start-index")),e=parseInt(o.attr("data-end-index")),t=n==="next"?e+1:f-1,i=0;return t<0&&(t=0),i=Math.floor(t/p(u).extension().pageSize()),{action:n,rowIndex:t,pageIndex:i,ensurePageIndex:Math.max(n=="next"?i+1:i-1,0),pageY:r.offset().top}}function h(n){r.find(".app-btn-"+n.dir).trigger("vclick")}function c(){i.removeClass("ui-btn-active");i.is(".app-btn-prev")?su(u,s("prev")):i.is(".app-btn-next")&&su(u,s("next"));n.feedback!==!1&&du()}var i=$(n.target),r=i.closest(".dv-action-see-all"),l=r.closest(".app-echo"),t=r.find(".app-btn-next"),o=r.find(".app-info"),u=l.attr("data-for"),e=rr(n.pageX);if(!i.is(".app-btn-next,.app-btn-prev"))if(t.length&&e>=t.offset().left&&e<t.offset().left+t.outerWidth()+4)i=t;else if(t=r.find(".app-btn-prev"),t.length&&e>=t.offset().left&&e<t.offset().left+t.outerWidth())i=t;else if(i.closest(".app-info").length)pi({anchor:o,yOffset:"bottom",items:[{text:f.Prev,disabled:r.find(".app-btn-prev").is(".app-btn-disabled"),icon:"material-icon-navigate-before",context:{id:u,dir:"prev"},callback:h},{text:f.Next,disabled:r.find(".app-btn-next").is(".app-btn-disabled"),icon:"material-icon-navigate-next",context:{id:u,dir:"next"},callback:h}]});else return;i.is(".app-btn-disabled")||(r.removeClass("ui-btn-active"),n.feedback===!1?c():st(i,c))}function lw(n,t){var i=$('<div class="app-echo"><\/div>').appendTo(t).attr({id:n+"_echo","data-for":n}),o,h,u=p(n),r,c=w(n),e;return c.echoChanged=!0,r=$('<div class="app-echo-toolbar"><h3><\/h3><a class="ui-btn ui-btn-inline ui-corner-all ui-icon-dots ui-btn-icon-notext app-btn-more"/><div class="app-echo-controls"><\/div><span class="app-echo-see-all"/><\/div>').appendTo(i),o=r.find("h3"),u.get_showViewSelector()||o.addClass("app-hidden"),r.find(".ui-icon-dots").attr("title",ki).css("visibility","hidden"),e=u.get_master(),vt("material-icon-chevron-right",r.find(".app-echo-see-all").css("visibility",e&&e.inserting()?"hidden":"").html(f.SeeAll)),r.find(".app-echo-controls"),u.get_showActionBar()||r.hide(),$('<div class="app-echo-instruction"><\/div>').appendTo(i).hide(),h=$('<div class="app-echo-inner"><\/div>').appendTo(i),$('<div class="app-echo-footer"><\/div>').appendTo(i),$('<div class="app-echo-empty"><\/div>').appendTo(h).text(vu),tit(i),r.find("h3").text(w(n).text),s||i.find(".app-echo-inner").attr("tabindex",0),u._hidden&&(i.hide(),u._hiddenEcho=!0),i}function du(t,i,r){var e,f,u,o=0;t?y(".app-echo-toolbar").each(function(){e=$(this).parent();f=e.attr("data-for");u=w(f);u.echoId&&!u.dataView._busy()&&su(u.echoId)}):uu||rt||co||g&&g.data("busy")?(clearTimeout(lk),lk=setTimeout(du,50,t,i)):(n.callWhenVisible(r||".app-echo",function(t){function r(){if(f=t.attr("data-for"),u=w(f),u){var i=u.dataView;!i||i._busy()||i.get_isForm()||tt._pending&&tt._dataViewId==i._id||(u.echoInitialized?u.echoChanged&&su(u.echoId):(u.echoId=t.attr("id"),n.pageInit(u.id,!1)&&u.echoInitialized&&su(u.echoId)))}}var e=i==null?o:i;e==0?r():setTimeout(r,e);o+=50}),y(".app-echo-controls.app-stale").each(function(){var n=ot($(this).removeClass("app-stale")),t=n.attr("id"),i=w(t.substring(0,t.length-5));lc(i.dataView,n)}))}function tit(){}function ov(n,t,i){var u=t._dataViewFieldName,e=u?p(t._dataViewFieldOwnerId).findField(u).HeaderText:null,r=n.find("h3").empty().text(e||t.get_view().Label||i.text),f=t._totalRowCount;return n.length&&f>0&&($("<span> (<\/span>").appendTo(r),$('<span class="app-echo-count"><\/span>').appendTo(r).text(String.format("{0:N0}",f)),$("<span>)<\/span>").appendTo(r),s||r.attr("title",r.text())),r}function hc(n){var i=ss(n),t=n.session(i);return t||(t=ca(),t.text("."+i+"frozen_{display:none!important}"),n.session(i,t)),t}function vs(n,t,r){if(arguments.length>=2)n.session("grid-is-fitted",t),r&&n.viewProp("grid-is-fitted",t?null:!1);else{var u=n.session("grid-is-fitted");return u!=null&&n.session("window-width")!==i.width&&(u=null),u==null&&(u=n.viewProp("grid-is-fitted"),u==null&&(u=!n.tagged("grid-fit-none")),n.session("grid-is-fitted",u)),u}}function ne(n){var t;n||(n=y(),t=!0);n.find(".app-grid-header").each(function(){var r=$(this),o=r.height(),e=r.find("[data-field-name]").first(),n,f,i,u;o&&e.length&&(n=p(r.attr("data-for")),f=n.inlineEditing(),f&&r.addClass("app-grid-header-bold"),i=n.session("grid-header-style"),i||(i=ca(),n.session("grid-header-style",i)),(t||n.session("reset-grid-header"))&&(i.text("").data("text",""),n.session("reset-grid-header",null)),u=".app-grid-header-cv-"+n._id+"-"+n._viewId+" > span {height:"+(r.height()-parseFloat(e.css("padding-top"))*2)+"px}",i.data("text")!=u&&i.data("text",u).text(u),f&&r.removeClass("app-grid-header-bold"))});$(document).trigger("gridresized.app")}function ys(n,t,i,r){function f(){get(n,t)}function e(){lt.scrollingAnimationFrame=null;i&&(t=-1*n.session("scroll-left"));var c=o+"-last-scroll-left",h=n.session(c)||0,l=n.session("scroll-left-margin")||0,a=Math.abs(Math.abs(t)-Math.abs(h));i&&h!=null&&a==0||(r&&t<(h||0)&&f(),u.html("."+o+"{margin-left:"+(t?t+l+"px!important":"inherit")+";transition:margin-left "+(r?s+"ms ease-out":"0 linear")+"}"),n.session(c,t),r?setTimeout(function(){f();ys(n,t)},s+64):f(),es(n));i&&(lt.scrollingAnimationFrame=requestAnimationFrame(e))}var u=n.session("scroll-style"),o=ss(n),h=+new Date,s=384;if(u||(u=ca(),n.session("scroll-style",u)),arguments.length>=2)if(i){if(lt.scrollingAnimationFrame)return;lt.scrollingAnimationFrame=requestAnimationFrame(e)}else e();return u}function get(n,t){var i=hc(n),r=t?"inline-block":"none",u=n.session("grid-frozen-width")||0;if(i&&(i.data("display")!=r||i.data("width")!=u))return i.html("."+ss(n)+"frozen_{display:"+r+"!important;width:"+u+"px}"),i.data("display",r).data("width",u),!0}function not(n){n.session("scroll-left",0);es(n);var t=n.session("scroll-style");t&&(t.remove(),n.session("scroll-style",null))}function iit(n,t,i){var r=n.extension(),u=r.aggregateLabels(),f=$('<div class="app-bar-aggregate-list"><\/div>').appendTo(t);$(n._fields).each(function(t){var o=this,h=n._allFields[o.AliasIndex],s=u[t],r,e,c;s&&(r=i[o.Index],r=String.localeFormat(o.DataFormatString||"{0:n0}",r),e=$('<a class="ui-btn ui-inline app-calculated app-btn-static"/>').appendTo(f),$('<span class="app-calculated-label"/>').text(h.HeaderText).appendTo(e),c=$('<span class="app-calculated-value"/>').text(r).appendTo(e),$('<div class="app-static-text"><\/div>').text(s).insertBefore(c.contents()),e.attr({title:h.HeaderText+"\n"+s+" "+r,"data-tooltip-location":"above"}))})}function rit(t,i){function r(){var t=[];n.navContext(t);$(t).each(function(){var n=this;if(n.command==u&&(!f||f==n.argument))return n.callback(n.context),!1})}if(!t._checkedStartCommand){t._checkedStartCommand=!0;var u=t.get_lastCommandName(),f=t.get_lastCommandArgument();u&&(i?r():vi(r))}}function uit(n){var i=ot(n),r,t;i.find(".app-listview").css("visibility","hidden");r=i.find(".app-echo-toolbar");r.find(".app-echo-controls .ui-btn,h3 span").remove();r.find(".app-echo-see-all").css("visibility","hidden");t=p(i.attr("data-for")).extension();t&&(t._commandRow=null,t.currentPageIndex(null))}function cc(n){var t=n._dataViewFieldName,i=n._dataViewFieldOwnerId;if(i&&t)return p(i).findField(t)}function fit(n,t){var i=n._detailDataViews;i&&i.forEach(function(n){var r=p(n),i=cc(r);i&&(t(i),fit(i,t))})}function aw(n){var t=cc(n);t&&t._detailDataViews&&fit(t,uit)}function su(t,i){function ru(){ii&&(iit(u,ui.show().empty(),ii),y(".app-echo").filter(gi).length===1&&p.prev().is(".app-page-header,.app-tabs")&&(it-=ui.outerHeight()))}function uu(){$(h).each(function(n){var t=this;if(u.rowIsSelected(t))return u.extension().headerText(t),ht=n,l.commandRow()?l._commandRow=t.slice(0):(l.tap(t,"none"),l.currentPageIndex(fi)),!1});vi=h.length}function or(){var n,r,f,u,t;i?(ht=null,i.action==="prev"?(k=i.rowIndex-o+1,k<0&&(k=0),r=i.rowIndex%ut,n=r-rt+1,n>0?h=h.slice(n,r+1):(h=h.slice(0,r+1),i.pageIndex&&(yt=l.visibleDataRows(i.pageIndex-1),yt&&(h=yt.slice(yt.length+n).concat(h))))):(k=i.rowIndex,n=i.rowIndex%ut,h=h.slice(n,n+o+1),h.length<o&&(yt=l.visibleDataRows(i.pageIndex+1),yt&&(h=h.concat(yt)))),uu()):ht!=null&&rt<wt&&(f=ut*fi+ht,u=o||rt,k=Math.floor(f/u)*u,t=fi*ut-k,t>0?(yt=l.visibleDataRows(fi-1),h=yt.slice(ut-t).concat(h),ht+=t):t<0&&(h=h.slice(-t),ht+=t),h.length<u&&(yt=l.visibleDataRows(fi+1),yt&&(h=h.concat(yt))),vi=ut)}function hr(n,t,i){n.empty();var r=$('<span class="app-btn-prev"/>').appendTo(n).text(f.Prev).attr("title",oe.Previous);return t||r.addClass("app-btn-disabled"),r=$('<span class="app-btn-next"/>').appendTo(n).text(f.Next).attr("title",oe.Next),i>=wt-1&&r.addClass("app-btn-disabled"),$('<span class="app-info"/>').appendTo(n).attr({"data-start-index":t,"data-end-index":i}).html(String.format(oe.ShowingItems,t+1,Math.min(i+1,wt),wt)+'<i class="app-icon material-icon">arrow_drop_down<\/i>'),n}function fu(){ct=$('<div class="dv-action-see-all"><\/div>').appendTo(a).html("text")}var p,pi,cr,lr,ar,vr,eu,bi,wr,gt,hu,si,ci,di,br,kr;if(!co&&(p=ot(t),p.length)){pi=p.is(".app-echo-embedded");p.removeClass("app-density-condensed app-density-compact");var at=d(p),lu=at.scrollTop(),au=p.outerHeight(),a=p.find(".app-echo-inner").show(),ui=a.next().hide(),vu=p.attr("data-for"),dt=w(vu),u=dt.dataView,li=u._pagerSize,nr=u.inlineEditing(),tr=hp(u),wt=u._totalRowCount,l=u.extension(),fi=i?i.pageIndex:l.pageIndex()||0,ut=l.pageSize(),k=0,vt,h=l.visibleDataRows(fi),yt,e,c,g,wi,st,ai,ni=u.get_showRowNumber()===!0,ir=$(p).find(".app-echo-toolbar"),yu=ir.find(".app-echo-controls"),gr=ir.find(".app-echo-see-all"),nu,tu=a.prev(),rr=l.instruction(!1),pt=l.viewStyle(),ei=l.itemMap(pt==="List"),pu=et.getScreenHeight(),it=at.height()*.55,ht,vi,o,rt,b,ct,oi,ur=u.get_selectedKey().length>0,yi,fr,ii=l.aggregates(),iu,er;if(tt.detach(u._id),rit(u,!0),u._checkedAutoSelect||(u._checkedAutoSelect=!0,l._autoSelect&&(yi=l._autoSelect,yi&&!ft()&&(dt.echoChanged=!0,n.contextScope(u),l.tap(yi.row,yi.action),u._selectedKeyList=[u._createRowKey(yi.row)],n.contextScope(null),ur=!0,du(!1,0)),l._autoSelect=null)),!p.is(":visible")){dt.echoChanged=!0;return}if(dt.echoChanged=!1,tit(p),!h||i&&ut*i.ensurePageIndex<wt&&!l.visibleDataRows(i.ensurePageIndex)){u.goToPage(i&&i.pageIndex||0,!0);l.echoCallback=function(){su(t,i)};return}if(nu=ov(ir,u,dt),dt.echoInitialized||(dt.echoInitialized=!0,dt.refreshed=!0),pi||p.css("padding-bottom",""),n.stub("put",at),rr&&(h.length||rr.match(/"app-filter"/))?tu.html(rr).show():tu.hide(),as(a),iu=a.find('div[data-role="presenter"]').detach(),a.empty(),iu.appendTo(a),n.presenter("hide",{container:a}),h.length||u.get_searchOnStart()&&pt==="Grid"||nr&&pt==="Grid"){if(u._filterSource||at.find(".app-echo").filter(gi).length!==1?s||at.css("overflow",""):(it=pu-a.offset().top,s||(it-=v(p,"padding-top")+v(p,"padding-bottom"),pt&&pt.match(/List|Grid|Cards/)?(at.css("overflow",""),overflowIsHidden=!0):at.css("overflow",""))),sv(u,a),n.presenter("supports",pt)&&(cr=[],lr=!1,n.presenter("enumerate",{id:u._id,list:cr}),$(cr).each(function(){if(this.name===pt)return lr=!0,!1}),a.height(""),lr&&n.presenter("show",{name:pt,id:u._id,container:a,maxHeight:Math.ceil(it)})?er=!0:pt="Grid"),!er)if(i||uu(),ar=ua(),it+=ar.is(":visible")?-ar.outerHeight():0,pt==="Grid"){a.height("");as(a);e=$('<ul class="app-listview app-grid" data-role="listview"/>').addClass(nv(u)).appendTo(a);c=$('<li data-role="list-divider" class="app-list-instruction"/>').appendTo(e);ac(u,e);uv(u,c);c=$('<li data-icon="false" class="dv-item"/>').appendTo(e);h.length&&cs(u,h[0],null,$("<a/>").appendTo(c));e.listview().listview("refresh");wi=c.outerHeight();ff(e);ne(e);it-=c.prev().outerHeight()+1;rt=Math.ceil(it/(wi+1));ii&&(rt-=2);c.remove();rt<4&&(rt=4);rt>ut&&(rt=ut);o=li||u.session("gridPagerSize");o&&(rt=o);vr=ht;o||vr==null||(ht=0);or();var lt=[],bt=[],ri=0,kt,yr;$(h).each(function(n){var i=this,f=k+n+1,t=$('<li data-icon="false" class="dv-item"/>').appendTo(e),r=$('<a class="ui-btn"/>').appendTo(t).data("data-context",{row:this.slice(0),pageIndex:0});return(cs(u,i,ni?f:null,r),r.data("rowIndex",f-1),n===ht&&(oi=i,r.addClass("app-selected")),ns(u,i,t,tr),vt=k+n,o&&n===o-1)?!1:(!ht||n<ht?lt.push(t):bt.push(t),rt<vi&&rt-1===n?!1:void 0)});ii&&(c=$('<li data-icon="false" class="dv-item"/>').appendTo(e),g=$('<a class="app-divider app-calculated"/>').appendTo(c),cs(u,ii,null,g,l.aggregateLabels()));hc(u);eu=$('<span class="app-hscrollbar2" data-view="'+u._id+'"><span class="app-hscrollbar-handle" data-draggable="hscrollbar"/><\/span>').toggleClass("app-scrollbar-wide",lf).appendTo(a).find(".app-hscrollbar-handle");(rt<vi||vi<wt)&&fu();e.listview().listview("refresh");ct&&(it-=ct.outerHeight());e.find(".dv-item").each(function(){ri+=$(this).outerHeight()});function ou(){kt&&(ri-=kt.outerHeight(),kt.find(".ui-btn").removeData(),kt.remove())}if(ri>it&&!o){if(ct||(fu(),it-=ct.outerHeight()),bt.length)while(lt.length+bt.length+1>3&&ri>it)kt=null,yr==="before"?(yr="after",lt.length>1&&lt.length>=bt.length&&(kt=lt[0],lt.splice(0,1),k++)):(yr="before",bt.length>1&&bt.length>lt.length&&(kt=bt[bt.length-1],bt.splice(bt.length-1,1),vt--)),ou();else while(lt.length>3&&ri>it)i&&i.action=="prev"?(kt=lt[0],lt.splice(0,1),k++):(kt=lt[lt.length-1],lt.splice(lt.length-1,1),vt--),ou();e.listview("refresh")}if(!o&&(o=e.find(".dv-item").length,ii&&o--,ri<it&&(o=Math.floor(it/(ri/o)),o>ut&&(o=ut)),o<3&&(o=3),u.session("gridPagerSize",o),vr!=null)){su(t,i);return}nr&&(bi=e.find(".dv-item .ui-btn:not(.app-calculated)").last(),bi.length?bi.data("rowIndex")===u._totalRowCount-1&&ev(u,e,null,!1,bi.parent()):ev(u,e));ct&&(wt<=o?ct.remove():hr(ct,k,vt));es(u,eu)}else if(pt==="List"){for(rt=ut,o=li||u.session("listPagerSize"),o&&(rt=o),or(),a.height(""),as(a),ru(),e=$('<ul class="app-listview app-onecolumnview" data-role="listview"/>').addClass(nv(u)).appendTo(a).listview(),wr=0,gt=0,ff(e),ac(u,e),ct=$('<div class="dv-action-see-all"/>text<\/div>').insertAfter(e),it-=ct.outerHeight(),ct.remove(),si=0,vt=k;gt>=0&&gt<h.length;){var ki=h[gt],wu=k+gt+1,c=$('<li data-icon="false" class="dv-item"/>'),g=$('<a class="ui-btn"/>').appendTo(c).data("data-context",{row:ki.slice(0),pageIndex:0});if(c.appendTo(e),ku(u,ki,ei,ni?wu:null,c,g,!0),gt==ht&&(oi=ki,g.addClass("app-selected")),o||e.listview("refresh"),si++,ns(u,ki,c,tr),wr+=c.outerHeight(),o){if(si==o||gt==h.length-1)break}else if(wr>=it&&si>2){si>3&&(hu=!0,vt--);break}vt++;gt++}if(si<wt&&(hu&&(g.removeData(),c.remove()),e.listview("refresh"),hr($('<div class="dv-action-see-all"><\/div>').insertAfter(e),k,vt)),o)e.listview("refresh");else if(o=e.find(".dv-item").length,g.is(".dv-action-see-all")&&o--,o<3&&(o=3),u.session("listPagerSize",o),ht!=null&&!oi){su(t,i);return}}else{for(e=$('<ul class="app-listview app-cardcolumn" data-role="listview"/>').appendTo(a),ac(u,e),sv(u,e),ru(),ci=u.session("cardsPagerSize"),ci?(e.listview(),o=ci.pagerSize,b=ci.itemsPerColumn,ai=ci.cardWidth,st=ci.columns):(ct=$('<li data-icon="false" class="dv-item"><div class="ui-btn dv-action-see-all"><\/div><\/li>').appendTo(e),it-=ct.outerHeight(),ct.remove(),c=$('<li data-icon="false" class="dv-item"/>').appendTo(e),g=$('<a class="ui-btn"/>').appendTo(c),ku(u,h[0],ei,ni?1:null,c,g),h.length>1&&(c=$('<li data-icon="false" class="dv-item"/>').appendTo(e),g=$('<a class="ui-btn"/>').appendTo(c),ku(u,h[1],ei,ni?1:null,c,g)),h.length>2&&(c=$('<li data-icon="false" class="dv-item"/>').appendTo(e),g=$('<a class="ui-btn"/>').appendTo(c),ku(u,h[2],ei,ni?1:null,c,g)),e.listview(),wi=c.outerHeight(!0),b=Math.floor(it/wi),b<1&&(b=1),st=Math.floor(a.innerWidth()/c.outerWidth(!0)),st===1&&at[0].getBoundingClientRect().width>=ti("md")&&st++,b<2&&(b=2),li&&b*st<li&&(b=Math.ceil(li/st)),o=b*st,o>ut&&(o=Math.floor(ut/b)*b),ai=st===1?Math.floor(c.outerWidth(!0)):Math.floor(a.innerWidth()/st-v(e,"margin-right")+v(e,"margin-right")/st)-2*st+1,u.session("cardsPagerSize",{pagerSize:o,itemsPerColumn:b,columns:st,cardWidth:ai})),rt=o;h.length<=(b-1)*st&&b>=1;)b--;if(or(),as(a),vt=k,$(h).each(function(n){e&&n%b!=0||(e=$('<ul class="app-listview app-cardcolumn" data-role="listview"/>').addClass(nv(u)).appendTo(a),e.css({"min-width":ai,"max-width":ai}),sv(u,e),ac(u,e),di=0);var t=this,f=k+n+1,i=$('<li data-icon="false" class="dv-item"/>').appendTo(e),r=$('<a class="ui-btn"/>').appendTo(i).data("data-context",{row:this.slice(0),pageIndex:0});if(ku(u,t,ei,ni?f:null,i,r),n===ht&&(oi=t,r.addClass("app-selected")),ns(u,t,i,tr),di++,vt===k+o-1)return!1;vt++}),di<b&&st>1&&(br=b-di,br<b))while(br-->0)c=$('<li data-icon="false" class="dv-item"/>').appendTo(e),g=$("<a/>").appendTo(c),ku(u,h[0],ei,ni?1:null,c,g),g.css("visibility","hidden").parent().addClass("app-hidden");e=ui.find(".app-echo-container-see-all").hide();wt>o&&(ui.show(),e.length?(e.show(),g=e.find(".dv-action-see-all")):(e=$('<div class="app-echo-container-see-all"><\/div>'),ii?e.insertBefore(ui.find(".app-bar-aggregate-list")):e.appendTo(ui),g=$('<div class="dv-action-see-all"><\/div>').appendTo(e)),hr(g,k,vt));ff(a.find(".app-listview").listview())}}else $('<div class="app-echo-empty"><\/div>').appendTo(a.height("")).text(rl);if(pi||p.prev().is(".app-echo")||p.next().is(".app-echo")||p.css("padding-bottom",0),er||(ur?oi||i?u.rowIsSelected(l.commandRow())||u.multiSelect()||(l.clearSelection(),l.tap(oi,"none")):l.clearSelection():l.commandRow()&&l.clearSelection()),gr.css("visibility",wt===0?"hidden":""),lc(u,p,ur,yu,nu,gr),pi&&pr(at),fr=nt(),fr.length&&!sr&&fr.offset().top>p.offset().top?at.scrollTop(lu+p.outerHeight()-au):gf(at,null,!0),kr=p.data("auto-highlight"),p.removeData("auto-highlight"),kr){var bu=$.Event("vclick",{ctrlKey:!0,force:!0}),cu=p.find(".app-listview .dv-item .ui-btn:not(.app-calculated):not(.dv-action-see-all)"),dr=kr==="first"?cu.first():cu.last();dr.is(".app-selected")||(hi(at),n.lastTouch(!1),dr.trigger(bu),nr?tt.scrollIntoView():gl(dr),n.lastTouch(!0))}n.stub("trim",at);tt.sync();u._selectedKey.length||aw(u);$(document).trigger($.Event("dataviewrefresh.app",{dataView:u}));u.get_searchOnStart()&&r.search("show",u._id)}}function lc(n,t,i,r,u,f){if(i==null&&(i=n.get_selectedKey().length>0),!r){if(t||(t=ot(n)),!t.length)return;r=t.find(".app-echo-toolbar .app-echo-controls");u=r.parent().find("h3");f=r.next()}var e=u.next().css("visibility",""),o=e.offset().left+e.outerWidth(),s=f.offset().left-16;eit(n,r,o,s)}function eit(t,i,r,u,f,e){function v(n){return n.offset().left+n.outerWidth()>d+p-1}var b=[],y=[],k,d,p,s=[],w=[],l,a={},o,h,c;if(r&&u)if(u-r>=28){if(i.find(".ui-btn").data("data-context",null),i.hide().contents().remove(),k=n.contextScope(),n.contextScope(t),t.extension().context(b,["ActionBar"]),n.contextScope(k),$(b).each(function(){var n=this;n.system?n.icon!=="search"||f||y.push(n):n.text&&!n.isStatic&&y.push(n)}),$(y).each(function(){var r=this,n,t=r.icon,u=r.text,f;l=r.group;e&&t===e||(n=$('<a class="ui-btn"/>').appendTo(i).data("data-context",r).attr({title:dy(r),"data-action-path":r.path||l}),t==="dots"||r.transition?n.addClass("app-has-children ui-mini").text(u):(n.addClass("ui-mini ui-btn-icon-left"),t==="search"?n.toggleClass("ui-btn-icon-left ui-btn-icon-notext ui-mini "):n.text(u),t=ge(t),f=ya(t),f&&vt(t,n),t===!1&&n.removeClass("ui-btn-icon-left"),o=a[l],o||(o=a[l]=[]),o.push(n)))}),p=u-r,i.width(p).show(),d=i.offset().left,i.find(".ui-btn").each(function(){var n=$(this);n.is(".ui-btn-icon-left")&&w.push(n);v(n)&&s.push(n)}),s.length)for(w.reverse();s.length;){if(h=s[0],c=v(h),c&&(isGeneric=h.is(".ui-icon-carat-r"),isGeneric?s.push(h):h.is(".ui-btn-icon-left")&&(h.toggleClass("ui-btn-icon-notext ui-mini ui-btn-icon-left"),c=v(h)),!isGeneric&&c&&$(w).each(function(){var n=this;if(s.indexOf(n)===-1&&n.is(".ui-btn-icon-left")&&(n.is(".ui-icon-carat-r")?n.hide():n.toggleClass("ui-btn-icon-notext ui-mini ui-btn-icon-left"),c=v(h),!c))return!1}),c)){$(s).each(function(){this.hide()});break}s.splice(0,1)}else for(l in a)o=a[l],o.length>1&&($(o).each(function(){$(this).addClass("app-group-item")}),o[0].addClass("app-group-first"),o[o.length-1].addClass("app-group-last"));$('<a class="ui-btn ui-btn-icon-notext ui-corner-all"/>').appendTo(i).css("visibility","hidden")}else i.hide();else i.addClass("app-stale")}function tot(n,t){var i=$('<div class="app-bar-actions ui-header ui-bar-inherit ui-header-fixed"><\/div>').insertBefore(t),u=$("<h3/>").appendTo(i).text(w(n).text),r;return $('<a class="ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-dots app-btn-more"/>').appendTo(i),r=$('<div class="app-bar-controls"><\/div>').appendTo(i),i.data({selector:u,controls:r}),i}function iot(){var n=uu||rt;return n===!0}function te(n,t){var i;if(uu||rt||lt.dragged())return!1;if(sr)if(i=$(n).closest("a"),i.data("scroll-check")===!0)i.data("scroll-check",!1);else{co=!1;var r=i.closest(".app-wrapper,.ui-panel-inner"),u=r.data("scroll-stop-time"),f=r.scrollTop();return u&&ur()-u.getTime()>5e3?!0:(i.data("scroll-check",!0),setTimeout(function(){t||(t="vclick");f===r.scrollTop()?($(n).is(".app-btn-more")?n:i).trigger(t):(te(i,t),yi())},10),!1)}return!0}function bt(t,i,r){function u(){var u,f;if(rt||g&&g.data("busy"))bt(t,ai,r);else if(hh=null,si("refresh"),u=y(),u.is(".app-page-modal"))f=[],n.navContext(f),n.refreshAppButtons(f,{toolbar:!1,actionBar:!0,promo:!0,buttonBars:u.find(".app-bar-buttons")}),r&&r();else{var e=gt(),i=ga(),o=i.data("page-id"),s=n.contextScope();o===e&&tw(i);n.contextScope(null);i.find(".app-show-request").removeClass("app-show-request").show().trigger("show.sidebar.app");i.find(".app-hide-request").removeClass("app-hide-request").hide().trigger("hide.sidebar.app");n.refreshTitleState();n.refreshContextMenu(i.data("page-id",e));n.contextScope(s);n.refreshMenuStrip();r&&r()}}but||pu()||(i==null&&(i=kut),hh&&(clearTimeout(hh),hh=null),t||(i?hh=setTimeout(u,i):u()))}function oit(n,t){if(arguments.length===1)return r.cache[n];r.cache[n]=t}function sit(n,t){var u={text:t,resolved:!0,description:null,type:null},i=n.attr("data-activator"),o,f,s,h=$(n).prev(".DataViewHeader").text(),e;return i||(s=n.closest("div[data-activator]"),i=s.attr("data-activator"),n=s),i&&(o=n.parent(),f=o.attr("id"),f||(f="aid"+wut++,o.attr("id",f)),u.container=f),i||(i=h),i&&i!="false"?(i=r.eval(i),e=nut.exec(i),e?(u.text=e[4]||e[2],u.type=e[1]):u.text=i):u.resolved=!1,u.description=n.attr("data-activator-description"),u}function vw(n,t){return pw(n,t,"call",uut)}function yw(n,t){return pw(n,t,"email",fut)}function rot(n,t){return pw(n,t,"url",eut)}function pw(n,t,i,r){var u=r&&n.Name.match(r);return t?!n.tagged("action-"+i+"-disabled")&&(n.tagged("action-"+i)||u):n.tagged("action-"+i,"field-"+i)||u}function sv(n,t){t.toggleClass("app-thumb-person",!!(n.get_isTagged("thumb-person")||n._controller.match(/\b(emp|acc|user|usr|person|cust)/i)&&!n.get_isTagged("thumb-standard")))}function ac(n,t){t.toggleClass("app-listview-multiselect",n.get_showMultipleSelection());t.toggleClass("app-listview-inlineediting",n.inlineEditing())}function hit(n,t){n=$(n);nt().length||n.scrollTop(n.scrollTop()+ye()*5*(t==="up"?-1:1))}function hv(n,t,i){n.data("scrolling",!0).animate({scrollTop:t},"swing",function(){rt=!1;i&&i();setTimeout(function(){n.removeData("scrolling")},100)})}function cit(t,r,u){var f,e,h;if(u||(u={}),f=$(t),e=u.position||"right",ri(),he=null,f.length)h=f.find("ul"),!f.is(".ui-panel-open")&&h.length>1&&(h.first().parent().css({transition:"none",transform:"none"}).removeClass("app-list-container-reverse"),h.slice(1).remove());else{f=$(String.format('<div data-position-fixed="true" data-role="panel" data-draggable="panel" data-theme="a" data-display="overlay" class="app-popup-icon-left ui-panel ui-panel-display-overlay ui-panel-animate ui-panel-position-{0}"><ul/><\/div>',e)).appendTo(o).panel({animate:wa(),position:e,beforeopen:function(){if(tr()?f.css({top:i.top,height:i.height,minHeight:i.height,right:e=="right"?i.right:"",left:e=="right"?"":i.left}):f.css({top:"",height:"",minHeight:"",right:""}),ht.width){var n=f.find(".ui-panel-inner").css({width:"","overflow-y":"scroll"});n.width(n.width()+ht.width)}f.find(".ui-panel-inner").attr("tabindex",0);tu(!1);ru=!0;ch&&(clearTimeout(ch),ch=null);r&&r()},open:function(){setTimeout(function(){ru=!1;yi();u&&u.afteropen&&u.afteropen();$(".ui-panel-open .ui-panel-inner").focus();tu(!0)})},beforeclose:function(){tu(!1);ru=!0;tw(f)},close:function(){setTimeout(function(){f.css("visibility","");tu(!0);ru=!1;he&&he();n.contextScope()&&(ch=setTimeout(function(){n.contextScope(null);ch=null},1e3));var t=hi();he||s||!t.find("[data-input-container]").length||tf(t);he=null;u&&u.close&&u.close()})}});wa(f);u.className&&f.addClass(u.className);ott(f);t.match(/^#/)&&f.attr("id",t.substring(1));f.find("ul").listview();f.on("swipe",dt);bh(f,!1);u&&u.resetScrolling&&f.addClass("app-reset-scrolling")}return f}function ie(){n.contextScope()==="_contextMenu"?ph(n._menuPanel):n.toggleContextPanel("#app-panel-context")}function re(t){return n.stickyHeaderBar(t)}function ue(t){t!=null?(clearTimeout(bk),bk=setTimeout(n.fetchOnDemand,t)):n.fetchOnDemand()}function hu(t){n.stickyHeader(t)}function ww(n){re(n).hide()}function uot(n){ww(n);hu(n)}function at(t,i,r){var u=$(".ui-panel-open"),s,f,e,c,l,o,h;if(u.length){tu(!1);f=u.find(".ui-panel-inner").addClass("app-multi-list");e=f.find(".app-list-container");e.length||(f.contents().wrap('<div class="app-list-container"><\/div>'),e=f.find(".app-list-container"));s=u.outerWidth();h='[data-panel="'+i+'"]';o=f.find(h);o.length||(o=$("<ul/>").attr("data-panel",i).appendTo(e).listview());c=u.find("ul").width(s);l=c.first();ii=t;n.refreshContextMenu(u,ii,h);e.css({transition:"",transform:"translate3d("+-(-v(l,"margin-right")+s*o.prevAll("ul").length)+"px,0,0)"}).one("transitionend",function(){setTimeout(function(){o.nextAll("ul").remove();r&&r.afteropen&&r.afteropen();tu(!0);$(".ui-panel-open .ui-panel-inner").focus()})})}else return ii=t,(n.contextScope()&&(!r||r.position!=="left")||r&&r.position!="right")&&(i+="-scope",r||(r={}),r.position="left"),ph(cit(i,function(){n.refreshContextMenu(i,ii)},r))}function bw(n){var r=new lu.StringBuilder,o=n._fields,i,f,u=n.get_sortExpression(),e=tl,t;if(u)for(t=e.exec(u);t;)i=n.findField(t[1]),f=!t[3]||t[3].match(/^asc/)?"asc":"desc",i&&i.AllowSorting&&(r.isEmpty()||r.append(", "),r.appendFormat("{0} ({1})",i.HeaderText,de(i,f))),t=e.exec(u);return r.toString()}function kw(n){var i=new lu.StringBuilder,o=n._fields,r,e,u=n.get_groupExpression(),f=tl,t;if(u)for(t=f.exec(u);t;)r=n.findField(t[1]),e=!t[3]||t[3].match(/^asc/)?"asc":"desc",r&&r.AllowSorting&&(i.isEmpty()||i.append(", "),i.appendFormat("{0}",r.HeaderText)),t=f.exec(u);return i.toString()}function ps(n){n.extension()._instructed=!1;w(n).stickyHeader.find(".app-bar-text").removeData("html")}function dw(t,i){var h=t.groupExpression(),u=t.get_sortExpression(),o,e=0,s;if(h&&u){for(u=u.split(r._simpleListRegex);e<u.length;)o=u[e].match(/(\w+)(\s+\w+)?/),!u[e]||o&&h.indexOf(o[1])!=-1?u.splice(e,1):e++;u=u.join(",");t.set_sortExpression(u);t.viewProp("sortExpression",u)}t.viewProp("groupExpression",i);t.set_groupExpression(i);ps(t);t._keepKeyList=!0;t.AutoPivots=null;of(t);s=kw(t);n.notify({dataView:t,text:s?f.Grouped+" - "+s:f.UnGrouped});t.sync()}function gw(n){n.session("reset-grid-header",!0)}function of(n){n?$(n._views).each(function(){var i=this,t=i.Id;i.Type!=="Form"&&(n.session("grid-style-changed",!0,t),n.session("grid-avail-width",null,t),n.session("window-width",null,t))}):(n=yt(),n&&(of(n),(n._allFields||[]).forEach(function(n){if(n.Type==="DataView"){var t=p(n._dataViewId);t&&of(t)}}),ff(),ne()))}function cv(){var t=n.contextDataView(),i;cr!=null&&(t.set_sortExpression(cr),cr=null,ps(t),t._keepKeyList=!0,gw(t),i=bw(t)||"",n.notify({dataView:t,text:i?f.Sorted+" - "+i:f.SortedDefault}),t.sync())}function fe(n,t,i){var e=cr==null?n.get_sortExpression()||"":cr,o=e.split(r._simpleListRegex),u,f;if(i==null){if(e)for(u=0;u<o.length;u++)if(f=o[u].match(out),f&&f[1]===t)return f[3]||"asc";return null}cr=i?String.format("{0} {1}",t,i):"";n.viewProp("sortExpression",cr)}function de(n,t){var i=au.GenericSortAscending,r=au.GenericSortDescending;switch(n.FilterType){case"Text":i=au.StringSortAscending;r=au.StringSortDescending;break;case"Date":i=au.DateSortAscending;r=au.DateSortDescending}return t==="asc"?i:r}function nr(n,t){ii=n;t?setTimeout(t,500):lv()}function fot(n,t){function h(n,t){for(var s,u="",i="",f=[],e=0;e<t;e++)i+=o;for(s in n)f.push(s);f.forEach(function(e,s){u=i+e+": ";var c=n[e],l=s==f.length-1?"":",";c!=null&&c instanceof Array?(u+="[",r.push(u),c.forEach(function(n,u){var f=u===c.length-1?"":",";typeof n=="object"?(r.push(i+o+"{"),h(n,t+2),r.push(i+o+"}"+f)):r.push(i+o+JSON.stringify(n)+f)}),r.push(i+"]"+l)):typeof c=="object"?(u+="{",r.push(u),h(c,t+1),r.push(i+"}"+l)):r.push(u+JSON.stringify(c)+l)})}var s=p(n),u=s._controller,e="",a=t.closest("ul").find(".app-layout-size").filter(function(){return $(this).find(".app-icon").length>0}),f=s._survey,c,i,l,r,o;if(f&&f.layout?(u=u.replace(/__search/,"._search"),e+=String.format("<!--\r\n\t~/js/surveys/{0}.html\r\n-->\r\n{1}",u,f.layout)):(u+="."+s._viewId,a.each(function(){var n=$(this).data("context-action");e+="\r\n<!--  "+n.text+" -->\r\n";e+=dg(s,ti(n.context));e+="\r\n"}),e=String.format("<!--\r\n\t~/views/{0}.html\r\n-->\r\n{1}",u,e.replace(/<span\s+class=\"app-control-inner\">([\s\S]+?)<\/span>/g,"$1").replace(/\n\s*>/g,">"))),hw(u+".html.txt",e,"text/plain"),f){c=f.context;f.context=null;i=JSON.stringify(f);c!=null&&(f.context=c);i=JSON.parse(i);i.text&&typeof i.text!="string"&&(i.text=i.text[0]);for(l in i)["options","text","text2","topics","controller",].indexOf(l)===-1&&delete i[l];i.layout="#ref";i.cache=!1;r=[];o="    ";h(i,1);i=String.format("//\r\n//\t~/js/surveys/{0}.js\r\n//\r\n({{\r\n{1}\r\n}})();",u,r.join("\r\n"));hw(u+".js.txt",i,"text/plain")}}function nb(n){or=JSON.parse(JSON.stringify(n));var t=n.width,r=n.height,u=t>r?!1:i.isVirtual&&i.width>i.height?!0:or&&(r==null||t<r)?!1:!0;t==null?i.isVirtual=!1:t==="auto"?i.isVirtual=!0:(i.isVirtual=!0,u?(i.width=r,i.height=t):(i.width=t,i.height=r),n.width=i.width,n.height=i.height);wh(n);i.deviceWidth=i.deviceHeight=null;ae();ou.trigger("resize")}function eot(){function u(n){if(i.isVirtual){var t=Math.min(or.width,or.height),r=Math.max(or.width,or.height);i.deviceWidth=null;i.deviceHeight=null;n==="Portrait"?(i.width=t,i.height=r):(i.width=r,i.height=t)}or.width=i.width;or.height=i.height;wh(or);ae();ou.trigger("resize")}var e=ii,t=or.name,r=i.width>i.height?"Landscape":"Portrait",n=[{text:f.Back,icon:wt,callback:function(){nr(e)}}];or.width&&(n.push({text:f.Orientation,instruction:!0}),n.push({text:f.Portrait,icon:r==="Portrait"?"check":!1,context:"Portrait",callback:u}),n.push({text:f.Landscape,icon:r==="Landscape"?"check":!1,context:"Landscape",callback:u}));n.push({text:f.Device,isStatic:!1,instruction:!0});n.push({text:"Responsive",icon:tr()?!1:"check",context:{name:"Responsive"},callback:nb});n.push({text:"Generic",icon:t==="Generic"?"check":!1,context:{name:"Generic",width:"auto",height:"auto"},callback:nb});[{n:"Moto G4 ",w:360,h:640},{n:"Galaxy S5 ",w:360,h:640},{n:"Pixel 2 ",w:411,h:731},{n:"Pixel 2 XL",w:411,h:823},{n:"iPhone 5/SE",w:320,h:568},{n:"iPhone 6/7/8",w:375,h:667},{n:"iPhone 6/7/8 Plus",w:414,h:736},{n:"iPhone X",w:375,h:812},{n:"iPad",w:768,h:1024},{n:"iPad Pro",w:1024,h:1366},{n:"Surface Pro 7",w:1368,h:912}].forEach(function(i){var r=i.n;n.push({text:r,icon:t===r?"check":!1,context:{name:r,width:i.w,height:i.h},callback:nb})});at(n,"#app-panel-developer-tools-device")}function oot(){function i(n,t){var i=t.find(".app-icon");i.length?(i.remove(),t.removeClass("app-has-material-icon")):vt("material-icon-check",t)}var r=ii,n=[{text:f.Back,icon:wt,callback:function(){nr(r)}},{text:oh.FormLayout,isStatic:!1,instruction:!0},],u=yt(),t;n.push({text:f.Download,icon:"material-icon-get-app",context:u._id,keepOpen:!0,callback:fot});t=pf(rf(d()));n.push({text:oh.FormLayoutInstr,instruction:!0});n.push({text:"Tiny (tn)",icon:t==="tn"?"check":!1,keepOpen:!0,context:"tn",linkClassName:"app-layout-size",callback:i});n.push({text:"Extra Extra Small (xxs)",icon:t==="xxs"?"check":!1,keepOpen:!0,context:"xxs",linkClassName:"app-layout-size",callback:i});n.push({text:"Extra Small (xs)",icon:t==="xs"?"check":!1,keepOpen:!0,context:"xs",linkClassName:"app-layout-size",callback:i});n.push({text:"Small (sm)",icon:t==="sm"?"check":!1,keepOpen:!0,context:"sm",linkClassName:"app-layout-size",callback:i});n.push({text:"Medium (md)",icon:t==="md"?"check":!1,keepOpen:!0,context:"md",linkClassName:"app-layout-size",callback:i});n.push({text:"Large (lg)",icon:t==="lg"?"check":!1,keepOpen:!0,context:"lg",linkClassName:"app-layout-size",callback:i});n.push({text:"Extra Large (xl)",icon:t==="xl"?"check":!1,keepOpen:!0,context:"xl",linkClassName:"app-layout-size",callback:i});n.push({text:"Extra Extra Large (xxl)",icon:t==="xxl"?"check":!1,keepOpen:!0,context:"xxl",linkClassName:"app-layout-size",callback:i});at(n,"#app-panel-developer-tools-form-layout")}function sot(){var r=ii,n=[{text:f.Back,icon:wt,callback:function(){nr(r)}},{text:oh.Tools,isStatic:!1,instruction:!0},],t=wh(),i=yt();n.push({text:f.Device,icon:"material-icon-devices",desc:tr()&&t?t.name:null,transition:!0,callback:eot});i&&i.get_isForm()&&!si()&&n.push({text:oh.FormLayout,icon:!1,transition:!0,callback:oot});at(n,"#app-panel-developer-tools")}function hot(){function t(n){n==="OnHover"&&o.addClass("app-show-system-buttons-on-hover");n==="Always"&&o.removeClass("app-show-system-buttons-on-hover");kt("showSystemButtons",n);e("ui.showSystemButtons",n)}var i=ii,r=[{text:f.Back,icon:wt,callback:function(){nr(i)}},{text:f.ShowSystemButtons,isStatic:!1,instruction:!0},{text:f.OnHover,icon:e("ui.showSystemButtons")==="OnHover"||e("ui.showSystemButtons")=="Auto"&&!s?"check":!1,context:"OnHover",callback:t},{text:f.Always,icon:e("ui.showSystemButtons")==="Always"?"check":!1,context:"Always",callback:t},];n.contextScope("_contextMenu");at(r,"#app-panel-settings-showsystembuttons")}function lit(){function t(t){ttt();n.contextScope(null);e("ui.sidebar.when",t);kt("sidebar",t);pa();br(!0)}var r=ii,i=e("ui.sidebar.when"),u=[{text:f.Back,icon:wt,callback:function(){nr(r)}},{text:f.Sidebar,isStatic:!1,instruction:!0},{text:f.Landscape,icon:i==="Landscape"?"check":!1,context:"Landscape",callback:t},{text:f.Always,icon:i==="Always"?"check":!1,context:"Always",callback:t},{text:f.Never,icon:i==="Never"?"check":!1,context:"Never",callback:t}];n.contextScope("_contextMenu");at(u,"#app-panel-settings-sidebar")}function tb(n){return n=n.toLowerCase(),n==="tiny"&&(n="condensed app-font-tiny"),"app-density-"+n}function ib(n){return"app-theme-"+n.toLowerCase()}function ait(t,i){var r=ei.ui.theme,u=r.name,f=r.accent;t.theme?r.name=t.theme.name:t.accent&&(r.accent=t.accent.name);i.closest(".ui-panel-inner").find(".app-item-theme-"+(t.theme?"name":"accent")+" i").remove();vt("material-icon-check",i);setTimeout(function(){e("ui.theme.name",r.name);e("ui.theme.accent",r.accent);n._changeThemeLink(u+"."+f,r.name+"."+r.accent,function(){u&&o.removeClass(ib(u));o.addClass(ib(r.name));gu.trigger("themechanged.app");var n=$(".ui-panel-open").css("transition","opacity 500ms");setTimeout(function(){n.css("opacity",0);setTimeout(function(){n.css("opacity","");setTimeout(function(){n.css("transition","")},600)},r.preview||1e3)},32)})},200)}function cot(){function o(){$(r.themes).each(function(){var n=this;t.push({text:se.List[n.name]||n.text||n.name,icon:i.name==n.name?"check":!1,keepOpen:!0,context:{theme:n},callback:ait,linkClassName:"app-item-theme-name",color:n.color})});t.push({text:se.Accent,isStatic:!1,instruction:!0});$(r.accents).each(function(){var n=this;t.push({text:se.List[n.name]||n.text||n.name,icon:i.accent==n.name?"check":!1,keepOpen:!0,context:{accent:n},callback:ait,linkClassName:"app-item-theme-accent",color:n.color})})}var u=ii,s=e("ui.theme.name"),t=[{text:f.Back,icon:wt,callback:function(){nr(u)}},{text:se.Label,isStatic:!1,instruction:!0}],i=ei.ui.theme,r=i.config;t.push({text:vu,icon:"material-icon-refresh",animate:!0,keepOpen:!0,callback:dt});at(t,"#app-panel-settings-theme");n.getThemes().done(function(i){r=ei.ui.theme.config=i;var u=$('.ui-panel-open [data-panel="#app-panel-settings-theme"] .ui-btn.app-animated').closest(".ui-panel");u.length&&(t.splice(t.length-1,1),o(),n.refreshContextMenu(u,t,'[data-panel="#app-panel-settings-theme"]'))})}function lot(){function i(t){t!=n&&(e("ui.transitions.style",t),kt("transitions",t))}var r=ii,n=e("ui.transitions.style"),t=[{text:f.Back,icon:wt,callback:function(){nr(r)}},{text:f.Transitions.Label,isStatic:!1,instruction:!0},];t.push({text:f.Transitions.List.none,icon:"none"==n?"check":!1,context:"none",callback:i});t.push({text:f.Transitions.List.slide,icon:"slide"==n?"check":!1,context:"slide",callback:i});at(t,"#app-panel-settings-theme")}function aot(){var r=ii,n=e("ui.displayDensity.value"),i=[{text:f.Back,icon:wt,callback:function(){nr(r)}},{text:f.DisplayDensity.Label,isStatic:!1,instruction:!0},];for(var t in f.DisplayDensity.List)i.push({text:f.DisplayDensity.List[t],icon:t==n?"check":!1,context:t,callback:function(t){t!=n&&(ou.trigger("resize"),o.removeClass(tb(n)),e("ui.displayDensity.value",t),o.addClass(tb(t)),ci(),kt("displayDensity",t),yo=null,br())}});at(i,"#app-panel-settings-display-density")}function vot(){var t=ii,u=e("ui.list.labels.display"),i=[{text:f.Back,icon:wt,callback:function(){nr(t)}},{text:f.LabelsInList.Label,isStatic:!1,instruction:!0},];for(var n in f.LabelsInList.List)i.push({text:f.LabelsInList.List[n],icon:n==u?"check":!1,context:n,callback:function(n){e("ui.list.labels.display",n);kt("labelsInList",n);r.confirm(f.ConfirmReload,function(){ap()},function(){nr(t)})}});at(i,"#app-panel-settings-labels-in-form")}function vit(){function r(n){e("ui.actions.promote",n);kt("promoteActions",n);bt();nr(t,vit)}var t=ii,i=e("ui.actions.promote"),n=[{text:f.Back,icon:wt,callback:function(){nr(t)}},{text:f.PromoteActions,isStatic:!1,instruction:!0},];n.push({text:hl,icon:i!=!1?"check":!1,context:!0,callback:r});n.push({text:sl,icon:i==!1?"check":!1,context:!1,callback:r});at(n,"#app-panel-promote-actions")}function yot(){var t=ii,u=e("ui.list.initialMode"),i=[{text:f.Back,icon:wt,callback:function(){nr(t)}},{text:f.InitialListMode.Label,isStatic:!1,instruction:!0},];for(var n in f.InitialListMode.List)i.push({text:f.InitialListMode.List[n],icon:n==u?"check":!1,context:n,callback:function(n){kt("initialListMode",n);r.confirm(f.ConfirmReload,function(){ap()},function(){nr(t)})}});at(i,"#app-panel-settings-default-list-mode")}function pot(){function u(n){e("ui.smartDates",n);kt("smartDates",n);r.confirm(f.ConfirmReload,function(){ap()},function(){nr(t)})}var t=ii,i=e("ui.smartDates"),n=[{text:f.Back,icon:wt,callback:function(){nr(t)}},{text:f.Dates.SmartDates,isStatic:!1,instruction:!0},];n.push({text:hl,icon:i!=!1?"check":!1,context:!0,callback:u});n.push({text:sl,icon:i==!1?"check":!1,context:!1,callback:u});at(n,"#app-panel-smart-dates")}function wot(){function i(n){n.selected||dr._instance.changeCulture(n.value)}var t=ii,n=[{text:f.Back,icon:wt,callback:function(){nr(t)}},{text:cf.ChangeLanguageToolTip,isStatic:!1,instruction:!0},];$(r.cultureList).each(function(){var t=this;n.push({text:t.text,icon:!1,selected:t.selected,context:t,keepOpen:t.selected,callback:i})});at(n,"#app-panel-languages")}function vc(){return i.width>=ti("md")}function bot(){lv("left")}function lv(n){var t=[],u,i;n||t.push({text:f.Back,icon:wt,callback:ie});t.push({text:f.Settings});ct("settings.options.displayDensity")&&t.push({text:f.DisplayDensity.Label,icon:"material-icon-blur-on",transition:!0,callback:aot,desc:f.DisplayDensity.List[e("ui.displayDensity.value")]});ct("settings.options.theme")&&(u=e("ui.theme.name"),i=e("ui.theme.accent"),t.push({text:se.Label,icon:"material-icon-brush",transition:!0,callback:cot,desc:(se.List[u]||r.prettyText(u))+(i=="None"?"":" "+(se.List[i]||r.prettyText(i)))}));ct("settings.options.transitions")&&t.push({text:f.Transitions.Label,icon:"material-icon-swap-horiz",transition:!0,callback:lot,desc:f.Transitions.List[e("ui.transitions.style")]});ct("settings.options.sidebar")&&vc()&&t.push({text:f.Sidebar,icon:"material-icon-view-quilt",transition:!0,callback:lit,desc:e("ui.sidebar.when")=="Landscape"?f.Landscape:e("ui.sidebar.when")=="Always"?f.Always:f.Never});ct("settings.options.labelsInList")&&t.push({text:f.LabelsInList.Label,icon:"material-icon-text-format",transition:!0,callback:vot,desc:f.LabelsInList.List[e("ui.list.labels.display")]});ct("settings.options.showSystemButtons")&&!s&&t.push({text:f.ShowSystemButtons,icon:"material-icon-more-"+(kr?"vert":"horiz"),transition:!0,callback:hot,desc:e("ui.showSystemButtons")=="OnHover"||e("ui.showSystemButtons")=="Auto"&&!s?f.OnHover:f.Always});ct("settings.options.promoteActions")&&t.push({text:f.PromoteActions,icon:"material-icon-add-circle",transition:!0,callback:vit,desc:ct("ui.actions.promote")?hl:sl});ct("settings.options.smartDates")&&t.push({text:f.Dates.SmartDates,icon:"material-icon-event",transition:!0,callback:pot,desc:e("ui.smartDates")!=!1?hl:sl});ct("settings.options.initialListMode")&&t.push({text:f.InitialListMode.Label,icon:"material-icon-receipt",transition:!0,callback:yot,desc:f.InitialListMode.List[e("ui.list.initialMode")]});$(r.cultureList).each(function(){var n=this;if(n.selected)return t.push({text:n.text,icon:"material-icon-language",transition:!0,callback:wot}),!1});at(t,"#app-panel-settings",n?{position:n}:null)}function rb(t){function p(n){var t=0;return n.closest("ul").find(".app-keep-open").each(function(){var n=$(this).data("context-action").context;n.index&&n.index>t&&(t=n.index)}),t}function w(n,t){n.closest("ul").find(".app-keep-open").each(function(){var n=$(this).data("context-action").context;n.index&&n.index>t&&n.index--})}function b(n){n.closest("ul").find(".app-keep-open").each(function(){var n=$(this),t=n.data("context-action").context;n.find(".ui-li-count").remove();t.index&&$('<span class="ui-li-count ui-body-inherit"/>').appendTo(n).text(t.index)})}var r=n.contextDataView(),i=r.get_groupExpression(),l=r.get_view().Label,a=r._fields,v=r._allFields,s=[],u=[],h,e,y=1,c,o={};if(t||u.push({text:f.Back,icon:wt,callback:ie}),i&&u.push({text:f.GroupedBy+" "+kw(r)+"."},{text:rh,icon:"delete",callback:function(){dw(r,null)}}),u.push({},{text:fh,icon:"material-icon-check",callback:function(n,t){var u=[];$(t).closest("ul").find(".app-keep-open").each(function(){var n=$(this).data("context-action").context;n.index&&u.push(n)});u.sort(function(n,t){return n.index-t.index});i="";$(u).each(function(){var n=this;i&&(i+=",");i+=n.field});dw(r,i)}},{text:String.format(f.GroupByField,l)}),i)for(h=tl,e=h.exec(i);e;)c=r.findField(e[1]),c&&(o[c.Name]={field:e[1],index:y++}),e=h.exec(i);$(a).each(function(){var n=this,t=n;n=v[n.AliasIndex];!t.Hidden&&n.AllowSorting&&n.Type!="DataView"&&s.push(n)});s.sort(function(n,t){var i=o[n.Name],r=o[t.Name];return(i?i.index:1e3)-(r?r.index:1e3)});$(s).each(function(){var t=this,n;n=o[t.Name];u.push({text:t.HeaderText,keepOpen:!0,icon:!1,context:n||{field:t.Name},count:n?n.index:null,callback:function(n,t){n.index?(w(t,n.index),n.index=null):n.index=p(t)+1;b(t)}})});at(u,"#app-panel-group-fields")}function kot(){function c(n){var t,r=0;$(i).each(function(){var i=this,r=i.context;if(r&&r.field==n.field)return t=i,!1});n.order?(t.context.order||($(i).each(function(){var n=this.context;n&&n.index>r&&(r=n.index)}),t.context.index=r+1,t.count=r+1),t.icon=n.order=="asc"?"arrow-u":"arrow-d",t.context.order=n.order):($(i).each(function(){var i=this,n=i.context;n&&n.index>t.context.index&&(i.count--,n.index--)}),t.context.order=null,t.context.index=null,t.count=null,t.icon=!1);at(i,"#app-panel-sort-fields")}var t=n.contextDataView(),u=t.get_sortExpression(),l=t.get_view().Label,a=t._fields,v=t._allFields,o=[],i=[{text:f.Back,icon:wt,callback:ie}],s,r,y=1,h,e={};if(u&&i.push({text:bw(t)},{text:rh,icon:"delete",callback:function(){cr="";t.viewProp("sortExpression",cr);cv()}}),i.push({text:fh,icon:"material-icon-check",callback:function(n,i){var r=[];$(i).closest("ul").find(".ui-btn").each(function(){var n=$(this).data("context-action").context;n&&n.order&&r.push(n)});r.sort(function(n,t){return n.index-t.index});cr="";$(r).each(function(){var n=this;cr&&(cr+=",");cr+=n.field+" "+n.order});t.viewProp("sortExpression",cr);cv()}},{text:String.format(f.SortByField,l)}),u)for(s=tl,r=s.exec(u);r;)h=t.findField(r[1]),h&&(e[h.Name]={field:r[1],index:y++,order:r[3]&&r[3].match(/^desc/i)?"desc":"asc"}),r=s.exec(u);$(a).each(function(){var n=this,t=n;n=v[n.AliasIndex];!t.Hidden&&n.AllowSorting&&n.Type!="DataView"&&o.push(n)});o.sort(function(n,t){var i=e[n.Name],r=e[t.Name];return(i?i.index:1e3)-(r?r.index:1e3)});$(o).each(function(){var r=this,n,u=t.groupExpression();n=e[r.Name];i.push({text:r.HeaderText,icon:n?n.order=="asc"?"arrow-u":"arrow-d":!1,context:n||{field:r.Name},count:n?n.index:null,transition:!0,callback:function(n){var r=t.findField(n.field),e=[{text:f.Back,icon:wt,callback:function(){at(i,"#app-panel-sort-fields")}},{text:String.format(f.SortByOptions,t.get_view().Label,r.HeaderText)},{text:de(r,"asc"),icon:n.order=="asc"?"check":!1,transition:!0,reverse:!0,context:{order:"asc",field:n.field},callback:c},{text:de(r,"desc"),icon:n.order=="desc"?"check":!1,transition:!0,reverse:!0,context:{order:"desc",field:n.field},callback:c}];u&&u.indexOf(n.field)!=-1||e.splice(2,0,{text:f.None,icon:n.order?!1:"check",transition:!0,reverse:!0,context:{field:n.field},callback:c});at(e,"#app-panel-sort-field-options")}})});at(i,"#app-panel-sort-fields")}function dot(n){var t=n.find(".app-group"),i=t.length?t.first().outerHeight(!0):0;return t.remove(),i}function got(n,t){var r=n.groupExpression(),o=[],v=n.get_showFirstLetters()&&!r,s,i=0,u,f,e,c,l,h,a;if(r){while(i<r.length)s=n.findField(r[i]),s?r[i++]=n._allFields[s.AliasIndex]:r.splice(i,1);t.find("li a").each(function(){var s=$(this),k=s.data("data-context"),t=[],y=[],p=[],w,b=[],d,n,g;k?($(r).each(function(l){var it=this,nt=k.row[it.Index],a,rt,tt,ft,ut;if(nt!=null&&(a=v?nt.substring(0,1):it.text(nt)),t.push(a),y.push(it.HeaderText),p.push(it.Type),b.push(nt),o.length&&o[l]==a||(o[l]=a,d=!0),d&&l==r.length-1){for(u&&($('<span class="app-group-count"/>').appendTo(u).text(f+(h?"+":"")),h=!1),n=$('<li class="app-group"/>').insertBefore(s.parent()),$('<span class="glyphicon glyphicon-menu-up"/>').appendTo(n),tt=null,rt=null,w=p[p.length-1].match(/^Date/),nt!=null&&p.length==1&&w&&(nt=b[b.length-1],rt=hf.DayNames[nt.getDay()]+" "+nt.getDate(),tt=hf.MonthNames[nt.getMonth()],ft=nt.getFullYear()),tt&&(e=$('<span class="app-group-info"/>').appendTo(n),$('<span class="app-group-info-value"/>').appendTo(e).text(tt),$('<span class="app-group-info-value-muted"/>').appendTo(e).text(ft),c!=tt?c=tt:e.addClass("app-group-info-duplicate")),w&&n.addClass("app-group-fixed"),f=0,i=0;i<t.length-1;)ut||(ut=$('<span class="app-group-path"/>').appendTo(n)),g=$('<span class="app-group-path-value"/>').appendTo(ut),a=t[i],a||(a=ey),g.text(a).attr("title",y[i]+":\n"+a),i++;a=rt||t[t.length-1];u=$('<span class="app-group-title"/>').appendTo(n).text(a);a||(a=ey);u.text(a).attr("data-text",a).attr("title",y[y.length-1]+":\n"+a)}}),f++):s.is(".dv-load-at-bottom")?a=!0:!l&&s.is(".dv-load-at-top")&&(h=!0,l=!0)});u&&$('<span class="app-group-count"/>').appendTo(u).text(f+(a?"+":""))}}function nst(n){var t=n.get_filter(),i=n._externalFilter||[];return t&&t.length&&i.length<t.length||we(n).length}function yit(n){var t=$(".ui-panel-open .app-btn-apply,.ui-popup-active .app-btn-apply");t.is(".app-enabled")||(n?t.removeClass("ui-disabled"):t.addClass("ui-disabled"))}function tst(n){var t=n.is(".app-include");n.find(".app-icon").text(t?"check_box":"check_box_outline_blank").toggleClass("material-icon-check-box",t).toggleClass("material-icon-check-box-outline-blank",!t)}function ist(n,t){var f=ub(t),u=fb(t),r,i;t.toggleClass("app-include");r=u.filter(".app-include").length;i=u.length==r;tst(t);f.find(".app-icon").text(i?"check_box":"check_box_outline_blank").toggleClass("material-icon-check-box",i).toggleClass("material-icon-check-box-outline-blank",!i);yit(r>0)}function ub(n){return n.closest(".ui-panel-inner").find(".app-btn-select-all a")}function fb(n){return ub(n).parent().nextAll().find("a")}function rst(n){return n.length>0?n.data("data-context")||n.data("context-action"):null}function ust(n,t){var i=p(n.dataViewId),r=n.field,f=i.findField(r),e=i._allFields[f.AliasIndex],u=fst(i,r,t);i.removeFromFilter(e);u&&i._filter.push(u);us(i)}function fst(n,t,i){function s(t){r=[];o.each(function(){var i=$(this),u=i.is(".app-include");(u&&t||!u&&!t)&&r.push(n.convertFieldValueToString(f,f._listOfValues[rst(i).context]))})}var f=n.findField(t),h=n._allFields[f.AliasIndex],u=[],r,e,o=fb(i);return o.filter(":not(.app-include)").length&&(s(!0),r.length&&(u.push(h.Name+":"),r.length==1?u.push("="+r[0]):(e=r.length<=10||r.length<=r.length/2,u.push(e?"$in$":"$notin$"),e||s(!1),$(r).each(function(n){n>0&&u.push("$or$");u.push(this)})))),u.join("")}function ws(t){function s(n,t,u){var e=n._dataView,o=e._allFields[n.AliasIndex],s=e.get_fieldFilter(o,!0);i||(t.push({text:f.Back,icon:wt,callback:l}),t.push({text:o.HeaderText}));t.push({});s&&t.push({text:rh,context:o.Name,callback:function(){e.removeFromFilter(o);us(e)},icon:"material-icon-clear"});t.push({text:vr.Filters[o.FilterType].Text,context:{id:e._id,field:e._allFields[n.OriginalIndex].Name},desc:s!=="$in"&&s!=="$notin"?u:null,callback:function(n){r.search("show",n)},transition:!1,icon:"material-icon-filter-list"});i||t.push({text:String.format(f.FilterByOptions,e.get_view().Label,o.HeaderText,fh)})}function h(n,t){var f,i,v,r=n._dataView,h=n._listOfValues||[],c=r._allFields[n.AliasIndex],o=r.get_fieldFilter(c,!0),l=[],y,a,e,u,s=o==="$notin";for(o&&(o==="="||o==="$in"||s)&&(a=(r.get_fieldFilter(c)||"").split(/\$or\$/)),y={text:fh,icon:"material-icon-check",disabled:!0,itemClassName:"app-btn-apply",context:{dataViewId:r._id,mappedId:r._mappedId,field:n.Name},callback:ust},t.push(y,{}),h.length>1&&t.push({text:fy.SelectAll,keepOpen:!0,itemClassName:"app-btn-select-all",icon:"material-icon-check-box-outline-blank",callback:function(n,t){var r=fb(t),i=r.filter(".app-include").length===r.length;ub(t).find(".app-icon").text(i?"check_box_outline_blank":"check_box").toggleClass("material-icon-check-box",!i).toggleClass("material-icon-check-box-outline-blank",i);i?r.removeClass("app-include").find(".app-icon").text("check_box_outline_blank").removeClass("material-icon-check-box").addClass("material-icon-check-box-outline-blank"):r.addClass("app-include").find(".app-icon").text("check_box").addClass("material-icon-check-box").removeClass("material-icon-check-box-outline-blank");yit(!i)}}),f=0;f<h.length;f++)i=h[f],u=a&&a.indexOf(r.convertFieldValueToString(n,i))!==-1,s&&(u=!u),v=i==null?fl:typeof i=="string"&&i===""?ey:c.text(i),e={text:v,icon:"material-icon-"+(u?"check-box":"check-box-outline-blank"),keepOpen:!0,context:f,callback:ist,linkClassName:u?"app-include":""},u?s?l.push(e):t.push(e):s?t.push(e):l.push(e);return t.concat(l)}function c(t,i){var r=[],f=n.contextDataView(),u=f.findField(t),l=f._allFields[u.AliasIndex],e=$(i).data("contextAction"),c=e?e.desc:null;s(l,r,c);o&&r.splice(0,1);u._listOfValues&&u._listOfValues.length?r=h(u,r):r.push({text:vu,icon:"material-icon-refresh",animate:!0,context:{id:f._id,field:t},keepOpen:!0,callback:dt});at(r,"#app-panel-filter-field",{position:"right",resetScrolling:!0,afteropen:function(){var u=on().data("context-action"),r=u&&u.context,i,f,t;r&&(i=p(r.id),t=i.findField(r.field),f=i._allFields,i._loadListOfValues(null,t.Name,f[t.AliasIndex].Name,function(){var u=on(),f=u.length&&u.data("context-action").context,r=[];u.length&&f.id===i._id&&f.field===t.Name&&(s(t,r,c),o&&r.splice(0,1),r=h(t,r),n.refreshContextMenu(u.closest(".ui-panel"),r,'[data-panel="#app-panel-filter-field"]'))}))}})}function l(){var t=n.contextDataView(),i=e?[]:[{text:f.Back,icon:wt,callback:ie}],o={},u=t&&t._filter,s=t&&t._externalFilter;if(nst(t)){if(e&&we(t).length){if(!u.length||t._filterSource&&u.length==s.length){r.search();return}i.push({text:bn(t)});i.push({text:oo.ShowAdvancedSearch,icon:"search",toolbar:!1,system:!0,context:{dataViewId:t._id},callback:hn})}u.length&&(i.push({text:t.extension().filterStatus(!1,!0)}),i.push({text:f.ClearFilter,icon:"delete",callback:function(){var t=n.contextDataView();ba(t,!0)}}))}i.push({text:String.format(f.FilterByField,t.get_view().Label)});$(u).each(function(){var n=this,t=n.match(/^\w+/);t&&(o[t[0]]=n)});$(s).each(function(){o[this.Name]=null});$(t._fields).each(function(){var e=this,r,f,n;r=t._allFields[e.AliasIndex];f=o[r.Name];f&&(t._filter=[f],n=t.extension().filterStatus(!0,!0),n.indexOf(r.HeaderText)==0&&(n=n.substring(r.HeaderText.length).trim(),n.length>2&&(n=n.charAt(0).toUpperCase()+n.slice(1))));!e.Hidden&&r.AllowQBE&&r.Type!="DataView"&&i.push({text:r.HeaderText,context:e.Name,icon:f?"filter":!1,desc:n,transition:!0,callback:c});t._filter=u});at(i,"#app-panel-filter")}var e,o,i,u;if(typeof t=="object"&&(t._dataView?i=t:t.scopeField?i=t.scopeField:t.mode==="everything"?e=!0:t.mode==="field"&&(o=!0)),i)return u=[],s(i,u),t.samples!=!1&&(i._listOfValues&&i._listOfValues.length?u=h(i,u):u.push({text:vu,icon:"refresh",animate:!0,context:{id:i._dataView._id,field:i.Name},keepOpen:!0,callback:dt})),u;t&&t.mode=="field"?c(t.field):l()}function eb(n,t,i,r,u){i||(i=w());var f=i&&i.dataView,o=f&&f.get_view(),s=0,e,h=[];return f&&f.get_isGrid()&&f.get_showViewSelector()&&($(f.get_views()).each(function(){var n=this;t&&n.Id===o.Id||(n.Type!=="Form"&&n.ShowInSelector||n.Id===o.Id)&&h.push(n)}),h.length>1&&(!f._lookupInfo||!f._lookupInfo.field.is("view-selector-none"))&&$(h).each(function(){var h=this,c=h.Label,l=c===o.Label;e={text:c,radio:!0,icon:l?"check":t?"":!1,context:s,callback:function(n){var t=$.find("#"+i.id+" .ui-content > .app-tabs-views .ui-btn");r&&t.length?$(t[n]).trigger("vclick",{selectedTab:c}):(f._forceSync(),f.extension()._commandRow=null,f._requestedSortExpression=f.pageProp(h.Id+"_sortExpression"),f._requestedFilter=f.pageProp(h.Id+"_filter"),f.executeCommand({commandName:"Select",commandArgument:h.Id}),f.pageProp("viewId",h.Id),r&&!t.length&&gr(i.id+"_viewTabs",c),i.id===gt()&&(i.headerText!==!1&&wr(c),un(),ps(f),bt()))}};u&&(e.radio=!1,e.selected=e.icon==="check",e.icon="material-icon-folder"+(e.icon==="check"?"":"-open"),e.depth=1);n.push(e);s++})),s}function bs(t){var o=$.Event("menuitem.app",{item:t}),i=t.url,u=i.match(/^((\_\w+)\:)/),f,e;return $(document).trigger(o),e=!o.isDefaultPrevented(),e&&(u?l.open(i.substring(u[0].length),u[2]):(i.match(/^http(s)?\:/)&&(f=n.openExternalUrl(i)),f?f():(r._navigated=!0,l.location.href=i))),e}function pit(n,t,i){return n.selected&&(i.selected=!0,$(n.children).each(function(){if(this.selected)return i.selected=!1,!1}),i.selected&&t&&(i.linkClassName=t,i.selected=!1)),i}function cu(n,t,i,r,u){var e,f,o;if(i)$(i).each(function(){var i=this,u=i.children,f=pit(i,null,{text:i.title,context:i,depth:r,icon:t&&i.icon?i.icon:!1,callback:i.url?bs:dt,keepOpen:!i.url,tooltip:i.description});n.push(f);u&&cu(n,t,u,r+1)});else if(i=hr,i)if(ct("ui.menu.apps.tiles")&&t)if(e=bi.nodesWithIcons,f=e.length,$(e).each(function(){var i=this,r=i.icon;i=i.node;n.push(pit(i,"app-item-selected",{text:i.title,context:i,icon:t&&i.icon?i.icon:!1,callback:i.url?bs:dt,keepOpen:!i.url,itemClassName:"app-item-tile",tooltip:i.description}))}),f){if(f%3)for(o=f%3;o<3;o++)n.push({text:" ",icon:!1,callback:dt,itemClassName:"app-item-tile app-item-tile-stub"});f<bi.nodeCount&&u!==!1&&n.push({},{text:ki,icon:"material-icon-apps",transition:!0,callback:rht,itemClassName:"app-item-tile-more"})}else cu(n,t,i,1);else cu(n,t,i,1)}function wit(t,i,r){var e=n.contextDataView(),u=e.extension();if(u){var o=u.viewStyle(),h=e!=yt(),s=[];eb(t,null,n.contextPageInfo(),!0)===1&&t.splice(t.length-2,2);e.get_isGrid()&&e.get_showViewSelector()&&(i==!1?t.length&&t.push({}):t.push({text:f.PresentationStyle}),(r==null||r==!0)&&(u.tagged("view-style-grid-disabled")||t.push({text:f.Grid,icon:o==="Grid"?"check":!1,radio:!0,callback:function(){u.viewStyle("Grid")}}),u.tagged("view-style-list-disabled")||t.push({text:f.List,icon:o==="List"?"check":!1,radio:!0,callback:function(){u.viewStyle("List")}}),u.tagged("view-style-cards-disabled")||t.push({text:f.Cards,icon:o==="Cards"?"check":!1,radio:!0,callback:function(){u.viewStyle()!=="Cards"&&u.viewStyle("Cards")}}),h||u.tagged("view-style-map-disabled")||u.tagged("supports-view-style-map")&&t.push({text:f.Map,icon:o==="Map"?"check":!1,radio:!0,callback:function(){u.viewStyle("Map")}}),n.presenter("enumerate",{id:e._id,list:s}),$(s).each(function(){var n=this;u.tagged("view-style-"+n.name.toLowerCase()+"-disabled")||(n.icon=n.name==o?"check":!1,n.radio=!0,t.push(n))})));wet(e,t)}}function bit(n){n||(n={});var t=[];n.position!=="left"&&t.push({text:f.Back,icon:wt,callback:ie});t.push({text:f.AlternativeView});wit(t);at(t,"#app-panel-view-options",n)}function kit(t,i,r){var e=t.extension(),o=t._id,s=t._allFields[t._fields[0].AliasIndex],f=i.length,u;r&&r.length&&!e.inserting()&&!t.rowIsTemplate(r)&&i.isSideBar===!1&&(n.enumerateFields(t,i,null,r),f<i.length&&(u=i[f],u.icon="material-icon-info-outline",u.transition=!0,u.context={id:o},u.callback=og))}function ob(n,t,i){i&&$(n._fields).each(function(){var r=n._allFields[this.AliasIndex],f=vw(r,!0),e=yw(r,!0),u;(f||e)&&(u=i[r.Index],u!=null&&(f?t.push({text:r.text(u),desc:r.HeaderText,icon:"phone",href:"tel:"+u,system:!0}):e&&t.push({text:r.text(u),desc:r.HeaderText,icon:"email",href:"mailto:"+u,system:!0})))})}function ge(n){var t=dit[n];return t?"material-icon-"+t:n}function est(n){var t=null,r=n.CommandName,i=n.CssClass;if(i&&ya(i)&&(t=i),!t){switch(r){case"Insert":case"Update":case"Confirm":t=n.CommandArgument==="SaveAndNew"?"add":"check";break;default:t=git[r];t||(t=!1)}t&&(t="material-icon-"+t)}return t}function nrt(n){var r=p(n.dataViewId),e=n.row,u=n.action,f=u.CommandName,i;r.editing()&&(i=u.CausesValidation&&f!=="Cancel",t.cancel(i),i&&!t.valid())||(ri(),f==="Edit"&&gh(r),r.extension().command(e,f,n.argument,i,u.Path))}function trt(t){n.contextScope(null);t=t.action;var i=p(t.dataViewId),u=t.action,f=t.group,e=t.groupIndex,o=t.actionIndex;i._busy()||(af(u.Confirmation)?nrt(t):i._confirm({action:u,scope:f.Scope,actionIndex:o,rowIndex:i.commandRow()?0:null,groupIndex:e},function(n){r.confirm(n,function(){nrt(t)})}))}function no(n,t,i,r){function w(n){for(var r=t._views,i=0;i<r.length;i++)if(r[i].Id===n)return r[i].Type!=="Form";return!1}t._rowIsSelectedCached=t._rowIsSelected(t._selectedRowIndex);var v=t.rowIsSelected(r),u,c=[],l=t.get_isGrid(),a,e,o,y=t.get_showActionButtons()!=="None",p=s?/^(DataSheet|Grid|Export(Rowset|Rss))$/:/^(DataSheet|Grid)$/,h;$(t.actionGroups(n)).each(function(s){var b=this,k=b.Scope,d;k!=="ActionBar"||b.Flat||b.Id===n?(!k.match(/Grid|ActionColumn/)||v&&l||b.Flat)&&(d=f.InlineCommands[t.extension().viewStyle()==="Grid"?"Grid":"List"],$(this.Actions).each(function(n){var v=this,f=v.CommandName,nt=v.CommandArgument,rt=v.Key,ut,g=est(v),tt=v.HeaderText,ft,et=f+"/"+nt+"/"+tt,it=!f||c.indexOf(et)===-1&&(!f||!f.match(p))&&(!b.Flat||v.HeaderText);o=f?trt:null;e=null;it&&(a=f&&f.match(/^(Select|Edit|New|Duplicate)$/),a&&l&&(!nt||w(nt))&&(f==="Edit"&&(rt||(rt="F2")),(!t.tagged("inline-editing-none")||t.tagged("inline-editing-mode"))&&ct("ui.inlineEditing.enabled")?v._autoHeaderText&&(ft=tt=d[f],ft&&(tt=ft,v.CssClass||(f==="New"?g="add":f==="Edit"?g="add-check":f==="Select"&&(g="play")),g&&(g="material-icon-playlist-"+g),ut=!1)):it=!1));it&&(!o&&k.match(/Grid|ActionColumn/)||k==="Form"&&!y)&&(it=!1);it?(h&&k!==h&&i.push({text:"$separator"}),c.push(et),u={text:tt,callback:o,icon:g,uiScope:k,group:b.Id,path:v.Path,command:f,argument:nt,tooltip:v.Description,context:{action:{dataViewId:t._id,row:r,group:b,groupIndex:s,action:v,actionIndex:n,argument:nt}}},rt&&(u.shortcut=rt),ut===!1&&(u.sidebar=ut),f==="Search"&&(u.system=!0,u.hidden=!0),e?Array.insert(i,i.indexOf(e)+1,u):i.push(u),h=k):tt||i[i.length-1].text==="$separator"||i.push({text:"$separator"})})):i.push({text:b.HeaderText,icon:!1,transition:!0,uiScope:k,group:b.Id,context:{group:b,isSideBar:i.isSideBar},callback:function(n){ii=[];n.isSideBar||ii.push({text:f.Back,icon:wt,callback:ie});ii.push({text:b.HeaderText});no(n.group.Id,t,ii,r);at(ii,"#app-panel-group-actions",n.isSideBar?{position:"left"}:null)}})});t._rowIsSelectedCached=null;t._editing=null}function ost(n,t){function s(n,t){$(e).each(function(i){var r=e[i],u=r.AliasIndex,o=e[u];r.Hidden||o.GroupBy||!(f||r.tagged(n))||t.call(r,u)})}function h(n){s(n,function(t){var e=this,h=e.tagged(n+"desc"),c=e.tagged(n+"para"),l=e.tagged(n+"column"),a=e.tagged(n+"nolabel"),o=(e.tagged(n+"label")||h||c||l)&&!a,s=r.tagSuffix,v=e.tagged(n+"count"),y=e.tagged(n+"aside"),p=e.tagged(n+"heading"),w=e.tagged(n+"thumb"),b;e.tagged(n+"none")||(!f||p||h||v||y||a||c||l||(i.heading==null?i.heading=t:i.thumb==null&&e.OnDemand&&e.OnDemandStyle!=1?i.thumb=t:(h=!0,o=!0)),p&&(i.heading=t),(!o||v||y)&&!a||(i.desc.push(t),u=i.desc.length-1,r.tagSuffix&&(i.descRwd[u]=r.tagSuffix),o&&(i.descLabels[u]=!0,s&&(i.descLabelsRwd[u]=s)),c&&(i.descPara[u]=!0),l&&(i.descColumn[u]=!0,b=e.Columns,i.descColumnCount++)),v&&(i.count=t,i.countRwd=r.tagSuffix,i.countLabel=o,i.countLabelRwd=s),y&&(i.aside=t,i.asideRwd=r.tagSuffix,i.asideLabel=o,i.asideLabelRwd=s),w&&(i.thumb=t))})}function c(){f=!0}var w=n._fields,e=n._allFields,i=t&&n._listItemMap&&n._listItemMap[n._viewId]||!t&&n._cardItemMap&&n._cardItemMap[n._viewId]||{heading:null,thumb:null,aside:null,count:null,desc:[],descOriginal:[],descRwd:[],descLabels:[],descLabelsRwd:[],descPara:[],descColumn:[],descColumnCount:0},f,u;if(i.cached)return i;if(t?(s("list-",c),f&&h("list-")):(s("card-",c),f&&h("card-",!0)),f||(s("item-",c),f&&h("item-")),f)i.heading==null&&(i.heading=w[0].AliasIndex);else{var l,a,b=0,o=[],v=3,y;function p(n){var r,s,h;if(!this.Hidden&&!this.GroupBy&&this.Type!="DataView")if(this.OnDemand)i.thumb==null&&this.OnDemandStyle!=1&&(i.thumb=n);else if(!l||this.ShowInSummary){if(n=this.AliasIndex,r=e[n],s=r.Type.match(/^Date/),r.GroupBy)return;h=r.Type!="String"&&!r.OnDemand;i.heading==null?(i.heading=n,t&&(i.desc.push(n),u=i.desc.length-1,i.descLabels[u]=n,o.push(u))):i.aside==null&&s&&i.count==null&&!t?i.aside=n:i.count!=null||!h||s||i.aside!=null||t?(i.desc.push(n),u=i.desc.length-1,i.descLabels[u]=n,t?(o.push(u),!r.ItemsLookupStyle&&(r.Rows>1||r.TextMode==3)?(i.descPara[u]=!0,a=!0):a&&(i.descPara[u]=!0,a=!1)):b++%3==0&&(i.descPara[u]=!0)):i.count=n;f=!0}}t&&(l=!1);$(e).each(p);t&&!i.descPara.length&&o.length>3&&(o.length<7&&(v=2),y=Math.ceil(o.length/v),$(o).each(function(n){n%y==0&&(i.descColumn[this]=!0,i.descColumnCount++)}));f||(l=!1,$(e).each(p))}return i.desc.length&&$(e).each(function(){var n=this,t=i.desc.indexOf(n.AliasIndex);t!=-1&&n.Index!=n.AliasIndex&&(i.descOriginal[t]=n.Index)}),i.cached=!0,t?(n._listItemMap||(n._listItemMap={}),n._listItemMap[n._viewId]=i):(n._cardItemMap||(n._cardItemMap={}),n._cardItemMap[n._viewId]=i),i}function irt(n){var t={latitude:null,longitude:null,segments:[]},i=[];return $(n._allFields).each(function(n){var r=this;r.tagged("map-")&&(r.tagged("map-latitude")?t.latitude=n:r.tagged("map-longitude")?t.longitude=n:i.push(this))}),$(["address","city","state","region","postalcode","zipcode","zip","country"]).each(function(){var n=this;$(i).each(function(r){var u=this;if(u.tagged("map-"+n))return t.segments.push(u.Index),i.splice(r,1),!1})}),t}function sst(n){var t=lh||kt("geoLocations"),i=null;return t&&$(t).each(function(){var t=this;if(t.address===n)return i=t.lat==null&&t.lng==null?"ZERO_RESULTS":{lat:t.lat,lng:t.lng},!1}),lh||(lh=t),i}function rrt(n,t,i){var r=lh||kt("geoLocations");r||(r=[]);r.push({address:n,lat:t,lng:i});r.length>lut&&r.splice(0,1);lh=r;setTimeout(kt,0,"geoLocations",r)}function hst(n,t){var i=[],r=t.latitude,u=t.longitude;return r!=null&&u!=null?i.push(n[r],n[u]):$(t.segments).each(function(){var t=n[this];t!=null&&i.push(t.trim())}),i.join(",")}function cst(n,t){var r=t.latitude,u=t.longitude,f,e,i;return r!=null&&u!=null?(r=n[r],u=n[u]):(f=new lu.StringBuilder,$(t.segments).each(function(t){var i=n[this];i&&(t>0&&f.append(","),f.append(i))}),e=f.toString(),i=sst(e),i?typeof i!="string"&&(r=i.lat,u=i.lng):i=e),typeof i!="string"&&(i=new google.maps.LatLng(r,u)),i}function urt(n){$(n.markers).each(function(){google.maps.event.clearListeners(this,"click");this.setMap(null)});n.markers=[];n.selected=null}function sb(n){if(n.fit!==!1){var i=new google.maps.LatLngBounds,t=n.markers,r=n.map;t.length===1?r.setCenter(t[0].position):($(t).each(function(){i.extend(this.position)}),r.fitBounds(i))}}function yc(){!(__tf!==4)||setTimeout(function(){n.notify({text:".noitide tcudorp ruoy ni detroppus ton si erutaef sihT".split("").reverse().join(""),duration:"medium"})},Math.random()*1e4)}function hb(t){t.items||(t.items=[]);var h=t.dataView,v=h.extension(),y=[],o=ic(),r=$('<div class="ui-content app-popup-message app-map-info"><\/div>').popup({transition:en(),history:s,arrow:o?null:t.x?s?"b,t,l,r":"t,b,l,r":null,theme:"a",overlayTheme:"b",tolerance:o?0:5,positionTo:o?null:t.x?"origin":"window",afteropen:function(){ert(null,r);ff(r.find(".ui-listview"));t.afteropen&&t.afteropen(r);rt=!1},afterclose:function(){r.find(".ui-btn").data("data-context",null);l.listview("destroy").remove();cb(r);rt=!1;t.afterclose&&t.afterclose(r);setTimeout(function(){u&&u.callback&&u.callback(u.context)},50)}}),c=o?{x:i.width/2,y:i.height-1}:{x:t.x,y:t.y},l=$('<ul class="app-listview"/>').appendTo(r),p=$('<li data-icon="false"/>').appendTo(l),a=$("<a/>").appendTo(p),b=$('<div class="app-map-info-toolbar"><\/div>').appendTo(r),u,k,w;ku(h,v.commandRow(),v.itemMap(!1),null,p,a,null,!0);a.find(".app-btn-check").remove();l.listview();i.width<640&&(e("ui.displayDensity.value")==="Comfortable"?r.addClass("app-density-compact"):e("ui.displayDensity.value")==="Compact"&&r.addClass("app-density-condensed"));$(t.items).each(function(){y.push(this.icon)});context=[];n.contextScope(h);n.navContext(context,!1);$(context).each(function(){var n=this;n.icon==="eye"&&(k=n.text);n.icon==="dots"||n.navigateTo||n.system||!n.callback||y.indexOf(n.icon)!==-1||!w&&(n.icon||n.command==="Select")&&(w=n,a.data("data-context",n))});n.contextScope(null);t.hasMore||(t.items.splice(0,0,{text:ki,icon:"dots",callback:function(){c.itemsToAppend=[{text:f.Back,icon:wt,callback:function(){hb(t)}}];ks(t.anchor,c)}}),t.hasMore=!0);$(t.items).each(function(){var n=this,t=$('<a class="ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all"/>').appendTo(b).attr("title",n.text).addClass("ui-icon-"+n.icon).data("data-context",n);n.href&&t.attr("href",n.href);n.target&&t.attr("target",n.target)});o&&r.addClass("app-popup-panel").parent().css("minWidth","100%");rt=!0;r.popupopen(c).on("vclick",".ui-btn",function(n){var t=$(n.target),i=t.closest("a");if(!t.is("[data-href]"))if(u=i.data("data-context"),u.href)u.keepOpen||to(r),u=null;else return st(i,function(){to(r)}),!1}).on("vclick","li",function(n){if(!$(n.target).is("[data-href]"))return markerAction=!0,to(r),!1})}function frt(n,t,i,r,u){var s=n,e=t.data("data-map"),h=s.dataView(),o=new google.maps.Marker({map:e.map,position:i,title:r});return google.maps.event.addListener(o,"click",function(){function a(n){google.maps.event.trigger(n||e.selected,"click")}function v(){if(e.fit=!1,o.setAnimation(null),n.getZoom()>=17){var t=n.getStreetView();t&&t.getVisible()?(t.setVisible(!1),a(o)):(e.fit=!0,sb(e));vv(o)}else n.setZoom(17),n.panTo(o.position),vv(o);a()}function y(t){var i=-1;$(r).each(function(n){if(this===o)return i=n,!0});i!==-1&&(t==="next"?i++:i--,i<0&&(i=r.length-1),i>=r.length&&(i=0),av(e,r[i]),n.panTo(e.selected.position),a())}s.tap({row:u},"none");var n=e.map,r=e.markers,l=ast(o.position,n),c=l&&{x:l.x+t.offset().left,y:l.y+t.offset().top},i=[];n.getZoom()>=17?r.length>1&&i.push({text:f.ZoomOut,icon:"zoomout",callback:v}):i.push({text:f.ZoomIn,icon:"zoomin",callback:v});i.push({text:f.Directions,icon:"navigation",context:{api:"dir",address:hst(u,irt(h))},callback:dl,target:"_blank",keepOpen:!0});e.markers.length>1&&(i.push({text:oe.Previous,icon:"arrow-l",context:"prev",callback:y}),i.push({text:oe.Next,icon:"arrow-r",context:"next",callback:y}));hb({x:c&&c.x,y:c&&c.y,dataView:h,afteropen:function(){av(e,o);vv(o)},items:i})}),e.markers.push(o),o}function av(n,t){n.selected&&n.selected.setIcon(null);n.selected=t;t&&t.setIcon("http://mt.google.com/vt/icon?psize=30&font=fonts/arialuni_t.ttf&color=ff304C13&name=icons/spotlight/spotlight-waypoint-a.png&ax=43&ay=48&text=%E2%80%A2")}function lst(){setTimeout(function(){n.notify({text:".dettimrep ton si tnempoleved noitacilppa laicremmoC .emiT nO edoC fo lairt eerf a si sihT".split("").reverse().join(""),duration:"medium"})},Math.random()*1e4)}function vv(n,t,i){typeof t=="undefined"&&(t=755);n.setAnimation(i||google.maps.Animation.BOUNCE);t&&setTimeout(function(){n.setAnimation(null)},t)}function ast(n,t){var u=t.getBounds(),i=t.getProjection(),s=i.fromLatLngToPoint(u.getNorthEast()),r=i.fromLatLngToPoint(u.getSouthWest()),e=Math.pow(2,t.getZoom()),f=i.fromLatLngToPoint(n),o=0;return(f.x<r.x||r.x==0)&&(o=$(t.getDiv()).width()/2,r=i.fromLatLngToPoint(u.getCenter())),new google.maps.Point((f.x-r.x)*e+o,(f.y-s.y)*e)}function ert(t,i){var r=i.closest(".ui-popup-container"),u=n.promo();o.addClass("app-has-popup-open");i.is(".app-popup-panel")&&o.addClass("app-has-panel-open");kf();bh(i,!1)}function vst(n){n.popup("close")}function to(n){n.data("mobilePopup")._currentTransition="none";vst(n)}function cb(n){eet(n);o.removeClass("app-has-popup-open app-has-panel-open");bh(n,!0);n.data("position-options",null).popup("destroy").remove()}function pc(n){n.find("a").data("data-context",null);n.find("li").remove()}function yst(n){pc(n);n.off("vclick").listview("destroy")}function ks(n,t){function o(){i.length&&i[i.length-1].text&&i.push({})}function e(n){var t=[];$(r).each(function(){var r=this,u=r.icon;r.system?n&&(!r.system||u==="eye"||u==="phone"||u==="email")&&u!="dots"&&t.push(r):r.text&&!r.isStatic&&i.push(r)});n&&t.length&&(o(),$(t).each(function(){var n=this,r=n.href,t={text:n.text,icon:n.icon};t.href?t.callback=n.callback:t.href=r;i.push(t)}))}if(n=$(n),n.css("visibility")!=="hidden"&&!si("ontop")){var s=ot(n),c=s.length?s.attr("data-for"):null,l=w(c),f=l.dataView,u=f.extension(),r=t&&t.context,i=[],h;u.lookupInfo()?(r=[],u.context(r),e()):(e(),t&&t.autoPopulate===!1||(r=[],u.context(r,["ActionColumn"]),r.length&&(o(),e()),o(),r=[],u.context(r,["Grid"]),e(!0)));t&&$(t.itemsToAppend).each(function(){i.push(this)});$(f._fields).each(function(){var r=this,e=f._allFields[r.AliasIndex],s=r.HyperlinkFormatString,o,n,t;s&&(n=u.commandRow(),n&&!f.rowIsTemplate(n)&&(t=n[e.Index],t!=null&&(o=fv(r,n),t=e.format(n[e.Index]),h||(h=!0,i.push({})),i.push({text:t,icon:"material-icon-info-outline",href:o}))))});pi({items:i,anchor:n,iconPos:"left",defaultIcon:"carat-r",x:t&&t.x||n.length&&n.offset().left+n.outerWidth()/2,y:t&&t.y||n.length&&n.offset().top+n.outerHeight(!0)*.66,y2:t&&t.y2||n.length&&n.offset().top+n.outerHeight(!0)*.33})}}function yv(t){function u(){ft(!1);i.Handler?l.location=nf+"appservices/saas/"+i.Handler+"?username="+i.name:n.showAccountManager([{name:"UserName",value:i.name}])}var f=r.AccountManager.list(!0),i=f[t];t===r.userName()?$(".app-acc-man .app-acc-close").trigger("vclick"):i.refresh_token?(ft(!0),r.switchUser(i,function(){r._navigated=!0;window.location.replace(n.returnUrl()||nf)},u)):u()}function pv(){dr._instance.logout();sessionStorage&&(sessionStorage.signedOut=!0)}function lb(t,i){function w(){nd&&l.match(/\blogout\b/)&&(t.push({text:cf.LogoutLink,icon:"power",callback:pv}),p=!0)}function b(){l.match(/\blogin\b/)&&v&&!sa()&&(t.length&&t.push({}),t.push({text:f.AddAccount,icon:"material-icon-add",callback:function(){le?n.showAccountManager():n.showAccountManager(null,!0)}}),y&&t.push({text:f.ManageAccounts,icon:"material-icon-settings",callback:function(){uf().remove();n.showAccountManager(null,"switch")}}))}var c=r.userName(),l=e("membership.profile"),v=r.AccountManager.enabled(),s=r.AccountManager.list(!0),y,p,h,a;if(!le){b();return}if(l.match(/\bview\b/)){var u=s&&s[c],k=u&&u.email,o={text:c,desc:u&&u.Handler||k,user:c,icon:!1,keepOpen:!0,callback:dt};if(t.push(o),i?(o.transition=!0,o.keepOpen=!1,o.callback=function(){var n=[{text:f.Back,callback:ie,icon:wt},{}];lb(n);at(n,"#app-panel-profile-context",{position:"left"})}):(o.selected=!0,o.depth=1,!td||u&&u.Handler||t.push({text:cf.MyAccount,icon:"account",callback:function(){n.show({controller:"MyProfile",startCommand:"Edit",startArgument:"myAccountForm"})}})),i)return;w();t.push({})}if(l.match(/\bswitch\b/)&&v&&s)for(id in s)h=s[id],h.name&&(y=!0,id!=c&&t.push({text:id,context:id,icon:!1,desc:h.Handler||h.email,user:id,status:h.refresh_token?null:f.SignedOut,callback:yv}));b();p||w();a=$.Event("beforeusercontextshow.app");a.items=t;$(document).trigger(a)}function pst(n){var t=[];si()&&(n=$(".app-kiosk .app-avatar"));lb(t);t.length&&pi({anchor:n,y:n.offset().top+n.outerHeight(),title:t.length>1?"":r.userName(),items:t})}function wv(n,t){var i=ot(n),r=i.length?i.attr("data-for"):null,u=w(r);return t&&t.dataView||u.dataView}function ab(t,u){function tt(n,t){$(n).each(function(i){var r=this,u=r.itemClassName;return u&&u.indexOf("app-btn-apply")!==-1?(n.splice(0,i),this.callback=t,!1):r.animate?(n.splice(0,i),!1):void 0})}function g(t){n.contextScope(e);fe(e,o,fe(e,o)==t?!1:t);cv();n.contextScope(null)}function it(){var n=ot(t),i=n.length?n.find(".app-grid.app-listview"):null;e.pageProp("frozenField",v===o?"_none_":o);e.extension()._reset=!0;of(e);e.sync()}function rt(){r.alert("hidden")}var e=wv(t,u),o=u.field||t.attr("data-field-name"),y=t.offset(),ut=ic(),h=e.findField(o),p=e.findFieldUnderAlias(h),k=(fe(e,o)||"").toLowerCase(),l=[],c=[],a,d=h.AllowSorting&&!u.valuesOnly,nt=h.AllowQBE,v=la(e),w,b;(d&&(c=[{text:de(h,"asc"),icon:k==="asc"?"check":"false",context:"asc",callback:g},{text:de(h,"desc"),icon:k==="desc"?"check":"false",context:"desc",callback:g},],c.push({text:f.Group,icon:"material-icon-group-work",callback:function(){dw(e,h.Name)}})),$(e._fields).each(function(){var n=this;n.Hidden||n.GroupBy||n.OnDemand||(w=n.Name,v==="_first_"&&(v=w))}),o===w||u.valuesOnly||(u.hide&&c.push({}),c.push({text:oo.Freeze,icon:o===v?"check":null,callback:it})),u.hide&&c.push({text:f.Hide,callback:rt}),nt&&(h.AllowSamples===!1&&(u.samples=!1),a=ws({scopeField:p,samples:u.samples}),d&&a.splice(0,0,{}),u.valuesOnly&&tt(a,u.callback)),c&&(l=l.concat(c)),a&&(l=l.concat(a)),l.length)&&(b={x:u&&u.x||y.left+t.outerWidth()/2,y:u&&u.y||y.top+t.outerHeight(!0)*3/4,y2:u&&u.y2||y.top},pi({items:l,anchor:t,x:b.x,y:b.y,scope:e._id,afteropen:function(){sn().length&&e._loadListOfValues(null,p.Name,h.Name,function(){var n=sn(),f=n.closest(".ui-listview"),r=n.length&&n.data("data-context"),o=!s,h=i.height;r&&e._id===r.context.id&&p.Name===r.context.field&&setTimeout(ab,0,t,u)})},afterclose:function(){u.afterclose&&u.afterclose()}}))}function wst(n,t,i){var r;$(t).each(function(){var t=this,e=t.text,f,u,o,h,c,a=t.icon,s=a,v=t.itemClassName,l=t.shortcut,y=t.status;e=="$separator"&&(e=null);e?(r=!1,c=a=="check",c&&(s="false"),f=$("<li/>").appendTo(n),s||s==!1||(s=i.defaultIcon),o=s||"false",f.attr("data-icon",!1),t.disabled&&f.addClass("ui-disabled"),v&&f.addClass(v),t.callback?(u=$("<a/>").appendTo(f).text(e).data("data-context",t),t.keepOpen&&(u.addClass("app-keep-open"),t.animate||u.addClass("app-btn-icon-transparent")),c&&(vt(t.radio&&!1?"material-icon-radio-button-checked":"material-icon-check",u),f.addClass("app-checked")),t.linkClassName&&u.addClass(t.linkClassName),t.animate&&u.addClass("app-animated app-animation-spin"),t.count&&$('<span class="ui-li-count"/>').text(t.count).appendTo(u),t.desc&&$('<p class="app-item-desc"/>').appendTo($("<p/>").appendTo(u)).text(t.desc)):t.href?u=$("<a/>").appendTo(f).text(e).attr("data-href",t.href):f.text(e).addClass("app-list-instruction ui-li-divider ui-bar-a"),t.visible&&(f.attr("data-visible","true"),u.addClass("app-selected")),t.selected&&t.depth&&u.addClass("app-item-selected"),o=ge(o),ya(o)&&vt(o,u),h=t.user,h&&ea(h,$('<i class="app-icon-avatar"/>').appendTo(u.addClass("app-avatar")).text(kh(h))),t.depth&&(f.addClass("app-has-depth"),u.addClass("app-depth"+t.depth)),l&&($('<span class="ui-li-count app-hidden"/>').text(l).appendTo(u),$('<span class="ui-li-count"/>').text(l).appendTo(u)),y&&$('<span class="app-status"/>').appendTo(u).text(y),t.color!=null&&$('<span class="app-event"> <\/span>').insertBefore(u.contents()).addClass("app-event-color-"+t.color),t.tooltip&&u.attr("title",t.tooltip).addClass("app-btn-tooltip")):r||(r=!0,$('<li data-role="list-divider"/>').appendTo(n))});r&&n.find("li").last().remove()}function bst(n){var t,i=ar();return i.is(":input")&&i.blur(),ud!=null&&+new Date-ud<300&&s&&(setTimeout(n,300),t=!0),t}function pi(t){function lt(){return kft({x:t&&t.x||(c?r.offset().left+r.outerWidth()/2:0),y:Math.round(t&&t.y||(c?r.offset().top+r.outerHeight(!0)*.8:0)),y2:Math.round(t&&t.y2||(c?r.offset().top+r.outerHeight(!0)*.2:0))})}function ft(i,r){var f=n.contextScope(),u=i.callback;t.scope&&n.contextScope(t.scope);u&&u(i.context,r);n.contextScope(f)}var ut,p;if(!rt&&!bst(function(){pi(t)})){if(fg()){setTimeout(pi,100,t);return}var a=!s,h=i.height,u=$('<div class="app-popup app-popup-listview" data-theme="a"><\/div>'),r=$(t.anchor),c=r&&r.length,f,l,o,v,k,d,tt=t.items||[],it=r.is(".app-btn-promo"),y,e=ic(),w=e?0:t.tolerance!=null?t.tolerance:5;if(!c||(currentPage=r.closest(".ui-page"),!currentPage.length||currentPage.is(".ui-page-active"))){kf();ri();yi();c&&(t.x==null&&(t.x=Math.ceil(r.offset().left+(t.xOffset?t.xOffset:r.outerWidth()/2))),t.y==null&&(t.yOffset==="bottom"?t.y=Math.ceil(r.offset().top+(a?r.outerHeight():r.outerHeight()/2)):typeof t.yOffset=="number"&&(t.y=Math.ceil(r.offset().top+r.outerHeight()*(a?t.y:1-t.y)))));typeof t.x=="number"&&(t.x=Math.ceil(t.x));typeof t.y=="number"&&(t.y=Math.ceil(t.y));u.addClass("app-popup-icon-left");$(t.items).each(function(){if(this.icon)return ut=!0,!1});ut||u.addClass("app-no-icons");t.title&&$('<h1 class="ui-title"/>').appendTo($('<div class="ui-header ui-bar-a"><\/div>').appendTo(u)).text(t.title);f=$('<div class="ui-panel-inner" tabindex="0"><\/div>').appendTo($('<div class="ui-content"><\/div>').appendTo(u));l=$('<ul class="app-listview"/>').appendTo(f);wst(l,tt,t);l.listview().on("vclick",function(n){var i=$(n.target),t=i.closest("a");return i.is("[data-href]")?(d=i.attr("data-href"),d&&rs(d),st(t,function(){to(u)})):t.length&&!k&&te(t)&&(k=!0,st(t,function(){o=t.data("data-context");v=t;o.keepOpen?(ft(o,v),gp(v),o=null,v=null,k=!1):to(u)})),!1});if(rt=!0,tu(!1),"arrow"in t||!c||(t.arrow=a||t.dropDown?"t,b,l,r":"b,t,l,r"),ve(!0),u.popup({history:!a,arrow:e?null:t.arrow,tolerance:w,transition:s?en():"none",afteropen:function(){ert(null,u);t.afteropen&&t.afteropen(u);f.focus();rt=!1;tu(!0)},afterclose:function(){ri();rt=!1;r&&(!(r.data("data-context")||{}).row||r.is(".app-calendar-selected"))&&r.removeClass("app-selected");t.afterclose&&t.afterclose(u,o);setTimeout(function(){t.autoFocus!==!1&&(hi(),s||tf());o&&ft(o,v);o=null;v=null;pc(l);yst(l);cb(u)},100)},beforeposition:function(){if(ht.width&&f[0].scrollHeight>f.height()){f.css({width:"","overflow-y":""}).parent().width("");var n=l.width();f.css({"overflow-y":"scroll"}).css({width:n+ht.width}).parent().css({width:n,overflow:"hidden"})}}}),ott(u),tt.length||(u.find(".ui-content").hide(),u.find(".ui-header").css({"border-bottom-width":0,"margin-bottom":".25em"})),y=e?{x:i.left+i.width/2,y:i.top+h-8}:lt(!0),c){it||t.highlightAnchor===!1||r.is(".app-calendar-selected")||r.addClass("app-selected");var et=r.offset(),at=i.height,ot=i.toolbarHeight,b=et.top-i.top,g=at-(et.top-i.top+r.outerHeight()),ct=e?h*.6:Math.max(b-ot*2,g-ot*2,50),nt=aft(u),vt=u.outerHeight()>h?ct:Math.max(ct,f.height());e||(!a&&b-w<nt?u.popup("option","arrow","b,t,l,r"):y.y2&&(b>g&&nt>g-w||!a&&nt<b-w)&&(y.y=y.y2,u.popup("option","arrow","b,t,l,r")));f.css({minHeight:e?Math.min(h*.4,h-156):null,maxHeight:e?Math.min(h*.6,h-156):vt})}yet(u);p=l.find('li[data-visible="true"]');p.length&&f.offset().top+f.outerHeight()<p.offset().top+p.outerHeight()&&f.scrollTop(p.offset().top-f.offset().top-(f.outerHeight()-p.outerHeight())/2);it&&n.promo().show();e&&u.addClass("app-popup-panel");u.data("position-options",y).popupopen(y);s||$(".ui-popup-screen").css("top",e?0:n._toolbar.height()+1+i.top)}}}function kst(n){var t=[];$(n).closest(".app-bar-buttons").find(".ui-btn:not(.app-btn-more)").filter(function(){return!gi.call(this)}).each(function(){var n=$(this);t.push({text:n.text(),callback:function(){n.trigger("vclick")}})});pi({anchor:n,items:t,y:n.offset().top+n.outerHeight()/4*3,tolerance:3})}function dst(n){return{overlayTheme:"b",history:!0,transition:n||"pop",positionTo:"window",afteropen:function(){$(this).attr("tabindex",0).focus();var n=yk;n&&setTimeout(n,200);yk=null},afterclose:function(){hi();var n=oy;n&&setTimeout(n,100);oy=null}}}function ort(n){var t=p(n.id),r=t.findField(n.field),i=n.op;t.removeFromFilter(r);i!="$clear"&&(i.startsWith("$")&&(i+="$"),t._filter.push(n.field+":"+i+(i.match(/\$(true|false)/)?"":t.convertFieldValueToString(r,n.value))));us(t)}function gst(n){n=n.closest(".app-echo");n.length&&oi({fieldName:p(n.attr("data-for"))._dataViewFieldName,container:d(n)})}function srt(t,i){function o(n,i){var f=u.Name+":"+n;n.startsWith("$")&&(f+="$");f+=t.convertFieldValueToString(u,p);tt!==f&&c.push({text:r.filterDef(nt,n).Text+(i?" "+i:""),context:{id:t._id,field:e,op:n,value:p},callback:ort})}function ut(i){var r=n.contextScope();n.contextScope(t);fe(t,e,fe(t,e)==i?!1:i);cv();n.contextScope(r)}function ft(n){var i=ot(l),r=l.data("data-context");r&&(tv(t).removeClass("app-selected"),i.length&&cw(i),l.addClass("app-selected"),gh(t,l),t.extension().tap(r,"none"),i.length?pe(t,i):wf(t),n())}function b(){ft(function(){ks(l,et)})}var y=$(i.target),a=y.closest(".app-field"),l=a.closest("a"),u,e,p,h,v,d,g=f.LookupViewAction,nt,tt,c=[],it,rt,et={x:rr(),y:yf()},k,w;if(a.length){if(k=l.data("data-context"),w=k&&k.row,!w||t.rowIsTemplate(w)){i.preventDefault();return}e=a.attr("class").match(/app\-field\-(\w+)/);e&&(e=e[1]);e&&(i.preventDefault(),u=t.findField(e),it=u.AllowQBE,rt=u.AllowSorting,v=t.findFieldUnderAlias(u.Name),v.ItemsDataController||(d=new RegExp("\\b"+e+"\\s*=\\s*\\w+"),$(t._fields).each(function(){var n=this;if(n.Copy&&d.exec(n.Copy))return v=n,g=String.format(ho.DetailsToolTip,t._allFields[n.AliasIndex].HeaderText),!1})),v.ItemsDataController&&!v.ItemsTargetController&&c.push({text:g,icon:"material-icon-arrow-forward",callback:function(){ft(function(){n.details({field:v})})}}),rt&&(c.length&&c.push({}),c.push({text:de(u,"asc"),icon:fe(t,e)==="asc"?"check":!1,context:"asc",callback:ut},{text:de(u,"desc"),icon:fe(t,e)==="desc"?"check":!1,context:"desc",callback:ut})),it&&(c.length&&c.push({}),nt=vr.Filters[u.FilterType].List,p=w[u.Index],$(t._filter).each(function(){var n=this;if(n.startsWith(e+":"))return tt=n,c.push({text:String.format(au.ClearFilter,u.HeaderText),icon:"material-icon-clear",context:{id:t._id,field:e,op:"$clear"},callback:ort},{}),!0}),p==null?(o("$isempty"),o("$isnotempty")):(h=u.text(p),u.FilterType==="Text"&&(h='"'+h+'"'),u.FilterType==="Text"?(o("=",h),o("<>",h),o("$contains",h),o("$doesnotcontain",h)):u.FilterType==="Boolean"?(o("$true"),o("$false")):(o("=",h),o("<>",h),o("<=",h),o(">=",h),o("<",h),o(">",h)))),c.length?(c.push({},{text:ki,icon:"material-icon-more-horiz",callback:function(){b(a)}}),pi({anchor:a,title:u.HeaderText,items:c,x:rr(i.pageX),iconPos:"left"})):b(a))}else{if(y.closest(".app-grid-header").length)return;if(y.closest(".app-presenter").length)return;if(l=y.closest(".ui-btn"),l.length)b(l);else if(!s&&y.closest('[data-layout="form"]').length)return}return!1}function hrt(t){var i=$(t.target).closest(".ui-btn"),u=i.data("icon"),o,f,e;return i.is(".app-btn-promo")&&(o=i.data("icon-list"),o)?(st(i,function(){var t=[],u=i.attr("data-icon"),r;if(i.is(".app-btn-promo-cancel"))return $(".ui-popup-screen.in").trigger("vclick"),!1;o.icons.forEach(function(i){i.match(ry)||(r=o.labels[i].split(/\n/),t.push({text:r[0],desc:r[1],icon:i,context:i,callback:function(t){n.executeInContext(t)}}))});f=t[t.length-1];f&&f.callback?f.callback(f.context):(i.addClass("ui-icon-delete app-btn-promo-cancel").removeClass(u),pi({anchor:n.promo(),items:t,iconPos:"left",y:i.offset().top-1,afterclose:function(){i.removeClass("ui-icon-delete app-btn-promo-cancel").addClass(u)}}))}),!1):(e=dt,u==="search"?e=r.search:u==="user"?e=function(){pst(i)}:u==="phone"&&kr?n.executeInContext(u):e=u==="apps"?function(){bv("right")}:function(){n.executeInContext(u==="check"?"ok":u)},st(i,e),!1)}function nht(n){var t=document.createElement("a");return t.href=n,t.href}function vb(t,i,r){var f,u;t=et.path.convertUrlToDataUrl(nht(t));f=o.find("> div[data-url]").filter(function(){return $(this).attr("data-url")===t});r?location.href=t:f.length?(f.appendTo(o),u=w(f.attr("id")),u?(n.makeModal(u),u.navigateInfo={href:t,transition:i},n.changePage(u.id)):et.navigate(t,{transition:i})):(ft({progress:!0}),$.ajax({url:t,dataType:"html"}).done(function(r){var u,c,l,a;if(ft({progress:!1}),u=r.match(/<td\s+id\s*=\s*"PageContent"\s*>([\s\S]+)?<\/td>\s*<td\s+id\s*="PageContent.+"\s*>/i),u||(u=r.match(/<div\s+id\s*=\s*"PageContent".+?>([\s\S]+)?<\/div>\s*<footer /i)),u&&!r.match(/\$create\(Web.DataView|\s+data-controller\s*=\s*"/)){for(var f=u[1],e,v=new lu.StringBuilder,y=/<script.+?>([\s\S]+?)<\/script>/ig,p,s,h,w=1;p=y.exec(f);)v.append(p[1]);for(f=f.replace(y,""),f.match(/data-content-framework="bootstrap"/)&&!$('[data-content-framework="bootstrap"]').length&&(c=$("link.app-theme"),l=c.attr("href"),l&&(l.match(/\&_cf=$/)?c.attr("href",l+"bootstrap"):$('<link href="'+nf+'css/sys/bootstrap.css" rel="stylesheet" type="text/css"/>').insertBefore(c))),e=$("<div><\/div>").appendTo(o).hide().attr("data-href",t),e.html(f).data("scripts",v.toString()),h=cp(t);n.pageInfo(h);)h=cp(t)+w++;s={pageId:h,selector:e,transition:i,dynamic:!0};n.build(e,s);a=$("#"+s.pageId).attr("data-url",t);n.pageInfo({id:s.pageId,text:s.pageId,url:t,root:!0,page:a,scrollable:d(a)});e.data("scripts",null).remove();setTimeout(vb,0,t,i)}else location.href=t}).fail(function(){ft({progress:!1})}))}function tht(n){var t=$(n.target);if(t.is(".app-btn-toggle"))return t.addClass("ui-btn-active"),o.focus(),setTimeout(function(){function u(){i.removeClass("app-text-expanded");t.attr("data-title",uh).toggleClass("ui-icon-carat-u ui-icon-carat-d");hu()}t.removeClass("ui-btn-active");var i=t.prev(),r,n;i.is(".app-text-expanded")?(r=i.closest(".dv-item,.ui-field-contain"),r.length?(n=d(t),hv(n,r.offset().top-(n.offset().top-n.scrollTop())-n.height()*.33,u)):u()):(i.addClass("app-text-expanded"),t.attr("data-title",el).toggleClass("ui-icon-carat-u ui-icon-carat-d"))},ai),!1}function iht(n){c.left.visible&&(hi(),arguments.length||(n=!c.left.mini,toggled=!0,e("ui.sidebar.mini",n),kt("minisidebar",n),ft(!0)),c.left.mini=n,o.toggleClass("app-has-minisidebar-left",c.left.mini),an(),vp(!0),g&&g.is(":visible")&&!g.is(".app-bar-notify-left,.app-bar-notify-center")&&g.css("left",c.left.width),br(!0),$(document).trigger("sidebarstatechanged.app"),bt(!1,0,function(){if(c.left.visible){var t=c.left.inner;t.css({transform:"translate3d("+(n?"100":"-66")+"%,0,0)"});setTimeout(function(){t.css({transition:"transform 96ms ease-in-out"});setTimeout(function(){t.css("transform","").one("transitionend",function(){t.css("transition","")});ft(!1)})})}}))}function rht(){bv(null,!0)}function bv(n,t,i){var r=[],u;t&&(u=ii,r=[{text:f.Back,icon:wt,callback:function(){ii=u;at(r,"#app-panel-apps")}},{}]);nc()&&!i?cu(r,!0,hr,1):cu(r,!0,t?hr:null,t?1:0,!i);at(r,"#app-panel-apps"+(t?"-all":""),{position:n||"left"})}function uht(t){var i=$(t.target);if(!uu)return gy(),yi(i,!1),ri(),i.attr("data-action")==="#app-back"?(n._backText.addClass("ui-btn-active"),st(i,function(){n._backText.removeClass("ui-btn-active");yr()})):(vf(!0),st(i,function(){var r=si(),t,i;c.left.visible&&!r?iht():(t=[{text:na(),itemClassName:"app-logo"}],i=$("#app-panel-menu-scope.ui-panel-open"),i.length?po(i):(r?(cu(t,!0),t.push({})):(n._toolbar.find(".app-icon-avatar").parent().is(":visible")||lb(t,!0),t.length&&t.push({}),(!dn()||bi.nodesWithIcons.length&&ct("ui.menu.tiles")||!c.left.visible&&e("ui.menu.location")!="toolbar")&&(nc(n.pageInfo())?cu(t,!0,hr,1):cu(t,!0),t.push({}))),ct("settings.enabled")&&t.push({text:f.Settings,icon:"material-icon-settings",transition:!0,callback:lv}),at(t,"#app-panel-menu",{position:"left"})))})),!1}function fht(t){var p,e,c,a,b;if(!t.isDefaultPrevented()){var s=$(t.target),i=s.is("a")?s:s.closest("a"),f=i.attr("href")||(i.attr("data-action-path")?"#app-action":""),v=i.attr("data-href"),h=i.attr("data-content-type"),u;if(!f&&v&&h==="image"&&(f=v),!rt&&!i.attr("download")){switch(f){case"#app-menu":u="#app-btn-menu";break;case"#app-context":u="#app-btn-context";break;case"#app-back":u=yr;break;case"#app-details":u=function(){var n=w(),t;n&&n.dataView&&(t=n.dataView.extension(),t.command(t.commandRow(),"Select"),pl=i.attr("data-field-text"),n.dataView._viewDetails(i.attr("data-field-name")))};break;case"#app-refresh":u=function(){var n=w();n&&n.dataView&&n.dataView.sync()};break;case"#app-clear-filter":u=function(){var n=w();n&&n.dataView&&ba(n.dataView,!1)};break;case"#app-filter":u=function(){var n=w();n&&n.dataView&&ws({mode:"everything"})};break;case"#app-action":if(i.is(".app-btn-disabled"))return i.removeClass("ui-btn-active"),!1;u=function(){var r=i.attr("class").match(/ui-icon-([\w\-]+)/)||[0,"carat-r"],t=i.attr("data-action-path");t==="wizard-next"?setTimeout(function(){bf("next",{container:d()})}):t==="wizard-prev"?setTimeout(bf,0,"prev",{container:d()}):i.is(".app-btn-more")?kst(i):r&&(r[1]==="carat-r"?n.executeInContext(null,i.text(),t):n.executeInContext(r[1],null,t))};break;case"#close-popup":u=function(){$(".app-popup-image").popup("close")};t.preventDefault();break;default:if(f)if(f.match(/^tel/))rs(f),u=dt;else if(i.attr("target"))l.open(f,i.attr("target"));else if(h=i.attr("data-content-type"),h&&h.match(/^image/))u=function(){var t=$("#app-popup-image"),i;if(!t.length){t=$('<div id="app-popup-image" class="app-popup-image" data-role="popup" data-overlay-theme="b" data-theme="b" data-position-to="window"><a href="#close-popup" class="ui-btn ui-corner-all ui-shadow ui-btn ui-icon-close-circle ui-btn-icon-notext ui-btn-right"/><img class="app-image-preview" style="max-width:10000px"/><div class="app-image-preview-box"><\/div><\/div>').appendTo(o).popup(dst("none")).popup("option","history",!0);t.find(".app-image-preview").one("load",function(i){var r=$(i.target);setTimeout(function(){r.width("").height("");var o=t.find(".app-image-preview-box"),s=n.screen(),u=r.width(),e=s.width*.9,i=r.height(),f=s.height*.9;u>e?(i*=e/u,u=e,i>f&&(u*=f/i,i=f)):i>f&&(u*=f/i,i=f);r.hide();o.css({background:"",width:u+"px",height:i+"px"}).show();t.popup("reposition",{positionTo:"window"});o.css({background:String.format("url({0})",r.attr("src")),"background-size":String.format("{0}px {1}px",u,i)});n.notify(vr.BlobDownloadOriginalHint)},100)})}t.find(".app-image-preview-box").attr("data-href",f).hide();i=t.find(".app-image-preview").attr("src","").width(100).height("");r.odp.blob("url",{href:f,original:!0}).done(function(n){i.show().attr("src",n)});oy=function(){cb(t)};t.popupopen()};else if(u=n.openExternalUrl(f,i.is('[rel="external"]')),!u&&!i.closest(".ui-panel-inner").length)if(p=et.path.parseUrl(f),e=p.hash,e)if(i.closest(".app-content-framework").length){if(s.data("app-click-test"))return;s.data("app-click-test",!0);et.linkBindingEnabled=!1;t.type="click";$(document).trigger(t);s.data("app-click-test",null);et.linkBindingEnabled=!0;t.isDefaultPrevented()||(e==="#"?u=function(){hv(d(),0)}:(c=e&&e.length>1&&y(e+',a[name="'+e.substring(1)+'"]'),a=d(),u=c&&c.length?function(){b=c.offset().top-(a.offset().top-a.scrollTop());st(i,function(){hv(a,b)})}:function(){$(e).is(".ui-page")&&n.changePage(e.substring(1))}));u&&t.preventDefault()}else e!=="#"&&(u=function(){et.navigate(e)});else u=function(){vb(f,i.attr("data-transition"),i.attr("rel")=="external")}}if(u&&!ft()){if(i.attr("download")){i.click();return}return st(i,function(){if(ft(!1),typeof u=="string"){var n=u;u=function(){$(n).trigger("vclick")}}u()}),!1}}}}function crt(t){var f=t.message,e=f!=null?f.toString():"",u=t.cancel,i=$.Deferred();return ft(!1),vi(function(){var t=n.pageInfo(),r=t.dataView;dh(function(){var u,n;t._canceled?i.reject():(u=r&&r.survey(),u&&(n=u._cancel,n===!1&&(n=u._submit),n?n!==dt?n():i.reject():i.resolve()))})}),r.survey({_submit:t.submit,_cancel:u,_promise:i,controller:t.name,questions:[{name:"msg__",value:e,text:!1,readOnly:!0,rows:3,htmlEncode:!e.match(/<\/\w+>/)}],options:{modal:{fitContent:!0,always:!0,max:"xxs",buttons:{more:!1}},contentStub:!1,promo:!1},submit:"alertconfirmed.app",cancel:u!==!1?"alertnotconfirmed.app":u,layout:'<div data-container="panel"><span data-control="field" data-field="msg__" class="app-text-default">[Message]<\/span><\/div>'}),i}function yb(n,t,i){$(n).each(function(){var n=this,r=n.url,f=$("<li/>").appendTo(t).addClass("app-depth"+i),u,e;r?(u=r.match(sut),u&&(r=u[2],e=u[1]),$("<a/>").appendTo(f).data("node",n).attr({href:r,target:e,rel:"external"}).text(n.title)):$("<span/>").appendTo(f).text(n.title);n.children&&yb(n.children,t,i+1)})}function eht(){$("#app-btn-context").on("vclick",function(){var t=$(this);if(!ft()&&!t.data("skipClick"))return st(t,function(){if(($(".ui-panel-open").attr("id")||"").match(/^app-panel-context/))vf();else{vf(!0);var t=o.is(".app-has-panel-right")?"left":"";n.showContextMenu({position:t,scope:t?yt():null})}}),!1});$('[data-app-role="sitemap"]').attr("class","app-site-map").each(function(){function r(){var n=$('<li><a rel="external"/><\/li>').appendTo(t).find("a");$("#app-welcome").length&&!i?n.attr("href","#app-welcome").text(cf.LoginButton):li.loginStatus(n)}var u=$(this),t=$('<ul data-inset="false" />').appendTo(u),i=li&&li.loggedIn();li&&!i&&r();yb(hr,t,1);li&&i&&r();t.listview().on("vclick",'a[rel="external"]',function(t){var i=$(t.target),r=i.attr("href"),u=r.match(/^#/);return te(i)?(st(i,function(){u?n.changePage(r.substring(1)):bs(i.data("node"))}),!1):!1}).filterable({filterPlaceholder:f.FilterSiteMap})})}function wc(n){n==="touch"?(s=!0,o.removeClass("app-desktop app-show-system-buttons-on-hover")):(s=!1,e("ui.showSystemButtons")!=="Always"&&o.addClass("app-show-system-buttons-on-hover"),o.addClass("app-desktop"));ro=!1}function oht(){var n,t;if(o=$(document.body),ik&&o.attr("x-ms-format-detection","none"),$.event.special.swipe.teardown(),$.event.special.swipe.setup=function(){},$.event.special.tap.teardown(),$.event.special.tap.setup=dt,$.mobile.autoInitializePage=!1,et.focusPage=dt,$.extend($.fn.buttonMarkup,{initSelector:"a:jqmData(role='button')"}),n=et.SerialTransition.prototype,n.toPreClass="",n.cleanFrom=function(){this.$from.removeClass(et.activePageClass)},n.doneIn=function(){this.deferred.resolve(this.name,this.reverse,this.$to,this.$from,!0)},n.hideIn=function(n){n.call(this)},n.scrollPage=dt,n.startIn=function(){this.hideIn(function(){this.$to.addClass($.mobile.activePageClass)});this.doneIn()},n.startOut=dt,n.toggleViewportClass=dt,n.transition=function(){var n="none",t="",i=$.mobile.getScreenHeight();return this.$from&&!n?this.startOut(i,t,n):this.doneOut(i,t,n,!0),this.deferred.promise()},et.resetActivePageHeight=function(){},t=l.matchMedia("(min-resolution: 144dpi), (-webkit-min-device-pixel-ratio: 1.5)"),t.matches?(gs=144,t=l.matchMedia("(min-resolution: 240dpi), (-webkit-min-device-pixel-ratio: 2.5)"),t.matches&&(screepDPI=240)):(screen.width>1080||screen.height>1080)&&(gs=144),s="ontouchstart"in l,s){if(!sr&&!kr)$(document).on("mousemove touchstart",function(n){ei&&(lr=null,n.type.match(/^touch/)?s||wc("touch"):s&&wc("mouse"))})}else if(l.PointerEvent){s=!1;ro=!0;brt&&(s=!1,ro=!0);$(document).on("pointerdown pointermove",function(n){if(ei){var t=n.originalEvent.pointerType;t==="touch"?(!s||ro)&&wc("touch"):t==="mouse"&&(s||ro)&&wc("mouse")}})}s||ro||e("ui.showSystemButtons")==="Always"||o.addClass("app-desktop")}function sht(){var f=e("ui.iconFonts"),o,n,i,s,u,r=["material-icon","glyphicons","glyphicon","fa","ion"],t=[];if(f)for(n in f)o=f[n],r.push(n),s=o.url,s&&t.push("@import url('"+s+"');"),i=o.size,i?u=(24-i)/2:(i=24,u=0),t.push(".app-icon."+n+",.app-icon."+n+":before{font-size:"+i+"px;line-height:24px;"+(u?"margin-left:"+u+"px;":"")+"}"),t.push(".app-page-header .app-icon."+n+",.app-page-header .app-icon."+n+"::before{font-size:40px;line-height:40px;}"),t.push(".app-page-header .app-icon."+n+".app-icon-background,.app-page-header .app-icon."+n+".app-icon-background::before{font-size:240px;line-height:240px;}");t.length&&$("<style/>").text(t.join("")).appendTo("head");r=r.join("|");nl=new RegExp("\\b((("+r+")-([\\w-]+?)))(\\s|$|,)","g");iy=new RegExp("^("+r+")-(.+)")}function hht(){var i='<a class="ui-btn-right app-btn ui-btn ui-btn-icon-notext ui-shadow ui-corner-all"/>',t=$('<div id="app-bar-toolbar" class="app-bar-toolbar ui-header ui-bar-a ui-header-fixed" data-role="header" data-position="fixed" data-theme="a" class="app-bar-toolbar"><span class="app-btn-menu-background"/><span class="app-back-text"/><span class="app-logo"/><h1 class="ui-title"/><a data-role="button" id="app-btn-menu" class="app-btn-menu ui-btn ui-btn-icon-notext ui-shadow ui-corner-all ui-icon-bars ui-btn-left"/><div class="app-btn-cluster-right">'+i+i+i+i+i+'<a id="app-btn-context" data-role="button" class="app-btn-context ui-btn-right ui-link ui-btn ui-icon-dots ui-btn-icon-notext ui-shadow ui-corner-all" /><\/div><\/div>').appendTo(o);$('<div data-role="page" id="Main"><div data-role="content" class="app-content-main"><\/div><\/div>').appendTo(o);$('<a class="ui-btn ui-btn-a ui-btn-icon-notext app-btn-float app-btn-promo"/>').hide().appendTo(o).on("click",hrt);pt=ct("ui.readingPane.enabled")?{enabled:!0,minLeft:e("ui.readingPane.minLeft")||375,minRight:e("ui.readingPane.minRight")||375,minTop:e("ui.readingPane.minTop")||375,minBottom:e("ui.readingPane.minBottom")||375,bkg:e("ui.readingPane.background"),divider:1}:{enabled:!1};yd()?(or=wh(),ae({isVirtual:or.width!=null,width:or.width,height:or.height,toolbar:t})):ae({isVirtual:!1,toolbar:t});t.find(".app-btn").data("icon","gear").on("vclick",hrt);eu&&t.css("visibility","hidden");n._toolbar=t;n._logo=t.find(".app-logo");n._actionButton=$(".app-btn-promo");n._toolbarButtons=t.find(".app-btn");n._title=t.find("h1").addClass("app-hidden");n._menuButton=$("#app-btn-menu");n._backText=t.find(".app-back-text").hide().attr("title",f.Back);n._contextButton=$("#app-btn-context");$("#aspnetForm").hide()}function cht(){o.on("pagecontainerbeforeshow",function(t,i){var f=y(),u=w(),r=u?u.headerText:n.title();r&&typeof r!="string"&&(r=r[0]);r===!1&&(r="");n.toolbar(r);hft(u);n.pageShow(gt());n.unloadPage(i.prevPage,f);os();n.contextScope(null)}).on("pagecontainerbeforehide",function(){t.ignoreErrors=!1;rt=!0;ft(!0)}).on("pagecontainerbeforetransition",function(i,u){var a,o;if(u.toPage&&u.prevPage){var s=$(u.toPage).attr("id"),h=w(s),c=$(u.prevPage),e=c.attr("id"),l=w(e),f=l&&l.dataView,v=n.pageTransitionCallback;if(s===e||h&&h.deleted)return!1;if(f&&(dismissAll=f._dismissAll,f._dismissAll=!1,u.options.reverse&&f.editing()))if(a=t.cancel(),o=f.changed("ignore"),a&&o)o&&$(document).trigger($.Event("dataviewignorechanges.app",{dataView:f,changed:f.changed()}));else return activeUrl=c.attr("data-url"),n.pageTransitionCallback=null,setTimeout(function(){oft(e);r.confirm(vr.DiscardChanges).then(function(){f.changed("ignore",!0);n.pageTransitionCallback=v;setTimeout(yr)}).fail(tf)}),i.preventDefault(),!1}ri();n.promo(!1);dp(y());tw(ga())}).on("pagecontainershow",function(){y()&&ftt(y())}).on("pagecontainertransition",function(n,t){vg(t)})}function ee(n){var i=n.originalEvent,t=i;return t.pageY==null&&(t=i.touches[0]||i.changedTouches[0]),{x:t.pageX,y:t.pageY}}function ds(){clearTimeout(pb);io&&(io.data("touch-start",null),io=null)}function bc(n){var i=n.type,t;if(k&&(i==="pointercancel"||i==="touchcancel")&&k.cancelable===!1){k.cancelable=!1;return}go(n);k&&(t=k.moved&&(k.originalX!==k.x||k.originalY!==k.y),t&&(k.swipeLeft=k.originalX>k.x,k.swipeRight=k.originalX<k.x,k.swipeUp=k.originalY>k.y,k.swipeDown=k.originalY<k.y,k.swipeHorizontalDistance=Math.abs(k.originalX-k.x),k.swipeVerticalDistance=Math.abs(k.originalY-k.y)),n.type!=="touchcancel"&&(n.type!=="mousemove"||k.moved)||(lt._keepTap=!0),$(document).trigger($.Event(t?"dragend.app":"dragcancel.app",{drag:k})),t||n.type==="taphold"?lt.dragged(!0):k.dir==="all"&&n.type==="touchend"&&(lr={x:k.x,y:k.y},$(document.elementFromPoint(k.x,k.y)).trigger("vclick")),k.target=null,k.data=null,k=null);ni&&(k=ni,ni=null,bc(n));$(document).off("pointermove mousemove touchmove",kb).off("pointerup pointercancel mouseup touchend touchcancel",bc)}function kb(n,t){var i;if(ni){var i=ee(n),u=Math.abs(i.x-ni.x),r=Math.abs(i.y-ni.y),f=ni.dir==="horizontal",e;if(u<1&&r<1&&(k&&(k.moved=!1),!t))return;f&&(e=lt[ni.type],e.canScroll&&!e.canScroll(ni.target,"vertical")&&(r=0));ni.dir==="all"||f&&u>r&&u>(ni.mouse?3:ni.pointer?5:1)&&r<(ni.pointer&&ni.touch?10:9)?(ds(),k=ni,(n.type==="touchmove"||n.type==="pointermove")&&(k.cancelable=!1,n.preventDefault()),ni=null,tu(!1)):(f&&(u||r)&&ds(),(!f||r>=1)&&bc(n))}k&&(n.preventDefault(),kf(),i=ee(n),k.moved||(k.moved=!0,k.originalX=k.x,k.originalY=k.y),(k.x!=i.x||k.y!=i.y)&&(k.lastX=k.x,k.lastY=k.y,k.x=i.x,k.y=i.y,k.dropTarget=n.type.match(/^touch|pointer/)?document.elementFromPoint(i.x,i.y):n.target,$(document).trigger($.Event("dragmove.app",{drag:k}))))}function tu(n){(!s||n)&&(o[0].style.pointerEvents=n?"":"none")}function lrt(n){n?n.find('[data-control="dataview"]').each(function(){var t=$(this).attr("id"),n,i;t&&(n=w(t.substring(0,t.length-3)),i=ot(n.id),i.is(":visible")&&n.echoId&&!n.dataView._busy()&&lc(n.dataView,i))}):y(".app-echo-toolbar").each(function(){echo=$(this).parent();echo.is(":visible")&&(pageId=echo.attr("data-for"),pageInfo=w(pageId),pageInfo.echoId&&!pageInfo.dataView._busy()&&lc(pageInfo.dataView,echo))})}function lht(){db||(db=!0,n.promo(!1),ttt(),ri(),lp(),rp().length&&n.promo(!1),$(document).trigger("resizing.app"))}function art(n){n||(n=y());var i=fu.indexOf(pf(n.width())),r=[],t;for(i||i++,i===fu.length-1&&i--,t=1;t<=i;t++)r.push("app-min-"+fu[t]);for(n.addClass(r.join(" ")),r=[],t=i+1;t<fu.length-1;t++)r.push("app-min-"+fu[t]);n.removeClass(r.join(" "))}function br(r,u){var e,f,h,l,o,s;rt||(tt.detach(),wi(),e=w(),f=d(u),r&&(db=!1,pa(),$(".ui-panel-dismiss").height(i.height),ci(),h=rp(),l=y(),h.length&&(ci(h),nu(l)&&ci(l),is(e?e.dataView:null),fp()),bt(!1,null,function(){of();pr(f);hu();df();tt.sync();ue()})),ri(),art(u),pr(f),cn(f),r||ue(null,u),is(),pa(!0),c.left.visibile&&c.left.inner.trigger("scroll"),wy(),nc(e,!0),uot(f),r?fc(f):setTimeout(fc,0,f),clearTimeout(wk),wk=setTimeout(function(){rt||(du(),n.refreshMenuStrip(),tet(f))},1e3),aht(f),r&&(lrt(),df(),o=$(".ui-popup"),o.is(".app-popup-message,.app-popup-listview")?to(o):o.popup("reposition",{positionTo:"window"}),wi(),$(document).trigger("resized.app"),t.restoreLastPopup(),ut&&ut.is(".app-tooltip-message")&&(s=ut.data(),s&&s.fieldName&&setTimeout(oi,100,s))))}function ri(){ut&&ut[0].style.display!=="none"&&ut.hide();vo&&(clearTimeout(vo),vo=null)}function kc(n,t,u,f,e){var d;if(!s||e){var b=u.split(/\n/g),y=i.width,h=i.left,g;ut||(ut=$('<div class="app-tooltip"><\/div>'),lg()&&ut.addClass("app-large"),ut.insertBefore(".ui-page:first"),ut._outer=ut.outerWidth(),ut._maxw=v(ut,"max-width"));ut.css({left:"",top:"",maxWidth:Math.min(ut._maxw,y-ut._outer)}).text(u);b&&(u.match(/\t/)?(g=$("<table/>").appendTo(ut.empty()),$(b).each(function(){var n=this.split(/\t/g),t=$("<tr/>").appendTo(g);$(n).each(function(){var n=this,i=$("<td/>").appendTo(t);n.match(/"/)?i.html(n.replace(/"(.+?)"/g,"<b>$1<\/b>")):i.text(n)})})):(ut.empty().removeClass("app-tooltip-message"),$(b).each(function(n){var t=r.safeHtml(this);n&&$("<br/>").appendTo(ut);t.match(/"/)&&(t=t.replace(/"(.+?)"/g,"<b>$1<\/b>"));$("<span/>").appendTo(ut).html(t)})));ut.show();var k=ou.scrollLeft(),nt=ou.scrollTop(),l=ut.outerWidth(),p=ut.outerHeight(),o,a,tt,w=f&&f[0].className,it;e&&(t+=2);w&&typeof w=="string"&&(d=f.attr("data-tooltip-location"),w.match(/\bapp-btn-float\b/)?(o=f.offset(),n=f.css("right")!=="auto"?o.left-l-8:o.left+f.outerWidth()+12,t=o.top+f.outerHeight()/2-p/2+1,a=!0):w.match(/\bapp-btn-tooltip\b/)?(o=f.offset(),tt=f.outerWidth(),it=n,n=o.left+tt+12,n+l>y+h?(n=o.left-12-l,n>=h?a=!0:n=it):a=!0,a&&(t=o.top+f.outerHeight()/2-p/2+1)):w.match(/\bui-btn\b/)&&f.closest(".app-sidebar").length&&(c.left.mini?(n=c.left.width+6+h,t=f.offset().top+f.outerHeight()/2-p/2+1,a=!0):f.parent().is(".app-bar-toolbar-bottom")&&(d="above")),d==="above"&&(o=f.offset(),t=o.top-p-6,n=o.left+f.outerWidth()/2-l/2,n<0&&(n=2),n+l>h+y&&(n=h+y-l-2),a=!0));a||(k+n+l>=k+y+h&&(n=k+y+h-l-2),nt+t+p>=nt+i.height+i.top&&(t=t-24-p));ut.css({left:Math.max(h,a?n:n-5),top:t});e&&(vl=new Date,vl.setSeconds(vl.getSeconds()+10),ut.addClass("app-tooltip-message"))}}function aht(n){var i=nt(n);if(i.length){var t=i.offset(),f=i.outerHeight(),r=n.offset(),u=n.height(),e=n.scrollTop();r.top+u<t.top?n.scrollTop(t.top+e-u-(f>u?0:f)):r.top>t.top&&n.scrollTop(t.top+e-r.top)}}function vrt(){nt().removeData("keepFocus").trigger("blur")}function nt(n){return n?$(n).find(".app-data-input"):$(".app-data-input")}function yrt(n){var t=0,r=n[0].style,i={};return cut.forEach(function(u){var e=r[u.name],f=u.ignore;f&&n.is(f)||(t++,i[u.name]=e)}),t?i:null}function vht(n){var t=[],i,r;for(i in n)r=n[i]||"",r.length&&t.push(i.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+r);return t=t.join(";"),t.length?'style="'+t+'"':null}function yht(n){var f,i,pt,r,p,c,u,k,ht,d,l,rt,ut,wt,y,ft,et,ot,st;if(!t.valid())return!1;d=nt();f=it(n);d.length&&(f.data("hitTest",!0),it(d).data("hitTest")||(d=null),f.removeData("hitTest"),vrt());u=$.Event("getvalue.input.app");f.trigger(u);var w=u.inputRows,a=u.rtf,g=u.spellCheck===!1?"false":"",lt;a?(i=$(' <iframe class="app-data-input"><\/iframe>'),w=w||1):(i=w?$('<textarea class="app-data-input" rows="'+(parseInt(w)+1)+'"/>'):$('<input class="app-data-input"/>').attr("type",u.inputIsPassword?"password":"text"),lt=yrt(f),lt&&i.css(lt));s||w||g==="false"||i.attr("spellcheck","true");p=t.createContainer(f.addClass("app-has-focus"));a||i.appendTo(p);w&&(p.addClass("app-has-textarea"),a&&p.addClass("app-has-rtf"));u.inputMaxLength&&i.attr("maxlength",u.inputMaxLength);r=u.inputAltValue||u.inputValue||"";r==null&&(r=u.inputAltValue,r==null&&(r=u.inputValue),r==null&&(r=""));var at=r,b=t._buffer,vt={autocapitalize:"off",autocorrect:"off"};if(b!=null&&(r=b.match(/Backspace|Del|Delete/)?"":b),i.val(r).data("original",at),f.data("original")==null&&f.data("original",at),a&&(l=[],rt=i[0],i.appendTo(p),i.load(function(){h.handlers(i,!0)}),l.push('<html><head><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/><meta charset="utf-8">'),l.push("<style>b,strong{font-weight:600}body{white-space:pre-line;margin:0;padding:0;overflow:hidden;font-size:"+i.css("font-size")),l.push(";color:"+i.css("color")),l.push(";font-family:"+o.css("font-family")),l.push(';}<\/style><\/head><body contenteditable="true">'),l.push(r),l.push("<\/body><\/html>"),rt.contentWindow.document.open(),rt.contentWindow.document.write(l.join("")),rt.contentWindow.document.close()),u.placeholder&&(pt=$('<span class="app-data-input-placeholder"/>').insertAfter(i).text(u.placeholder).css("display",r?"none":""),i.data("placeholder",pt)),u.change&&(i.data({change:u.change,last:r}),u.change=null,vt.autocomplete="off",g="false"),af(g)||(vt.spellcheck=g),a||i.attr(vt),c=f.attr("data-type"),!c){switch(u.inputDataType){case"DateTime":c="datetime";break;case"Date":c="date"}f.attr("data-type",c)}ut=f.find(".app-control-inner");switch(c){case"datetime":ut.attr("data-smart-value")&&ut.data("last-smart-text",ut.text()).text(i.val());break;default:c&&s&&(i.attr("type",c),c==="number"&&(r=u.inputValueRaw,r!=null&&(i.val(JSON.stringify(r)),r=r.toString())))}if(k=$.Event("beforefocus.input.app",{inputElement:i}),f.trigger(k),k.inputElement=null,k.isDefaultPrevented())return!1;try{if(et=rr(),ot=yf(),a&&(y=i.offset(),y.left<=et&&et<=y.left+i.outerWidth()&&y.top<=ot&&ot<y.top+i.outerHeight()&&(wt=h.range("select",{x:et-y.left,y:ot-y.top}))),wt)h.document("focus");else if(a)h.document("focus"),h.range("save"),h.focus();else if(ft=i.focus()[0],ft.setSelectionRange){if(st=at||u.placeholder,st!=null&&st.length&&f.attr("data-auto-expand")==="true"&&!s){var yt=(t._testPlaceholder||$('<span class="app-data-input-placeholder"/>').css("font-style","normal")).text(st).insertAfter(i),bt=ft.getBoundingClientRect(),kt=yt[0].scrollWidth+v(p,"padding-left")*2;t._testPlaceholder=yt;kt>bt.width&&tt.expandBy(i,kt-bt.width);yt.detach()}ft.setSelectionRange(b!=null||f.attr("data-select-on-focus")==="false"||s&&e("ui.input.touch.autoSelect")!==!0||!s&&ct("ui.input.mouse.autoSelect")===!1||u.selectOnFocus===!1?r.length:0,r.length);b&&r.length&&f.data("autoOpen",!0)}ht=$.Event("afterfocus.input.app",{inputElement:i});f.trigger(ht);ht.inputElement=null}catch(dt){}return!0}function gb(n){var t=r.host&&r.host.barcode,i=b.enabled&&t;return i&&n.push({text:"Scan",system:!0,icon:"material-icon-line_weight",rotate:270,toolbar:!0,callback:t||dt}),i}function dc(){return b.input&&(new Date).getTime()-b.time<=(s?b.slowInputSpeed:b.inputSpeed)}function kv(t){var f=arguments.length,e,u,i=b.queue,r;if(f){if(t.match(b.ignore)){n.notify({text:t,force:!0});return}if(r=$.Event("barcodebefore.app",{text:t}),gu.trigger(r),r.isDefaultPrevented())if(b.ready)e=!0;else return;else i.push(r.text)}if(f||!b.ready||n.busy()||e)clearTimeout(b.timeout),b.timeout=setTimeout(kv,b.frequency);else if(i.length){t=i.shift();u=$.Event("barcode.app",{text:t});b.ready=!1;try{gu.trigger(u);u.isDefaultPrevented()||(b.ready=!0,n.notify({text:t,force:!0}))}catch(o){b.ready=!0}i.length&&kv()}}function prt(){b.enabled&&(b.keysDown={},b.keyMap=[])}function pht(){b.input&&!b.buffer.length&&(b.input=!1,b.waiting=null)}function wht(n){var i=n.key,r=b.keyMap,t;b.enabled&&(t=r.indexOf(i),b.keysDown[i]=!1,t>=0&&r.splice(t))}function bht(n){var o,v,f,y,h,i=n.key,c=!b.input&&ar().is(":input"),k=b.input||s||!c?b.slowInputSpeed:b.inputSpeed,r=b.buffer,e,u,l,a=b.keyMap,p=b.keysDown,w;if(b.enabled&&(!b.always||i==="Enter"||!bo(n,!1,!1))&&(e=b.enter,u=e.length-1,a.indexOf(i)===-1&&a.push(i),p[i]=!0,b.override||!c)){if(o=(new Date).getTime(),v=o-b.time,!b.waiting&&!b.always&&v>k?(r.splice(0),b.input=!1):a.length===1&&r.length&&!p[r[r.length-1]]&&(b.input=!0,t._buffer=null,f=ar(),c&&f.is(".app-data-input")&&(t.methods.lookup._preventList(),h=f.data("original"),f.val(h==null?"":h).blur())),b.time=o,b.input){if(e[u--]===i){for(l=r.length-1;u>=0&&l>=0&&r[l--]===e[u];)u--;w=u===-1}if(w)return clearTimeout(b.waiting),b.waiting=setTimeout(pht,b.inventorySpeed),y=r.join(""),prt(),r.splice(0),kv(y),!1}return i==null||i.length!==1||n.ctrlKey||n.altKey||n.metaKey||(!si()||b.always)&&r.push(i),b.input||b.always&&i!=null&&i.length===1?!1:void 0}}var nk="app-transition",sf=navigator.userAgent,dv=navigator.platform,sr=/iPhone|iPad|iPod/.test(dv)&&sf.indexOf("AppleWebKit")>-1,tk=sr?parseInt(navigator.userAgent.match(/\(i.*;.*CPU.*OS (\d+)_\d+/)[1]):null,kr=/Android/i.test(sf),wrt=/\bCrOS\b/.test(sf),brt=/chrom(e|ium)/i.test(sf),gv=!!sf.match(/Trident\/7\./),ik=sf.match(/Edge/),krt=/safari/i.test(sf),s,ro,gs=96,nh,gc,ny=dv.match(/Mac/i)!=null,drt=dv.match(/Win/i)!=null,lu=Sys,ty=lu.Application,grt=lu.CultureInfo.CurrentCulture,hf=grt.dateTimeFormat,nut=/^s*(\w+)\s*\|s*(.+?)\s*(\|\s*(.+)\s*)?$/,tut=/(<(\/*(a|span).*?>)|(&nbsp;)|onclick=".+?")/g,iut=/(<(\/*(b).*?>))/g,rut=/" ([.;])/g,nl,iy,uut=/phone/i,fut=/email/i,eut=/\burl/i,out=/^\s*(\w+)(\s+(\w+)\s*)?$/,tl=/\s*(\w+)(\s+(asc|ascending|desc|descending))?\s*(,|$)/gi,ry=/(delete|clear|trash|remove|undo|erase)/,rk=/(autofill(\d+)?-(\w+))-(\w+)/,uk=".app-page-modal-glass-pane,.app-page-modal-background,.app-progress-screen,.ui-popup-screen,.ui-panel-dismiss,.app-page-modal-title,.app-bar-buttons,.app-bar-toolbar,.app-bar-actions",sut=/^(_\w+):(.+)$/,li,bi,hr,uo,fr=Web,r=$app,dr=fr.Membership,ir=r,th,ih,fo,il,er=fr.DataViewResources,fk=er.Views,hut=er.Menu,vr=er.Data,uy=vr.Filters,fy=uy.Labels,f=er.Mobile,ek=er.Device,ok=fy.And,rh=fy.Clear,rl=vr.NoRecords,eo=f.NoMatches,oe=er.Pager,ul=er.ModalPopup,au=er.HeaderFilter,vu=au.Loading,fl=au.EmptyValue,ey=au.BlankValue,ki=f.More,oo=er.Grid,so=oo.PerformAdvancedSearch,sk=er.Form,uh=sk.Maximize,el=sk.Minimize,fh=f.Apply,eh=er.Actions,ol=er.Validator,ho=er.Lookup,hk=fr.MembershipResources,cf=hk&&hk.Bar,ck=eh.Scopes.Grid,se=f.Themes,di=f.Import,oh=f.Develop,sl=vr.BooleanDefaultItems[0][1],hl=vr.BooleanDefaultItems[1][1],cl=er.Editor,iu={cache:{},list:[],keyCodes:[]},b={buffer:[],time:(new Date).getTime(),queue:[],keyMap:[],keysDown:{},ready:!0},h,cut=[{name:"fontWeight"},{name:"color",ignore:".app-null"},{name:"backgroundColor"},{name:"textTransform"},{name:"fontStyle",ignore:".app-null"}],sh=vr.NullValueInForms,lk,ak,vk,yk,oy,ru,he,pk,hh,ll,wk,ch,bk,uu,sy,al,co,rt,kk={},ii,cr,dk={},lut=500,aut=500,fu=["tn","xxs","xs","sm","md","lg","xl","xxl"],lo,ao,vut="http://www.w3.org/2000/svg",ut,vl,vo,yut=500,put,g,yl=[],wut=0,gk,but,hy,pl,lh,pt,ah,ei,wl={},c,t,fi,oi,l=window,bl=history,eu=l.parent!==l,cy,o,ou=$(l),gu=$(document),i={isVirtual:!1,top:0,left:0,width:0,height:0,physicalWidth:0,physicalHeight:0},or,tt,et=$.mobile,vh=et.navigate.history,yu=r.htmlEncode,ai=34,kut=450,yo,ht,nd,ce,td,le,ly,yh,lr,rd,ud,ay,lt,k,ni,lf,fd,wt="material-icon-chevron-left",p=r.findDataView,kt=r.userVar,dut=r.sessionVar,gr=r.pageVar,af=String.isNullOrEmpty,nf,kl,ed={},yp,rc,dit,git,n,io,pb,wb,bb,db;r.keyCode={backspace:8,tab:9,enter:13,esc:27,space:32,insert:45,"delete":46,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};yp=ur;rc=r.storage;$(document).on("searchperform.dataview.app",function(t){var h=t.dataView,f=t.survey,l=f.context.field,v=f.context.start,i=h.data(),c=i.QuickFind,a=f.context.id,o,u,s;"QuickFind"in i&&(u=y("li.app-selected").attr("data-text"),u!=null&&(s=c?c.match(/(\"?(\S+)\:)\S*/):null,i.QuickFind=s?'"'+s[2]+":"+u.substring(1):u));o=r.search("parse",{id:a,data:i,field:l,showErrors:!0});o.errors.length?t.preventDefault():(n.pageInfo(h)._canceled=!0,be(!1),e("ui.transitions.style","none"),vi(function(){be(!0);r.search("execute",o)}))}).on("searchgenerate.dataview.app",function(n){r.search("generate",{id:n.survey.context.id,survey:n.survey})}).on("searchreset.dataview.app",function(n){return r.confirm(f.ResetSearchConfirm,function(){r.search("reset",{id:n.survey.context.id})}),!1}).on("searchcalculate.dataview.app",function(n){var u=n.rules.trigger(),e,v=n.dataView,w=n.survey,f=v.data(),t,o,i,s,h=f[u],l,a,y,p,c;if(u){if(u.match(/_op$/)){o=u.substring(0,u.length-3);i=f[o];t=v.findField(o);t&&(l=t.ItemsTargetController,y=t.ItemsStyle,t.ItemsStyle=t.lov("static")?t.Extended.itemsStyle:h&&h.match(/^(=|<>|\$in|\$notin)$/)&&t.FilterType==="Text"&&t.Extended.autoComplete!==!1?"AutoComplete":null,t.ItemsTargetController=h==="$in"||h==="$notin"?"_basket":null,a=t.ItemsTargetController!==l,p=t.ItemsStyle!==y,a&&(i=f[o],l?(t.Items=[],i!=null&&(i=r.csv.toArray(i),i.length&&(i=i[0]))):i!=null&&(t.Items=[[i,i]],t.is("lookup-distinct")&&t.Items[0].push(null))),(p||a)&&r.input.execute({values:{name:o,value:i}}));return}s=w.context.id;e=u.match(/^_Match(\d+)_addCondition$/);e&&setTimeout(r.search,0,"addCondition",{id:s,match:parseInt(e[1]),condition:f[u]});e=u.match(/^_Match(\d+)(_filters)?$/);e&&(c=parseInt(e[1]),setTimeout(r.search,0,"changeMatch",{id:s,match:c,type:f["_Match"+c],filters:f["_Match"+c+"_filters"]}));u==="_Match_addGroup"&&setTimeout(r.search,0,"addGroup",{id:s,type:f[u]})}}).on("quickfindshow.dataview.app",function(n){return r.search("toggle",n.survey.context.id),!1}).on("quickfindautocomplete.dataview.app",function(n){var t=n.inputData;r.search("autoComplete",{id:yt().survey().context.id,dataInput:it(t.input),value:t.value,keyboard:t.keyboard})}).on("vclick",".app-bar-history",function(n){var t=$(n.target).closest("li"),i=t.data("text");return i!=null&&(ar().blur(),t.closest("ul").find(".app-selected").removeClass("app-selected"),t.addClass("app-selected"),setTimeout(r.action,ai,{path:"form/submit"})),!1}).on("populateexternalfilter.dataview.app",function(n){var t=yt(),r=t.survey(),i;r&&(i=r.context,i&&i.id===r.parent&&(t=p(i.id),t&&(t._externalFilter||"").forEach(function(t){n.externalFilter.push(t)})))});r.search=function(t,u){function et(){return ye()===12||i.width<480?"xs":""}function it(n,t){var i=t._dataView._allFields[t.OriginalIndex].SearchOptions,r={field:t.Name,operator:i?i[0]:"="};n.fields.push(r)}function tt(n){return n.is("search-mode")!=="forbidden"&&!n.OnDemand&&n.AllowQBE!==!1&&n.Type!=="DataView"}function ot(n){var t=e._allFields,i=n.fields,u=n.available,r;i.length||$(e._fields).each(function(){var r=this;if(tt(r)){if(r=t[r.AliasIndex],i.length===3)return!1;it(n,r)}});r={};i.forEach(function(n){r[n.field]=!0});t.forEach(function(i){var e=i.is("search-mode"),f;(e&&e!=="forbidden"||!e&&!i.Hidden&&tt(i))&&(i=t[i.AliasIndex],f=i.Name,!r[f]&&u.indexOf(f===-1)&&n.available.push(f))})}function w(n,t,i){var r={id:t,type:i||"$matchall",filters:"$showfilters",fields:[],available:[]},u=n?e._allFields[e.findField(n).AliasIndex]:null;return e._allFields.forEach(function(t){var i=t.is("search-mode");(n&&u==t||!n&&(i==="required"||i==="suggested")&&tt(t))&&(t=t._dataView._allFields[t.AliasIndex],it(r,t))}),n||ot(r),r}function ct(n,t){var r=[],o=1,u,s,f=n["_Match1"],c=e._allFields,h,i;if(t)r.push(w(t,1));else if(f)while(f)u={id:o,type:f,filters:"$showfilters",fields:[],available:[]},h={},c.forEach(function(t){tt(t)&&(t=c[t.AliasIndex],i=t.Name,s=n["_Match"+o+"_"+i+"_op"],s&&!h[i]&&(u.fields.push({field:i,operator:s}),h[i]=!0))}),ot(u),r.push(u),f=n["_Match"+(++o).toString()];else r.push(w(null,1));return r}function lt(){var s=e._allFields,n=u.data,t=u.field,i={id:u.id,data:n,field:t,start:u.start,filter:[],find:n.QuickFind,errors:[]},c=i.filter,f=[],l=[],o,a,h;for(o in n)o.match(/^_match\d+$/i)?f.push(o):l.push(o);return f.length||f.push(""),f.forEach(function(i){var u=new RegExp("^("+(i?i+"_":"")+".+?)_op$"),f=n[i]||"$matchall";i||t||s.forEach(function(t){t=s[t.AliasIndex];var i=t.Name;n[i]!=null&&n[i+"_op"]==null&&(n[i+"_op"]="=")});l.forEach(function(o){var w=o.match(u),l,b,nt=1,h,v,d,g,p,y,k;if(w){for(b=w[0];n[b]!=null;)l=n[b],b=w[0]+(++nt).toString();l&&(d=np(l),p=w[1],h=n[p],v=n[p+"_v2"],g=i?p.substring(i.length+1):p,y=e.findField(g),!y||t&&s[y.OriginalIndex].Name!=t||d&&h==null&&v==null||(d?(l==="$between"?h==null?(l="<=",h=v):v==null?l=">=":v<h&&(v=[h,h=v][0]):h==null&&(h=v),l==="$in"||l==="$notin"?(h=r.csv.toArray(h.toString()),h.forEach(function(n,t){h[t]=e.convertFieldValueToString(y,n)}),h=h.join("$or$")):(h=e.convertFieldValueToString(y,h),l==="$between"&&(h=h+"$and$"+e.convertFieldValueToString(y,v)))):h="",l.match(/^\$/)&&(l+="$"),a!=i&&(t||(k=f.match(/(match|donotmatch)(all|any)/),k&&c.push("_"+k[1]+"_:$"+k[2]+"$")),a=i),c.push(y.Name+":"+l+h)))}})}),t||(h=yt(),h!=e&&h._allFields.forEach(function(t){if(t.Extended&&t.Extended.required){var r=n[t.Name+"_op"];r&&np(r)&&n[t.Name]==null&&i.errors.push({field:t.Name,error:ol.Required})}})),u.showErrors&&i.errors.length&&oi({fieldName:i.errors[0].field,message:i.errors[0].error}),i}function vt(){var f=u.id,i=u.data,o=u.start,r=u.field,n=u.filter,t;r?(e.removeFromFilter(e._allFields[e.findField(r).AliasIndex]),n.forEach(function(n){e._filter.push(n)}),us(e)):(u.keepFilter||e.clearFilter(),n=n.length?n:null,e.asearch("filter",n),e.asearch("active",n!=null),"QuickFind"in i?(t=i.QuickFind,t==null&&o?sc(f):gft(e,t),wn(e)):us(e))}function pt(){var t=yt(),i=t.survey().context,f=JSON.parse(i.base),o=i.model,n=o[u.match-1];n.available.splice(n.available.indexOf(u.condition),1);it(n,e.findField(u.condition));u.survey=f;b(o,t.data());r.survey("refresh",f,function(n){ci();s||n.find('[data-control="label"][data-field="_Match'+u.match+"_"+u.condition+'"]').trigger("vclick")})}function wt(){var t=yt(),i=t.survey().context,f=JSON.parse(i.base),n=i.model;n.push(w(null,n.length+1,u.type));u.survey=f;b(n,t.data());r.survey("refresh",f,function(t){ci();rt(t,n.length)})}function st(){var n=[],t=e._allFields;return t.forEach(function(t){t.is("search-option-top-values")&&n.push(t)}),n.length||t.forEach(function(i){var r=t[i.AliasIndex];i.ItemsDataController&&n.length<3&&r.Type=="String"&&!(i.AllowAutoComplete==!1||i.AllowMultipleValues==!1)&&n.push(r)}),n}function kt(){var f=yt(),o=f.survey().context,s=JSON.parse(o.base),h=o.model,n=h[u.match-1],i=u.filters,t,e,c;if(n.type=u.type,n.fields.forEach(function(t){var i=f.findField("_Match"+n.id+"_"+t.field);i.Extended&&i.Extended.context&&(i.ContextFields=n.type.match(/any/)?null:i.Extended.context,i._dataView.sessionRemove(ko(i)))}),i&&i!=n.filters){n.filters=i;t=f.data();for(e in t)e.startsWith("_Match"+n.id+"_")&&delete t[e];delete t["_Match"+n.id];i==="$showfilters"?(c=w(),n.fields=c.fields):(n.fields=[],st().forEach(function(t){n.fields.push({field:t.Name,operator:"$in"})}));u.survey=s;b(h,t);r.survey("refresh",s,function(t){ci();rt(t,n.id)})}}function rt(n,t){s||n.find('[data-field="_Match'+t+'"]').closest("[data-container]").next().find('[data-control="label"]').first().trigger("vclick")}function dt(){var n=yt().survey().context,t=JSON.parse(n.base);u.survey=t;b(n.model=[w(null,1)],{});r.survey("refresh",t,function(n){ci();rt(n,1)})}function b(n,t){var o=u.survey,c=o.context,l=e._allFields,p=st(),r=c.field,v,a,i=[],s=[],y,h;return t||(t=e.data(r?"filter":"search")),c.base||(c.base=JSON.stringify(o)),n||(n=ct(t,r)),c.model=n,r&&(v=t[r+"_op"],a=t[r],r&&(v==="$in"||v==="$notin")&&e.findField(r).FilterType!=="Text"&&(t[r+"_op"]="=",t[r]=a instanceof Array?a[0]:a)),i.push('<div data-layout="form" data-layout-size="tn">'),i.push('<div data-container="'+(r?"simple":"collapsible")+'" data-wrap="false" data-header-text="none">'),n.forEach(function(n){var u=r?"":"_Match"+n.id,o=n.filters,h;r||(i.push('<div data-container="row" style="padding:1em">'),i.push('<span data-control="field" data-field="'+u+'" data-size="auto" style="font-weight:bold;">[_Match]<\/span>'),p.length&&i.push('<span data-control="field" data-field="'+u+'_filters" data-size="auto" style="text-transform:lowercase">[_Match_Filters]<\/span>'),i.push("<\/div>"),s.push({name:u,required:!0,value:t[u]||n.type,text:!1,placeholder:"add matching group",causesCalculate:!0,items:{list:[{value:"$matchall",text:f.MatchAll},{value:"$matchany",text:f.MatchAny},{value:"$donotmatchall",text:f.DoNotMatchAll},{value:"$donotmatchany",text:f.DoNotMatchAny}]},options:{lookup:{openOnTap:!0,nullValue:!1}}}),p.length&&s.push({name:u+"_filters",required:!0,value:t[u+"_filters"]||n.filters,text:!1,placeholder:"filters",causesCalculate:!0,items:{list:[{value:"$showfilters",text:f.WithSpecifiedFilters},{value:"$showtop5",text:f.WithSelectedValues5},{value:"$showtop10",text:f.WithSelectedValues10}]},options:{lookup:{openOnTap:!0,nullValue:!1}}}));n.fields.forEach(function(f,h){function ft(n,i){var f=0,r,u=i.items.list;return n.List.forEach(function(i){if(i){var e=i.Function,o=w.SearchOptions;e?o&&o.indexOf(e)===-1||(y!=="text"||w.AllowAutoComplete===!1||w.AllowMultipleValues===!1)&&e.match(/^\$(in|notin)$/)||(r&&(u.push({value:"$separator"}),r=!1),et&&["=","<>","$isnotempty","$isempty","$true","$false"].indexOf(e)===-1||(u.push({value:e,text:i.Text}),f++)):i.List&&(d={name:v+"_op2",text:a.HeaderText,value:t[v+"_op2"],items:{list:[]},placeholder:n.Text.toLowerCase(),options:{openOnTap:!0,lookup:{autoCompleteAnywhere:!0,nullValue:!1},clearOnHide:!0},visibleWhen:"$row."+v+'_op=="all-dates-in-period"'},ft(i,d)&&u.push({value:"all-dates-in-period",text:i.Text}))}else r=!0}),f}var a=e.findField(f.field),w=l[a.OriginalIndex],b=a.Name,rt=a.FilterType,y=rt.toLowerCase(),k=uy[rt],v=u?u+"_"+b:b,nt=t[v+"_op"]||f.operator,c={name:v,type:y,text:a.HeaderText,placeholder:k.Kind.toLowerCase(),format:a,value:t[v],extended:{required:l[a.OriginalIndex].is("search-mode")==="required"},visibleWhen:"["+(y==="date"?'"=","<>","<",">","<=",">=","$between","$in","$notin"':'"$isnotempty","$isempty"')+"].indexOf( $row."+v+"_op) "+(y=="date"?"!":"=")+"= -1"},ut,p={name:v+"_op",text:a.HeaderText,required:!0,items:{list:[]},value:nt,causesCalculate:!0,options:{openOnTap:!0,lookup:{autoCompleteAnywhere:!0,nullValue:!1,autoAdvance:"row"}}},d,et=a.lov("static"),tt,g,it;o==="$showfilters"?(i.push('<div data-container="row" style="padding-left:3em">'),i.push(String.format('<span data-control="label" data-field="{0}" data-size="'+(r?"fit":"auto")+'">{1}<\/span>',v,a.HeaderText)),i.push(String.format('<span data-control="field" data-field="{0}_op" data-size="auto" style="text-transform:lowercase">{0}_op<\/span>',v)),y!=="boolean"&&i.push(String.format('<span data-control="field" data-field="{0}" data-size="auto" data-focus="true" data-visibility="f:{0}">[{0}]<\/span>',v)),y==="date"&&i.push(String.format('<span data-control="field" data-field="{0}_op2" data-size="auto" data-focus="true" data-visibility="f:{0}_op2">{0}_op<\/span>',v)),y==="boolean"||a.lov("static")||i.push(String.format('<span data-control="text" data-visibility="f:{0}_v2">{1}<\/span><span data-control="field" data-field="{0}_v2" data-size="auto" data-visibility="f:{0}_v2">[{0}]<\/span>',v,ok)),i.push("<\/div>")):(h||i.push('<div data-container="row" style="padding-left:3em">'),i.push('<span style="display:inline-block;vertical-align:top">'),i.push(String.format('<span data-control="label" data-field="{0}" data-size="auto">{1}<\/span>',v,a.HeaderText)),i.push(String.format('<span data-control="field" data-field="{0}" data-size="auto" data-focus="true" data-visibility="f:{0}">[{0}]<\/span>',v)),i.push("<\/span>"),h===n.fields.length-1&&i.push("<\/div>"));ft(k,p);s.push(p);d&&s.push(d);y==="date"&&(c.options={smartDatesDisabled:!0,clearOnHide:!0});y==="text"&&(tt=w.AllowAutoComplete!==!1,g=nt.match(/^(=|<>|\$in|\$notin)$/)!=null&&tt,c.items={controller:e._controller,view:e._viewId,dataValueField:b,dataTextField:b,style:g?"AutoComplete":null,disabled:!g},c.context=[],n.fields.forEach(function(n){f!=n&&c.context.push(String.format("{1}={0}_{1}",u,n.field))}),c.extended.context=c.context.join(","),tt||(c.extended.autoComplete=!1),n.type.match(/any/)&&(c.context=null),r&&(c.extended.filter=e.get_filter(),c.extended.search=e._combinedFilter([])),c.options={lookup:{distinct:(e._fields[0]!=a||a.is("search-sample-distinct")||!!l[a.OriginalIndex].ItemsStyle)&&!a.is("search-sample-all"),acceptAnyValue:!0,multiple:t[v]instanceof Array||!!nt.match(/\$(in|notin)/),autoCompleteAnywhere:g&&w.AutoCompleteAnywhere===!0},clearOnHide:!0});y==="number"&&(c.options={clearOnHide:!0});y==="boolean"?(p.required=!1,p.options.lookup.autoCompleteAnywhere=!1,p.items.list.splice(0,0,{value:null,text:vr.AnyValue}),p.placeholder=k.Kind.toLowerCase()):(s.push(c),a.lov("static")?(it=a.ItemsStyle,c.extended.itemsStyle=it,c.placeholder=uy.Text.Kind.toLowerCase(),c.items={style:it,list:[]},a.Items.forEach(function(n){c.items.list.push({value:n[0],text:n[1]})}),c.options.lookup={nullValue:!1,openOnTap:!0}):(ut={name:v+"_v2",type:y,text:a.HeaderText,format:a,placeholder:k.Kind.toLowerCase(),visibleWhen:"$row."+v+'_op=="$between"',value:t[v+"_v2"],options:{smartDatesDisabled:!0,clearOnHide:!0}},s.push(ut)));o!=="$showfilters"&&c.items&&c.options&&(c.items.style="CheckBoxList",c.options.lookup={distinct:!0,nullValue:"any",top:parseInt(o.substring(8))})});!r&&n.available.length&&o==="$showfilters"&&(i.push('<div data-container="row" style="padding-left:3em">'),i.push('<span data-control="field" data-field="'+u+'_addCondition" data-size="auto">[_AddCondition]<\/span>'),i.push("<\/div>"),h={name:u+"_addCondition",text:!1,placeholder:oo.AddConditionText.toLowerCase(),causesCalculate:!0,items:{list:[]},options:{lookup:{nullValue:!1,openOnTap:!0,autoCompleteAnywhere:!0}}},n.available.forEach(function(n){var t=e.findField(n);t=l[t.AliasIndex];h.items.list.push({value:t.Name,text:t.HeaderText})}),s.push(h))}),r||(i.push('<div data-container="row" style="padding:1em">'),i.push('<span data-control="field" data-field="_Match_addGroup" data-size="auto">[_addGroup]<\/span>'),i.push("<\/div>"),s.push({name:"_Match_addGroup",text:!1,placeholder:f.AddMatchingGroup.toLowerCase(),causesCalculate:!0,items:{list:[{value:"$matchall",text:f.MatchAll},{value:"$matchany",text:f.MatchAny},{value:"$donotmatchall",text:f.DoNotMatchAll},{value:"$donotmatchany",text:f.DoNotMatchAny}]},options:{lookup:{nullValue:!1,openOnTap:!0}}})),i.push("<\/div>"),i.push("<\/div>"),o.questions=s,o.layout=i.join("\r\n"),o.options||(o.options={discardChangesPrompt:!1,modal:{always:!0,max:et(),fitContent:!0,dock:"top",autoGrow:!0},materialIcon:"search"}),r?(o.submitText=fh,y=o.options,y.modal={always:!0,max:"xxs",fitContent:!0,autoGrow:!0},y.materialIcon="filter-list",o.text2="Filter",o.text=e.get_view().Label):(o.text||(o.text=e.get_view().Label,o.text2=f.AdvancedSearch),h=o.buttons,h||(h=o.buttons=[]),h.push({id:"resetSearch",text:oo.ResetAdvancedSearch,icon:"material-icon-clear-all",click:"searchreset.dataview.app",key:"Ctrl+R"}),e.get_showQuickFind()!==!1&&h.push({},{id:"showQuickFind",text:f.ShowLess,click:"quickfindshow.dataview.app"})),o}function ni(){var n=u.value||"",tt=/(\"?(\S+)\:)\S*/g,l=tt.exec(n),k,s,t,v,it,y=n=="",o=y?null:new RegExp(RegExp.escape(n.toString()),"i"),rt=y?null:new RegExp("^"+RegExp.escape(n.toString()),"i"),ut=e.viewProp("quickFindHistory")||[],i,p=u.dataInput,ft=p.closest('[data-container="row"]'),h=ft.next(),d,a=6,et=a,w=[],b=[],ot=u.keyboard,g=e._allFields,f,nt;if(p.closest(".app-bar-search").toggleClass("app-null",y).find("input"),i=[],ot?ut.forEach(function(n){(!o||n.toString().match(o))&&i.push(n)}):i=ut.splice(y?0:1),n){while(l)k=l[1],w.indexOf(l[2])==-1&&w.push(l[2]),l=tt.exec(n);w.length&&w.forEach(function(n){var t=[],i=n.replace(/\s/g,"").toLowerCase();g.forEach(function(n){var r=g[n.AliasIndex],u=r.HeaderText||r.Label||"";n.AllowQBE&&!n.Hidden&&u.replace(/\s/g,"").toLowerCase().startsWith(i)&&(t.push('"'+u+'"'),s||(s=r.Name))});t.length&&b.push('"'+n+':" = '+t.join(", "))});k&&(n=n.substring(k.length),o=n.length?new RegExp(RegExp.escape(n.toString()),"i"):null,rt=n.length?new RegExp("^"+RegExp.escape(n.toString()),"i"):null)}if(i.length<a&&o&&!e.tagged("search-suggestions-none")&&ot){et=i.length;t=e.viewProp("searchData");t||(t={});p.data("scannedDataItems")||(v=$("#"+e._id).find("li.dv-item a"),v.length||(v=$('[data-for="'+e._id+'"]').find("li.dv-item a")),v.each(function(){var i=$(this),n=i.data("data-context");n&&e._fields.forEach(function(i){var r,u,f;i=g[i.AliasIndex];i.AllowQBE&&i.Type=="String"&&(r||(r=t[i.Name],r||(t[i.Name]=r=[])),u=n.row[i.Index],u!=null&&(f=i.format(u),r.indexOf(f)==-1&&(r.push(f),it=!0)))})}),it&&p.data("scannedDataItems",!0),e.viewProp("searchData",t));var c=[],r=[],st=0;for(f in t)f=="_list"||s&&f!=s||t[f].forEach(function(n){n.match(rt)&&c.indexOf(n)==-1&&c.indexOf('"'+n+'"')==-1&&c.push(n)});if(c.sort(),c.length<a){for(f in t)f=="_list"||s&&f!=s||t[f].forEach(function(n){n.match(o)&&r.indexOf(n)==-1&&r.indexOf('"'+n+'"')==-1&&r.push(n)});r.sort()}for(r=c.concat(r);st<r.length&&i.length<a;)nt=r[st++],i.indexOf(nt)==-1&&i.push(nt)}i.length||b.length?(h.is(".app-bar-history")||(h=$('<div data-container="row" class="app-bar-history"><\/div>').insertAfter(ft)),h.show().empty(),d=$("<ul/>").appendTo(h),b.length&&$('<li class="app-hint"/>').text(b.join("; ")).appendTo(d),$(i).each(function(t){if(t==a)return!1;var i=this,f=t>=et,r=o?i.match(o):null,u=$("<li/>").attr("data-text",f?'"'+i+'"':i).appendTo(d);r?($("<span/>").appendTo(u).text(i.substring(0,r.index)),$("<b/>").appendTo(u).text(i.substring(r.index,r.index+n.length)),$("<span/>").appendTo(u).text(i.substring(r.index+n.length))):u.text(i);$('<i class="app-icon material-icon"/>').appendTo(u).text(f?"search":"history")}),ci()):h.length&&(h.remove(),ci())}var o,nt,e,k,ft,g,a,c,v;if(t&&typeof t=="string"||(t="show"),e=u?typeof u=="string"?p(u):u._controller?u:p(u.id):n.contextDataView(),!e||!pet(e)){if(t=="mode")return e.asearch("mode");if(t=="toggle"&&(o=r.search("mode",e),o=o=="quickfind"?"advanced":"quickfind",e.asearch("mode",o)),t=="enumerate"){var h=[],l,ut=d(y()),ht=ut.offset();return ut.find(".app-echo").each(function(){var t=$(this),n=p(t.attr("data-for")),i=n._totalRowCount,u=t.offset(),f=n.get_view();i!=-1&&u.top>=ht.top-1&&u.top<=ht.top+ut.height()-1&&f&&h.push({text:f.Label,icon:"search",desc:ls(n.extension().instruction(!1)),count:i,callback:function(){ke(n);r.search("show",n)}})}),h.length&&(l=function(){h.length===1?h[0].callback():(h.splice(0,0,{text:so}),at(h,"#app-panel-search-menu",{position:"right"}))}),l||(n.navContext(h),$(h).each(function(){var n=this;if(n.icon=="search")return l=function(){n.callback(n.context)},!1})),l&&setTimeout(l),l!=null}if(t==="generate"&&r.survey("show",b()),t==="parse")return lt();(t==="execute"&&(u.filter||(u=search("parse",u)),vt(u)),t==="addCondition"&&pt(),t==="changeMatch"&&kt(),t==="addGroup"&&wt(),t==="reset"&&dt(),t==="autoComplete"&&ni(),t==="show"||t==="toggle")&&(k=e.get_searchOnStart(),ft=y(),k&&(e._totalRowCount=0,gt()!==e._id?lc(e):bt(!1,0),e._requiresContextRefresh=!0,e.set_searchOnStart(!1)),o=e.asearch("mode"),u||(u={}),g=n.contextDataView(),a={id:e._id,start:k,search:!0,field:u.field},g&&g!=e&&r.read(g,"_survey.context.search")&&(n.pageInfo().deleted=!0,a=g.survey().context,k=a.start),k&&(t!=="toggle"&&(nt=e.tagged("search-on-start-simple")?"quickfind":"advanced",o!==nt&&e.asearch("mode",nt),o=nt),vi(function(){var t=n.pageInfo(),i=t.dataView.survey(),r=i&&i.context;dh(function(){r&&!t._canceled&&sc(r.id)})})),o==="advanced"||u.field?(c={controller:e._controller+"._search",parent:e._id,context:a,dynamic:!1},c.submit="searchperform.dataview.app",c.submitText=so,c.submitIcon="material-icon-search",c.create="searchgenerate.dataview.app",c.calculate="searchcalculate.dataview.app",c.tryLoad=!a.field,r.survey(c),yc()):(v=e.extension().quickFind(),v===""&&(v=null),vi(function(){r.search("autoComplete",{id:e._id,dataInput:y().find('[data-field="QuickFind"]'),value:v})}),r.survey({parent:e._id,controller:e._id+"-quickfind",context:a,topics:[{questions:[{name:"QuickFind",text:!1,placeholder:String.format(f.QuickFindDescription,e.get_view().Label),value:v}]}],options:{modal:{fitContent:!0,always:!0,max:ft.is(".app-page-modal")&&!ft.is(".app-page-modal-dock")?"":et(),title:!1,tapOut:!0,dock:"top"},actionButtons:!1,discardChangesPrompt:!1,contentStub:!1},layout:'<div class="app-container-search" data-container="simple" data-header-text="none" data-wrap="true"><div data-container="row" class="app-bar-search'+(v==null?" app-null":"")+'" data-density="'+(s?"comfortable":"relaxed")+'"><i class="app-icon material-icon material-icon-search" title="'+so+'">search<\/i><span data-control="field" data-field="QuickFind" data-notify="quickfindautocomplete.dataview.app">[Query]<\/span><i class="app-icon material-icon material-icon-cancel" title="'+f.ClearText+'">cancel<\/i><i class="app-icon material-icon material-icon-more app-btn-more" title="'+f.ShowMore+'"/><\/div><\/div>',submitText:"Search",submit:"searchperform.dataview.app"})))}};r.import=function(t,i){function l(n){return n.match(/\.(\w+)$/)[1].toLowerCase()}function o(n){var e=r.import.state.queues.errors,o=i.data[n.index-1],u,t;if(!e.length){t=[f.Line,f.Error];for(u in o)t.push(u);e.push(r.csv.toString(t))}t=[n.index+1,n.error];for(u in o)t.push(o[u]);e.push(r.csv.toString(t))}function a(n,t){for(var r,f=i.data,e=t.DataFormatString,u=0;u<Math.min(f.length,100);u++)if(r=f[u],r&&(r=r[n]),r)break;return r&&t.Type.match(/^Date/)&&typeof r=="number"&&(r=e?String.format(e,d(r)):r.toString()),r}function tt(n){for(var r="",t=0,i=10240;t<n.byteLength/i;++t)r+=String.fromCharCode.apply(null,new Uint8Array(n.slice(t*i,t*i+i)));return r+String.fromCharCode.apply(null,new Uint8Array(n.slice(t*i)))}function v(n){var t=n[n.length-1];return t=="Z"?n.length-1>0?v(n.substring(0,n.length-1))+"A":"AA":n.substring(0,n.length-1)+String.fromCharCode(n.charCodeAt(n.length-1)+1)}function w(n){this.message=n}function it(){var n=i.dataView,t=i.view,u=n.get_parentDataView();vi(yc);r.survey({text:n.get_view().Label,text2:eh.Scopes.ActionBar.Import.HeaderText,parent:n._id,context:{id:n._id,controller:n._controller,view:t},controller:"import_from_file",topics:[{description:di.SelectFile,wrap:!0,questions:[{name:"file",text:!1,type:"blob"}]}],options:{materialIcon:"publish",discardChangesPrompt:!1,modal:{fitContent:!0,max:"xs",always:!0}},submitText:f.Submit,submit:function(n){function u(){s||oi({fieldName:"file"})}var i=n.dataView,t=i.data(),e=i.survey().context;t.file?r.import("supports",{name:t.file[0].name})?vi(function(){r.import("parse",{file:t.file[0],callback:function(n){r.import("map",{data:n,name:t.file[0].name,context:e})}})}):(n.preventDefault(),r.alert(String.format(di.NotSupported,t.file[0].name),u)):(n.preventDefault(),r.alert(f.Files[s?"Tap":"Drop"],u))}})}function b(){var h,t,a;try{if(h=u.result,l(i.file.name)==="csv")t=$.csv.toObjects(h);else{t=[];var g=tt(h),y=XLSX.read(btoa(g),{type:"base64"}),c=y.Sheets[y.SheetNames[0]],p=c["!ref"],f=p?p.match(/(([A-Z]+)(\d+))\:(([A-Z]+)(\d+))/):null,b,k,n,e,o,s=[],d=[];if(!f)throw new w(rl);if(b=f[2],k=f[5],e=parseInt(f[3]),lastRow=parseInt(f[6]),e<lastRow){for(o=e+1,n=b;n!=k;)s.push(n),n=v(n);for(s.push(n),s.forEach(function(n){var t=c[n+e];d.push(t?t.v:null)});o<=lastRow;)a={},t.push(a),s.forEach(function(n,t){var i=c[n+o],r=d[t];r&&(a[r]=i?i.v:null)}),o++}}if(t.length)ft(!1),i.callback&&i.callback(t);else throw new w(rl);}catch(nt){ft(!1);r.alert(nt.message)}}function k(t){function tt(n,t){var i=g[n.Name];i.value=t;i.items.list.push({value:t,text:t});u.splice(u.indexOf(t),1)}function it(n,t){return n.toLowerCase().indexOf(t.toLowerCase())!==-1}var f=i.context,c,l,e;if(!arguments.length){r.execute({controller:f.controller,view:f.view||"createForm1",requiresData:!1,success:function(n){k(n)}});return}var s=p(f.id),w=(s._filterFields||"").split(","),b=t.fields,h=[],u=[],v,o=[],d=s.get_view().Label,y=[],g={};for(v in i.data[0])h.push(v.toLowerCase()),u.push(v);if(f.importColumns=u.slice(0),b.forEach(function(n){var e=n;if(n=b[n.AliasIndex],!e.Hidden&&!n.OnDemand&&!e.ReadOnly&&e.Type!=="DataView"){var i=n.Name,l=n.HeaderText,t={name:i,text:l,causesCalculate:!0,items:{style:"DropDownList",list:[{value:null,text:di.NotMatched}]},value:null,columns:30,placeholder:di.NotMatched,required:!n.AllowNulls&&!n.HasDefaultValue},r=h.indexOf(l.toLowerCase()),a=w.indexOf(e.Name);if(a!==-1){if(a>0)return;delete t.items;var p=s.context(),c=p.headerField(),v=s.context("data");t.value=c?c.format(v[c.Name]):sh;t.readOnly=!0;f.masterKey=[];w.forEach(function(n){f.masterKey.push({field:n,newValue:v[n],modified:!0})})}else r===-1&&(r=h.indexOf(i.toLowerCase())),r===-1?o.push(n):(i=u[r],t.value=i,t.items.list.push({value:i,text:i}),h.splice(r,1),u.splice(r,1));y.push(t);g[t.name]=t}}),o.length){for(c=0;c<u.length;)e=u[c],l=null,$(o).each(function(n){var t=this;if(it(t.HeaderText,e)||it(t.Name,e))return l=t,o.splice(n,1),!1}),l?tt(l,e):c++;o.length&&o.forEach(function(n){e=null;$(u).each(function(){var t=this;if(t.indexOf(n.HeaderText)!==-1||t.indexOf(n.Name)!==-1)return e=t.toString(),!1});e&&tt(n,e)})}y.forEach(function(n){u.forEach(function(t){n.items&&n.items.list.push({value:t,text:t})});var i=n.value,r;i&&(r=t.map[n.name],n.footer=a(i,r))});f.availableColumns=u;f.metadata=t;r.survey({controller:"import_map",text:d,text2:eh.Scopes.ActionBar.Import.HeaderText,description:String.format(di.FileStats,i.data.length,i.name),questions:y,options:{modal:{max:"xs",fitContent:!0,always:!0},materialIcon:"settings_input_component"},context:f,submit:function(t){var u=t.dataView,f,e;i.fieldMap=u.data();for(f in i.fieldMap)e=u.findField(f),(!e||e.ReadOnly)&&delete i.fieldMap[f];u.discard();vi(function(){vi(function(){var t=n.pageInfo();dh(function(){t._canceled||t.dataView.survey().cancel()});nt("init")});r.survey({controller:"import_status",options:{modal:{max:"xxs",fitContent:!0,always:!0,buttons:{more:!1,fullscreen:!1}},contentStub:!1},questions:[],layout:String.format('<div style="padding:1em"><div>{0} <b>{1}<\/b> {2} <b>{3}<\/b>...<\/div><div class="app-import-status">&nbsp;<br/>&nbsp;<br/>&nbsp;<br/>&nbsp;<\/div><\/div>',di.Importing,i.name,di.Into,d),submit:!1,cancel:function(){r.import.state=null}})})},submitText:di.StartImport,calculate:function(n){var i=n.dataView,e=i._fields,o=i.survey(),s=o.context,u=s.importColumns.slice(0),f=i.data();e.forEach(function(n){if(!n.ReadOnly){var i=f[n.Name],e=n.FooterText;i!=null?(u.splice(u.indexOf(i),1),n.FooterText=a(i,t.map[n.Name])):n.FooterText=null;e!==n.FooterText&&setTimeout(r.input.execute,0,{values:{name:n.Name,value:f[n.Name]}})}});e.forEach(function(n){if(!n.ReadOnly){var t=n.Items,i=f[n.Name];n.ItemCache=null;t.splice(1);i!=null&&t.push([i,i]);u.forEach(function(n){t.push([n,n])})}})}})}function d(n){var u=Math.floor(n-25569),f=u*86400,i=new Date(f*1e3),e=n-Math.floor(n)+1e-7,t=Math.floor(86400*e),r=t%60;t-=r;var o=Math.floor(t/3600),s=Math.floor(t/60)%60,h=String.format("{0:d4}-{1:d2}-{2:d2}T{3:d2}:{4:d2}:{5:d2}.000Z",i.getUTCFullYear(),i.getUTCMonth()+1,i.getUTCDate(),o,s,r);return Date.fromUTCString(h)}function g(n){var t=r.import.state;t.busy=!1;t.mode="error";t.error=n.get_message()}function nt(){function ri(){var n,i;for(ci.forEach(function(n){var r=u.lookup[n._ilc.lookupIndex],i=t.lookupCache[n._ilc.entryKey][n.filter[0].value];i.v!=null&&(r.values[n._ilc.valueIndex].newValue=i.v)}),n=pi;n<=li;n++)i=u.lookup[n],i.error?o(i):u.submit.push(i)}var t=r.import.state,v,ht,ut,lt,kt,dt,gt,l,b,ot,rt,ni,ti,ii,ai;if(arguments[0]==="init"){r.import.state=t=i;var ui=t.context.metadata,vi=t.fields={},fi=t.fieldMap,ut=t.columnMap={};for(v in fi)ht=fi[v],ht&&(ut[ht]=v);t.duplicate={test:[],accept:[]};ui.fields.forEach(function(n){vi[n.Name]=n;var i=n.Tag;i&&(i.match(/\bimport-duplicate-test\b/)&&t.duplicate.test.push(ui.fields[n.AliasIndex]),i.match(/\bimport-duplicate-accept\b/)&&t.duplicate.accept.push(n.Name))});t.status=y(".app-import-status");t.dataView=p(t.context.id);t.index=0;t.count=0;t.lookupCache={};t.queues={lookup:[],nextLookup:0,test:[],submit:[],errors:[]};t.started=ur();t.mode="scan"}else if(t){var u=t.queues,yi=ur(),w=t.data,ct=t.context.controller,ei=t.context.view;if(t.mode==="scan"){if(ut=t.columnMap,w.length)while(t.index<w.length){lt=w[t.index++];var tt=[],v,s,it,e,a,h=[],at,ft=[],vt=[],oi=t.duplicate.test;for(v in ut)if(e=lt[v],s=t.fields[ut[v]],s&&i.fieldMap[s.Name]===v)if(it=s.Name,a=s.OriginalIndex!==s.Index?t.fields[t.context.metadata.fields[s.OriginalIndex].Name]:null,e==null)a&&(s=a),tt.push({field:s.Name,newValue:e,modified:!0}),oi.indexOf(s)!==-1&&ft.push(it+": "+ol.RequiredField);else{if(a)if(it=a.Name,e==="")e=null;else{var si=a.ItemsDataController,hi=a.ItemsDataView,yt=a.ItemsDataTextField,pt=a.ItemsDataValueField,wt=si+"_"+hi+"_"+pt+"_"+yt,et=t.lookupCache[wt],k,bt;et||(et=t.lookupCache[wt]={});k=et[e];k&&k.v!=null?e=k.v:pt&&(at={controller:si,view:hi,filter:[{field:yt,value:e}]},at.fieldFilter=[pt,yt],bt={valueIndex:tt.length,args:at,entryKey:wt},h.push(bt),k?bt.resolve=!0:k=et[e]={v:null},e=null)}else e===""?e=null:typeof e=="number"&&s.Type.match(/^Date/)?e=d(e):typeof e=="string"&&e&&s.Type!=="String"&&(kt={NewValue:e},dt=t.dataView._validateFieldValueFormat(t.fields[it],kt),dt?ft.push(s.HeaderText+": "+dt):(e=kt.NewValue,typeof e=="number"&&s.Type.match(/^Date/)&&(e=new Date(e))));tt.push({field:it,newValue:e,modified:!0});oi.indexOf(s)!==-1&&vt.push({field:s.Name,value:lt[v]})}if(gt=t.context.masterKey,l={index:t.index,type:"submit",command:"Insert",values:tt},gt&&gt.forEach(function(n){tt.push(n)}),ft.length?(l.error=ft.join("\n"),o(l)):vt.length?(h.length&&(l.requests=h),l.filter=vt,u.test.push(l)):h.length?(l.type="lookup",l.requests=h,u.lookup.push(l)):u.submit.push(l),ur()-yi>8)break}t.mode="send"}else if(t.mode==="send"){if(!t.busy){if(u.submit.length)t.busy=!0,b=[],ot=0,$(u.submit).each(function(n){if(n>=c)return!1;for(var t=this,u=[],r,f,i=0;i<t.values.length;i++)r=t.values[i],r&&(u.push(r),r.newValue!=null&&(f=!0));f?b.push({command:t.command,controller:ct,view:ei,values:u,_src:t}):ot++}),u.submit.splice(0,b.length+ot),t.count+=ot,b.length?(t.message=di.InsertingRecords,r.execute({batch:b,done:function(n){var t=r.import.state;t.busy=!1;t.count+=b.length;b.forEach(function(t,i){var r=n[i];r.errors.length&&(t._src.error=r.errors.join("\n"),o(t._src))})},fail:g})):t.busy=!1;else if(u.test.length)t.busy=!0,t.message=di.TestingRecords,rt=[],ni=t.duplicate.accept,$(u.test).each(function(n){if(n>=c)return!1;var t=this;rt.push({controller:ct,view:ei,filter:t.filter,requiresRowCount:!1,fieldFilter:["_pk_only"],_trc:t})}),u.test.splice(0,rt.length),r.execute({batch:rt,done:function(n){var t=r.import.state;t.busy=!1;n.forEach(function(n,t){var f=n[ct],i=rt[t]._trc,e,h,c,r,s,l;if(f.length){if(ni.length)if(f.length===1){if(i.command="Update",e=i.values,c=0,e.forEach(function(n,t){ni.indexOf(n.field)===-1?e[t]=null:c++}),c){r=i.requests;for(h in f[0])e.push({field:h,oldValue:f[0][h],modified:!1});if(r)for(s=0;s<r.length;)l=r[s],l.resolve=!1,e[l.valueIndex]?s++:r.splice(s,1);r&&r.length?u.lookup.push(i):u.submit.push(i)}}else i.error=di.Duplicates+": "+f.length,o(i)}else i.requests?(i.requests.forEach(function(n){n.resolve=!1}),u.lookup.push(i)):u.submit.push(i)})}});else if(u.nextLookup<u.lookup.length){t.busy=!0;h=[];for(var ci=[],pi=u.nextLookup,li,st,wi=10;wi-->0;)if(st=u.nextLookup++,u.lookup[st].requests.forEach(function(n){n.args._ilc={lookupIndex:st,valueIndex:n.valueIndex,entryKey:n.entryKey};n.resolve?ci.push(n.args):h.push(n.args)}),st===u.lookup.length-1)break;li=u.nextLookup-1;t.message=di.ResolvingReferences;h.length?r.execute({batch:h,done:function(n){var t=r.import.state,i=t.queues;t.busy=!1;n.forEach(function(n,r){var u=h[r],e=n[u.controller],s=u._ilc.lookupIndex,o=i.lookup[s],c=t.lookupCache[u._ilc.entryKey][u.filter[0].value];e&&e.length?c.v=o.values[u._ilc.valueIndex].newValue=e[0][n.primaryKey[0].Name]:o.error=String.format('{0}: {1} = "{2}"',f.DidNotMatch,n.map[u.filter[0].field].Label,u.filter[0].value)});ri()},fail:g}):(t.busy=!1,ri())}else u.test.length&&(t.mode="done");t.index<w.length?t.mode="scan":!u.submit.length&&u.nextLookup>=u.lookup.length&&!u.test.length&&!t.busy&&(t.mode="done")}}else t.mode==="error"&&(message=t.error);ti=ur();ii=new Date(ur()-t.started);t.status.html(String.format("{0:N1}% {1}<br/>{2}...<br/>{3}: {4}<br/>{5}: {6}",t.count/w.length*100,di.Complete,t.message||di.TestingRecords,di.Expected,ii<6e4?f.Dates.InAMin:sw(new Date(ti+Math.round(ii/(t.count||1)*(w.length-t.count))),new Date(ti)),di.Remaining,w.length-t.count));t.mode==="done"&&(n.pageInfo()._canceled=!0,ai=t.dataView,yr(function(){u.errors.length&&hw("errors_"+i.name+".csv",u.errors.join("\r\n"));setTimeout(function(){r.alert(String.format("{0} <b>{1}<\/b> {2} <b>{3}<\/b>.",di.Done,i.name,di.Into,ai.get_view().Label),function(){sc(i.context.id)})})}),t=null)}t&&t.mode!=="error"&&requestAnimationFrame(nt)}var c=e("import.batchSize")||10,u,h;if(t==="upload")it();else{if(t==="supports")return extension=i.name.match(/\.(\w+)$/),extension&&!!extension[1].match(/^(csv|xlsx|xls)/i);t==="parse"?(ft(!0),$(".app-glass-pane").addClass("app-glass-pane-reject"),u=new FileReader,h=i.file,l(h.name)==="csv"?u.readAsText(h):u.readAsArrayBuffer(h),u.onload=function(){try{$.csv?b():$.getScript(nf+"js/lib/import.min.js",b)}catch(n){ft(!1);r.alert(n.message)}},u.onerror=function(n){ft(!1);r.alert(n.message)}):t==="map"&&k()}};$(document).on("vclick",".app-bar-actions h3,.app-echo-toolbar h3",function(t){var e=$(this).closest(".app-echo"),u=e.length?e.attr("data-for"):w().id,i=$(t.target).closest("h3"),o=i.offset(),f=[],h=n.contextScope(),c,r;return i.addClass("app-selected"),c=ctt(),n.contextScope(u),wit(f,!1,!0),r=$.Event("viewselector.dataview.app"),r.items=f,r.dataView=p(u),ke(u),$(document).trigger(r),n.contextScope(h),pi({anchor:i,items:f,iconPos:"left",dropDown:!s,y:o.top+i.outerHeight(),y2:o.top}),!1}).on("vclick",".app-bar-actions .ui-btn, .app-echo-toolbar .ui-btn",function(n,t){function e(){wi();var t=r.context&&r.context.group,e=[],n=w(o).dataView;gst(u);t?(no(t.Id,n,e,n.commandRow()),pi({items:e,iconPos:"left",defaultIcon:"carat-r",scope:n._id,anchor:i,y:f.top+i.outerHeight(!0)/4*3,y2:f.top,dropDown:!s})):r.callback(r.context)}if(!uu){var u=$(this).closest(".app-echo"),o=u.length?u.attr("data-for"):w().id,i=$(n.target).closest("a"),f=i.offset(),r=i.data("data-context");if(r)return i.length&&!ft()&&(ke(i,!1),wi(!1),t!==!1?st(i,e):setTimeout(e)),!1}}).on("vclick",".app-bar-actions",function(){hi()});$(document).on("vclick taphold",".app-echo-inner",function(t){var i=$(t.target),r=i.closest("a"),o=ot(i),y=o.attr("data-for"),p,u,f,h,e,c=t.type,l=c!=="taphold"&&!t.ctrlKey,a=i.closest(".dv-action-see-all").length,v,s;if((!i.closest(".app-presenter").length||a)&&!i.is(".app-hscrollbar2")){if(sy){sy=!1;return}if(ke(o,!1),(a||t.force||r.length&&!r.is(".app-divider")&&te(i,c))&&!ft())if(a)nit(t);else{if(i.is("[data-href]"))return;if(n.contextScope(y),p=w(y),u=p.dataView,f=u.extension(),e=r.data("data-context"),v=r.is(".app-selected"),u._hasKey()){if(att(t,u))return!1;h=u.get_showMultipleSelection();l&&h&&iw(t)?ow(u,r,"none"):(cw(o),l?r.addClass("app-selected"):v?r.removeClass("app-selected"):r.addClass("app-selected"),tv(u).removeClass("app-selected"),l?(h&&r.find(".app-btn-check").addClass("app-btn-check-selected"),s=vtt(t),gh(u,r,s?"none":null)?s&&ks(rw(i)):s?(f.tap(e,"none"),ks(rw(i))):f.tap(e)):(v?f.clearSelection():f.tap(e,"none"),c==="taphold"&&(sy=!0)),st(i));pe(u,o)}else n.infoView(u,!0,e.row);return n.contextScope(null),!1}if(!i.closest(".app-grid-header").length)return!1}}).on("contextmenu",function(n){if(!($(n.target).is(":input")||$(n.target).closest(".app-display-flow").length)&&!n.isDefaultPrevented()){var i=ot(n.target).attr("data-for"),t=w(i);if(t)return srt(t.dataView,n)}}).on("vclick",".app-echo-footer",function(n){var t=$(n.target),i=t.closest(".dv-action-see-all");return i.length&&nit(n),!1}).on("vclick",".app-echo-instruction, .app-echo-toolbar",function(n){n.isDefaultPrevented()||ke($(n.target))});dit={plus:"add",edit:"edit",trash:"delete",duplicate:"content-copy",search:"search",phone:"phone",email:"email",power:"power-settings-new",user:"account-circle",account:"perm-identity",refresh:"refresh",apps:"apps"};git={Delete:"delete",New:"add",Edit:"edit",Cancel:"undo",Duplicate:"content-copy",Select:"arrow-forward",ExportCsv:"get-app",ExportRowset:"grid-on",ExportRss:"rss-feed",ReportAsPdf:"picture-as-pdf",ReportAsImage:"collections",ReportAsExcel:"filter-none",ReportAsWord:"library-books",Search:"search",BatchEdit:"done-all",Upload:"publish",Import:"publish"};r.iyf28=function(n,t){var i=rc.get(n);i||(i=rc.get(t),i?rc.set(t,null):i=yp(),rc.set(n,i));((yp()-i)/864e5>14?lst:dt)()};$.fn.popupopen=function(n){return o.focus(),this.popup("open",n),this};typeof Web=="undefined"&&(Web={DataView:{}});th=ir.MobileBase=function(){th.initializeBase(this)};th.prototype={initialize:function(){},show:function(){},hide:function(){},systemFilter:function(){return null},reset:function(){},notify:function(){},wait:function(){},dataView:function(n){if(n==null)return this._dataView;this._dataView=n},inserting:function(){return this.dataView().inserting()},editing:function(){return this.dataView().editing()},content:function(){var t=this._dataView;return n.content(t._id)},commandRow:function(n){var i=this,r,t;return arguments.length?n?(r=i._commandRow=n.slice(0),t=i.dataView(),t._rows=[r.slice(0)],t.get_isForm()||(t._editRow=null,t._originalRow=null),r):n:i._commandRow},command:function(n,t,i,r,u){var e=this,f=e.dataView(),o=0,s=f._keyFields,h;n&&!n.length&&(s.length&&s[0].Name in n?(h=n,n=[],$(f._allFields).each(function(){n.push(h[this.Name])})):(n=null,o=null));e.commandRow(n);f.executeRowCommand(n?o:null,t,i,r,u)},action:function(n,t,i,r,u,f){this.commandRow(n);var e=this.dataView().a;arguments.length===1?(a=arguments[0],this.executeRowCommand(0,a.CommandName,a.CommandArgument,a.CausesValidation,a.Path)):e.executeAction(0,t,i,r,u,f)},itemMap:function(n){return ost(this.dataView(),n)},stateChanged:function(){bt()},lookupInfo:function(n){var t=this.dataView();if(arguments.length)t._lookupInfo=n;else return t._lookupInfo},viewDescription:function(){var t=this.dataView(),i=t._showDescription!==!1,n=i&&t.get_view().HeaderText;return n=i?t._formatViewText(fk.DefaultDescriptions[n],!0,n):"",n?n.replace(/\n/g,"<p/>"):null},executeInContext:function(n,t,i,r){var e=this.lookupInfo(),u=[],f;return i&&this.lookupInfo(null),this.context(u),i&&this.lookupInfo(e),$(u).each(function(){var i=this,u=i.command;if(u&&u===n&&(t==null||i.argument===t))return f=i,r||bu(i),!1}),f},tagged:function(n){return this.dataView().get_isTagged(n)},filterStatus:function(n,t){var u=this,i=u.dataView(),r,f=we(i),e=i?i.get_filter():null,o=f.length>0,s=i&&e.length>0&&!i.filterIsExternal();return(s||o)&&u.options().filterDetails?(r=new lu.StringBuilder,o&&!t&&i._renderFilterDetails(r,f,!1),s&&i._renderFilterDetails(r,e,!n),r.toString().replace(tut,"").replace(iut,'"').replace(rut,'"$1')):null},aggregates:function(){var n=this._dataView._aggregates;return n&&n.length?n:null},aggregateLabels:function(){var n=[];return $(this._dataView._fields).each(function(){var t=this;n.push(t.Aggregate==0?null:String.format(oo.Aggregates[fr.DataViewAggregates[t.Aggregate]].FmtStr,"").trim())}),n},_disposeSession:function(){var r=this.dataView(),t=r._pageSession,n,i;if(t){for(i in t)n=t[i],n&&typeof n=="object"&&(n.length===1&&n[0]&&n[0].tagName==="STYLE"&&n.remove(),delete t[i]);delete r._pageSession}},focus:function(n,t){var u=this,i=u._dataView,r=y('[data-input-container="'+i._id+'"]');r.length&&(i._inlineEditor&&tt.showField(i,n,r),oi({container:r,fieldName:n,message:t}))}};il=ir.Extensions={};ir.prototype.asearch=function(){var n=this,r=arguments[0],t,i;if(arguments.length===2)r==="active"?(t=n._useAdvancedSearch=arguments[1]===!0,n.viewProp("useAdvancedSearch",t)):r==="mode"?(t=n._searchMode=arguments[1],n.viewProp("searchMode",t)):r==="filter"&&(i=arguments[1],i===!0?n._advancedFilter=null:i===!1?n._advancedFilter="":(n._advancedFilter=i==null?"":i,n.viewProp("advancedSearchFilter",i)));else{if(r==="active")return t=n._useAdvancedSearch,t==null&&(t=n._useAdvancedSearch=n.viewProp("useAdvancedSearch")||!1),t;if(r==="mode")return t=n._searchMode,t||(t=n._searchMode=n.viewProp("searchMode")||"quickfind"),t;if(r==="filter")return i=n._advancedFilter,i==null&&(i=n._advancedFilter=n.viewProp("advancedSearchFilter")||[]),i}};ir.prototype.pageProp=function(n,t){var i=this,r;if(n=i._id+"_"+n,r=e("ui.history.dataView")!==!0&&!1,arguments.length===1)return r?i.sessionShared(n):gr(n);r?i.sessionShared(n,t):gr(n,t)};ir.prototype.viewProp=function(n,t){var i=this,r=arguments.length===1,u={sortExpression:"sort",groupExpression:"group",filter:"filter",advancedSearchFilter:"search"}[n];if(n=(i._viewId||"grid1")+"_"+n,u&&fd.indexOf(u)===-1){if(r)return i.session(n);i.session(n,t)}else{if(r)return i.pageProp(n);i.pageProp(n,t)}};ir.prototype.sessionShared=function(n,t){var i=this,u=i._viewId,r;return i._viewId="__shared",arguments.length===1?r=i.session(n):i.session(n,t),i._viewId=u,r};ir.prototype.mobileUpdated=function(){var t=this,e,o,h,i,c;t.tagged("history-search-none")&&gr(t._id+"_*",{viewTabs:null,viewId:null,filter:null,advancedSearchFilter:null,quickFind:null});t._startPage||t.get_useCase()||t.get_lastCommandName()||(e=t.pageProp("viewId"),e&&(t._viewId=e),o=t.viewProp("sortExpression"),h=t.viewProp("groupExpression"),i=t.viewProp("filter"),c=t.get_master(),c&&c.inserting()&&(i=null,we(t).length&&(t._useAdvancedSearch=!1)),o&&(t._sortExpression=o),h&&(t._groupExpression=h),i&&i.length&&(t._filter=(t._filter||[]).concat(i)));var l=$(t._element),u=sit(l,document.title),a=r.eval(l.attr("data-page-header")),f=w(t._id);f||(f={id:t._id,text:a||u.text,headerText:a||u.text,dataView:t,activator:u},w(f));t._pageSize=sf.match(/iPad;.*CPU.*OS \d_\d/i)||!s?30:30;n._appLoaded||t._hidden||t._filterSource||$('<a class="app-action-navigate"/>').attr("href","#"+f.id).appendTo($("<li>").appendTo(n.pageMenu())).text(u.text);$(t._element).remove();t._element=null};ir.prototype.gridSettings=function(n){var t=this,i,r;if(arguments.length){if(n){for(i in n.width);for(r in n.hidden);n.sequence.length||i||r||(n=null)}t.viewProp("gridSettings",n)}else return n=t.viewProp("gridSettings"),n||(n={sequence:[],width:{},hidden:{}}),n};ir.prototype.gridChanged=function(){var n=this;of(n);gw(n);ff();ne();es(n);pr();ue();tt.sync()};il.Grid=function(n){return new fo(n)};il.DataSheet=function(n){return new fo(n)};fo=ir.MobileGrid=function(n){fo.initializeBase(this);this.dataView(n)};fo.prototype={initialize:function(){var n=this,t=n.dataView().pageProp("viewStyle");t||(n.tagged("view-style-map")&&!n.tagged("view-style-map-disabled")?t="Map":n.tagged("view-style-cards")&&!n.tagged("view-style-cards-disabled")?t="Cards":n.tagged("view-style-list")&&!n.tagged("view-style-list-disabled")?t="List":n.tagged("view-style-grid")&&!n.tagged("view-style-grid-disabled")?t="Grid":n.tagged("view-style-charts")&&!n.tagged("view-style-charts-disabled")?t="Charts":n.tagged("view-style-calendar")&&!n.tagged("view-style-calendar-disabled")?t="calendar":(t="Grid",$(n._dataView._fields).each(function(){if(this.OnDemand&&this.OnDemandStyle!==1)return t="Cards",!1}).each(function(){if(this.Rows>1)return t="List",!1})));n._viewStyle=t},options:function(){var n=this.dataView();return{quickFind:n.get_isGrid()&&n.get_showQuickFind(),filterDetails:!0}},viewStyle:function(t){var i=this,r=i.dataView(),u=i._viewStyle,f,e;if(!arguments.length)return u;f=y();e=u;i._viewStyle=t;f&&(r.pageProp("viewStyle",t),i._instructed=!1,n.presenter("supports",t)||(i._reset=!0),t==="Grid"&&not(r),r.sync());bt()},notifyChildren:function(i,r){var f=this.dataView(),e,u,o;return u=cc(f),u&&(o=u._detailDataViews,o)?(e=u._dataView,t.evaluate({dataView:e,container:d(),row:e.editRow()}),o.forEach(function(t){var u=n.pageInfo(t),e=u.dataView;i?e._busy()||u.echoInitialized==null||(f._id!==tt._dataViewId&&f.inlineEditing()&&tt.detach(),e.sync()):r==="New"&&uit(u.id)}),!0):void 0},headerText:function(n){var t=this._dataView,i=t.headerField(),r=n[i.Index];r!=null&&(t._dataText=i.format(r),i.TextMode===2&&(t._dataText=ls(t._dataText)))},tap:function(t,i){var c,o;if(t){var u=this,r=u.dataView(),a=r._dataViewFieldName,h=t.row||t,f=!0,e,v=0,l;r._busy()||ft()||(r._hasKey()?(l=r._selectedKey,l.length?u._commandRow?r._keyFields.every(function(n){return f=h[n.Index]!==l[v++],!f}):f=!0:f=!0,f&&(u.command(h,"Select"),u.headerText(h),t.pageIndex!=null&&t.pageIndex!==-1&&u.currentPageIndex(t.pageIndex),tv(r).each(function(){var n=$(this),t=n.data("data-context");if(t&&r.rowIsSelected(t.row))return n.addClass("app-selected"),!1})),i||(i="select"),e=$.Event("dataitemselect.dataview.app",{dataView:r,action:i}),$(document).trigger(e),i==="select"?(a&&(u.notifyChildren(f)&&e.preventDefault(),$("#"+r._id+"_ph").is(".app-focus")||oi({fieldName:a,container:d()})),(!e.isDefaultPrevented()||r.extension()._autoSelect)&&(c=!s&&n.lastTouch(),o=c&&$(document.elementFromPoint(c.x,c.y)).closest(".app-field-type-bool"),o&&o.length&&n.touched(o.find("i"))?tt.toggleBool(o,r):u.lookupInfo()?u.executeInContext("Select"):n.executeInContext())):u.notifyChildren(i==="highlight")):n.infoView(r,!0,h),e&&e.isDefaultPrevented()&&!f||bt())}},clearSelection:function(n,t){var r=this,i=r.dataView(),f=i._selectedKey,u,e;if(r._commandRow=null,f&&f.length){if(i.multiSelect()&&i._selectedKeyList.length){rv(i);i.extension().notifyChildren(!1,t);return}u=$.Event("clear.dataview.app");i._clearSelectedKey();i._forgetSelectedRow(!0);r.currentPageIndex(null);u=$.Event("clear.dataview.app");u.dataView=i;$(document).trigger(u);n&&(e=ot(i),e.find('ul[data-role="listview"] a.app-selected').removeClass("app-selected"),w(i).page.find('.app-wrapper > ul[data-role="listview"] a.app-selected').removeClass("app-selected ui-btn-active"),pe(i));bt()}r.notifyChildren(!1,t)},quickFind:function(n){var i=this.dataView(),t,u,r;if(arguments.length){if(n&&ct("search.quickFind.history.enabled")){for(t=i.viewProp("quickFindHistory"),u=e("search.quickFind.history.depth")||100,t||(t=[]),r=t.indexOf(n),r>-1&&t.splice(r,1),t.splice(0,0,n);t.length>u&&t.length;)t.splice(t.length-1,1);i.viewProp("quickFindHistory",t)}i.viewProp("quickFind",n);i._executeQuickFind(n);kn(i)}else return i.viewProp("quickFind")||""},dispose:function(){var u=this,i=u.dataView(),r=i._lookupInfo,f=w(i),t=f?d(f.page):null;t&&(n.presenter("dispose",{id:i._id,container:t}),as(t),t.prev().find("h3, .app-bar-controls").off(),t.find(".app-map").each(function(){var t=$(this),n=t.data("data-map");n&&(urt(n),n.map=null,t.data("data-map",null))}));r&&(r.field=null,r.callback=null);u._disposeSession()},refresh:function(){function ur(i){if(o.requiresInitCallback)return o.initCallback=function(){t.get_searchOnStart()?vi(function(){setTimeout(r.search,0,"show",t._id)}):i()},o.requiresInitCallback=!1,n.navigate(o.id),!0;i()}function wi(n){n?(rr=h.css("display")=="none",rr&&h.css({display:"block","margin-left":-2e4})):rr&&(dp(h),h.css({display:"","margin-left":""}))}function pr(){if(!cu){var n=t.get_selectedKey();t._selectedKeyList=n.length?[n.join(",")]:[];ps(t)}}function br(){var i=t.get_master(),u,n,r;i&&(i.inserting()?wr(o.text,d):(u=i.commandRow(),n=i._fields[0],n=i._allFields[n.AliasIndex],r=n.format(u[n.Index]),n.TextMode===2&&(r=ls(r)),wr([r,o.text],d)));t._lookupInfo&&o.headerText!==!1&&(wr(o.headerText,d),ei!==0&&(h.attr("data-page-header",!1),wr(!1,d)))}function lu(){t._rows.forEach(function(n){if(t.rowIsSelected(n))return i.commandRow()?i.commandRow(n):(t._forgetSelectedRow(!0),i.command(n,"Select")),!1});ov(kt,t,o);wp(s,i);n.bar("hide",ct);n.bar("hide",l);var r=n.presenter("show",{name:b,id:t._id,container:s,reset:p});return br(),r}function au(r){function f(){var c=s!==n.asyncJob(),o,l,e,h;if(u.length&&!c)o=u[0],l=new Date,r.geocoder.geocode({address:o.address},function(n,e){var s,h,c,a;if(e===google.maps.GeocoderStatus.OK)s=n[0].geometry.location,h=frt(i,it,s,o.title,o.row),t.rowIsSelected(o.row)&&av(r,h),rrt(o.address,s.lat(),s.lng()),sb(r),vv(h,750,google.maps.Animation.DROP);else if(e===google.maps.GeocoderStatus.ZERO_RESULTS)rrt(o.address);else if(e===google.maps.GeocoderStatus.OVER_QUERY_LIMIT){setTimeout(f,1e3);return}u.splice(0,1);c=new Date-l;a=675;c<a?setTimeout(f,a-c):f()});else{if(!c&&!u.length&&r.markers.length<aut&&(e=i._mapPageWindow,e||(e=i._mapPageWindow={top:g,bottom:g,dir:"up"}),e.dir==="up"?e.bottom<i.pageCount()-1?(e.bottom++,e.dir="down"):e.top--:e.top>0?(e.top--,e.dir="up"):e.bottom++,h=e.dir==="down"?e.bottom:e.top,h>=0&&h<i.pageCount()-1)){i.pageIndex(h);i.refresh();return}c||(i._mapPageWindow=null)}}var o=irt(t),u=[],s=n.nextAsycJob(),e;r.fit=!0;i._mapPageWindow==null&&urt(r);$(yt).each(function(){var n=this.slice(0),f=cst(n,o),s=ou[eu[0].AliasIndex],h=s.text(n[s.Index]);typeof f=="string"?f!=="ZERO_RESULTS"&&(u.push({address:f,title:h,row:n}),r.geocoder||(r.geocoder=new google.maps.Geocoder)):(e=frt(i,it,f,h,n),t.rowIsSelected(n)&&av(r,e))});sb(r);f()}function dr(){var t=it.data("data-map");t?(it.show(),bp(s),au(t)):n.supports("Map")?(t={map:new google.maps.Map(it.get(0),{zoom:8}),geocoder:null,markers:[]},t.map.setOptions({keyboardShortcuts:!1}),it.data("data-map",t).show(),i.refresh()):setTimeout(dr,100)}function gr(n){var r=$('<li data-icon="false" class="dv-item"/>').appendTo(n),u=$('<a class="ui-btn app-divider app-calculated"/>').appendTo(r);return cs(t,at,null,u,i.aggregateLabels()),r.find(".app-field").attr("data-tooltip-location","above"),r}function yu(){var g;if(wi(!0),n.bar(k?"show":"hide",ct),at&&(k&&pt?s[0].scrollHeight-v(pt,"margin-bottom")<s.height()?n.bar("hide",l):(pt.prev().addClass("ui-last-child"+(pt.is(".app-has-promo")?" app-has-promo":"")),pt.remove(),n.bar("show",l)):(n.bar(at?"show":"hide",l),g=!0)),k&&(hc(t),ne(u),es(t)),p||!i._synced){if(br(),y.length){var r=s.offset().top,e=s.height(),c,f=Math.ceil(y.offset().top),w=y.outerHeight(!0);function b(n,t){n.length&&(t+=v(n,"height"),n[0].style.cssText="height:"+t+"px !important")}ot=s.scrollTop();nt&&nt>0&&nt+w<e?(f-r<nt?b(u.find(".dv-load-at-top"),nt-(ot+f-r)):(c=s[0].scrollHeight,c-(ot+f-r-nt)<e&&b(u.find(".dv-load-at-bottom"),e-(c-(ot+f-r-nt)))),y.parent().prev().is(".dv-item,.dv-load-at-top-parent")&&wu(s,ot+f-r-nt)):wu(s,ot+f-r-(e-w)/2);p&&t.raiseSelected()}else if(i._synced||!t.get_selectedKey().length||t._lookupInfo)i.clearSelection();else{function d(){gt()!=o.id||rt?setTimeout(d,50):t.sync()}d()}i._synced=!0;ue(0);y&&y.length?t.multiSelect()&&ef(!0,fw(u),ytt(t),y.find(".app-btn-check")):s.scrollTop(0);itt(t,h,k)}else y&&y.length&&!p&&!a&&pi!=null&&wu(s,s.scrollTop()+y.offset().top-s.offset().top-pi);df(h);h.find(".ui-header-fixed").length&&h.addClass("app-has-fixed-bar");p?tt.sync(s):hu();wi(!1)}var i=this,g=i.pageIndex(),fu=i.pageCount(),t=i.dataView(),vt=t._totalRowCount,o=w(t),eu=t._fields,ou=t._allFields,ht=i.content(),h=o.page,yt=i.visibleDataRows(g),u=ht.find('ul[data-role="listview"]').show(),ri,ct=h.find(".app-bar-hscrollbar"),l=h.find(".app-bar-aggregates"),pt,at=i.aggregates(),ui=this.pageSize(),p=i._reset,cu=t._keepKeyList,cr=g>0,lr=g<fu-1,li,fi,ar=t.get_showRowNumber()==!0,b=i.viewStyle(),k,s=ht,ot=s.scrollTop(),yi,pi,nt,d=s.find(".app-page-header"),wt,ir,rr,vr,kt=ht.prevAll(".app-bar-actions"),yr=i.echoCallback,fr,er,or,sr,it,dt,tu,ii,lt,gi,nr,iu,si,ru,hi,ci,tr,uu;if(!yt){p&&pc(u);t.goToPage(g,!0);return}if(fr=t._pendingNotification,fr&&(n.notify(fr),t._pendingNotification=null),yr){i.echoCallback=null;yr();return}if(o.echoId&&!o.echoInitialized){t.sessionShared("isSummary")||(t.sessionShared("isSummary",!0),h.remove().empty());su(o.echoId);o.displayed||(o.initialized=!1);return}if(t._keepKeyList=!1,p&&(o.echoChanged=!0,i.currentPageIndex(g)),!rt&&o.id!==gt()&&o.id!==gk&&!t._lookupInfo){pr();du();t._keepKeyList=!0;return}if(o.initialized=!0,o.displayed=!0,n.makeModal(o),er=t.tagged(/\bpage\-header\-(\w+)\b/),er&&(er[1]==="none"?(o.headerText=!1,wr(!1,d)):h.addClass("app-page-header-show")),o.headerText!==!1&&gtt(t,h,d),rit(t),i._autoSelect&&(or=i._autoSelect,vi(function(){i.tap(or.row,or.action);i._autoSelect=null})),o.loading&&(o.loading=!1,h.find(".app-page-loading").remove()),y=u.find("a.app-selected").first(),y.length&&(pi=Math.round(y.offset().top-s.offset().top)),p&&(nt=pi,pr()),t._requiresContextRefresh&&(t._requiresContextRefresh=!1,bt()),i._checkedViews||(i._checkedViews=!0,!t._lookupInfo&&t.get_showActionBar()?kt=tot(t,ht):(wt=[],eb(wt,!1,o)>1&&(ir=[],$(wt).each(function(){var n=this;ir.push({text:n.text,active:n.icon==="checked",callback:n.callback})}),n.tabs("create",{tabs:ir,className:"ui-header-fixed app-tabs-views",id:t._id+"_viewTabs",scope:"page",placeholder:ht}),o.headerText=!1,wr(!1,d),hasMultipleViews=!0))),kt.length&&d.addClass("app-has-action-bar"),n.presenter("supports",{name:b,id:t._id})){tt.detach();ur(lu);i._reset=!1;return}if(b.match(/Grid|Cards|List|Map/)||(b=i._viewStyle="Grid",t.pageProp("viewStyle",b)),t.groupBy(),k=b==="Grid",fi=i.itemMap(b==="List"),is(t,fi.thumb!=null),pn(s,i,b==="Map"),b==="Map"){if(tt.detach(),n.bar("hide",ct),n.bar("hide",l),ht.find('ul[data-role="listview"]').hide(),un(h),!i.tagged("supports-view-style-map")){i.viewStyle("Grid");bt();return}if(yc(),p){i._reset=!1;i._mapPageWindow=null;sr=!1;$(yt).each(function(){if(t.rowIsSelected(this))return sr=!0,i.tap(this,"none"),!1});sr?t.raiseSelected():i.clearSelection();i.refresh();return}wr(!0);wi(!0);wp(s,i);ov(kt,t,o);it=s.find("> .app-map");it.length||(it=$('<div class="app-map"><\/div>').appendTo(s).attr("data-map-for",t._id).hide());n.registerAPI("Map")||(s.find(".app-presenter-instruction").hide(),$('<div class="app-api-error">Google MAP API Key is required. Specify a valid key in <i>Settings | Features | Touch UI<\/i> section of your project properties.<br/><br/><a href="https://developers.google.com/maps/documentation/javascript/get-api-key" rel="external">Get The Key Now!<\/a><\/div>').appendTo(it.empty().show()));df(h);wi(!1);ur(dr);i._reset=!1;gf(ht);return}gv||(yi=$('<div class="app-scrollable-cover"><\/div>').appendTo(s.parent()).css({position:"absolute",left:s.offset().left,top:s.offset().top,width:rf(s),height:s.outerHeight(),zIndex:2,backgroundColor:kr?"transparent":"#fff"}));u.length||(u=$('<ul data-role="listview" class="app-listview"/>').addClass(nv(t)).appendTo(ht).listview().on("taphold",function(n,r){if(r&&(n=r),iot())return!1;if(!t._busy()){var s=$(n.target),f=s.closest("a"),h=f.data("data-context"),e=t.multiSelect()&&!1;return f.closest("li").is(".dv-item")&&!f.is(".app-divider")&&(f.is(".app-selected")?(f.removeClass("app-selected"),e||(i.clearSelection(),i.lookupInfo()?st(f,function(){i.executeInContext("Clear")}):st(f,function(){}))):t._hasKey()&&(e||iv(u),f.addClass("app-selected"),i.tap(h,"none"),o.echoChanged=!0,st(f)),li=!0),!1}}).on("vclick",function(n){function a(n){if(!t._busy()){i._loadAtTop=!n;var u=r.parent();n?u=u.prev():(u=u.next(),u.is(".dv-item")||(u=u.next()));wt=u.find(".ui-btn").data("data-context");wt&&(i.pageIndex(wt.pageIndex+(n?1:-1)),i.refresh())}}var f=$(n.target),r=f.closest("a").removeClass("ui-btn-active"),h,l,s,c,e,v;if(!f.is(".app-btn-toggle,[data-href]")){if(r.length&&!r.is(".app-divider")){if(r.is(".dv-load-at-bottom"))a(!0);else if(r.is(".dv-load-at-top:visible"))a(!1);else{if(li){li=!1;return}if(!te(f)||ft())return!1;if(n.ctrlKey)return u.trigger("taphold",n),li=!1,!1;if(r.is(".dv-action-none")||att(n,t))return!1;h=t.multiSelect();h&&iw(n)?ow(t,r,"none"):(s=r.data("data-context"),c=vtt(n),s?(h&&r.find(".app-btn-check").addClass("app-btn-check-selected"),u.find("a.app-selected").removeClass("app-selected ui-btn-active"),c?(r.addClass("app-selected"),f=rw(f),e=function(){gh(t,r,"none")||i.tap(s,"none");ks(f)}):e=function(){t._hasKey()?(r.addClass("app-selected"),c||gh(t,r)||i.tap(s),o.echoChanged=!0):i.tap(s)}):r.is(".dv-action-refresh")?e=function(){sc(t._id)}:r.is(".dv-action-new")?e=function(){i.executeInContext("New",null,!1)}:r.is(".dv-action-filter-clear")&&(e=function(){ba(t,!0)}),e&&(e(),st(f)))}return!1}if(l=f.closest(".app-group"),l.length)return f.is(".app-group")||(v=f.closest(".app-group").find(".app-group-path,.app-group-title").addClass("ui-btn-active"),setTimeout(function(){v.removeClass("ui-btn-active");rb(!0)},ai)),!1}}).contextmenu(function(n){if(!n.isDefaultPrevented())return srt(i.dataView(),n)}),sv(t,u),ri=n.bar("create",{type:"footer",page:h}),!l.length&&at&&(dt=ri.find('[data-location="bottom"]'),l=$('<div class="app-bar-aggregates"><\/div>'),dt.length?l.insertBefore(dt.first()):l.appendTo(ri)),ct.length||(ct=$('<div class="app-bar-hscrollbar"><span class="app-hscrollbar2" data-view="'+t._id+'"><span class="app-hscrollbar-handle" data-draggable="hscrollbar"/><\/span><\/div>').toggleClass("app-scrollbar-wide",lf),l.length?ct.insertAfter(l):(dt=ri.children().first(),dt.length?ct.insertBefore(dt):ct.appendTo(ri)),hc(t)));p&&pc(u);p!==!1&&l.length&&at&&(k?gr(aggregateListView=$('<ul class="ui-listview app-listview app-grid"/>').appendTo(l.empty())):iit(t,l.empty(),at));net(u,b);b==="Grid"&&hc(t);ov(kt,t,o);ac(t,u);var ut=u.find(".dv-item"),ni=ut.length>ui*2,ti=u.find("li").last(),c,ei,a=i._loadAtTop,y,oi,hr,bi=ti&&ti.length&&ti.prev(),vu=bi&&bi.length&&Math.round(bi.position().top),nu,ki,di;nu=dot(u);(!cr||ti.length)&&(!ni||a||u.find("li.dv-load-at-top-parent").length)||(d.hide(),c=$('<li data-icon="false" class="dv-load-at-top-parent"><a class="dv-load-at-top"/><\/li>'),ni?(c.insertBefore(ut.get(0)),cr=!0):c.appendTo(u));a?(c=u.find("li").first(),c.is(".app-list-instruction")&&(c=c.next()),oi=c.length&&c.next(),hr=oi&&Math.round(oi.position().top)+nu,yt=yt.slice(0).reverse()):ti.remove();ei=g*ui;tu=hp(t);$(yt).each(function(n){var r=this,f=$('<li class="dv-item" data-icon="false"/>'),s=a?ei+ui-n:ei+n+1,e=$('<a class="ui-btn"/>').appendTo(f).data("data-context",{row:this.slice(0),pageIndex:g}),o;t.rowIsSelected(r)&&(i.headerText(r),e.addClass("app-selected"),o=i.commandRow(),o?(i.commandRow(r),o.join(";")!==r.join(";")&&bt()):(t._forgetSelectedRow(!0),i.command(r,"Select")));a?f.insertAfter(c):f.appendTo(u);k?cs(t,r,ar?s:null,e):ku(t,r,fi,ar?s:null,f,e,b==="List");ns(t,r,f,tu)});(lr&&!a||ni&&a&&!u.find(".dv-load-at-bottom-parent").length)&&(ti=hi=$('<li data-icon="false" class="dv-load-at-bottom-parent"><a class="dv-load-at-bottom"/><\/li>').appendTo(u));a&&!g&&c.remove();(!vt||t.get_searchOnStart())&&(ev(t,u,fi,!0),ki=$('<li><a class="dv-action-refresh ui-btn ui-btn-icon-left ui-icon-refresh"><p/><\/a><\/li>').appendTo(u).find("a"),ki.attr("title",oe.Refresh).find("p").text(rl),t._filter&&t._filter.length&&!t.filterIsExternal()&&(di=$('<li><a class="dv-action-filter-clear  ui-btn ui-btn-icon-left ui-icon-clear"><p/><\/a><\/li>').appendTo(u).find("a"),di.attr("title",f.ClearFilter).find("p").text(f.ClearFilter)));lr||(vt>0&&ev(t,u,fi),at&&k&&vt>0&&(pt=gr(u)),e("ui.actions.promote")?vr=!0:kt.length||(ii=i.executeInContext("New",null,!1,!0),ii&&(gi=$('<li class="dv-action-new">').appendTo(u).attr("data-icon",ii.icon),lt=$('<a class="dv-action-new"/>').appendTo(gi).attr("title",f.LookupNewAction),k?$("<p>").appendTo(lt).text(ii.text):($("<h3>").appendTo(lt),nr=gi.prev(),nr.is(".dv-item")&&(lt.html(nr.find("a").html()).find("p,img,span").css("visibility","hidden"),nr.is(".ui-li-has-thumb")&&gi.addClass("ui-li-has-thumb")),lt.find("h3").text(ii.text),vt||$("<p>").appendTo(lt.html("")).text(ii.text)))));a&&(h.attr("data-page-header")!=="false"&&h.attr("data-page-header",""),o.headerText!==!1&&wr(!ei,d));iu=u.find("li").first();si=i.instruction();(si||k)&&!u.find(".app-list-instruction").length&&(hi=$('<li data-role="list-divider" class="app-list-instruction"/>').insertBefore(c?c:iu),si&&$('<span class="app-view-instruction"/>').appendTo(hi).html(si),k&&!!vt&&(ru=uv(t,hi),si||ru.addClass("app-grid-header-no-description")),hi.toggleClass("app-no-records",vt<1));a&&c&&c.find(".ui-btn").css("height","").find("p").css("margin-top","");ni&&(a?(ci=$(String.format('<li style="clear:left;height:{0}px"><\/li>',et.getScreenHeight()*10)).appendTo(u),ut=ut.slice(ui*(kr?2:2)),ut.find("a").data("data-context",null),ut.remove(),u.find("li.dv-action-new").remove()):(d.hide(),ci=$(String.format('<li style="clear:left;height:{0}px"><\/li>',et.getScreenHeight()*10)).appendTo(u),u.find("li.app-li-card").remove(),ut=ut.slice(0,ui),ut.find("a").data("data-context",null),ut.remove().empty()));got(t,u);ff(u);u.listview("refresh");vr&&u.find("li.dv-item").last().addClass("app-has-promo");y=u.find(".app-selected");nt==null&&(ni?a?(tr=oi.position().top,wu(s,ot+tr-hr)):(uu=bi.position().top,wu(s,ot+uu-vu)):a?(tr=oi.position().top,wu(s,ot+tr-hr)):a==null&&wu(s,0));ci&&setTimeout(function(){ci.prev().addClass("ui-last-child");ci.remove()},100);k&&(ki&&ki.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"),lt&&lt.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"),di&&di.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"));yu();ur(function(){ue(p?10:200)});yi&&(kr&&ni?setTimeout(function(){yi.remove()},300):yi.remove());i._reset=!1;i._loadAtTop=null;$(document).trigger($.Event("dataviewrefresh.app",{dataView:t}))},reset:function(){var i=this.dataView(),n=w(i),r="#"+n.id,t;this._reset=!0;$(ui("list")).each(function(n){return n>ui("index")?!1:this.hash===r?(t=!0,!1):void 0});t||(n.initialized=!1,n.echoInitialized=!1)},visibleDataRows:function(n){var u=this._dataView,i=u._cachedPages,t,r;if(i)for(t=0;t<i.length;t++)if(r=i[t],r.index==n)return r.rows;return null},currentPageIndex:function(n){return arguments.length&&(this._currentPageIndex=n),this._currentPageIndex},pageIndex:function(n){var t=this._dataView,i,r;if(typeof n=="string")return n==="bottom"&&(i=this.content().parent().find("ul li.dv-item").last().find("a").data("data-context"),i)?i.pageIndex:n==="top"&&(r=this.content().parent().find("ul li.dv-item").first().find("a").data("data-context"),r)?r.pageIndex:t.get_pageIndex();if(n==null)return t.get_pageIndex();t.set_pageIndex(n)},pageCount:function(){var n=this._dataView;return n.get_pageCount()},pageSize:function(){var n=this._dataView;return n.get_pageSize()},instruction:function(n){var e=this,o=e.lookupInfo(),i,r=e.dataView(),c=e.viewDescription()||"",t=c?[c]:[],h=e.filterStatus(),s=r.groupExpression(),u;return o&&(t.length&&t.push(" "),i=o.field,t.push(String.format(i.ItemsDescription||f.LookupInstruction,i._autoAlias?i.AltHeaderText||i.HeaderText:i._dataView._allFields[i.AliasIndex].HeaderText)),o.value&&(u=o.text,u&&u.length>50&&(u=u.substring(0,50)+"..."),t.push(String.format(f.LookupOriginalSelection,u)))),r.multiSelect()&&t.push('<span class="app-multi-select-instruction">'+ptt(r)+"<\/span>"),n!==!1&&(t.length||h||s)&&r._totalRowCount>1&&(t.length&&(t.push(" "),t.push(String.format(f.ShowingItemsInfo,String.format("{0:N0}",r._totalRowCount)))),$(s).each(function(n){var i=r.findField(this);i&&(n||(t.length&&t.push(" "),t.push(f.GroupedBy," ")),n&&(n===s.length-1?t.push(" ",ok," "):t.push(", ")),t.push(i.HeaderText),n==s.length-1&&t.push("."))})),h&&(t.length&&t.push(" "),t.push(String.format('<span class="app-filter" title="{1}">{0}<\/span><i class="material-icon app-filter-clear" title="{2}">clear<\/i>',h,f.Filter,rh))),t.join("")},context:function(n,t){var l=this,i=l.dataView(),w=i.extension(),e=i._totalRowCount,b=i.get_view().Label,k=i.get_sortExpression(),r=l.commandRow()||[],u=l.lookupInfo(),o,a=r&&r.length,v,s,y,h,c,p;if(e!==-1)if(i.get_showViewSelector()&&n.push({text:b,tooltip:e>999?String.format(f.ShowingItemsInfo,String.format("{0:N0}",e)):null,count:e>999?"999+":e,icon:"gear",system:!0,toolbar:!1,transition:!0,callback:bit},{}),gb(n),(i.get_showQuickFind()&&(e>1||i._busy()||i.get_filter().length>i.get_externalFilter().length)||we(i).length||i._hasSearchAction)&&n.push({text:so,desc:bn(i),descInTooltip:!1,icon:"search",toolbar:!1,system:!0,context:{dataViewId:i._id},callback:hn}),n.push({text:f.Sort,icon:"sort",transition:!0,desc:bw(i),toolbar:!1,system:!0,callback:kot}),n.push({text:f.Filter,icon:"filter",transition:!0,desc:w.filterStatus(!0,!0),toolbar:!1,system:!0,callback:ws}),n.push({text:f.Group,icon:"group",transition:!0,desc:kw(i),toolbar:!1,system:!0,callback:rb}),u&&u.value==null||n.push({}),kit(i,n,r),u||ob(i,n,r),v=i.rowIsTemplate(r),u&&!v)for(o=u.field,a&&n.push({text:f.LookupSelectAction,icon:"material-icon-arrow-forward",command:"Select",context:{field:o,lookupInfo:u,row:r},callback:kd}),u.value&&n.push({text:f.UnSelect,icon:"material-icon-clear",command:"Clear",context:{field:o,lookupInfo:u},callback:kd}),af(o.ItemsNewDataView)||n.push({text:f.LookupNewAction,icon:"material-icon-add",command:"New",system:!0,context:o,callback:ift}),n.push({}),!a||o.tagged("lookup-details-hidden")||i.rowIsTemplate(a)||n.push({text:f.LookupViewAction,icon:"material-icon-info-outline",callback:rft}),ob(i,n,r),s=[],y=!0,no(["Grid"],i,s,r),h=0;h<s.length;)c=s[h],p=c.argument,c.command==="Select"&&(!p||p==="editForm1")||(y&&(n.push({text:"$separator"}),y=!1),n.push(c)),h++;else t||(t=["Grid","ActionColumn","ActionBar"]),v||no(t,i,n,r)}};il.Form=function(n){return new ih(n)};ih=ir.MobileForm=function(n){ih.initializeBase(this);this.dataView(n)};ih.prototype={initialize:function(){this._initRow()},_initRow:function(){var n=this.dataView(),t=this.inserting()?n._newRow:n._rows[0];return n._mergeRowUpdates(t),this.commandRow(t)},reset:function(){this._reset=!0;this._initRow()},options:function(){return{quickFind:!1,filterDetails:!1}},dispose:function(){this._dispose();this._disposeSession()},_disposeLayout:function(n){function t(n){var r,i;if(n)for(r=0;r<n.length;r++)i=n[r],t(i.children),i.children=null,i.self.removeData(),i.self=null}n=$(n);n.find(".app-data-list").remove();n.find(".app-drop-box").each(function(){r.upload("destroy",{container:this})});t(n.data("rootNodes"))},_disposeForm:function(n){var t=this;return n||(n=t.content()),n.find('[data-layout="form"]').each(function(){t._disposeLayout(this)})},_dispose:function(t){var r=this,f=r._dataView,i=this.content(),e,u;r._newValues=null;r._disposeForm(i);$(f._allFields).each(function(){var i=this,t;i._dataViewId&&(t=p(i._dataViewId),t._dataViewFieldOwnerId===f._id&&n.deletePage(t._id))});i.find(".app-status-bar, .app-bar-buttons,.app-stub,.app-form-grid").remove();e=i.parent().find('div[data-role="header"]');as(i);u=i.find(".app-echo").each(function(){var t=$(this).attr("data-for"),n=w(t);n&&(n.echoId=null,n.echoInitialized=!1)});u.find(".app-echo-inner").off();u.find(".app-echo-footer").off();u.remove();n.tabs("destroy",{container:i});t&&bt();r._disposeSession()},viewStyle:function(){return"Form"},refresh:function(){function vt(){n.tabs("create",{tabs:y,className:"app-tabs-echo",scope:t.get_selectedKey(),change:function(){}})}function yt(){a&&ln(a);cn(f);n.bar("show",k);n.refreshTitleState();n.refreshAppButtons(b,{buttonBars:e!=="None"?k:[],layout:c,toolbar:!1,dataView:t})}var u=this,t=u.dataView(),ot=t._survey,v,h,tt,it,ut,at,ft,et;if(u._skipRefresh||ot&&ot.show===!1){u._skipRefresh=!1;return}var pt=u.editing(),wt=t._inlineEditor,r=w(t),c,f=u.content(),l,y=[],p,b,a,g,k,st=this.inserting(),bt=this._reset,e=t.get_showActionButtons(),ht=t._confirmContext,o=r.page,nt=o.find(".app-page-header"),lt;bt&&(u._dispose(),u._commandRow=null);l=pt?t.editRow():u.commandRow()||u._initRow()||[];n.makeModal(r);vet(t,o,l);v=u.viewDescription();v&&$('<div class="app-view-description"><\/div>').appendTo(nt).html(v);h=ht&&ht.WindowTitle||t.get_view().Label;h&&(r.headerTextLocked?typeof r.headerText=="string"&&(r.headerText=typeof h=="string"&&(!t.inserting()||t._confirmContext)?[r.headerText,h]:h):(t.inserting()&&t._filterSource&&(tt=d(t._filterSource).find(".app-page-header h1").text()),r.headerText=tt?[h,tt]:t._controller==="MyProfile"&&ct("membership.myProfile.appName")?[h,na()]:h));st&&nt.attr("data-locked","false").data("data-text",null);it=t.tagged(/page\-header\-(\w+)/);it&&it[1]==="none"&&(r.headerText=!1);!r.headerText==!1&&gtt(t,o,nt);o.is(".app-page-modal")||r.headerText===!1||$('<div class="app-page-header-placeholder dv-heading" data-selector=".app-page-title"><span class="app-static-text app-page-title"><span class="app-text"/><\/span><\/div>').appendTo(f);c=gg(t,o.is(".app-page-modal")?rf(f):i.width);g=t.statusBar();g&&(a=$('<div class="app-status-bar"><\/div>').html(g).appendTo(f),ut=a.find("li.Segment"),at=ut.length+10,ut.each(function(n){this.style.zIndex=at-n}),s&&a.css("overflow-x","auto"));v&&r.headerText===!1&&(ft=$('<ul data-role="listview" class="app-list-instruction"/>').appendTo(f),$('<li data-role="list-divider" class="app-list-instruction"/>').appendTo(ft).html(v),ft.listview());t.tagged("action-buttons-none")&&(e="None");(e==="TopAndBottom"||e==="Top")&&$('<div class="app-bar-buttons"><\/div>').appendTo(f);c.appendTo(f);r.isModal&&e!=="None"?e="Auto":e!=="Auto"||ug()||(e="None");e==="Auto"?k=$('<div class="app-bar-buttons"><\/div>').appendTo(n.bar("create",{type:nu(o)?"header":"footer",page:o})):((e==="TopAndBottom"||e==="Bottom")&&$('<div class="app-bar-buttons"><\/div>').appendTo(f),k=f.find(".app-bar-buttons"));b=[];u.context(b);st||wt||($(n._pages).each(function(){var r=this,i,n,e,u=r.dataView,o=u&&u._filterSource;o&&o===t._parentDataViewId&&!u._dataViewFieldName&&(n=r.activator,n&&n.type==="Tab"&&($(y).each(function(){if(n.text===this.text)return i=this,!1}),i||(p!==n.container&&(p&&(vt(),y=[]),p=n.container),i={text:n.text,content:[]},y.push(i))),e=lw(r.id,f),i&&i.content.push(e))}),p&&vt());lt=$('<div class="app-stub"><\/div>').appendTo(f);t.tagged("promo-none")&&lt.addClass("app-hidden");u.stateChanged();u._reset=!1;r.requiresInitCallback?(et=o.css("display")!=="block",et&&o.css({display:"block","z-index":-10}),t._unchangedRow=l.slice(0),e!=="None"&&e!=="Auto"&&n.refreshAppButtons(b,{buttonBars:f.find(".app-bar-buttons"),toolbar:!1,dataView:t}),nn(t,l,c),ns(t,l,c),t._isWizard&&bf("start",{layout:c}),pr(f),df(o),et&&o.css({display:"","z-index":""}),r.requiresInitCallback=!1,rt=!1,r.initCallback=yt,n.navigate(r.id)):yt()},collect:function(){var r=this,u=[],n,t=r.dataView(),o=t._allFields,f,i=r.inserting(),e;return e=t.editRow(),f=t._originalRow,$(o).each(function(t){var s=this,a=s.Name,l=s.IsPrimaryKey,v=s.Type,y=s.ReadOnly,r=e[t],h=f[t],c,o;v==="DataView"||s.OnDemand||(r===undefined&&(r=null),h===undefined&&(h=null),v.match(/^Date/)&&r!=null&&r!==h&&(r=new Date(r)),c=r!==h||r==null&&!s.AllowNulls&&!l||i&&r!=null,n={Name:a},c&&r!=null&&(n.NewValue=r,o=!0),i||h==null||(n.OldValue=h,o=!0),c&&(n.Modified=c,o=!0),!y||l&&i||a==="Status"&&!o||(n.ReadOnly=!0),o||!l||y||(o=!0,n.Modified=!0),o&&u.push(n))}),u},stateChanged:function(n){var r=this,u=r.dataView(),e=r.content(),i=e.find("[data-layout]"),f;i.data("prepared")?(f=u.editRow(),t.evaluate({dataView:u,row:f,container:i}),t.render({container:i,dataView:u,row:f}),n!==!1&&(bt(!1,0),br(),r.editing()&&!s&&oi({container:i,lastFocused:"auto"}))):bt()},context:function(n){var u=this,t=u.dataView(),i=u.commandRow(),f=u.editing(),r;n.isSideBar||kit(t,n,i);f||ob(t,n,i);r=[t._inlineEditor?"Row":"Form"];no(r,t,n,i);gb(n)&&n.push({});r=["ActionBar","Context"];no(r,t,n,i)}};r.alert=function(n,t){return crt({name:"_alert",message:n,submit:t,cancel:!1})};r.confirm=function(n,t,i){return crt({name:"_confirm",message:n,submit:t,cancel:i||dt})};$(document).on("alertconfirmed.app alertnotconfirmed.app",function(t){var u=t.rules.dataView(),i=u.survey(),f=t.type==="alertconfirmed",r=f?i._submit:i._cancel,e=i._promise;n.pageInfo(u)._canceled=!0;be(!1);vi(function(){be(!0);r&&r!==dt?r():f?e.resolve():e.reject()})}).on("menuchanged.app",function(t){hr=bi.nodes=bi[uo]=t.nodes;delete n._menuStrip;$(".app-menu-strip").remove();bt()});if(bi=fr.Menu={Nodes:{}},l.$nextTabIndex=l.$closeHovers=dt,dr){$(document).one("membershipinit.app",function(n){li=n.membership;nd=li.get_authenticationEnabled();td=li.get_displayMyAccount();userName=li.get_user()});dr.prototype.updated=function(){if(li=this,os(),this.get_idleTimeout())$(document).on("awake.app",function(){return!li.idle()});li.idleInterval(!0);$(document).one("start.app",function(){li._allowLoginInMenu=li.get_displayLogin()});if(li.loginStatus('a[data-app-role="loginstatus"]'),!r.AccountManager.enabled())$(document).one("start.app",function(){n.returnUrl()&&!sa()&&n.showAccountManager(null)})};dr.prototype._idle=function(){li.idleInterval(!1);pv()};dr.prototype.loginStatus=function(n){var t=this,i=t.loggedIn(),r=$(n).text(i?cf.LogoutLink:cf.LoginLink).on("vclick",function(){return st(r,function(){i?pv():t.showLogin()}),!1})};dr.prototype.showLogin=function(){n.showAccountManager(null,!0)}}r.Mobile=function(){var n=this;n._asyncJob=0;n._pageMap={};n._pages=[];n._modalDataViews=[];n._modalStack=[];n._pagesToDelete=[]};r.Mobile.prototype={settings:function(){return e.apply(this,arguments)},appName:function(){var t=this;return t._appName||(t._appName=n._logo.text()||$("#PageHeaderBar").text()||$('head meta[name="application-name"]').attr("content")),t._appName},height:function(){var n=i.height;return navigator.userAgent.match(/Mobile.+Safari/)&&!navigator.userAgent.match(/Chrome/)&&(n+=60),n},page:function(n){n||(n="Main");var t=$("#"+n),u,i,r;return t.length||(t=$('<div data-role="page" id="'+n+'"><div data-role="content"><\/div><\/div>'),pu()&&t.addClass("app-ui-automation"),u=si("get"),i=w((u?t.insertBefore(u):t.appendTo(o)).page()),r=$('<div id="app-bar-heading" class="app-bar-heading"><div class="app-bar-text"><\/div><\/div>').hide().appendTo(t),i&&(i.page=t,i.stickyHeader=r,i.scrollable=da(t).data("sticky-header",r),i.home&&i.dataView&&i.dataView.get_isForm()&&!i.dataView._selectedKey.length&&r.remove())),t},makeModal:function(t){var u=t.page,r=t.dataView,v=t.home,h,e=!1,c,o,l,s,y,a;r&&(r._parentDataViewId===pt.id&&r._controller===pt.controller&&(i.splitBottom||i.splitRight)?(u.addClass("app-reading-pane-detail app-transition-none"),e=!0):(r.tagged("content-stub-none")&&u.addClass("app-content-stub-hidden"),c=r.tagged(/\bmodal-dock-(top|left|right|bottom)\b/),c&&(r.tagged("modal-fit-content")||!$(".app-page-modal-background").filter(gi).length)&&u.addClass("app-page-modal-dock app-page-modal-dock-"+c[1]),r.tagged("modal-gap-required")&&u.addClass("app-page-modal-gap-required"),r.tagged("modal-fullscreen")&&(u.addClass("app-page-modal-fullscreen"),h=!0),r.tagged("transition-none")&&u.addClass("app-transition-none"),v&&r.tagged(/\breading-pane-(right|bottom|auto)\b/)&&(u.addClass("app-reading-pane-master app-transition-none"),pt.id=r._id,pt.controller=r._controller)));v||e||($(".app-page-modal-root").length?e=!0:ly?(r.tag("modal-never-"+r.get_viewId()),r.get_view().Label!==n.title()&&(t.backText=n.title())):(o=r&&r.tagged(/\bmodal-(never|always|(when-(tn|xxs|xs|sm|md|lg|xl|xxl)))\b/),o?(u.addClass("app-page-"+o[0]),e=r._inlineEditor||o[1]==="always"||!(o[1]==="never"||i.width<ti(o[3])),e||o[1]!=="never"||(l=r.tagged(/\bmodal-never-(\w+)\b/),l&&l[1]!==r.get_viewId()&&(e=oa()))):(e=r&&oa(),t.backText=n.title())),si()&&(e=!0));e&&!u.is(".app-page-modal")?(u.find(".app-page-header-fixed").remove(),u.addClass("app-page-modal"),r&&(r.tagged("modal-title-none")||nu(u))||(s=$('<div class="app-page-modal-title"><span class="app-text"/><\/div>').insertBefore(d(u)),$('<a class="app-btn app-btn1 app-btn-search"/>').appendTo(s).hide().attr("title",so),r&&r.tagged("modal-buttons-more-none")||$('<span class="app-btn-context app-btn app-btn2 ui-icon-dots"/>').appendTo(s).attr("title",ki),r&&r.tagged("modal-buttons-fullscreen-none")||(y=$('<span class="app-btn app-btn3 app-btn-fullscreen"/>').appendTo(s).attr("title",h?f.ExitFullscreen:f.Fullscreen),h&&y.addClass("app-btn-fullscreen-exit")),$('<span class="app-btn app-btn4 app-btn-close"/>').appendTo(s).attr("title",ul.Close)),a=r&&r.tagged(/\bmodal-max-(tn|xxs|xs|sm|md|lg|xl|xxl|any)\b/),a&&u.addClass("app-page-"+a[0])):!e&&u.is(".app-page-modal")&&(u.removeClass("app-page-modal").css({left:"",top:"",width:"",minWidth:"",maxWidth:"",paddingTop:""}),u.find(".app-page-modal-title").remove(),t.scrollable.css({left:"",top:"",width:"",minWidth:"",maxWidth:""}));!!t.isModal!==e&&(t.isModal=e,ci(u))},activeLink:function(n,t){if($(et.activeClickedLink).is(".app-tab-active")||et.removeActiveLinkClass(!0),n){var i=$(n).closest("a");i.length&&(n=i);n.is(".app-btn-static")||(n.addClass("ui-btn-active"),(t==null||t)&&(et.activeClickedLink=n))}},blink:function(n,t){yi(n);setTimeout(function(){yi();setTimeout(function(){yi(n);setTimeout(function(){yi();t&&t()},200)},200)},200)},content:function(t){var i=w(t),r=i&&i.page?i.page:n.page(t),u=i&&i.scrollable?i.scrollable:d(r);return u.length?u:r.find('[data-role="content"]')},showContextPanel:function(n,t,i){at(n,"#"+t,i)},toggleContextPanel:function(n){this.contextScope()&&(n+="-scope");ph($(n))},causesCalculate:function(){},pageVar:function(n,t){if(arguments.length===1)return gr(n);gr(n,t)},userVar:function(n,t){if(arguments.length===1)return kt(n);kt(n,t)},callWithFeedback:function(n,t){n=$(n);n&&n.length&&st(n,t)},progress:function(t,i){function e(){r.length||(r=$('<div class="app-progress-screen"><div class="app-progress-text"><\/div><div class="app-progress-bar"><div class="app-progress-indicator"><\/div><\/div><div class="app-progress-content"><\/div><\/div>').appendTo(o));var c=r.find(".app-progress-text"),v=r.find(".app-progress-bar"),t=v.find(".app-progress-indicator"),l=r.find(".app-progress-content");if(i.text?c.text(i.text).show():c.hide(),i.background!=null&&r.css({"background-color":i.background,color:n.invertColor(i.background,!0)}),i.estimate!=null){u();i.progress=0;var h=0,e=0,y=i.estimate===-1,a=i.estimate/1e3,s=r.find(".app-progress-estimate").show();s.length||(s=$('<div class="app-progress-estimate"><\/div>').appendTo(r));_progressEstimateInterval=setInterval(function(){h++;y?s.text(f(h*.25)+"..."):(e=h*250/i.estimate,e>=1&&(e=1,u()),t.width(Math.floor(e*100)+"%"),a-=.25,s.text(f(a)+" remaining..."))},250)}else u();i.accent!=null&&t.css("background-color",i.accent);i.progress!=null?t.css({width:Math.floor(i.progress*100)+"%","margin-left":""}).removeClass("app-progress-marquee"):t.css({width:"100%","margin-left":"-100%"}).addClass("app-progress-marquee");i.content===!1?l.empty():i.content!=null&&l.empty().append(i.content)}function s(){r.remove()}function f(n){var t="",i=Math.floor(n/60),r=n%60;return i>0&&(t+=i+" minute",i>1&&(t+="s"),t+=" and "),t+=Math.ceil(r)+" second",r>1&&(t+="s"),t}function u(){r.find(".app-progress-estimate").hide();clearInterval(n._progressEstimateInterval)}var r=$(".app-progress-screen");i||(i={});switch(t){case"show":e();break;case"hide":s();break;default:r.find(".app-progress-text").text(i.text)}return r},invertColor:function(n,t){if(n.indexOf("#")===0&&(n=n.slice(1)),n.length===3&&(n=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]),n.length!==6)throw new Error("Invalid HEX color.");var i=parseInt(n.slice(0,2),16),r=parseInt(n.slice(2,4),16),u=parseInt(n.slice(4,6),16);return t?i*.299+r*.587+u*.114>186?"#000000":"#FFFFFF":(i=(255-i).toString(16),r=(255-r).toString(16),u=(255-u).toString(16),"#"+padZero(i)+padZero(r)+padZero(u))},pageHeader:function(n){var t=w(n.id),i=[n.text];n.text2&&(i[1]=n.text2);t&&(t.headerText=i,t.id===gt()&&wr(i))},dataView:function(){var n=this.pageInfo();return n?n.dataView:null},pageInfo:function(n){if(n?n._id&&n._controller?n=n._id:n.selector!=null&&n.length!=null&&(n=n.attr("id")||""):n=gt(),typeof n=="string")return this._pageMap[n];if(n)this._pageMap[n.id]=n,n.dataView&&n.dataView._id&&(this._pageMap[n.dataView._id]=n),this._pages.push(n);else return null},isInTransition:function(){return!al||rt},summary:function(n){return ot(n)},scrollable:function(n){var t=d(typeof n=="string"?null:n);return typeof n=="string"&&(n==="refresh"?fc(t,!1):n==="focus"&&hi(t)),t},makeVisible:function(){gl.apply(this,arguments)},scrollGrid:function(n,t){t==!0?(of(n),t=0):n.session("scroll-left",t);ys(n,-t)},unloading:dt,refresh:function(n,t,i){bt(n,t,i)},refreshEchoToolbarWithDelay:function(n,t){pe(n,t)},listPopup:function(n){pi(n)},cardPopup:function(n){hb(n)},busyIndicator:dt,viewStyle:function(n,t,i){fs(n,t,i)},bar:function(t,i){function h(){var t,n;f=r.prevAll(".app-bar-actions");t=f.parent().find(".app-page-header-fixed");f.is(".app-bar-actions")&&f.is(":visible")?(n=f.position().top+f.height(),r.css("top",n),t.css("top",n+r.outerHeight()-1).closest(".ui-page").addClass("app-has-header-bar")):r.css("top","")}function c(){var t=!0,i;r.children().each(function(){var n=$(this);n.css("display")!=="none"&&(t=!1)});t?(r.hide(),r.is(".app-bar-footer")?n.promo().css("margin-bottom",""):r.parent().find(".app-page-header-fixed").closest(".ui-page").removeClass("app-has-header-bar"),l()):(r.show(),i?r.removeClass("app-bar-system"):r.addClass("app-bar-system"))}function l(){ci(r.closest(".ui-page"))}var r,f,u;if(t==="create"){var e=i.type,a=i.page,o=d(a),s;return r=a.find(".app-bar-"+e),r.length||(e==="header"?(r=$('<div class="app-bar-header ui-header ui-bar-inherit ui-header-fixed"><\/div>').hide().insertBefore(o),h()):e==="footer"&&(s=o.next(),r=$('<div class="app-bar-footer ui-footer ui-bar-inherit ui-footer-fixed"><\/div>').hide().insertAfter(s.is(".app-vscrollbar")?s:o))),r}(u=i,u&&u.length)&&(r=u.parent(),t==="show"?(r.is(".app-bar-header")&&h(),r.show(),u.show(),l(),df()):t==="hide"?(u.hide(),c()):t==="remove"&&(u.remove(),c()))},promo:function(t,i,r){function s(){var t,i,r;if(u.is(".ui-disabled")||!e("ui.actions.promote")||n.edit._pending)u.hide();else{if(f=$(".ui-page-active").is(".app-page-modal"),t=u.is(":visible"),i=ra(),!t){u.one("transitionend",wi);g&&g.is(":visible")&&(u.show(),i=ra(),u.hide());u.css({"margin-bottom":f?0:"",transform:t?"none":"scale(.5)",transition:t?"none":"transform 200ms"}).show()}u.css("margin-bottom","");r=v(u,"margin-bottom");i&&(r=v(u,"margin-bottom")+(g.is(":visible")?g.outerHeight():0));o=y(".app-bar-footer");u.css({"margin-bottom":f?0:r+(o.is(":visible")?o.outerHeight():0)});t||(n._promoTimeout=setTimeout(function(){u.css("transform","none")},50))}}var u=this._actionButton,f,o;if(arguments.length){if(typeof t=="boolean")return t?s():(clearTimeout(n._promoTimeout),u.hide()),u;if(typeof t=="string")return u.find(".app-icon").remove(),t=ge(t),vt(t,u.attr({title:i,"data-icon":t})),r&&u.find("i").css("transform","rotate("+r+"deg)"),t.match(ry)?(u.hide().addClass("ui-disabled"),!1):(u.removeClass("ui-disabled"),s(),!0)}else return u},toolbar:function(n){var t=this._toolbar;return typeof n=="boolean"&&(n?t.show():t.hide()),t},stickyHeaderBar:function(n){var t=d(n);return t.data("sticky-header")||$()},enumerateFields:function(n,t,i,r){var f=n._allFields,u=i==null;r||(r=n.commandRow());u?(i=[],$(f).each(function(){this.ShowInSummary&&!this.Hidden&&i.push(this)})):t.push({text:n.get_view().Label,theme:"a",isStatic:!1,instruction:!0});$(i).each(function(i){var e=f[this.AliasIndex],o=r[e.Index],s=o==null?"":e.TextMode===2?ls(o):e.text(o);o==null&&i||(e.OnDemand?e.OnDemandStyle!==1&&o&&typeof o=="string"&&!o.match(/^null/)&&t.push({src:String.format("{0}blob.ashx?{1}=t|{2}{3}",n.resolveClientUrl(n.get_appRootPath()),e.OnDemandHandler,o,e.OnDemandStyle===2?"&_nocrop":""),desc:e.HeaderText,display:"before"}):(af(s)&&(s=sh),!u&&vw(e)&&o?t.push({text:s,desc:e.HeaderText,href:"tel:"+s,icon:"phone"}):!u&&yw(e)&&o?t.push({text:s,desc:e.HeaderText,href:"mailto:"+s,icon:"material-icon-email"}):t.push({text:s,desc:e.HeaderText,isStatic:!0,display:"before"})))});i.length&&t.push({})},infoView:function(n,t,i,r){var e=[],h=t?"left":r||"",s,o,u,c;for(t||e.push({text:f.Back,callback:ie,icon:wt});n;)c=e.length,s=n.extension().itemMap(),o=n._allFields,u=[o[s.heading]],t||$(s.desc).each(function(){u.push(o[this])}),$(n._fields).each(function(){this.Hidden||u.indexOf(o[this.AliasIndex])!=-1||u.push(this)}),this.enumerateFields(n,e,u,i),n=fn(n);at(e,"#app-panel-info-view"+(h?"-standalone":""),{position:h,className:"app-panel-info-view"})},deletePage:function(t){var r,u,i,f,e;typeof t=="string"&&(t=w(t));r=t.page;u=t.dataView;u&&u.dispose();r&&(f=t.scrollable,f&&f.removeData().off(),r.parent().length&&r.page("destroy").remove().empty());i=n._modalDataViews.indexOf(t.id);i!==-1&&n._modalDataViews.splice(i,1);i=n._pages.indexOf(t);i!==-1&&n._pages.splice(i,1);e=ui("list");$(e).each(function(n){var i=this;if(i.hash==="#"+t.id)return e.splice(n,1),n<ui("index")&&vh.activeIndex--,!1});t.dataView=null;t.page=null;t.scrollable=null;delete n._pageMap[t.id]},garbageCollector:function(t){var i=n._pagesToDelete;arguments.length?i.push(t):i.length&&setTimeout(function(){$(i).each(function(){n.deletePage(this)});i.splice(0,i.length)},32)},modalDataView:function(n,t){var i=this,r;t!==!1&&i.busy()||(n&&i.busy(!0),t&&setTimeout(function(){n!==gt()&&i.modalDataView(n,!1)}),n?(r=i.pageInfo(n),pl&&(r.text=pl,pl=null),r.dataView._lookupInfo||(r.dataView._isModal=!0),i._modalDataViews.indexOf(n)===-1&&i._modalDataViews.push(n),i.changePage(n)):($(i._modalStack).each(function(){i.deletePage(this)}),i._modalStack=[]))},unloadPage:function(n,t){function o(){i._modalStack.indexOf(r)==-1&&i._modalStack.push(r)}var i=this,r=i.pageInfo(n),f;if(r&&(f=i._modalDataViews.indexOf(r.id),f>=0)){var s=r.dataView,h=p(s._parentDataViewId),u=i.pageInfo(t),e=u?i._modalDataViews.indexOf(u.id):-1;(u&&(h===u.dataView||u.home)||t.attr("id")==="Main"||e>=0&&f>e)&&o()}},sidebar:function(){return ga()},desktop:function(){return!s},rowContext:function(n,t){ks(n,t)},animate:function(){return wa()},clearHtmlSelection:function(n){kf(n)},lastTouch:function(){if(arguments.length===1)arguments[0]===!0?lr=rd:(rd=lr,lr=null);else return lr},syncEmbeddedViews:function(n){pr(n)},animatedScroll:function(n,t,i){hv(n,t,i)},scroll:function(n,t){wu(n,t)},configureFilter:function(t){n.contextScope(t.scope);ws(t);n.contextScope(null)},pointer:function(t){return arguments.length?t===n.pointer():s?"touch":"mouse"},touched:function(t,i){if(i||(i=2),t.length){var r=t[0].getBoundingClientRect(),u=n.lastTouch();return r.left-i<=u.x&u.x<=r.right+i&&r.top-i<=u.y&&u.y<=r.bottom+i}},toggleTooltip:function(n,t){var i=t?el:uh;n.attr("data-title")?(n.attr("data-title",i),s||setTimeout(function(){n.attr("title",i).trigger("mouseenter",10)},50)):n.attr("data-title",i)},busy:function(n){var t=this,i,r=t._busyDV;if(arguments.length===1)isBool=typeof n=="boolean",typeof n=="boolean"?(t._busy=n,i=t._glassPane,i||(i=t._glassPane=$('<div class="app-glass-pane"><\/div>')),n?i.is(".app-glass-pane-active")||i.addClass("app-glass-pane-active").appendTo(o):i.parent().length&&i.detach().removeClass("app-glass-pane-reject app-glass-pane-active")):n.progress?r||(t._busyPh=$("<p>"),r=t._busyDV=$create(ir,{},null,null,$("<p>").get(0)),r._busy(!0)):r&&(r._busy(!1),$(r._element).remove(),r.dispose(),t._busyDV=null);else return t._busy===!0},executeInContext:function(t,i,r,u){var o=arguments,e,f,s;if(ft()&&!u)setTimeout(function(){n.executeInContext.apply(this,o)},50);else if(e=[],n.navContext(e),o.length){if(f=[],$(e).each(function(){var n=this;if((!r&&(t&&n.icon===t||!t&&n.text===i)||r&&r===n.path)&&(f.push(n),o.length>1||t&&!t.match(/material-icon-(add|edit)/)||n.uiScope!=="Grid"))return!1}),f.length){if(s=f[f.length-1],u)return s;bu(s)}}else $(e).each(function(){var n=this;if(n.text&&n.icon!=="dots"&&!n.system&&!n.isStatic)return u?n:(bu(n),!1)})},navigate:function(t){typeof t=="string"?(t.match(/^#/)&&(t=t.substring(1)),n.changePage(t)):t.id&&$("#"+t.id).length?($("#"+t.id).trigger("navigating.app"),n.changePage(t.id)):t.href&&vb(t.href,t.transition)},changePage:function(t,i){var c;gt()!==t&&ft(!0);var o=y(),f=o&&n.pageInfo(o.attr("id")),r=n.pageInfo(t),a=$.Event("navigating.app");if(r&&(r.navigating?r.navigating=!1:r.page&&(r.page.trigger(a),a.isDefaultPrevented()&&(r.initialized=!1,r.navigating=!0))),htt(!0),n.pageInit(t)){page=n.page(t).css("padding-top",o.css("padding-top"));var p=ei.pageTransition,u=n.pageInfo(t),v=u.home,e,s,h=u.navigateInfo;if(h){u.navigateInfo=null;et.navigate(h.href,{transition:h.transition});ui("last").hash="#"+u.id;return}e=u.replaceUrl;f&&f.deleted&&(l.location.replace("#"+t),vi(function(){var t=yt();t._doneCallback=f.dataView._doneCallback;t._cancelCallback=f.dataView._cancelCallback;n.deletePage(f);fp(y())}));et.changePage("#"+t,{changeHash:!(i===!1)&&!v,transition:"none"});s=ui("last");e&&(u.replaceUrl=null,$("#"+t).attr("data-url",decodeURIComponent(e)),et.navigate.navigator.squash(e),s.url=decodeURIComponent(et.path.makeUrlAbsolute(e,et.path.documentBase)));v&&(s.transition=p,et.path.documentBase.hrefNoHash=et.path.documentBase.hrefNoSearch,et.path.documentBase.href=et.path.documentBase.hrefNoSearch+et.path.documentBase.hash)}else r.home&&(c=[],n.navContext(c),n.refreshAppButtons(c,{toolbar:!0}),n.refreshMenuStrip())},title:function(){return document.title},navContext:function(t,i){var u=n.contextPageInfo(),e=u&&u.dataView,o=e&&e.extension(),s=wo(),h,f;if(ce&&n._started&&t.push({text:ek.Exit,icon:"material-icon-exit-to-app",toolbar:!0,system:!0,callback:nft},{}),o&&!t.isKiosk?(i||o&&o.context(t),u.dataView._parentDataViewId&&(u=n.pageInfo(u.dataView._parentDataViewId),e=u.dataView)):gb(t),t.isSideBar||t.isKiosk||(t.length&&t.push({}),ct("help.enabled")&&!l.location.pathname.match(/\/help(\/|$)/)&&li&&!r.host&&(hy||(hy={text:cf.HelpLink,system:!0,toolbar:!1,icon:"material-icon-info",callback:function(){li.help()}}),t.push(hy))),iu.list.length&&(iu.list.splice(0),iu.keyCodes.splice(0)),t.isAppBuilder=s,h=t.length,gu.trigger($.Event("context.app",{context:t})),s)for(f=t.length-1;f>=h;)t[f--].appBuilder||t.splice(f+1,1);$(t).each(function(){var t=this.shortcut,n;t&&(n=iu.cache[t],n||(n=ig(t),iu.cache[t]=n),n.which&&!t.invalid&&(iu.keyCodes.push(n.which),iu.list.push(n)))});yd()&&!t.isSideBar&&t.push({text:oh.Tools,system:!0,icon:!1,toolbar:!1,transition:!0,callback:sot})},refreshAppButtons:function(t,u){var ai,vi,dt,pi,ht,rt,lt,k,gt;if(!pu()){var at=n._title,yi=Math.max(v(n._toolbar,"width")/2,at.offset().left+(at.is(".app-hidden")?0:at.outerWidth()-1)),a,o,ni=n._contextButton,ut=[],nt,h=[],it={search:so,user:rt,apps:f.Apps},ii={},ft={},g,pt,d=[],et=[],ri,ui,fi,ei,oi,s=u&&u.dataView||yt(),wt=0,b,hi=u&&u.buttonBars||y(".app-bar-buttons"),ot=u&&u.layout||y("[data-layout]"),tt=s&&n.content(s._id).prevAll(".app-bar-actions"),bt,ci,li,st,kt;if(u&&u.promo&&s&&(ai=w(s).page.find(".app-page-modal-title").removeClass("app-has-btn1"),st=!s||!s.get_showActionBar()||s.get_isForm(),$(t).each(function(){var t=this,i;o=t.icon;i=t.toolbar!==!1&&o&&!o.match(/more|back|undo/);o&&(st||t.uiScope==="ActionBar"&&(o==="material-icon-add"||o==="material-icon-edit")||t.system&&o!=="material-icon-info-outline")&&(o==="search"?ai.addClass("app-has-btn1"):(o.match(/^(refresh|phone|email|eye)$/)||i)&&!s.get_isForm()&&g!=="material-icon-add"&&(n.promo(o,t.text),g=o))}),g||n.promo(!1)),(!u||u.toolbar)&&(ni.attr("title",ki).removeClass("ui-icon-carat-u").addClass("ui-icon-dots"),t.length&&ni.show(),dft(),n._toolbarButtons.each(function(){a=$(this).show();vi||(vi=a.show()[0].offsetWidth);a.offset().left>yi-(tr()?i.left:0)&&ut.push(a);a.hide()}),nt=ut.length,nt>0)){for(st=!s||!s.get_showActionBar()||s.get_isForm(),$(t).each(function(){var n=this,t;o=n.icon;t=n.toolbar!==!1&&o&&!o.match(/more|back|undo/);o&&(st||n.uiScope==="ActionBar"&&(o==="material-icon-add"||o==="material-icon-edit")||n.system&&o!=="material-icon-info-outline")&&(o==="search"?oi=!0:o==="refresh"?ui=!0:o==="phone"?ri=!0:o==="email"?ei=!0:o==="eye"&&t?fi=!0:t&&h.indexOf(o)===-1?h.push(o):o=null,o&&(it[o]=dy(n)+(n.desc&&n.descInTooltip!==!1?"\n"+n.desc:"")),n.path&&(ii[o]=n.path),n.rotate&&(ft[o]=n.rotate),n.uiScope==="ActionBar"&&et.push(o))}),ei&&h.push("email"),ri&&h.push("phone"),fi&&h.push("eye"),ui?h.push("refresh"):!h.length||s&&(s.editing()||s.get_isForm()&&ug())||!e("ui.actions.promote")?n.promo(!1):(s&&(dt=s.get_isForm()?"material-icon-edit":"material-icon-add",kt=h.indexOf(dt),kt>0&&(h.splice(kt,1),h.unshift(dt))),$(h).each(function(){var n=this;if(!n.match(ry))return g=n.toString(),!1}),s&&(w(s).loading||s.get_searchOnStart()||s._requiresContextRefresh)||!n.promo(g,it[g],ft[g])||(n.promo().data("icon-list",{icons:h.slice().reverse(),labels:it}),d.push(g),h.splice(h.indexOf(g),1))),oi&&(h.length<nt?h.push("search"):h[nt-1]="search"),eu||(i.width>=ti("md")||si())&&(r.odp.offline()&&(h.push(pt=r.odp.offline("icon")),it[pt]=r.odp.offline("tooltip")),e("ui.menu.apps.location")==="toolbar"&&h.push("apps"),le&&h.push("user"));et.length>0;)o=et[0],et.splice(0,1),h.indexOf(o)!==-1&&h.splice(h.indexOf(o),1);for(h.length<nt&&(wt=nt-h.length),b=0;b<wt;b++)$(ut[b]).hide();while(b<nt)a=$(ut[b]),o=h[b-wt],pi=a.data("icon"),a.attr("data-title",it[o]),a.data("action-path",ii[o]),d.push(o),a.empty().removeClass("app-avatar"),o==="user"?(ht=l._userLetters,rt=r.userName(),ht||(l._userLetters=ht=kh(rt)),ea(rt,$('<i class="app-icon-avatar"/>').text(ht).appendTo(a.addClass("app-avatar").attr("title",rt)))):(vt(ge(o),a),ft[o]&&a.find("i").css("transform","rotate("+ft[o]+"deg)")),a.data("icon",o).show(),b++;n._usedToolbarIcons=d.slice(0)}for(hi.length&&hi.each(function(){var i=$(this),n,h,r,u,o,c;if(i.is(":visible"))if(i.children().remove(),lt)i.append(lt.html()).toggleClass("app-bar-buttons-md",lt.is(".app-bar-buttons-md"));else{if(lt=i,o=s&&s._isWizard,k||(k=[],$(t).each(function(){var n=this,t=n.icon;!n.system&&t!=="dots"&&n.text&&n.uiScope==="Form"&&(k.push(n),n.command==="Cancel"&&(r=k.length-1))})),o&&(k=k.reverse(),r!=null&&(r=k.length-1-r)),u=i.width(),o&&(k.splice(0,0,{text:f.Prev,path:"wizard-prev"},{text:f.Next,path:"wizard-next"}),r!=null&&(r+=2,cancelButton=k[r],k.splice(r,1),u>375&&k.splice(0,0,cancelButton))),$(k).each(function(){var n=this,t=n.path,r=$('<a class="ui-btn ui-mini"/>').text(n.text).attr("data-action-path",n.path).appendTo(i);(n.shortcut||n.tooltip)&&r.attr("title",dy(n));t&&t.match(/^wizard/)&&r.addClass("app-btn-has-icon")}),bf("status",{layout:ot}),n=i.toggleClass("app-bar-buttons-md",u>=ti("md")).find(".ui-btn").last(),n.length&&n.position().left+n.outerWidth()-1>u+2&&(i.find(".ui-btn").css("min-width","8em"),n.length&&n.position().left+n.outerWidth()-1>u+2&&(i.find(".ui-btn").css("min-width","4em"),n.length&&n.position().left+n.outerWidth()-1>u+2&&o&&i.find(".app-btn-has-icon").addClass("app-btn-icon-notext"),n.length&&n.position().left+n.outerWidth()-1>u+2)))for(h=$('<a data-action-path="more" class="ui-btn ui-corner-all ui-mini app-btn-more app-btn-icon-notext"/>').html("&nbsp;").attr("title",ki).appendTo(i);n.length&&h.position().left+h.outerWidth()-1>u+2;)n=n.hide().prev();s&&(c=e("ui.actions.reverse")==!0,drt&&!c||o||s._controller=="MyProfile"&&s._viewId.match(/^(pas|ide)/)||!(ct("ui.actions.autoReverse")||c)||i.append(i.find(".ui-btn").get().reverse()))}}),ot.length&&(gt={},ot.find('[data-control="action"]').each(function(){var i=$(this),r=ot.attr("data-input-container"),n,u,t;n=gt[r];n||(n=p(r),gt[r]=n);n&&(u=n.findAction(i.attr("data-action")),u||(i.css("visibility","hidden"),t=i.closest('[data-container="row"]'),t.length&&!t.find("[data-control]").filter(function(){return $(this).css("visibility")!=="hidden"}).length&&t.remove()))}));d.length;)if(b=0,d[0]==="user"||d[0]==="apps"||d[0]===pt)d.splice(0,1);else while(b<t.length)d.length&&t[b].icon===d[0]?(t.splice(b,1),d.splice(0,1)):b++;(!u||u.toolbar!==!1||u.actionBar===!0)&&tt&&tt.length&&(bt=tt.find("h3").next(),ci=Math.floor(bt.offset().left)+bt.outerWidth(!0),li=Math.floor(tt.offset().left)+rf(tt)-8,tt.data("selector").toggleClass("app-hidden",!s.get_showViewSelector()||c.left.visible&&e("ui.sidebar.views.collapsed")===!0),eit(s,tt.data("controls"),ci,li,!0,g))}},endModalState:function(t,i){if(!rt){rt=!0;var r=n.page(i._id);yr()}},renderContext:function(n,t,i){var l=!0,a,f=t.isSideBar,e=f&&c.left.mini,u,h,o={};$(t).each(function(){var d,ft,b;if(!i||i(this)){var t=this,a=t.text,g=t.shortcut,nt=t.count||g,v=ge(e&&t.miniIcon||t.icon),p=ya(v),tt=v==="check"||p?"false":v==="ok"?"check":v,it=t.rotate,k=t.href,y=t.itemClassName,h,u,w=t.sidebarCollapse,rt=!1,ut;(a==="$separator"&&(a=""),f&&(c.left.mini&&!v&&(a&&!t.transition||t.src)||t.sidebar===!1)||t.hidden)||(h=$("<li/>").attr({"data-icon":!tt&&t.pageTransition&&!p?"false":tt}).appendTo(n),t.callback||t.dataRel||k?(u=$("<a/>").appendTo(h).data("context-action",t),e?(u.html("&nbsp;").attr("title",a),a&&t.transition&&$("<span/>").text(a.substring(0,1)).appendTo(u)):u.text(a),k&&u.attr({rel:"external",href:k}),!nt||(f||s)&&g||$('<span class="ui-li-count"/>').appendTo(u.addClass("ui-li-has-count")).html(nt),t.dataRel&&u.attr("data-rel",t.dataRel),t.isStatic&&u.addClass("app-summary-btn")):t.isStatic?h.html(a):t.src?r.odp.blob("url",t.src).done(function(n){$('<img class="ui-li-thumb"/>').appendTo(h.addClass("ui-li-has-thumb")).attr({src:n})}):(l?h.remove():(ut=h.attr("data-role","list-divider").html(a),!t.isStatic&&a&&t.instruction!==!1&&ut.addClass("app-list-instruction")),l=!0,rt=!0),rt||(l=!1),t.desc&&!e&&(d=t.display==="before",d&&$('<p class="app-item-desc app-item-desc-before"/>').insertBefore((u?u:h).contents()).text(t.desc),ft=$('<p class="app-item-desc"/>').appendTo(u?u:h).text(t.desc),d&&ft.addClass("app-item-desc-after")),t.wrap&&h.addClass(t.callback?"app-wrap-text":"app-wrap"),t.disabled&&h.addClass("ui-disabled"),it&&(y=(y||" ")+" app-icon-rotate"+it),y&&h.addClass(y),t.linkClassName&&u.addClass(t.linkClassName),t.keepOpen&&(u.addClass("app-keep-open"),t.animate||t.count||u.addClass("app-btn-icon-transparent")),t.animate&&u.addClass("app-animated app-animation-spin"),t.selected||v==="check"?(f?u.addClass("app-option-selected"):t.depth||vt("material-icon-check",u),t.depth&&u.addClass("app-item-selected"),p&&vt(v,u)):p&&vt(v,u),t.state&&u.addClass("app-selected"),t.tooltip&&(u.attr("title",t.tooltip),y&&y.indexOf(/tile$/)||u.addClass("app-btn-tooltip")),w&&f&&(o[w]||(o[w]=[]),o[w].push(h)),b=t.user,b&&ea(b,$('<i class="app-icon-avatar"/>').appendTo(u.addClass("app-avatar")).text(kh(b))),t.depth&&(h.addClass("app-has-depth"),u.addClass("app-depth"+t.depth)),(t.transition&&!t.reverse||t.pageTransition)&&vt(e?"material-icon-navigate-next":"material-icon-chevron-right",u.addClass("app-group-actions")),t.popOut&&!e&&vt("material-icon-chevron-right",u),t.color&&$('<span class="app-color-block"/>').appendTo(u).css("background-color",t.color))}});for(a in o)if(u=o[a],u.length>4){for(h=3;h<u.length;h++)u[h].hide();$("<a/>").appendTo($('<li data-icon="false" data-theme="a"/>').insertBefore(u[3])).text("+"+(u.length-3)+" "+ki.toLowerCase()).data("context-action",{callback:wft})}},tabs:function(i,r){function f(n,t){if(!n||n==="page"||n==="user")return null;var u=oit(r.id)||[],i,f;if(n=n.toString(),$(u).each(function(t){var r=this;if(r.oid===n)return i=r,f=t,!1}),arguments.length===1)return i?i.tab:null;i?u.splice(f,1):i={oid:n};i.tab=t;u.push(i);u.length>10&&u.splice(0,1);oit(r.id,u)}function o(){var t=r.tabs,o=r.scope,s=r.placeholder||$((t[0].content||[])[0]),i=r.container||$('<div class="app-tabs ui-header ui-bar-inherit"><\/div>').insertBefore(s).addClass(r.className),h=$("<ul/>").appendTo(i),n=t[0].text;$(t).each(function(){var t=this;t.active&&(n=t.text);$(t.content).each(function(){$(this).addClass("app-tab-content")})});r.id||(r.id=s.attr("id"),r.id&&(r.id+="_tabs"));r.id&&(i.attr("id",r.id),n=f(o)||o==="page"&&gr(r.id)||o==="user"&&kt(r.id)||n);$(t).filter(function(){return this.text===n}).length||(n=t[0].text);$(t).each(function(t){var i=this,f=$('<a class="ui-btn"/>').appendTo($("<li/>").appendTo(h)).text(i.text).attr("data-text",i.text),r=i.content,u;i.active=i.text===n;i.active&&(t>0&&(r&&r.length&&$(r[0]).is('[data-container="tab"]')&&(r=r.children()),$(r).each(function(){var n=this.style;if(n&&n.display!=="none")return u=!0,!1})),u&&t?(n=null,i.active=!1):f.addClass("ui-btn-active app-tab-active"))});n||(t[0].active=!0,h.find(".ui-btn").first().addClass("ui-btn-active app-tab-active"));r.forceSelectedTab=arguments.length!==2?null:arguments[1].selectedTab;i.data({"data-tabs":r.tabs,options:r});e(i);u(i,!1)}function s(n){n||(n=r.container?r.container.find(".app-tabs"):d().find(".app-tabs"));n.find("ul").off();n.data({"data-tabs":null,options:null}).remove()}function e(n){n||(n=d().find(".app-tabs"));$(n).each(function(){$($(this).data("data-tabs")).each(function(){var n=this;$(n.content).each(function(){$(this).toggleClass("app-tab-active",n.active)})})})}function u(n){n||(n=(r&&r.page||y()).add($(".ui-page.ui-page-active .app-bar-header.ui-header-fixed")));var t=n.find(".app-tabs").addBack(".app-tabs");t.find("ul").css("visibility","");t.each(function(){var t=$(this),r=t.width(),h=t.data("data-tabs"),u=t.offset().left+v(t,"padding-left"),i,n,s,e,o,f;if(r||t.data("dynamic"))if(t.find(".app-tab-more").parent().remove(),i=t.find(".ui-btn").css({"padding-left":"","padding-right":"","min-width":"","max-width":"",display:""}).removeData("hidden"),$(h).each(function(n){var r=this,f=0,t=Array.isArray(r.content)?$(r.content).map(function(){return this.toArray()}):$(r.content),u;t.length===1&&$(t[0]).is('[data-container="tab"]')&&(t=$(r.content).children());t.length&&(t.each(function(){var t=this,n=t.style;n&&n.display==="none"&&f++}),t.length===f&&(u=$(i[n]),u.css("display","none").data("hidden",!0),u.is(".app-tab-active")&&(o=!0)))}),f=i.filter(function(){return this.style.display!=="none"}),f.length<2)t.css("display","none").data("dynamic",!0),o&&$(f[0]).trigger("vclick");else{if(t.css("display")==="none"&&(r=t.css("display","").width(),u=t.offset().left+v(t,"padding-left"),o=!1),t.find("li").removeClass("app-first-child app-last-child"),$(f[0]).parent().addClass("app-first-child"),n=$(f[f.length-1]).parent().addClass("app-last-child"),n.offset().left-u+n.outerWidth()>r&&(i.css("min-width","8em"),n.offset().left-u+n.outerWidth()>r&&(i.css("min-width","4em"),n.offset().left-u+n.outerWidth()>r&&(i.css({"padding-left":"1em","padding-right":"1em"}),n.offset().left-u+n.outerWidth()>r&&(i.css({"padding-left":".5em","padding-right":".5em"}),n.offset().left-u+n.outerWidth()>r)))))for(n.parent().removeClass("app-last-child"),n=$('<a class="ui-btn app-tab-more"/>').appendTo($('<li class="app-last-child"/>').appendTo(n.closest("ul"))).text(ki).css({"min-width":"4em","padding-left":"0.5em","padding-right":"0.5em"}),e=i.length-1;n.offset().left-u+n.outerWidth()>r;){if(!e){$(i.get(0)).css("max-width",r-n.outerWidth()-12);break}s=$(i.get(e)).css("display","none");s.is(".app-tab-active")&&n.addClass("ui-btn-active");e--}o&&$(f[0]).trigger("vclick")}})}if(!n._initialized){n._initialized=!0;$(document).on("vclick",".app-tabs .ui-btn",function(i){function v(){s.find(".app-tab-active").is(":visible")||s.find(".app-tab-more").addClass("ui-btn-active")}function g(){n.stub("put");tt.detach(!0);e(c);v();l.callback&&l.callback();r.change&&(co=!1,r.change(l),du(),r.restoreScrolling!==!1&&ftt(w));r.stickyHeader&&hu();n.stub("trim")}var o=$(i.target).closest("a"),c=o.closest(".app-tabs"),r=c.data("options"),s=c.find("ul"),p=r.forceSelectedTab,d=r.tabs,h=r.selectedTab||r.forceSelectedTab||o.attr("data-text"),w=y(),l,b,a,k;if(t.cancel()){if(p&&(r.selectedTab=p),o.length)if(!r.selectedTab&&o.is(".app-tab-more"))k=s.find(".ui-btn").removeClass("ui-btn-active"),st(o,function(){o.addClass("ui-btn-active");a=[];$(r.tabs).each(function(n){var t=this;$(k[n]).data("hidden")||a.push({text:t.text,icon:t.active?"check":!1,wrap:!0,context:{text:t.text,index:n},linkClassName:"app-btn-icon-transparent",callback:function(n){o.removeClass("ui-btn-active");r.selectedTab=n.text;$(s.find(".ui-btn")[n.index]).trigger("vclick")}})});pi({items:a,anchor:o,afterclose:function(){setTimeout(function(){o.removeClass("ui-btn-active");s.find(".app-tab-active").addClass("ui-btn-active");v()},50)}})});else{if(s.find(".ui-btn").removeClass("app-tab-active ui-btn-active"),o.addClass("app-tab-active ui-btn-active"),$(d).each(function(){var n=this;n.active&&h===n.text&&(b=!0);n.active=n.text===h;n.active&&(l=n)}),b){r.selectedTab=null;v();return}r.scope==="page"?gr(r.id,h):r.scope==="user"?kt(r.id,h):f(r.scope,h);dp(w);r.selectedTab&&(r.selectedTab=null,u(c));setTimeout(g)}return!1}})}switch(i){case"create":r.tabs&&r.tabs.length>1&&o(r);break;case"destroy":s();break;case"fit":u()}},refreshTitleState:function(){n._title.toggleClass("app-hidden",n._menuButton.is(".ui-icon-bars"))},refreshMenuStrip:function(){var t=n._menuStrip,r=t&&t.strip,p=n._logo,g=v(p,"left"),w=g+p.width("").outerWidth(),b=c.left.visible?(c.left.mini?w:c.left.width)+1:w,k=n._toolbar,nt=k.find(".app-btn-cluster-right .ui-btn").filter(gi).first(),l=(nt.length?nt.offset().left:rf(k))-16,tt=hr,a,y,o,it,s,rt=e("ui.menu.location")==="toolbar",u,d,ut,ft,f,h;if(!r)if(t=n._menuStrip={strip:$('<div class="app-menu-strip"><\/div>').appendTo(k)},r=t.strip,rt){for(a=$("<ul/>"),f=0;f<tt.length;f++)h=tt[f],u=$("<li/>").appendTo(a),d=$('<a class="ui-btn"/>').appendTo(u).text(h.title).attr({title:h.description}).data("data-node",h),h.children&&d.addClass("app-has-children"),h.selected&&d.addClass("app-selected");t.links=a.find(".ui-btn");t.items=t.links.parent();t.more=$('<a class="ui-btn app-has-children"/>').appendTo($("<li/>").appendTo(a)).text(ki);a.appendTo(r)}else t.title=$('<span class="app-menu-strip-title"/>').appendTo(r.addClass("app-menu-strip-has-title")).text(bi.currentNode?bi.currentNode.title:document.title);if(s=l-b,rt){if(s!==r.data("tested-width")||!r.is(":visible"))if(r.data("tested-width",s),i.width>414&&s>=200&&r.attr("data-enabled")!=="false"&&n._menuButton.is(".ui-icon-bars"))for(r.removeClass("app-hidden"),uc(!0),r.width(s).css({left:b}),y=t.items,o=t.more.removeClass("app-selected").parent(),moreLink=o.find(".ui-btn").text(ki),o.hide(),y.show(),f=y.length-1;f>=0;f--){if(u=$(y[f]),ft=u.outerWidth(),ut=u.offset().left,ut+ft-1>=l&&(o.show(),it=o.outerWidth(),u.hide()),u.is(":hidden")&&u.find(".app-selected").length&&t.more.addClass("app-selected"),!o.is(":visible")||o.offset().left+it-1<l){f<=1&&!u.is(":visible")&&uc(!1);break}else u.hide(),u.find(".app-selected").length&&t.more.addClass("app-selected");if(f<=1){uc(!1);break}}else uc(!1)}else r.width(s).css({left:b}),uc(s>=100);w>l&&p.width(l-g)},refreshSideBar:function(t,i){function ot(){var u,h,t,b;if(p=!1,u=ct("ui.sidebar.views.styles"),h=ct("ui.sidebar.views.names"),o.dataView().get_showViewSelector()&&(u||h)){var y=[],a=e("ui.sidebar.views.collapsed")===!0,r=v.dataView,k=r.get_view().Label,w;gn(i);h&&r.get_showActionBar()&&eb(y,!1,v,null,!0)>1&&(c.left.mini||a||($(y).each(function(){i.push(this)}),i.push({})));t=[];o.tagged("view-style-grid-disabled")||t.push({text:f.Grid,icon:"grid",selected:nt,callback:function(){nt||fs(s,"Grid")}});o.tagged("view-style-list-disabled")||t.push({text:f.List,icon:"bullets",selected:it,callback:function(){it||fs(s,"List")}});o.tagged("view-style-cards-disabled")||t.push({text:f.Cards,icon:"cards",selected:tt,callback:function(){tt||fs(s,"Cards")}});o.tagged("supports-view-style-map")&&!o.tagged("view-style-map-disabled")&&t.push({text:f.Map,icon:"location",selected:rt,callback:function(){rt||fs(s,"Map")}});n.presenter("enumerate",{id:s,list:ut});$(ut).each(function(){var n=this;o.tagged("view-style-"+n.name.toLowerCase()+"-disabled")||(n.name==l&&(n.selected=!0),t.push(n))});u&&t.length>1&&(a?$(t).each(function(){var n=this;if(n.selected)return w=n.text,viewStyleIcon=n.icon,!1}):($(t).each(function(){i.push(this)}),gn(i)));a&&(b=r._totalRowCount>0?" ("+String.format("{0:N0}",r._totalRowCount)+")":"",i.push({text:k+b,desc:w,icon:"material-icon-folder-open",context:{position:"left"},popOut:!0,itemClassName:"app-view-selector",callback:bit}))}}var v=w(),r=v&&v.dataView,k=r,s=r&&r._id,u=r&&r.get_parentDataView(r),h=[],d=r&&r.get_showActionBar(),y=$('.TaskBox.About .Inner .Value, head meta[name="description"]'),g=u&&!u._parentDataViewId,p=r&&r.get_isGrid(),o=r&&r.extension(),l=p&&o.viewStyle(),nt=l==="Grid",tt=l==="Cards",it=l==="List",rt=l==="Map",ut=[],ft=[],et=["material-icon-undo","check","info"],b,a;if(g&&!r.rowIsTemplate()){while(r&&h.indexOf(r)===-1){if(u&&u._dataViewFieldName)break;(r.get_showInSummary()||u&&r!==u&&u.get_showInSummary())&&!r.inserting()&&r.commandRow()&&h.unshift(r);r.get_isForm()&&(r=u);r=fn(r)}b=i.length;$(h).each(function(){n.enumerateFields(this,i)});i.length>b&&(r=h[h.length-1],a=i[b],a.icon="material-icon-chevron-right",a.miniIcon="material-icon-info-outline",a.context=r._id,a.callback=og,i.push({}))}d&&k&&(k.extension().context(ft,["ActionBar"]),$(ft).each(function(){var t=this,n=t.icon;t.uiScope==="ActionBar"&&n&&n!=="dots"&&n!=="carat-r"&&et.push(n)}));$(t).each(function(){var n=this;et.indexOf(n.icon)!==-1||n.system&&n.toolbar===!1||n.command==="Select"||n.icon==="eye"&&(!u||u.get_showInSummary())||(n.text||i.length)&&(n.navigateTo&&p&&ot(),n.theme=null,n.uiScope==="ActionBar"&&d||i.push(n))});p&&ot();c.left.mini||e("ui.menu.location")!=="sidebar"||(i.length&&i[i.length-1].callback&&i.push({}),cu(i),!ct("ui.sidebar.toolbar")&&ct("settings.enabled")&&i.push({},{text:f.Settings,icon:"material-icon-settings",transition:!0,callback:bot}));y.length&&g!==!1&&(i.length&&i[i.length-1].text&&i.push({}),i.push({text:y.is("meta")?y.attr("content"):y.html(),isStatic:!0,wrap:!0}))},contextPageInfo:function(){return w(n._contextScope)},refreshContext:function(){bt.apply(n,arguments)},resetUI:function(){var n=$(".ui-page-active .app-bar-buttons"),i=n.outerHeight(),t;bt(!1,0,function(){ci();ltt();n.length&&(t=d(),t.scrollTop(t.scrollTop()+n.outerHeight()-i));hu()})},contextScope:function(t){if(arguments.length)t&&t._controller&&(t=t._id),n._contextScope=t;else return n._contextScope},contextDataView:function(t){var i,r;return t!=null&&(i=ot(t),i.length)?p(i.attr("data-for")):(r=n.contextPageInfo(),r?r.dataView:null)},showContextMenu:function(t){t||(t={scope:""});var r=t.position||"left",i="#app-panel-context-"+r;t&&(n.contextScope(t.scope),t.scope&&(i+="-scope",t.position=r));ph(cit(i,function(){n.refreshContextMenu(i)},t))},refreshContextMenu:function(t,r,u){var h=n,e=$(t),v=e.find(u||"ul"),f=v.length?v:e.find("ul"),d=f.outerHeight(),y,p,l=e.is(".app-sidebar"),w,b,s,k;if(l&&!e.is(":visible")){r=[];h.navContext(r);h.refreshAppButtons(r);return}if(l&&!gv&&(p=$("<div><\/div>").appendTo(o).css({"z-index":2e3,position:"absolute",left:0,top:e.find(".ui-panel-inner").offset().top,width:e.outerWidth(),height:i.height,"background-color":"#fff"})),d&&(y=$("<div><\/div>").height(d).insertAfter(f)),pc(f),f.find("a").removeData(),f.find("li").remove(),r||(r=[],r.isSideBar=l,r.isKiosk=si("ontop"),h.navContext(r)),l&&(h.refreshAppButtons(r),b=[],s=0,h.refreshSideBar(r,b),r=b,r.isSideBar=!0,c.left.visible&&c.left.mini))while(s<r.length)if(k=r[s].icon,k&&n._usedToolbarIcons.indexOf(k)!==-1)for(r.splice(s,1);s<r.length&&!r[s].text;)r.splice(s,1),s>0&&s--;else s++;var a=v.data("panel"),g=e.attr("id").match(/^app-panel-(\w+)/),nt=l?"sidebar":g&&g[1];for(a&&a.match(/^\#app-panel-/)&&(a=a.substring(11)),w=$.Event("before"+nt+"panelshow.app"),w.panel={type:nt,id:a,items:r},$(document).trigger(w);r.length&&!r[r.length-1].text&&!r[r.length-1].src;)r.splice(r.length-1);h.renderContext(f,r);f.listview("refresh");f.find("a.ui-btn-icon-right").removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left");f.find("li.app-wrap").addClass("ui-li-static").find("a").attr({"class":""});f.prev().find(".app-focus").length&&f.find(".ui-btn").first().addClass("app-focus ui-btn-active");e.is(".app-reset-scrolling")?e.find(".ui-panel-inner").scrollTop(0):aet(e);y&&y.remove();p&&p.remove();l&&c.left.inner.trigger("scroll")},pageShown:function(n){vi(n)},isWebView:function(){return sr&&!l.navigator.standalone&&!krt},isHosted:function(){return eu},screen:function(){return i},indicator:function(n){var t=r._busyIndicator,u;return n==="reset"?u=!0:t||(t=r._busyIndicator=$('<div class="dataview-busy-indicator"><\/div>').appendTo(o),u=!0),u&&t&&t.css({left:i.left-i.width,top:i.top,width:i.width}),t},kiosk:function(){return!1},toWidth:function(n){return arguments.length?typeof n=="string"?ti(n):pf(n):fu},icon:function(n,t){return vt(ge(n),t)},openHref:function(t){var r=t.match(/\?(.+)/),i={},o=/(\w+)=(.+?)(&|$)/g,u,f;if(r)for(u=o.exec(r[1]);u;)i[u[1]]=u[2],u=o.exec(r[1]);if(i._controller&&e("navigation.dataController.enabled")===!0){r={};for(f in i)f.match(/^_/)||(r[f]=i[f]);n.show({controller:i._controller,view:i._view||i._argument,startCommand:i._command,startArgument:i._argument,filter:r,syncWith:i._syncWith})}else return rs(t)},toSmartDate:function(n){return sw(n,new Date)},syncData:function(n){if(n){var t=n.dataView;t&&yg(t)}y(".app-echo").filter(gi).each(function(){var n=$(this).attr("data-for");yg(p(n),!0)})},notify:function(t){function e(n,t){var e=n._filterSource,r,u,i,f=n._dataViewFieldParentId;return i=cc(n),!i&&e&&(u=p(e),u&&(r=n._dataViewFieldName?n:n.get_parentDataView(),r&&(i=u.findField(r._dataViewFieldName),i||(f=r._dataViewFieldParentId,f&&(i=p(f).findField(r._dataViewFieldName)))))),i&&(t=i.HeaderText+": "+t),t}function o(n){var f=n._lastArgs,i,u,t;return f&&(i=n.findAction(f.Path),i&&i.Notify&&(t=i.Notify,t&&(t==="$none"?t=null:(t.match(/\{/)?t=n._parseText(t,n.row()):(u=r.touch.pageInfo(n),u&&(t+=" - "+u.text)),t=e(n,t))))),t}var f,i,u;if(t!=null){if(f=ct("ui.notify.enabled"),i=t.text,t._controller)return f?o(t):null;if(!f){t.force&&i&&r.alert(i);return}typeof t=="number"?t=t.toString():typeof t=="object"&&"stack"in t&&(t={text:location.hostname==="localhost"?t.stack:t.message,duration:6e4});typeof t=="string"?t={text:t.toString()}:Array.isArray(t)&&(t={text:t.join(", ")});t===!1&&(t={text:!1,force:!0});u=t.dataView;i=t.text;Array.isArray(i)&&(t.text=i=i.join(", "));u?(t.dataView=null,t.text=e(u,i),u._pendingNotification=t):i!==!1&&af(i)||(si()&&yl.splice(0),yl.push(t),setTimeout(n.notify,150))}else uu?setTimeout(py,100):py()},stub:function(n,t){var i,f,r,u;t||(t=d());t.length&&t.scrollTop()&&(i=t.find(".app-stub,.app-stub-main"),f=i.length,n==="put"?(f||(i=$("<div><\/div>").appendTo(t).addClass("app-stub"+(ctt()?"-main":""))),i.height(i.outerHeight()+t[0].scrollHeight)):f&&(r=i[0].getBoundingClientRect(),u=t[0].getBoundingClientRect(),r.top>u.bottom?i.height(""):r.bottom>u.bottom&&i.height(Math.round(u.bottom-r.top))))},seeAll:function(t){var i=t,u,f,e=!1,r;typeof i=="string"&&(i=p(i));u=cc(i);u&&(f=p(u._dataViewId)._filterSource,f&&(r=p(f),r.get_isForm()&&(r=r.get_parentDataView()),r&&(e=r._dataText)));n.show({controller:i._controller,view:i._viewId,_filter:i._filter||[],_externalFilter:i._externalFilter||[],sort:i.get_sortExpression(),headerText:e,useCase:"seeAll",filterFields:i.get_filterFields(),filterSource:i.get_filterSource()})},details:function(t){var i=t.field,u=i._dataView,e=u._allFields[i.AliasIndex],s=u.editing()?u.editRow():u.commandRow(),f=t.key,o=e.format(s[e.Index]);f=f!=null?f:s[i.Index];i.ItemsTargetController&&$(i.DynamicItems||i.Items).each(function(){var n=this;if(n[0]==f)return o=n[1],!1});n.show({controller:i.ItemsDataController,view:t.view||"editForm1",filter:[{name:i.ItemsDataValueField,value:f}],headerText:o!=null?o:e.HeaderText,useCase:"ObjectRef",done:function(n){var e,f;gt()===u._id?u.get_isForm()?(n._newRow&&n._newRow.length||(e=r.input.methods.lookup._rowToValues(i,n,n.editRow()),fi({dataView:u,values:e})),t.done&&t.done(n)):u.sync():(f=yt(),f&&!f.get_isForm()&&f.sync())},cancel:t.cancel})},syncWithOdp:function(t){var i=t&&t.odp;return i&&i.is(":dirty")&&i.root(t)&&t.get_isForm()&&!t.editing()&&(rt=!0,n.executeInContext(ge("edit")),rt=!1,br()),i},toDataView:function(n){var t=ot(n);return t.length?p(t.data("for")):yt()},tooltip:function(n){n===!1?ri():kc(n.x,n.y,n.text,n.elem,n.autoHide===!1)},lookup:function(r){if(ri(),r.field&&ta(r.field),r.create){var u=r.field,g=r.dataInput,c=r.value,v=u.ItemsDataTextField,o=u._dataView;c==sh&&(c=null);n.show({controller:u.ItemsDataController,startCommand:"New",startArgument:u.ItemsNewDataView,filter:o.get_contextFilter(u,o.extension().collect()),defaultValues:c!=null&&v?[{name:v,value:c}]:null,done:function(n){var f=u._dataView,e,i;f._inlineEditor&&tt.showField(f,u.Name);e=t.methods.lookup._rowToValues(u,n,n.editRow());i=[];$(e).each(function(){i.push(this.value)});var o=0,s=u.DynamicItems||u.Items,r=i[1]?i[1].toString().toLowerCase():"undefined";if(u.ItemsStyle.match(/AutoComplete|Lookup/)){for(;;){if(u._dataView.session(ko(u)+r,null),!r.length)break;r=r.substring(0,r.length-1)}tp(u)}else $(s).each(function(n){if(this[0]==null||this[1].toString().toLowerCase()<r)o=n;else return!1}),s.splice(o+1,0,i);u.ItemsStyle.match(/AutoComplete|Lookup|DropDownList/)?(t.methods.lookup.focus(g.data("autoComplete",!1)),t.methods.lookup._useItemValue(u,i)):t.methods.listbox._useItemValue(u,i,!0)}});return}var s,e=r.field,h=e._dataView,p=[],w=ip(h,e,p),l,a,b=r.query,nt=h._allFields[e.AliasIndex],k=nt.HeaderText,d=k!=="&nbsp;"?k:e.AltHeaderText,it=h.editRow();if(ec(),!e.ContextFields&&(s=n._modalStack.length&&n._modalStack[0].dataView,s&&s._lookupInfo&&s._lookupInfo.field==e&&ui("index")<ui("length")-1&&ui("next").hash=="#"+s._id)){s._lookupInfo=r;bl.go(1);return}n.modalDataView();l=e.ItemsDataController.toLowerCase();$find(l)&&(l+=ty.getComponents().length);o=$create(ir,{id:l,baseUrl:h.get_baseUrl(),servicePath:h.get_servicePath(),controller:e.ItemsDataController,viewId:e.ItemsDataView,externalFilter:w,filter:p,filterSource:w.length>0?"options":null,showSearchBar:!0,tag:(ct("history.lookup.search")?"":"history-search-none")+(y().is(".app-page-modal")&&i.width<=ti("sm")?" modal-fullscreen":""),showFirstLetters:e.ItemsLetters,searchOnStart:e.SearchOnStart,description:e.ItemsDescription},null,null,$("<p>")[0]);a=n.pageInfo(o);b&&o.viewProp("quickFind",b);a.headerText=r.value?[r.text,d]:[d,f.LookupSelectAction];o._lookupInfo=r;r.value==null||e.ItemsValueSyncDisabled||cg(o,[r.value]);o._parentDataViewId=h._id;n.modalDataView(a.id,!0)},show:function(t){var v=t.controller,d=t.view||"grid1",e,y=JSON.stringify(t),i,u,f,o,h=n._modalStack,b=yt(),s=$.Deferred(),r=t.filter,c,l,a,k;if(f=h.length&&h[h.length-1],f&&f.showSign===y&&t.cache!==!1&&ui("index")<ui("length")-1&&ui("next").hash==="#"+f.id&&(o=p(f.id),!o||!o.odp&&o._useCase!=="seeAll"))return bl.go(1),s.promise();if(ec(),r){if(!Array.isArray(r)){c=[];for(l in r)c.push({Name:l,value:r[l]});r=c}r.forEach(function(n){n.name&&(n.Name=n.name,delete n.name);"value"in n&&(n.Value="%js%"+JSON.stringify(n.value),delete n.value)})}for(n.modalDataView(),a=t.id||v.toLowerCase(),k=1,e=a;$find(e);)e=a+k++;return i=$create(ir,{id:e,baseUrl:nf,servicePath:kl,controller:v,viewId:d,filter:t._filter||[],externalFilter:t._externalFilter||r,sortExpression:t.sort,showSearchBar:!0,startCommandName:t.startCommand,startCommandArgument:t.startArgument,showActionButtons:t.showActionButtons,exitModalStateCommands:["Cancel"],tag:t.tags,useCase:t.useCase,filterFields:t.filterFields,filterSource:t.filterSource},null,null,$("<p>")[0]),i._syncWith=t.syncWith,i._doneCallback=function(n){w(n).showSign=null;yr(function(){t.done&&t.done(n);s.resolve(n)})},b&&(i._parentDataViewId=b._id),i._ditto=t.defaultValues,i._cancelCallback=t.cancel||function(n){yr(function(){s.reject(n)})},u=n.pageInfo(i),u.headerText=t.headerText,t.headerText&&(u.headerTextLocked=!0),u.showSign=y,t.key&&cg(i,[t.key]),n.modalDataView(u.id,!0),s.promise()},pageInit:function(t){var i=n.pageInfo(t),r,u;return i==null?!1:(r=i.dataView,u=i.initialized||!i.dataView&&i.initialized!==!1,r&&r._busy())?!1:(i.initialized||(i.initialized=!0,r&&(i.requiresInitCallback=!0,i.refreshed===!1?(i.refreshed=!0,r.extension().refresh()):r._loadPage())),u)},pageShow:function(t){var i;if(y()&&(i=n.pageInfo(t),i!=null)){var r=i.dataView,u=r?r.extension():null,f=n._modalStack.indexOf(i);f>=0&&n._modalStack.splice(f,1);i.initialized||(i.initialized=!0,r&&r._loadPage());u&&u._reset&&u.refresh()}},callWhenVisible:function(n,t){var i=typeof n=="string"?y(n):n;i.each(function(){var n=$(this);if(n.is(":visible")&&n[0].style.visibility!=="hidden"){var i=n.offset().top,u=i+n.outerHeight(),e=d(n),r=e.offset().top,f=r+e.height()-1;(r<=i&&i<=f||r<=u&&u<=f||i<=r&&f<=u)&&t(n)}})},whenPageShown:function(n){vi(n)},whenPageCanceled:function(n){dh(n)},goBack:function(n){yr(n)},asyncJob:function(){return n._asyncJob},nextAsycJob:function(){return++n._asyncJob},resetPageHeight:function(){ci()},supports:function(t){switch(t){case"Map":return n._supportsMap===!0}return!1},mapsApiKey:function(){var n=!!l.location.host.match(/^localhost\b/);return e("map.apiKey")||(n?"key=AIzaSyAhggwxCKiA2oEdxaRqap4t4-_96ajw_uw":"")},registerAPI:function(t,i){var u=n,f,o,e,r=ed[t];return r?(i&&r.then(i),r.promise()):(r=ed[t]=$.Deferred(),r.then(i),t==="Map"?(o=!!l.location.host.match(/^localhost\b/),e=n.mapsApiKey(),f="https://maps.googleapis.com/maps/api/js?&callback=appFactoryCallback",e?(f+="&"+e,u._mapAPI=!0,l.appFactoryCallback=function(){u._supportsMap=!0;$(document).trigger("map.init.app");r.resolve();l.appFactoryCallback=null},$.getScript(f)):r.resolve()):t==="Charts"&&n.registerAPI("Map",function(){$.getScript("https://www.google.com/jsapi",function(){$.getScript("https://www.gstatic.com/charts/loader.js",function(){u._chartsAPI=!0;$(document).trigger("charts.init.app");r.resolve()})})}),r.promise())},fetchOnDemand:function(){return co||(n.callWhenVisible(".dv-load-at-bottom",od),n.callWhenVisible(".dv-load-at-top",od)),n},calendar:function(n,t){var i=$(".app-calendar-plugin-container");if(i.length)switch(n){case"keepOpen":i.removeClass("app-visible app-hidden");i.addClass(i.is(":visible")?"app-visible":"app-hidden");clearTimeout(l._keepCalOpenTimeout);l._keepCalOpenTimeout=setTimeout(function(){i.removeClass("app-visible app-hidden")},t||100);break;case":visible":return i.is(n)}return i},keyboard:function(){return fg()},callInAnimationFrame:function(n){if(requestAnimationFrame)var t=requestAnimationFrame(function(){n();cancelAnimationFrame(t)});else n()},stickyHeader:function(t){var b,k;if(!pu()){b=n;k=l._stickyHeaderHideInstruction;l._stickyHeaderHideInstruction=!1;var y=d(t),c=y.closest(".ui-page"),p=aa(c),f=p.attr("data-selector"),u=f?c.find(f):p.find(".app-static-text"),r=re(t),e,o=!0;if(r&&r.length&&c.is(".ui-page-active")){if(!rt&&(u.length||f)){var w=c.is(".app-page-modal"),g=v(y,"top"),nt=Math.ceil(u.length?u.offset().top+(t?1:0):-1),h,a;nt<g&&(f||u.height()>0)&&(r.is(":visible")&&r.data("screen-width")==i.width?o=!1:(o=!1,w?r.is(".app-bar-heading-modal")||r.addClass("app-bar-heading-modal"):r.is(".app-bar-heading-modal")&&r.removeClass("app-bar-heading-modal"),r.data("screen-width",i.width),r.show()[0].style.width=rf(y)-v(r,"padding-left")-v(r,"padding-right")-(w&&s?-1:0)+"px",e=r.css({top:g+(w?-1:-1)}).find(".app-bar-text"),f?(a=p.html(),a!=e.data("html")&&(e.data("html",a).html(a).css("white-space","normal"),k&&r.find(".app-view-instruction,.app-group:not(.app-group-fixed)").addClass("app-hidden").parent().addClass("app-bar-text-instruction-hidden"))):(h=u.text().trim(),h?h!=e.data("text")&&e.data("text",h).text(h).css("white-space",""):o=!0),r.outerHeight()+v(r,"top")<u.outerHeight()+nt&&(r.hide(),o=!0)))}return(o||it(ar()).length)&&r.hide(),b}}},wait:function(){},build:function(t,i,u){var h=n._pages.length>1,f=t.attr("data-href"),e=0,s=t.find('div[data-app-role="page"]').each(function(t){var s=$(this),y=s.find('> div[data-role="content"]'),a=s.attr("data-content-framework");a&&s.attr("data-enhance","false");y.length||(y=$('<div data-role="content"><\/div>'),s.contents().appendTo(y),y.appendTo(s));s.attr({"data-role":"page","data-app-role":null}).addClass("app-page-scrollable").appendTo(o);var l=r.eval(s.attr("data-page-header")),v=sit(s),c={text:(l!=="false"?l:"")||v.text||n.title(),description:v.description,activator:v,url:f,transition:i&&i.transition},w=i&&i.pageId||s.attr("id")||cp(f||location.pathname)+(t>0||f?t+1:"")||"_root",b,p;l=c.text.split(/\s*\|\s*/);c.headerText=l.length>1?l:l[0];s.find('div[data-role="content"]').contents().wrapAll('<article class="app-page-content'+(a?" app-content-framework app-"+a:"")+'"><\/article>');s.page().attr("id",w);c.id=w;c.page=s;c.dynamic=i&&i.dynamic;n.pageInfo(c);p=(c.scrollable=da(s,!1)).find(".app-page-content");a&&(s.attr("data-page-header","false"),r.configureFramework(a,p,function(n){ah=n}));i&&i.dynamic||op();h&&n.makeModal(c);s.each(function(){$.each(this.attributes,function(){var t=this,n;t.specified&&(n=t.name,n.match(/^data\-/)&&!n.match(/^(data-(content-framework|page-header|app-role|role|activator|enhance))$/)&&p.attr(n,t.value))})});r.dataBind(p,[]);v.text&&(e++,b=$('<a class="app-action-navigate" />').attr("href","#"+w).text(v.text).appendTo($("<li/>").appendTo(u)),c.description&&$("<p/>").appendTo(b).text(c.description));gu.trigger($.Event("displayflow.app",{page:s}))});return s.data("linkCount",e),s},start:function(t){function nt(n){return $(n).each(function(){return this.selected?(c=this,!1):this.children&&(nt(this.children),c)?!1:void 0}),null}function ut(){var i,u;try{i=l.external;i&&i.TouchUI&&(r.embedded=!0,wc("mouse"))}catch(f){}u=t&&$(t.selector).data("scripts");u?eval(u):hr&&eht();$(document).trigger("start.app");n._started=!0;ce&&n.notify({text:ek.DeviceLoginPrompt,duration:6e4});gu.trigger("ifttt.app")}function ft(){n.tabs("create",{tabs:p,className:"app-tabs-echo",scope:"page",change:function(){}})}var g,c;sd();tt=n.edit;et.ignoreContentEnabled=!0;ty._raiseInit();lu.Observer.clearEventHandlers(ty);n._appLoaded=!0;cht();var i=n.pageMenu(t&&t.pageId),h,k=$(t&&t.selector||"#PageContent"),u=k.attr("data-href"),f=n.build(k,t,i),ot=f.data("linkCount"),d=si("get");f.length&&(h=f.first(),ot||h.attr("data-activator")==="false"||$('<a class="app-action-navigate" />').attr("href","#"+h.attr("id")).text(h.attr("data-page-header")||hut.SeeAlso).appendTo($("<li/>").appendTo(i)),i.is(".ui-listview")&&i.listview().listview("refresh"),d&&d.insertAfter(f[f.length-1]));g=hr;t||nt(g);!c||f.length||i.find("a").length||yb(c.children,i,1);var it=n,s=t?n.page(t.pageId):y(),a=s.find("a.app-action-navigate"),v,p=[],b,rt=it._pages[0];a.length===1&&(t||e("ui.list.initialMode")==="SeeAll"||o.attr("class").match(/see-all-always/)||!rt.dataView||rt.dataView.get_lastCommandName()||l.location.href.match(/_controller=.+_commandName=.+/))?$(n._pages).each(function(){var t=this,i=t.dataView;return gk=i&&i._id,(!u||t.url===u&&!t.root)&&(!i||!i._hidden)?(u||(t.home=!0,u=et.path.documentBase.pathname+l.location.search),ut(),et.navigate.history.clearForward(),u&&(t.replaceUrl=u),i&&(da($("#Main")),$('<h1 class="app-page-loading"/>').appendTo(n.content().empty()).text(vu),op()),ci(t.page),it.changePage(t.id),!1):void 0}):s.attr("id")==="Main"&&(a.length&&s.find('a[rel="external"]').parent().remove(),ci(),a.show(),v=da(s),op(),s.addClass("app-page-scrollable"),wr(document.title),$(a).each(function(){var r=$(this),u=r.attr("href"),i=u&&w(u.substring(1)),t,f,n;i&&i.dataView&&i.activator.type!=="Button"&&(n=i.activator,n&&n.type==="Tab"&&($(p).each(function(){if(this.text===n.text)return t=this,!1}),t||(b!=n.container&&(b&&(ft(),p=[]),b=n.container),t={text:n.text,content:[]},p.push(t))),f=lw(i.id,v),t&&t.content.push(f),r.parent().remove())}),b&&ft(),i=n.pageMenu(),i.find('a.app-action-navigate,a[rel="external"]').length?i.listview().show():i.remove(),v.find(".app-tabs").length>1&&$('<div class="app-stub-main"><\/div>').appendTo(v),ut(),vg({toPage:s}))},pageMenu:function(t){var i=n.content(t),r=i.find("ul.app-page-menu");return i.parent().attr("id")!=="Main"||r.length||(r=$('<ul data-role="listview" data-inset="false" class="app-page-menu"/>').appendTo(i).hide().on("vclick",function(t){var i=$(t.target),r,u;return i.is("a")||(i=i.closest("a")),i.length&&(r=i.attr("href"),u=r.match(/^#/),st(i,function(){u?n.changePage(r.substring(1)):(yi(i,!1),l.location.href=r)})),!1})),r},initialize:function(){function rt(n){$(n).each(function(){var n=this,i=n.cssClass,t=i&&i.match(nl);t&&(s.push({node:n,icon:t[0]}),n.icon=t[0]);n.children&&rt(n.children);fr.Menu.nodeCount++})}function ut(n){return $(n).each(function(){var n=this,i=(n.url||"").toLowerCase();return(i.startsWith("../")&&(i=i.substring(3)),n.selected||r.host&&u.indexOf(i)!==-1)?(t=n,t.selected=!0,fr.Menu.currentNode=t,!1):n.children&&(ut(n.children),t)?(n.selected=!0,!1):void 0}),null}function st(){var n=ur(),t;if(n-ft>2500){if(t=$.Event("awake.app"),$(document).trigger(t),t.isDefaultPrevented())return;n=ur()}ft=n;setTimeout(st,1250)}var t,u,s,k,d,tt,y,p,it;ei=__settings;nf=__baseUrl;kl=__servicePath;$(document).trigger("beforetouchinit.app");le=r.loggedIn();oht();eu=eu&&ct("ui.embedding");sht();hht();dr&&lft();u=l.location.pathname+l.location.search.replace(/(\_(\w+)=(.*?)(&|$))/,"");s=fr.Menu.nodesWithIcons=[];u.match(/\?$/)&&(u=u.substring(0,u.length-1));fr.Menu.nodeCount=0;for(uo in bi.Nodes){wo()&&(bi.Nodes[uo]=r.designer.menu());hr=bi.nodes=bi.Nodes[uo];ut(hr);rt(hr);t&&t.cssClass&&(t.showPageHeaderTitle=!!t.cssClass.match(/\bpage-header-title\b/),t.showPageHeaderDescription=!!t.cssClass.match(/\bpage-header-description\b/),t.showPageHeaderIcon=!!t.cssClass.match(/\bpage-header-icon\b/));k=$.Event("menuinit.app",{menu:hr,menuId:uo});$(document).trigger(k);d=k.nodes;d&&(hr=bi.nodes=bi.Nodes[uo]=d);break}var ft=ur(),g=et.path.parseUrl(location.href),w=g&&g.hash,ot=$("head"),a=$('<div class="app-scrollbar-info"><div><\/div><\/div>').appendTo(o);ht={width:a[0].offsetWidth-a[0].clientWidth,height:a[0].offsetWidth-a[0].clientWidth,gridColumnPadding:16};a.remove();fet();h.init();w&&w!=="#"&&(w.match(/\W/)||!$(w).length)&&location.replace(g.hrefNoHash);sr?$('<meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black'+(tk>=8?"-translucent":"")+'"/><link rel="apple-touch-icon" href="../images/logo-icon.png"/>').appendTo(ot):kr&&$('<meta name="mobile-web-app-capable" content="yes"/><link rel="icon" sizes="196x196" href="../images/logo-icon.png"/>').appendTo(ot);setTimeout(st,10);ei.appInfo.match(/\|$/)||$("#app-welcome").remove();n._logo.html(na());bg();var i=c.left.toolbar,lt=ct("settings.enabled"),at=e("ui.menu.apps.location"),b=!at||at==="sidebar",nt=s.length<=4&&s.length===bi.nodeCount||!b,v=Math.min(s.length,(nt?4:3)+(lt?0:1));if(bi.nodeCountInSidebar=v,ct("ui.sidebar.toolbar")){if(tt=e("ui.menu.tabbar")===!0,ct("ui.sidebar.icons")&&!tt)for(y=0;y<v;y++)p=s[y],it=$('<a class="ui-btn ui-btn-a app-btn-page app-btn'+y+'">&nbsp;<\/a>').appendTo(i).attr("title",p.node.title).data("context",p.node),vt(p.icon,it),p.node==bi.currentNode&&it.addClass("app-selected");else v=0,nt=!b;!nt&&b&&vt("material-icon-apps",$('<a class="ui-btn ui-btn-a app-btn-apps">&nbsp;<\/a>').appendTo(i).attr("title",f.Apps));lt&&vt("material-icon-settings",$('<a class="ui-btn ui-btn-a app-btn-settings">&nbsp;<\/a>').appendTo(i).text(f.Settings).attr("title",f.Settings));tt?i.addClass("app-has-tabbar"):v&&i.addClass("app-has-icons");e("ui.menu.location")!=="sidebar"&&b||v||i.addClass("app-has-optional-apps");vn();c.left.inner.closest(".ui-panel").addClass("app-has-toolbar-bottom");i.find(".ui-btn").length||i.css("visibility","hidden");kg()}else i.hide(),c.left.inner.css("bottom",0);bh(c.left.inner,!1);$(document).trigger("touchinit.app")},presenter:function(t,i){function u(){r[i.name]=i}function f(n){fs(n.id,n.name)}function e(){var n=r[typeof i=="string"?i:i.name];return n&&(typeof i=="string"||n.supports(p(i.id),i.config))}function o(){var u=p(i.id),e=u.extension(),f=i.container.is(".app-echo-inner"),n=yc(),t;if(f||u==yt()){if(n=r[i.name],f&&n.echo&&!n.echo())return!1;f||(pn(i.container,e),i.container.find('ul[data-role="listview"]').hide(),wp(i.container,e));t=$(i.container).find('div[data-presenter="'+n.name+'"][data-scope="'+u._viewId+'"]');t.length||(t=$('<div data-role="presenter" class="app-presenter"><\/div>').appendTo(i.container).attr({"data-presenter":n.name,"data-scope":u._viewId}));t.show();i.container=t;n.show(i)}else su(i.id);return!0}function s(){$(i.container).find('div[data-role="presenter"]').each(function(){var n=$(this),u=n.attr("data-presenter"),t=r[u];t&&(i.container=n,t.hide(i),n.hide())})}function h(){$(i.container).find('div[data-role="presenter"]').each(function(){var n=$(this),u=n.attr("data-presenter"),t=r[u];t&&(i.container=n,t.dispose(i),n.remove())})}function c(){var e=p(i.id),o=n.contextDataView()!=yt(),u,t;for(u in r)t=r[u],t.supports(e)&&(!o||!t.echo||t.echo())&&i.list.push({name:u,text:t.text(),icon:t.icon(),context:{id:e._id,name:u},callback:f})}function l(){return r[i.name]}var r=n._presenters;switch(t){case"supports":return e();case"enumerate":c();break;case"register":u();break;case"show":return o();case"hide":s();break;case"dispose":h();break;case"find":return l()}},showAccountManager:function(t,i){if(dr){var o=r.AccountManager.list(!0),s=location.href.match(/(\?|&)_accMan=(\w+)/),u=[],e;if(dr._instance._rememberMeSet&&(t||(t=[]),t.push({name:"RememberMe",value:!0})),!r.AccountManager.enabled()){n.showLogin(t);return}for(e in o)e!="_lastUser"&&o[e].name&&u.push({text:e,callback:cft,context:o[e]});i&&(u.length||s&&s[2]!="login")?s||u.length?(u.push({text:f.AddAccount,callback:n.showLogin,icon:"material-icon-add"}),uf(u,"switch")):yv(u[0].context.name):n.showLogin(t)}},showLogin:function(t){var u=dr&&dr._instance,r,i;!u||u.get_displayLogin()||sa()?(i=uf(),i.is(".app-acc-man-inactive")||i.is(".app-acc-man-splash")||i.appendTo(o).addClass("app-acc-man-inactive"),i.insertBefore($(".app-page-modal-background")),oa()||uf().fadeOut("slow"),n.show({controller:"MyProfile",startCommand:"New",startArgument:"loginForm",showActionButtons:"Bottom",defaultValues:t})):(r=nf+"login",l.location.href.indexOf(".aspx")!==-1&&(r+=".aspx"),l.location.href=r)},openExternalUrl:function(t,i){var u,r=et.path.parseUrl(t);return r.host&&(u=function(){if(r.host==="maps.apple.com"||r.host==="maps.google.com"||i)rs(t);else{var u=r.pathname.replace(/\//g,"-").substring(1)||r.host.replace(/\W/g,"-"),o=n.pageInfo(u),f,e;o||n.pageInfo({id:u,external:!0,href:t});f=n.page(u);e=f.find("iframe");ft(!0);e.length&&e.remove();e=$('<iframe class="app-page-external"/>').attr("src",t).appendTo(d(f).addClass("app-wrapper-external")).load(function(){gt()===u?ft(!1):setTimeout(n.changePage,0,u)});sr&&d(f).css("overflow","auto")}}),u},getThemes:function(){var n=new $.Deferred;return $.ajax({url:kl+"/Themes",method:"POST",cache:!1}).done(function(t){n.resolve(t.d||JSON.parse($(t).text()))}),n.promise()},startUrl:function(){return ui(0).url},returnUrl:function(){if(ce=sessionStorage.identityConfirmationRequested,ce)return ce;var n=ui(0).url.match(/\?ReturnUrl=(.+?)(#.+)?(&|$)/);return n&&(n=decodeURIComponent(n[1])),n&&n.indexOf("/_invoke/getidentity")!==-1&&(sessionStorage.identityConfirmationRequested=ce=n),n},initials:function(n){return kh(n)},_changeThemeLink:function(n,t,i){var f=new Date,o=ei.appInfo.split("|")[1],r,u,e;f.setMonth(f.getMonth()+1);document.cookie=".COTTHEME"+o+"="+t+";expires="+f.toUTCString()+";path=/";u=$("link.app-theme");u.length&&(r=u.attr("href"),r.indexOf("appservices")>-1?r=r.replace(new RegExp(RegExp.escape(n),"i"),t):(e=t.split("."),r=r.substring(0,r.indexOf("Theme.ashx")+17)+e[0]+"&accent="+e[1]),$.ajax({url:r,dataType:"text"}).done(function(){u.attr("href",r);i()}))}};n=r.touch=r.mobile=new r.Mobile;n.activeLinkBlacklist=".ui-slider-handle,.dv-action-see-all,.app-do-not-activate";n._presenters={};n.calcWidth=rf;n.createLayout=gg;n.prepareLayout=nn;n.fnVisible=gi;r.dragMan=lt=new function(){return this.prototype={active:function(){return this._active===!0},call:function(t,i){if(i.drag){this._dragged=!1;var u=this,r=i.drag,f=u[r.type],s=f&&f[t],o,e;clearTimeout(u._draggedTimeout);t==="start"?(lt._keepTap=!1,u._active=!0,e=r.target,o=n.contextDataView(e),r.dataView=o,f&&(!f.options||f.options.taphold!=!1)&&(u._tapholdTimeout=setTimeout(function(){if(u._tapholdTimeout=null,r){if(r.touch)$(document).one("vmouseup pointerup",function(n){n.preventDefault();n.stopPropagation();gy()});var n=$.Event("taphold.app",{drag:r});r.target=e;r.dataView=o;$(e).trigger(n);bc(n)}},750))):lt._keepTap||u._tapholdTimeout&&(clearTimeout(u._tapholdTimeout),u._tapholdTimeout=null);f&&s&&(!f.options||!f.options.dataView||r.dataView)&&!r.cancel&&(t==="cancel"&&(r.cancel=!0),f[t](r));(t==="end"||t==="cancel")&&(r.dataView=null,u._active=!1,tu(!0))}},dragged:function(n){var t=this;return arguments.length&&(t._dragged=n,n&&clearTimeout(t._draggedTimeout),t._draggedTimeout=setTimeout(function(){t._dragged=!1},200)),t._dragged===!0}}};$(document).on("mousedown pointerdown touchstart","[data-draggable]",function(n){var i;if(go(n),i=n.type,(i!=="mousedown"||n.which===1)&&!ni&&!k){kf();ri();var f=lr,o=$(this),r=o.attr("data-draggable"),u=lt[r],e=n.originalEvent.pointerType,t=u&&u.options;if(e!=="mouse"||n.which!==3)if(ni={x:f.x,y:f.y,lastX:f.x,lastY:f.y,target:o,type:r,data:null,cancel:!1,mouse:e==="mouse"||i==="mousedown",pointer:!!i.match(/^pointer/),touch:e==="touch"||!!i.match(/^touch/),pen:e==="pen",tooltip:t&&t.tooltip},$(document).trigger($.Event("dragstart.app",{drag:ni})),r!==ni.type&&(r=ni.type,u=lt[r],t=u&&u.options),ni.cancel)ni=null;else{(ni.dir==="all"||t&&t.immediate)&&(n.preventDefault(),t&&t.immediate&&kb(n,!0));$(document).on("pointermove touchmove mousemove",kb).on("pointerup pointercancel touchend touchcancel mouseup",bc);if(n.isDefaultPrevented())return!1}}}).on("dragstart.app",function(n){lt.call("start",n)}).on("dragmove.app",function(n){lt.call("move",n)}).on("dragend.app",function(n){lt.call("end",n)}).on("dragcancel.app",function(n){lt.call("cancel",n)}).on("taphold.app",function(n){lt.call("taphold",n)});lt.hscrollbar={options:{taphold:!1,immediate:!0},start:function(n){var t=this,f=n.target,h=f.width(),r=f.parent(),u=p(r.attr("data-view")),e,o,i,s;u?(e=u.session("grid-avail-width"),o=r.outerWidth(!0),t._maxScroll=e-o,s=e/o,tt._dataViewId===u._id&&tt.detach()):(t._dataView=null,i=r.prev(),i.css("overflow-x")!=="auto"&&(i=i.children().first()),t._scrollable=i,s=i[0].offsetWidth/h);r.addClass("app-scrollbar-dragging");n.dir="all";t._dataView=u;t._ratio=s;t._rect=r[0].getBoundingClientRect();t._offset=n.x-f.offset().left},move:function(t){var i=this,u=i._dataView,r=(t.x-i._rect.left-i._offset)*i._ratio;u?(r=r<0?0:Math.min(r,i._maxScroll),n.scrollGrid(u,r)):i._scrollable.scrollLeft(r)},cancel:function(n){this.end(n)},end:function(n){var i=n.target.parent(),t=this._dataView;i.removeClass("app-scrollbar-dragging");t?(hi(),tt._dataViewId===t._id&&tt.sync({dataView:t,scrollIntoView:!1})):i.prev().focus()}};lt.vscrollbar={options:{taphold:!1,immediate:!0},start:function(n){n.dir="all";this._scrollable=n.target.parent().prev();n.target.parent().addClass("app-scrollbar-dragging");this._rect=n.target.parent()[0].getBoundingClientRect();this._ratio=this._scrollable[0].scrollHeight/this._scrollable.height();this._offset=n.y-n.target.offset().top},move:function(n){var t=this;t._scrollable.scrollTop((n.y-t._rect.top-t._offset)*t._ratio)},cancel:function(n){this.end(n)},end:function(n){n.target.parent().removeClass("app-scrollbar-dragging");hi()}};lt["grid-header"]={options:{dataView:!0},start:function(n){if(s){var t;n.target.find(".app-field-separator").each(function(){var i=$(this),r=i.offset(),u=n.x-r.left;Math.abs(u)<=22&&(t=i)});t&&(n.originalType=n.type,n.type="grid-header-separator",n.target=t,lt["grid-header-separator"].start(n))}}};lt["grid-header-field"]={options:{dataView:!0},start:function(n){var t=n.target,i,u=t.offset(),r;n.mouse||(i=t.width(),i>ht.gridColumnPadding*2&&(u.left+i-ht.gridColumnPadding<n.x?(n.target=t.next(),r=!0):u.left+ht.gridColumnPadding>n.x&&t.prev().is(".app-field-separator")&&(n.target=t.prev(),r=!0)));r?(n.originalType=n.type,n.type="grid-header-separator",lt["grid-header-separator"].start(n)):n.dir=n.mouse?"all":"horizontal"},move:function(n){var t=this,e=n.dataView,r=t._lastDropTarget,u,c=t._dragLine,k=0,g,ut,l=ot(n.target),a,ft,p,nt,et,w=s?30:20,h,f,tt,b,it=t._mirror;if(h=(l.length?l:y(".app-grid")).find(".dv-item").first(),f=h.offset(),b=e.session("grid-frozen-width")||0,!t._dragLine){g=d();ut=g.offset();et=!0;r=t._lastDropTarget=n.target;t._targetFieldName=r.attr("data-field-name");a=l.length?l.find(".dv-item").last():null;ft=i.height-(a?a.offset().top+a.outerHeight():ut.top+g.outerHeight());c=t._dragLine=$('<div class="app-drag-line"><\/div>').appendTo(o);c.css({top:r.offset().top,bottom:ft});n.target.css("color",c.css("background-color"));var rt=r.prevAll(".app-field-separator").first(),st=r.nextAll(".app-field-separator").first(),ct=rt.length?rt.offset().left+Math.ceil(rt.outerWidth()/2):r.offset().left-(s?ht.gridColumnPadding/2:2),vt=st.offset().left+Math.ceil(st.outerWidth()/2),lt=r.css("padding-top"),at=r.css("padding-bottom");it=t._mirror=$('<span class="app-drag-header-field"/>').appendTo(o).css({"font-size":r.css("font-size"),paddingLeft:ht.gridColumnPadding/2,paddingRight:ht.gridColumnPadding/2,paddingTop:lt,paddingBottom:at,textAlign:r.css("text-align")}).width(vt-ct-ht.gridColumnPadding).height(r.closest(".app-grid-header").height()-v(lt)-v(at)).text(r.text());t._mirrorDispX=n.x-ct;t._mirrorDispY=n.y-r.offset().top+(n.mouse?0:r.outerHeight());t._mirrorWidth=it.outerWidth()}h.find(".app-field").each(function(){var t=$(this),i=t.offset();(t.is(".app-frozen")||i.left>f.left+b)&&n.x>=i.left-ht.gridColumnPadding/2&&n.x<i.left+t.width()+ht.gridColumnPadding/2&&(p=t)});p&&(nt=p.attr("class").match(/\bapp-field-([\w\_]+)\b/i),nt&&(r=p,t._targetFieldName=nt[1]));t._lastDropTarget=r;u=r.prev();u.is(".app-field-separator")?k=Math.ceil(u.outerWidth(!0)/2)+2:(u=r,k=-ht.gridColumnPadding/2);u.length&&c.css({transform:"translate3d("+(u.offset().left+k)+"px,0,0)",transition:et||n.instantFeedback?"":"transform 160ms ease-out"});t._mirror.css({left:n.x-t._mirrorDispX,top:n.y-t._mirrorDispY});n.instantFeedback=!1;clearTimeout(t._gridScrollTimeout);tt=h.width();(f.left+tt-(n.x-t._mirrorDispX+t._mirrorWidth-1)<=w||n.x-t._mirrorDispX-(f.left+b)<=w)&&(t._gridScrollTimeout=setTimeout(function(){var r=e.session("grid-avail-width"),o=Math.ceil(r-r*(h.width()/r)),i=e.session("scroll-left")||0,s=n.x-t._mirrorDispX,l=s+it.outerWidth()-1,c=s-(f.left+b),u;i<o&&f.left+tt-l<=w?(i=Math.min(i+32,o),u=!0):i>0&&c>0&&c<=w?(i=Math.max(i-32,0),u=!0):clearTimeout(t._gridScrollTimeout);u&&(e.session("scroll-left",i),ys(e,-i,!1),n.instantFeedback=!0,n.dropTarget=document.elementFromPoint(rr(),yf()),t.move(n))},100))},end:function(n){var e=this,t=n.dataView,f=t._allFields,o=t.gridSettings(),i=o.sequence,r=n.target.attr("data-field-name"),u=e._targetFieldName;r=f[t.findFieldUnderAlias(r).Index].Name;u=f[t.findFieldUnderAlias(u).Index].Name;i.length||$(t._fields).each(function(){i.push(this.Name)});i.splice(i.indexOf(r),1);i.splice(i.indexOf(u),0,r);this._removeDragState(n);t.gridChanged()},cancel:function(n){this._removeDragState(n)},taphold:function(n){ab(n.target,{x:n.x,samples:!1,hide:!0})},_removeDragState:function(n){var t=this;clearTimeout(t._gridScrollTimeout);n.target.css("color","");t._lastDropTarget=null;t._dragLine&&(t._dragLine.remove(),t._dragLine=null,t._mirror.remove(),t._mirror=null)}};lt["grid-header-separator"]={options:{dataView:!0,taphold:!1,immediate:!0},start:function(n){var t=this,f=d(),r=n.target.prevAll("[data-field-name]").first(),e=ot(r),u=e.length?e.find(".dv-item").last():null,s=i.height-(u?u.offset().top+u.outerHeight():f.offset().top+f.outerHeight());t._columnHeader=r;t._left=Math.ceil(r.offset().left);t._minRight=t._left+ye()+n.target.outerWidth()+2;r.next().is(".app-btn-more")&&(t._minRight+=r.next().outerWidth());t._maxRight=t._left+(r.closest(".app-bar-heading").length?d():r.closest(".app-grid")).width()*.75;t._dragLine=$('<div class="app-drag-line"><\/div>').appendTo(o).css({transform:"translate3d("+(n.target.offset().left+Math.floor(n.target.outerWidth()/2))+"px,0,0)",top:n.target.offset().top,bottom:s});t._leftLine=$('<div class="app-drag-line"><\/div>').appendTo(o).css({left:t._left-Math.ceil(ht.gridColumnPadding/2),top:r.offset().top,bottom:s});r.css("color",t._dragLine.css("background-color"));n.dir=n.mouse?"all":"horizontal"},move:function(n){var t=this,i=n.x;i<t._minRight&&(i=t._minRight);i>t._maxRight&&(i=t._maxRight);t._right=i;t._dragLine.css("transform","translate3d("+i+"px,0,0)")},end:function(n){var t=this,o=t._dragLine,f=t._right-t._left-n.target.outerWidth()-2,i=n.dataView,r=i.gridSettings(),u=t._columnHeader,e=i.findField(u.attr("data-field-name"));u.next().is(".app-btn-more")&&(f-=u.next().outerWidth());r.width[e.Name]||u.parent(".app-grid-header").find("[data-field-name]").each(function(){var n=$(this),t=n.width();r.width[n.attr("data-field-name")]=t});r.width[e.Name]=f;i.gridSettings(r);lt.dragged(!0);t._removeLine(n);vs(i,!1,!0);i.gridChanged()},cancel:function(n){this._removeLine(n)},_removeLine:function(n){var t=this;n.target.prevAll("[data-field-name]").first().css("color","");t._dragLine.remove();t._leftLine.remove();t._columnHeader=null},canScroll:function(){return!1}};lt.dismiss={start:function(n){n.dir="all"},move:function(){},end:function(n){this.cancel(n)},cancel:function(n){n.target.trigger("vclick")}};lt.panel={start:function(n){var t=this;t._position=n.target.is(".ui-panel-position-right")?"right":"left";n.dir="horizontal";t._lastX=t._x=n.x;t._time=+new Date},move:function(n){var t=this,r=n.target,u=t._dir,f=n.x-t._x;t._dir||(u=t._dir=r.is(".ui-panel-position-right")?"right":"left",u==="right"?r.offset().left:r.outerWidth(),r.css({position:"absolute"}),t._animated=r.is(".ui-panel-animate"));t._displacement=f;t._movedBy=n.x-n.lastX;u==="right"?r.css({right:(tr()?i.right:0)+Math.min(0,-t._displacement)}):r.css({left:(tr()?i.left:0)+Math.min(0,t._displacement)});t._lastX=n.x},end:function(n){function c(){f?po(t.css("visibility","hidden"),!0):t.css({transform:"none",transition:"transform 0 linear",right:e=="right"?0:"",left:e==="left"?0:""});i._done(t)}var i=this,r=i._displacement,t=n.target,u=t.outerWidth(),e=i._dir,o=s?30:10,h=+new Date-i._time<=250,f;if(e==="right")if(v(t,"right")){f=i._movedBy>=0&&(h&&r>=o||Math.abs(r)>=u*.5);t.css({transition:"transform 300ms ease",transform:"translate3d("+(f?u-r:-r)+"px,0,0)"}).removeClass("ui-panel-animate").one("transitionend",c)}else i._done(t);else if(v(t,"left")){f=i._movedBy<1&&(h&&-r>=o||Math.abs(u+r)<=u*.5);t.css({transition:"transform 300ms ease",transform:"translate3d("+(f?-(u+r):-r)+"px,0,0)"}).removeClass("ui-panel-animate").one("transitionend",c)}else i._done(t)},cancel:function(n){this._done(n.target)},_done:function(n){var t=this;t._dir=null;n.css({position:"",transition:"",transform:"",left:tr()?t._position==="left"?i.left:"":"",right:tr()?t._position==="right"?i.right:"":""});t._animated?setTimeout(function(){n.addClass("ui-panel-animate");ru=!1},100):ru=!1},canScroll:function(n,t){return t==="vertical"?n.height()<n[0].scrollHeight:!0}};lt["data-item"]={options:{dataView:!0},start:function(n){var t=this,i=n.dataView,s=i.extension().viewStyle(),h=n.target.closest(".app-listview"),r=i.session("grid-avail-width"),f=h.width(),u,e,o;if(s=="Grid"&&r>f){if(i.multiSelect()&&(u=n.target.closest(".ui-btn").find(".app-btn-check"),u.length&&n.x<u.offset().left+u.outerWidth()+8))return;e=f/r;o=Math.ceil(r-r*e);t._maxScroll=o;t._originalX=n.x;t._lastX=n.x;t._listViewWidth=f;t._scrollLeft=i.session("scroll-left")||0;n.dir="horizontal";t._minScroll=v($("span."+ss(i)),"margin-left")+t._scrollLeft;i.session("scroll-left-margin",t._minScroll)}},move:function(n){var i=this,r=n.dataView,u,t=i._scrollLeft;tt._dataViewId==r._id&&tt.detach("hide");u=Math.ceil(i._originalX-n.x);t+=u;t<0?(t=0,i._originalX=n.x,i._scrollLeft=t):t>i._maxScroll&&(t=i._maxScroll,i._originalX=n.x,i._scrollLeft=t);n.time=+new Date;r.session("scroll-left",t);ys(r,-t,!0)},end:function(n){this._stopAnimation(n);var r=this._scrollLeft,u=+new Date,f=n.time,e=(u-f)*100,i=n.x-n.lastX;if(e>0&&Math.abs(i)>5){var o=i<0?1:-1,t=r+this._listViewWidth*o;t<this._minScroll?t=0:t>this._maxScroll&&(t=this._maxScroll);n.dataView.session("scroll-left",t);ys(n.dataView,-t,!1,!0)}},cancel:function(n){this._stopAnimation(n)},taphold:function(n){n.target.is(".app-btn-more")?n.target.trigger("vclick"):n.target.trigger("contextmenu")},_stopAnimation:function(n){lt.scrollingAnimationFrame!=null&&(cancelAnimationFrame(lt.scrollingAnimationFrame),lt.scrollingAnimationFrame=null);n.moved&&n.dataView._id===tt._dataViewId&&setTimeout(tt.frame,600,"show")}};lt["reading-pane"]={options:{taphold:!1,immediate:!0},start:function(n){var t=this,u=pt.splitter,r=u.offset(),f=r.left,e=r.top;t._originalLeft=f;t._originalTop=e;i.splitLeft?(t._minLeft=f-(i.splitLeft-pt.minLeft),t._maxLeft=f+(i.splitRight-pt.minRight),t._offset=Math.round(n.x)-r.left):(t._minTop=e-(i.splitTop-pt.minTop),t._maxTop=e+(i.splitBottom-pt.minBottom),t._offset=Math.round(n.y)-r.top);t._placeholder=u.clone().insertBefore(u.addClass("app-dragging"));n.dir="all"},move:function(n){var t=this,r=Math.round(n.x),u=Math.round(n.y);i.splitLeft?(r-=t._offset,r<t._minLeft&&(r=t._minLeft),r>t._maxLeft&&(r=t._maxLeft),t._left=r,pt.splitter.css("left",r)):(u-=t._offset,u<t._minTop&&(u=t._minTop),u>t._maxTop&&(u=t._maxTop),t._top=u,pt.splitter.css("top",u))},end:function(){var n=this;n._restore();i.splitLeft?gr("splitLeft",n._left-i.left-c.left.width-1):gr("splitTop",n._top-i.top-i.toolbarHeight);$(".app-reading-pane-detail:not(.ui-page-active)").length?(vi(function(){ou.trigger("resize")}),bl.go(1)):ou.trigger("resize")},cancel:function(){this._restore()},_restore:function(){var n=this;n._placeholder.remove();pt.splitter.removeClass("app-dragging").css({left:n._originalLeft,top:n._originalTop})}};$(document).ready(function(){n.initialize();et.initializePage();r._parse();n.start()}).on("dragend",function(){$.event.special.swipe.eventInProgress=!1}).on("mousedown",function(n){go(n)}).on("touchstart pointerdown",function(t){if(go(t),!$(t.target).is(":input")){if(rt){t.preventDefault();return}var r=$(t.target),i=r.closest("a,.app-feedback"),u=wb=ee(t);bb=!lr.isScrollable;i.length&&(io=i.data("touch-start",u),i.is(n.activeLinkBlacklist)||(i.parent().is("li")?(clearTimeout(pb),pb=setTimeout(function(){io&&yi(io,!1)},250)):s&&yi(i,!1)))}}).on("touchmove pointermove",function(n){var u,f=$(n.target),i=$(io),e=f.closest(".ui-panel-inner,.app-wrapper"),t=ee(n),r=i.length&&i.data("touch-start"),o;if(sr&&!i.length&&f.closest(".app-bar-toolbar").length){n.preventDefault();return}if(f.is(".ui-panel-dismiss,.ui-popup-screen,.app-scrollable-cover")){n.preventDefault();return}if(bb&&(bb=!1,e.length&&(t.y>wb.y?u=e.scrollTop()==0:t.y<wb.y&&(o=ett(e),u=o.height>=o.maxHeight-1)),u)){ds();yi();n.preventDefault();sr&&(co=!1);return}i.length&&(r&&(r.scrollTop!==t.scrollTop||Math.abs(r.x-t.x)>4||Math.abs(r.y-t.y)>4)&&yi(),ds())}).on("touchend pointerup",function(n){go(n);ds()}).on("touchcancel pointercancel",function(){yi();ds()}).on("scrollstart.app",function(n){os();vd(n,ww);lp()}).on("scrolldir.app scrollstop.app",function(n){function y(){hu(i)}if(n.relatedTarget){var i=$(n.relatedTarget),h=i.find("> .app-listview").filter(gi),u=h.find(".app-group"),f,a,v,e;u.length&&(f=aa(ts(i)),f.length&&(group=f.find(".app-group"),group.length||(group=$('<div class="app-group"><\/div>').appendTo(f),$(u[0]).is(".app-group-fixed")&&group.addClass("app-group-fixed")),a=i.offset().top+re(i).outerHeight(!0),u.each(function(){var n=$(this);if(n.offset().top+n.outerHeight(!0)/2>a)return!1;v=n}),e=(v||$(u[0])).html(),e!==group.html()&&(group.html(e),re(i).find(".app-group").html(e))));var c=i.data("scroll-dir"),p=h.filter(".app-grid"),w=h.find(".app-group-fixed").first(),o=p.length>0||w.length,s=i.data("sticky-header"),r=o?s.find(".app-view-instruction,.app-group:not(.app-group-fixed)"):null,b=r&&r.parent();c==="up"?(o&&r.length&&!r.is(":visible")&&r.removeClass("app-hidden"),ec(s),vd(n,y,200)||y()):(c==="down"||!c&&o)&&(o?(r.addClass("app-hidden"),b.addClass("app-bar-text-instruction-hidden"),l._stickyHeaderHideInstruction=!0,hu(i)):s&&s.hide());n.type==="scrollstop"&&(t.restoreLastPopup(),clearInterval(vk),vk=setTimeout(function(n){var t=ett(n);t.top<=0&&t.height<=t.maxHeight+1&&(ue(),du(null,null,i.find(".app-echo")))},250,i))}}).on("contextmenu MSHoldVisual selectstart",function(n){var t,i,r,u;s&&!$(n.target).is(":input")||rt?n.preventDefault():n.type==="contextmenu"?(t=$(n.target),t.is(".ui-popup-screen")?(i=$(".ui-popup-active .ui-popup.app-popup-listview"),i.length&&(to(i),n.preventDefault(),n.originalEvent&&(r=ee(n),u=document.elementFromPoint(r.x,r.y),setTimeout(function(){var n=$(u);n.trigger(n.closest(".app-control-helper").length?"vclick":"contextmenu")},75)))):t.closest(".ui-popup").length?n.preventDefault():t.is(".app-has-children")&&(n.preventDefault(),setTimeout(function(){t.trigger("vclick")},50))):n.type==="MSHoldVisual"&&n.preventDefault()}).on("vclick","a",fht).on("vclick",".app-input-value",function(n){return $(n.target).prev().focus(),!1}).on("vclick",".app-btn-toggle",tht).on("vclick",".app-filter",function(t){var i=ot(t.target);return i.length&&n.contextScope(i.attr("data-for")),ws({mode:"everything"}),!1}).on("vclick","[data-href]",function(n){if(!n.isDefaultPrevented()){var t=$(this),u=t.attr("data-href"),i=t.closest(".app-field");return t.is(".app-control-inner")&&t.parent().attr("data-input")!=="none"?void 0:(i.addClass("app-selected"),setTimeout(function(){i.removeClass("app-selected");r.odp.blob("download",u)},ai),!1)}}).on("vclick",".app-filter-clear",function(n){var t=wv(n.target);return ba(t),!1}).on("vclick",".app-form-clear-all",function(n){var r=$(n.target),u=r.closest('[data-layout="form"]'),t=wv(r),i={};return u.find("[data-control][data-field]").each(function(){var n=t.findField($(this).attr("data-field"));n&&n.Type!=="DataView"&&!n.OnDemand&&(i[n.Name]=null,n.Index!==n.AliasIndex&&(n=t._allFields[n.AliasIndex],i[n.Name]=null))}),fi(i),u.find(".app-has-clear-all").removeClass("app-form-clear-all-visible"),t._showClearAll=!0,!1}).on("vclick contextmenu",".app-grid-header",function(n){if(lt.dragged()||uu){n.preventDefault();n.stopPropagation();return}kf();var t=$(n.target),i={x:n.pageX,y:null};if(!t.is(".app-btn-more"))return t.is(".app-icon,.app-grid-header-text")&&(t=t.parent()),iw(n)?rv(wv(t),null,!0):(t.attr("data-field-name")||$(this).find("span").each(function(){var i=$(this),r=i.offset().left;if(!i.is(".app-btn-check,.app-btn-more,.app-frozen-spacer")&&r<=n.pageX&&n.pageX<r+i.outerWidth(!0))return t=i,!1}),t.is(".app-frozen-spacer")&&(t=t.next()),t.is("span")&&!t.is(".app-btn-check,.app-field-separator")&&(t.addClass("ui-btn-active"),i.x&&(i.y=t.offset().top+t.outerHeight()*.75),(n.type==="contextmenu"||n.type==="vclick"&&n.ctrlKey)&&(i.samples=!1),n.preventDefault(),setTimeout(function(){t.removeClass("ui-btn-active");ab(t,i)},ai))),!1}).on("vclick contextmenu",".app-bar-heading",function(n){var t=$(n.target);if(t.closest(".app-group").length&&!t.is(".app-group"))return rb(!0),!1});ou.on("resize",function(){ae();lht();i.isVirtual&&vf(!0)}).on("throttledresize",function(){ae();br(!0)}).on("orientationchange",function(){ae();br(!0)}).on("popstate",function(){t.ignoreErrors=!0}).on("focus",function(){prt();(!tft()||wo())&&tf()});$(document).on("mousedown",function(){var n=ut&&ut[0];n&&n.display!=="none"&&!n.className.match(/\bapp-tooltip-message\b/)&&ri()}).on("mousemove",function(n){n.pageX!=null&&(lo=n.pageX,ao=n.pageY)}).on("vclick",".app-tooltip-message",function(){ri();tf()}).on("mouseenter","[title],[data-title]",function(n,t){var i=$(this),u=i.attr("data-title"),f=typeof u=="string"&&u.length,r=i.attr("title"),e=typeof r=="string"&&r.length,o=lo,s=ao;if(f&&(r=u),e&&i.attr("data-title",r).removeAttr("title"),e||f){if(put){r&&(i.removeAttr("title"),setTimeout(function(){i.attr("data-title",r)},1e3));return}clearTimeout(vo);vo=setTimeout(function(){if(vo=null,t=10,!k||k.tooltip){var n=i.offset();i[0].namespaceURI===vut&&Math.abs(o-lo)<=11&&Math.abs(s-ao)<=11||lo>=n.left&&lo<n.left+i.outerWidth()&&ao>=n.top&&ao<n.top+i.outerHeight()?ut&&ut.is(".app-tooltip-message:visible")&&vl>new Date||kc(lo,ao+23,r,i):ut&&!ut[0].className.match(/\bapp-tooltip-message\b/)&&ut.hide()}},t!=null?t:yut)}}).on("mouseleave","[data-title]",function(){ut&&!ut[0].className.match(/\bapp-tooltip-message\b/)&&ri()});t=r.input={methods:{none:{render:dt},text:{render:function(n){var c=n.container,f=n.inner,a=n.row,i=n.field,v=i._dataView,h,y=n.originalField,l,e,u,s,o;y||i.Index===i.AliasIndex||(i=v._allFields[i.AliasIndex]);s=i.ItemsStyle;h=i.TextMode;e=a[i.Index];typeof e!="string"||e.length||(e=null);c.removeClass("app-has-helper");e==null?(u=n.editing?t.fieldToPlaceholder(y||i):"",c.addClass("app-null")):(s&&s!=="Lookup"&&s!=="AutoComplete"?(l=v._findItemByValue(i,e),l&&(u=l[1])):u=i.text(e,!0),h===1&&(u=new Array(u.length+1).join("&#9679;")),c.removeClass("app-null"));h===2&&f.addClass("app-field-data-rtf");!i.Rows||i.ItemsTargetController||s||f.css({"min-height":i.Rows+"em"}).addClass("app-text-multiline");af(u)?f.html("&nbsp;"):(u=u.trim(),i.HtmlEncode&&h!==1?f.text(u):f.html(u));oc(f,i,e,u,!0)&&f.attr("title",u);n.editing?(i.Type.match(r._numericTypeRegex)?o="number":vw(i)?o="tel":yw(i)?o="email":rot(i)&&(o="url"),o&&n.container.attr("data-type",o)):i.HyperlinkFormatString&&f.attr("data-href",fv(i,a));this._createFooter(n)},focus:function(n){t.beforeFocus(n);var r=it(n),f=nt(r),i=t.elementToField(n),e=i.TextMode===2,u;if(e){if(u=i.is("rtf-editor"),u){h.editor({field:i.Name,type:u});return}h.toolbar("create",r)}else h.range("clear");if(ta(i,r.closest(".ui-page")),f.length)f.focus();else return yht(n)},blur:function(n){var t=$(n.target),i=it(t),u=i.find(".app-control-inner"),r=t.data("restoreText");h.range("save");r!=null&&u.text(r);h.toolbar("remove",i)},setup:function(n){var i=$(n.target).data("notify");i&&(n.change=t.methods.text._textChange)},_textChange:function(n){var i=n.input.closest("[data-notify]").data("notify"),t=$.Event(i);t.inputData=n;$(document).trigger(t)},_createFooter:function(n){var i=n.container,u=n.field,r=n.originalField,t;r||(r=u);r.FooterText?(t=i.find(".app-control-footer"),t.length||(t=$('<span class="app-control-footer"/>')),t.appendTo(i.addClass("app-has-footer")),t.html(r.FooterText)):i.is(".app-has-footer")&&i.removeClass("app-has-footer").find(".app-control-footer").remove()}},blob:{_mapRequest:function(n,t,i,r){var u={autofill:"map"},f=0,e=0,o=0;return r.forEach(function(r){if(!r.match(/^_/)&&r in i){var s=i[r],h=s.trigger,l=n.findField(s.field),c=t[l.Index];h&&e++;c!=null&&(u[r]=c,f++,h&&o++)}}),f&&e===o?u:null},_mapUpdate:function(n,t,i,r){var u="",f,e;i=JSON.parse(i);r&&(r=JSON.parse(r),r.image&&(u="url(data:"+r.contentType+";base64,"+r.image+")"));f=[];e=i.latitude;e==null||"address1"in i?["address1","address2","address3","city","region","postalcode","country"].forEach(function(n){var t=i[n];t!=null&&f.push(t)}):f.push(e,i.longitude);n.attr("title",f.join(", "));n.css({backgroundImage:u,width:u?Math.floor(n.width()):"",backgroundSize:i.scale>1?"100% auto":""}).data("r",i);t.toggleClass("app-has-map",u.length>0)},render:function(n){var p=this,v=n.container,f=n.inner,u=n.field,h=u._dataView,y=n.row,ut=n.editing,b=y[u.Index],e,o,k,d,g,w,ft,i,l,et,nt,tt,it,c,a,rt;if(e=t.fieldToPlaceholder(u),u.tagged("autofill-address","autofill-geocode")){o=f.find(".app-map-placeholder");o.length||(o=$('<div class="app-map-placeholder"><\/div>').appendTo(f.empty()),v.attr("data-read-only","true"),e&&$('<span class="app-data-input-placeholder"/>').text(e).appendTo(o));ad(h,"");k=h._autoFill;d=h._controller;for(nt in k)if(u.tagged(nt+"-map")&&(g=k[nt],w=p._mapRequest(h,y,g,["latitude","longitude"]),ft=p._mapRequest(h,y,g,["address1","address2","address3","city","region","city","country"]),i=ft,i?"address1"in i||!w||(i=w):i=w,f.toggleClass("app-has-map",i!=null),i)){et="";o.css({width:"",height:u.tagged("map-height-")?r.tagSuffix:""});i.width=Math.floor(o.width());i.height=Math.floor(o.height());lg()&&(i.scale=2);tt=u.Tag.match(/\bmap\-type\-(\w+)\b/);tt&&(i.mapType=tt[1]);i.zoom=u.tagged("map-zoom-")?parseInt(r.tagSuffix):16;i=JSON.stringify(i);l=r.cache["map:"+i];l?l!==!0&&p._mapUpdate(o,f,i,l):(r.cache["map:"+i]=!0,r.execute({controller:d,view:h._viewId,command:"AutoFill",trigger:i,background:!0}).done(function(n){l=n[d].AutoFill;p._mapUpdate(o,f,i,l);r.cache["map:"+i]=l}));break}et==null&&o.css({backgroundImage:"",width:"",height:""}).removeData("r")}else f.empty(),!b||b.match(/^null/)?(v.addClass("app-null"),e&&(e===ol.Required&&(e=""),$('<span class="app-blob-placeholder"/>').text(e).appendTo(f))):(e=b,ut||(it=f.find(".app-drop-box"),it.length&&r.upload("destroy",{container:it})),c=$('<a rel="external"/>').appendTo(f),rt=u.Name.toLowerCase(),r.odp.blob("init",{link:c,field:u,key:e}),u.OnDemandStyle!==1?(c.addClass("app-has-image"),r.odp.blob("init",{image:$("<img/>").appendTo(c).attr({title:vr.BlobDownloadHint}),field:u,key:e}),$(h._allFields).each(function(){var n=this,t=n.Name.toLowerCase();if(t===rt+"contenttype"||t===rt+"content_type")return a=y[n.Index],!1}),$(h._allFields).each(function(){var n=this,t=n.Name.toLowerCase();if(t==="contenttype"||t==="content_type")return a=y[n.Index],!1}),a||(a="image"),a.match(/^image/i)?c.attr("data-content-type",a):s||c.attr("target","_blank")):(c.appendTo(f).addClass("app-link-blob").attr("title",vr.BlobDownloadHint),$("<span/>").text(vr.BlobDownloadLink).appendTo(c),s||c.attr("target","_blank"))),ut&&r.upload("create",{container:$('<div tabindex="0"><\/div>').appendTo(f).addClass("drop-box-"+u.Index),dataViewId:h._id,fieldName:u.Name,multiple:u.Multiple,change:function(){var n=!!v.find(".app-drop-box.app-empty").length;v.toggleClass("app-null",n);fi({dataView:u._dataView,values:{field:u,value:n?null:"0"},skipDrawingInput:v});br(!1)}});t.methods.text._createFooter(n)},focus:function(n){return t.beforeFocus(n),n.is(":input")?void 0:(nt().blur(),n.find(".app-drop-box").focus(),!0)}},checkbox:{render:function(n){var i=n.container,r=n.inner,u,e=n.field,o=e.Items,f,s=n.editing,h=n.row[e.Index];f=o[o.length-1][0]==h;h==null?r.html(sh):(vt("material-icon-"+(f?"check-box":"check-box-outline-blank"),r.empty()).addClass("app-icon-checkbox"),i.addClass("app-has-checkbox"));r.css("visibility",s?"hidden":"");s?(u=$('<div class="app-checkbox-container" tabindex="0"><\/div>').appendTo(t.createContainer(i)),f&&u.addClass("app-checkbox-on"),$('<a class="app-checkbox-button" />').appendTo(u)):i.find(".app-data-input-container").remove();t.methods.text._createFooter(n)},focus:function(n,i){t.beforeFocus(n);nt().blur();var r=n.find(".app-checkbox-container").focus();return i&&i.is('[data-control="label"]')&&this._toggleState(r),!0},click:function(n){var i=rr(n.clientX),t=it(n.target,".app-checkbox-container");t.offset().left-8<=i&&i<=t.offset().left+t.outerWidth()+8&&(this._toggleState(t),n.preventDefault())},_toggleState:function(n){var r=n.is(".app-checkbox-on"),o=n.find(".app-checkbox-button"),u=it(n),e=u.attr("data-checkbox-style"),i,f;if(t.cancel()){if(ri(),n.toggleClass("app-checkbox-on"),i=t.elementToField(n),e!=="circle"&&e!=="square")if(r)n.addClass("app-checkbox-on app-animation").addClass("app-animate-off").one("transitionend",function(){setTimeout(function(){n.removeClass("app-animation").removeClass("app-checkbox-on app-animate-off")})});else n.addClass("app-animation").addClass("app-animate-on").one("transitionend",function(){n.removeClass("app-animation").removeClass("app-animate-on")});fi({dataView:i._dataView,values:{field:i,value:!r},skipDrawingInput:u});s||r||(f=i.is("lookup-auto-advance"),f&&setTimeout(t.move,0,u,"right",9,f))}}},lookup:{render:function(n){var i=n.originalField=n.field,p=i.ItemsTargetController,w,b;n.field=n.dataView._allFields[n.field.AliasIndex];var h=n.inner,o=n.container,e=o.find(".app-data-input-button"),k=o.data("node"),l=n.editing,a,s,y,u,c;!l&&p?t.methods.listbox.render(n):(a=i.ItemsStyle,l&&!e.is(".app-data-input-button")&&(e=$('<span class="app-data-input-button"><span class="app-caret"/><\/span>').attr("title",ck.Select.HeaderText).insertAfter(h),e.css("marginTop",(h.text("w").outerHeight()-e.outerHeight())/2),a==="Lookup"?e.addClass("app-caret-r"):a==="DropDownList"&&($('<span class="app-caret app-caret2"/>').appendTo(e.addClass("app-caret-u-d")),i.tagged("open-on-tap")&&o.css("cursor","pointer"))),l?h.css("max-width",o.attr("data-size")!==""?"none":k.self.width()-(e.outerWidth()||22)-v(h,"padding-left")*2):(e.length&&e.is(".app-data-input-button")&&e.remove(),h.find(".app-control-before").remove(),o.removeClass("app-null app-has-helper")),s=o.find(".app-control-before"),p?(s.length?c=s.find("ul"):(h.text(t.fieldToPlaceholder(i)),o.addClass("app-has-helper"),s=$('<span class="app-control-before app-control-helper" tabindex="0"/>').insertBefore(h),c=$("<ul/>").appendTo(s)),y=i.DynamicItems||i.Items,u=n.row[i.Index],u==null&&(u="",a!=="CheckBoxList"&&(c.empty(),s.css("display","none"),t.fitContainer(o))),typeof u!="string"&&(u=u.toString()),y.length?(u.length&&(w=c.find("li"),b=i.is("lookup-distinct"),u=r.csv.toArray(u),$(y).each(function(){var n=this,i=n[0],r;i!=null&&u.indexOf(i.toString())!=-1&&(r=$("<li/>").text(n[1]).attr("data-value",i).appendTo(c),b&&t.addCount(n[n.length-1],r))}),w.remove()),s.css("visibility","")):s.css("visibility","hidden"),o.toggleClass("app-null",af(u))):(s.remove(),t.methods.text.render(n)),l||!i.ItemsDataController||n.row[i.Index]==null||i.tagged("lookup-details-hidden")||$('<span class="app-field-object-ref app-feedback"/>').appendTo(h).attr("title",f.LookupViewAction))},focus:function(n){var i,f,r,h,c,l;t.beforeFocus(n);var u=n.find(".app-control-helper"),e=u.data("focus")===!1||t._buffer!=null,o=n.find("li");return(u.removeData("focus"),i=it(n),i.addClass("app-has-focus"),!e&&o.length)?t.valid()?(u.focus(),o.removeClass("app-focus").first().addClass("app-focus"),!0):!1:(f=t.methods.text.focus(n),e&&i.addClass("app-has-focus"),f&&(r=t.elementToField(n),h=r._dataView.editRow(),n.data("autoComplete")===!1?n.removeData("autoComplete"):h[r.Index]==null&&(t.elementToButton(n).removeClass("app-caret-r"),r.ItemsStyle==="Lookup"&&(c=nt(it(n)).focus(),setTimeout(function(){t.methods.lookup._showList({field:r,value:null,input:c})},s?300:10)))),l=i.data("autoOpen"),l&&(i.removeData("autoOpen"),setTimeout(function(){t.popup("hide");$(".app-data-input").trigger($.Event("keydown",{altKey:!0,which:40}))},s?310:20)),f)},click:function(i){function a(){u.removeClass("app-has-focus");r.removeClass("app-focus")}var e=t.eventToButton(i),c=e.offset(),l=i.pageX,r=$(i.target),u=it(r),h;if(r.is("li,.app-muted")){if(r=r.closest("li"),!t.cancel())return i.preventDefault(),!1;if(nt(u).length){i.preventDefault();nt(u).blur();setTimeout(function(){r.trigger("vclick")},100);return}r.is(".app-focus")||r.parent().find("li").removeClass("app-focus");nt(u).blur();var v=u.find(".app-control-helper").blur(),o=t.elementToField(r),y=[{text:ck.Delete.HeaderText,icon:"trash",callback:function(){t.methods.lookup._removeBasketItem(r,!0);v.focus()}}];o.is("lookup-details-hidden")||o.is("lookup-distinct")||y.push({text:f.LookupViewAction,icon:"carat-r",callback:function(){a();n.details({field:o,key:r.attr("data-value")})}});u.addClass("app-has-focus");r.addClass("app-focus");pi({anchor:r,items:y,autoFocus:!1,afterclose:function(n,t){s?a():t||v.focus()}});i.preventDefault()}else r.closest(".app-control-helper").length?r.closest(".app-control-helper").focus():u.attr("data-input")==="dropdownlist"&&!nt(u).length&&(s||t.elementToField(r).tagged("open-on-tap"))?(i.preventDefault(),h=nt(),h.length&&h.blur(),s?(wi(!1),setTimeout(function(){wi();t.methods.lookup.lov(u)},100)):this.clickButton(i)):(e.length&&c.left<=l&&l<c.left+e.outerWidth()+8||si())&&this.clickButton(i)&&i.preventDefault()},clickButton:function(i,r){function y(){e.removeClass("ui-btn-active");o=u._dataView;c=o._allFields[u.AliasIndex];l=o.editRow();n.lookup({field:u,value:v?l[u.Index]:null,text:v?c.format(l[c.Index]):null,change:function(n){if(o._inlineEditor&&tt.showField(o,u.Name),u.ItemsTargetController){if(n.length>=2)if(t.methods.lookup._useItemValue(u,[n[0].value,n[1].value]))s||f.find(".app-control-helper").data("focus",!1);else{f.addClass("app-has-focus").find(".app-control-helper").focus();return}}else fi({dataView:o,values:n});s||setTimeout(function(){a.focus(f)},100)}})}var e=t.eventToButton(i),a=t.elementToMethod(e),f=it(e),h=nt(f).length>0,u=t.eventToField(i),o,c,v=!u.ItemsTargetController,l;return!h&&!t.cancel()?!1:(h&&t.popup(":visible")&&(s||i.type!=="vclick")?(t.popup("hide"),t.methods.lookup._buttonUp(e)):u.ItemsStyle!=="Lookup"&&(!si()||$(".app-kiosk").nextAll(".ui-page-active").length)?(e.removeClass("ui-btn-active"),h||(f.find(".app-control-helper").data("focus",!1),a.focus(f)),nt(f).trigger($.Event("keydown",{ctrlKey:!0,which:32}))):r!==!1?(e.addClass("ui-btn-active"),setTimeout(y,ai)):y(),gy(),!0)},blur:function(n){var r=$(n.target),f=it(r),e=f.find(".app-control-inner"),i=r.data("restoreText"),u=t.eventToField(n);u.ItemsTargetController?(i=t.fieldToPlaceholder(u),e.text(i),t.fitContainer(f,null,i)):i!=null&&e.text(i);this._buttonUp(r);t.popup("hide");clearTimeout(u._showListTimeout)},setup:function(n){n.change=t.methods.lookup._lookupChange},_lookupChange:function(n){var i=n.input,r=t.elementToField(i),e,o,u,f,s;if(t.methods.lookup._preventList(),i.removeData("keepFocus"),n.value?r.AllowAutoComplete===!1&&(i.val(i.data("original")).select(),n.value=""):(t.popup(":visible")||r.AllowAutoComplete===!1||r.ItemsStyle==="DropDownList")&&(clearTimeout(r._showListTimeout),f=it(i),s=i.data("original")||"",i.val(""),i.removeData("restoreText"),s!==""&&(t.clearValue(r),e=!0),i.data("original",""),f.find(".app-control-inner").text(t.fieldToPlaceholder(r)),t.fitContainer(f)),o=t.elementToButton(i),o.removeClass("app-caret-r"),i.data("autoComplete")===!1)i.removeData("autoComplete"),clearTimeout(r._showListTimeout);else{if(!n.value&&(e||i.data("original")===""||t.clearValue(r),r.ItemsTargetController&&n.keyCode))return;u={field:r,value:n.value,originalValue:i.data("original"),input:i};"keyCode"in n&&(u.keyCode=n.keyCode);t.methods.lookup._showList(u)}},lov:function(i){function o(f){if(f==="Clear")t.clearValue(u);else if(f==="New")n.lookup({field:u,create:!0,dataInput:i});else{var e=l[f];r.input.methods.lookup._useItemValue(u,e)}}var u=t.elementToField(i),h=u._dataView,c=h._allFields[u.AliasIndex],y=h.editRow(),l=u.DynamicItems||u.Items,a=y[u.Index],v,e=[],s;$(l).each(function(n){var t=this,i=a==t[0];e.push({text:c.format(t[1]),icon:i?"check":!1,visible:i,callback:o,context:n})});t.canCreateItems(u)&&(e.length&&(e.push({}),v=!0),e.push({text:ho.GenericNewToolTip,icon:"material-icon-add",callback:o,context:"New"}));a!=null&&u.AllowNulls&&(v||e.push({}),e.push({text:f.LookupClearAction,icon:"material-icon-cancel",callback:o,context:"Clear"}));s=c.HeaderText;pi({x:rr(),y:yf(),title:s!=="&nbsp;"?s:null,anchor:i.find(".app-control-inner"),items:e})},_hidePopup:function(){if(!s)if(t.popup(":visible")){var i=t._lastInputBeforeScroll=nt(),n=it(i,".app-data-input-button");n.length&&this._buttonUp(n);t.popup("hide")}else t._lastInputBeforeScroll=null},_buttonUp:function(n){var i=t.elementToField(n);n.is(".app-data-input-button")||(n=t.elementToButton(n));i&&i.ItemsStyle==="Lookup"&&n.addClass("app-caret-r");n.removeClass("app-caret-u app-caret-d")},_getCopyFields:function(n){var o=n.Copy,i,t,u,f,e;if(o&&(i=n._dataView,t=t=i.session(n.Name+"_copyFields"),!t)){for(t=[];u=r._fieldMapRegex.exec(o);)f=u[1],e=u[2],(i.findField(f)||e==="null")&&t.push({fromField:e,toField:f});i.session(n.Name+"_copyFields",t)}return t},_preventList:function(){var n=this;clearTimeout(n._popupTimeout);clearTimeout(n._searchTimeout);n._searchTimeout=null;n._popupTimeout=null},_showList:function(n){function vt(){bt||(o.push({text:"$separator"}),bt=!0)}function yt(o){function nr(){function ni(){c.css({"min-width":hi?ot.width()-ft*2:"","max-width":"",width:""});at=Math.max(kt[0].getBoundingClientRect().width,b.length?b.offset().left-ht.left+b.outerWidth()+(bt?1:0):0)+ft;at=Math.min(at,(bi?ir:i.width)*.9);c.css({width:at,"max-width":at,"min-width":at})}var f,o,nt,y,ut,et,lt,d,ri,oi,wi,si;if(!dc()&&h.parent().length){if(f=c.data("state"),!g&&f&&f.id===l._id&&f.f===u.Name&&f.v==ct&&!f.loading&&f.c===fi&&c.is(":visible")){if(o=kt.find(".app-selected"),w){for(o.html(w.text);++ui<a.length;)if(ut=a[ui].text,o=o.next(),et=o.html(),ut!=null&&ut.match(/\"app\-text\-\w+/)||et&&et.match(/\"app\-text\-\w+/))o.html(ut);else break;return}if(!o.length&&f.noMatch&&e.length)return}for(nt=0;nt<a.length;nt++)y=a[nt],a[nt]="<li "+(y.before?y.before:"")+">"+(y.text==null?"":y.text)+((y.after?y.after:"")+"<\/li>");kt.html(a.join(""));w&&(w=kt.find(".app-selected"));c.data("state",{id:l._id,f:u.Name,v:ct,loading:yi,c:fi,noMatch:pi});c.css({width:"",maxWidth:"",minWidth:"",maxHeight:"",height:"",minHeight:"",left:"",top:"",display:""});ht=h.offset();lt=v(h,"font-size");v(c,"font-size")!=lt&&c.css("font-size",lt);var vt=fr||kt.find("li").first(),hi=l._inlineEditor&&!rt,bt=hi&&vi.closest(".app-page-inlineeditor-overlay").length>0,bi=b.css("right")=="auto",ft=v(vt,"padding-left")+v(c,"border-left-width")+(bt?-1:0),dt=wt&&(!vt.length||ht.top>vt.outerHeight()*2.5),gt;if(ni(),pt=ht.left,dt&&(gt=!h[0].selectionStart&&tt!=null&&h[0].selectionEnd===tt.length),dt&&gt||(pt-=ft),yt=ht.top-1-i.top,ti=ht.top+ai,ii=i.height-(ht.top+ai-i.top),p=c.outerHeight(),s&&yt>100?(ei=!0,p=yt<p?yt:""):ii<p?yt>ii?(ei=!0,p=yt<p?yt:""):p=ii:p="",p&&(p-=4),p=p||c.outerHeight(),ei?(ti=ht.top-p,b.is(".app-caret-u-d")||b.addClass("app-caret-u")):b.removeClass("app-caret-u"),pt+at>i.width+i.left-10&&(pt=i.width+i.left-1-at-10),c.css({left:pt,top:ti,"max-height":p,height:p}),w){if(w.addClass("app-selected"),d=w.position().top-(p-w.outerHeight())/2,tt=tt.trim(),ri=e.length<tt.length,ri&&!g&&n.keyCode!=8)ni();else if(dt&&!ri&&gt){d=c.css("left",-1e4).scrollTop(d).scrollTop();ht=h.offset();var ki=w.offset().top,r=ti-(ki-ht.top)-1,li=c.outerHeight();r<0?(r-=4,c.find("li").last().css("margin-bottom",-r),d=Math.ceil(d-r),r=4):r+li>i.height&&(oi=i.height-li-4,wi=r-oi,r=oi,c.find("li").first().css("margin-top",wi));c.css({top:r,left:pt-ft+(bt?5:0)})}c.scrollTop(d)}else h.val().length||(ot=it(h),st=ot.find(".app-control-inner"),st.length&&h.data("restoreText")==null&&h.data("restoreText",st.text()),t.fitContainer(ot,h.closest(".app-data-input-container").width("")),ni());k&&(si=h.closest(".app-page-inlineeditor"),si.length&&ci(si))}}var fr,gi,hi;e=h.val();e===""&&wt&&o.length&&o[0]instanceof Array&&o[0][0]==null&&(e=o[0][1]);var vt=e==="",tr=vt?e:e.toLowerCase(),kt=c.data("ul"),a=[],y,dt,ot=lt.parent(),li=vht(yrt(ot)),st,ht,ai=h.outerHeight(),vi=d(h),ir=rf(vi),w,tt,ui,yi,pi,fi=0,wi=e&&RegExp.escape(e),rr=e?new RegExp(g?wi:"^"+wi+".*","i"):null,ft,gt=0,bi,ni,ki,at,pt,ti,yt,ii,p,ei,ur=u.is("lookup-distinct"),di,oi,bt,ri,si=0;c.data("list",o);rt&&(ri=r.csv.toArray(l.row()[u.Index]));$(o).each(function(i){var s=this,r=s.text,h,l=s.totalRowCount,c,v;if(l)e.length>=s.value.length&&gt<l&&a.push({before:'class="app-instruction"',text:String.format(f.ShowingItemsRange,gt,l)});else if(r==="$separator")i>0&&a.push({before:'class="app-instruction app-separator"'});else if(r)a.push(y={before:"",text:r}),dt="",s.instruction?(dt="app-instruction",r===vu&&(yi=!0)):ni||(ni=y),s.selected&&(dt+=" app-selected"),dt&&(y.before='class="'+dt+'"'),c=s.command,c&&(y.before+=' data-command="'+c+'"',c.match(/SeeAll|New/)&&(y.after='<span class="app-icon app-caret-r"><span class="app-caret"/><\/span>'));else if(h=s[0],r=s[1],r!=null&&typeof r!="string"&&(r=u.format(r)),ft=r?r.toString().match(rr):null,r==="$separator")a.push(ki={before:'class="app-instruction app-separator"'});else if((u.AllowNulls||h!=null||vt||e===r)&&(ut||vt&&(et||nt)&&r!==""||!vt&&r&&(ft||r===e||e===n.originalValue))){if(gt++,ri){if(h!=null&&ri.indexOf(h.toString())!==-1)return;si++}a.push(y={before:'data-index="'+i+'"',text:""});fi++;li&&(y.before+=" "+li);!bi&&ft&&(v=tr===r.toString().toLowerCase(),w&&!v||vt||(tt=r,w=y,ct=h,ui=a.length-1),bi=h!=null&&(k||v));ft&&g&&e!==n.originalValue?(ft.index&&(y.text="<span>"+yu(r.substring(0,ft.index))+"<\/span>"),y.text+="<b>"+yu(r.substring(ft.index,ft.index+ft[0].length))+"<\/b>",ft.index+ft.length<=r.length-1&&(y.text+="<span>"+yu(r.substring(ft.index+ft[0].length))+"<\/span>")):ft&&!g?(y.text='<span class="app-text-normal">'+yu(r.substring(0,e.length))+"<\/span>",y.text+='<span class="app-text-bold">'+yu(r.substring(e.length))+"<\/span>"):y.text=r==null||r===""?fl:yu(r);r===di&&s.length>2?(bt=t.methods.lookup._itemToDetails(u,s),bt&&(y.text+="<i>"+yu(bt)+"<\/i>"),oi||(bt=t.methods.lookup._itemToDetails(u,o[i-1]),bt&&(a[a.length-1].text+="<i>"+yu(bt)+"<\/i>"),oi=!0)):oi=!1;ur&&(y.text+=t.addCount(s[s.length-1]));di=r}});w||vt&&(!ri||si||nt)||o[0].text===vu||o[0].text===eo||(a.splice(0,0,{before:'class="app-instruction"',text:eo}),pi=!0,st=ot.find(".app-control-inner"),st.length&&h.data("restoreText")==null&&h.data("restoreText",st.text()),vt||(st.text(e+"  "),t.fitContainer(ot,lt)));rt&&gt&&si>1&&(y={before:'data-command="SelectAll"',text:cl.SelectAll},ni?a.splice(a.indexOf(ni),0,y):(ki||a.push({before:'class="app-instruction app-separator"'}),a.push(y)));w&&(w.before+=' class="app-selected"',tt=tt.trim(),gi=e.length<tt.length,gi&&!g&&n.keyCode!==8&&(ot=it(h),st=ot.find(".app-control-inner"),st.length&&h.data("restoreText")==null&&h.data("restoreText",st.text()),tt=e+tt.substring(e.length),t.fitContainer(ot,h,tt),kr||(hi=h.data("keyCode"),hi!==8&&hi!==46&&(h.data("autoComplete",!1),h.val(tt),h[0].setSelectionRange(e.length,tt.length),h.removeData("autoComplete")))));t.methods.lookup._preventList();"keyCode"in n?t.methods.lookup._popupTimeout=setTimeout(nr,100):nr()}function ni(n){c.is(":visible")&&c.data("field")===l._id+"_"+u.Name&&(o.splice(0,1),yt([[null,n.get_message()]].concat(o)))}function pt(){function it(n){if(s[g]=n,w(l)&&h.parent().length&&(!i.searchTimeout||t.methods.lookup._searchTimeout===i.searchTimeout)){h.data("ignoreContextFields",!0);var r=[],a=n[p];$(a).each(function(){var t=this,i=[t[rt||n.primaryKey[0]],t[f]],u=t.group_count_;kt&&$(kt).each(function(){i.push(t[this.fromField])});u!=null&&i.push(u);r.push(i)});l.session(ko(u)+(v[ht.Index]==e?"":e),r);o.splice(0,1);o.length&&o[0].selected&&o.splice(0,1);a.length<n.totalRowCount&&r.push({totalRowCount:n.totalRowCount,value:e});c.data("field")===l._id+"_"+u.Name&&(nt&&!e?(o.splice(0,1),o=r.concat(o),o.splice(0,0,{text:dt,instruction:!0})):o=r.concat(o),o.length||(o=[{text:eo,instruction:!0}]),yt(o))}}var p=k,f=u.ItemsDataTextField,rt=u.ItemsDataValueField,v=l.editRow(),s=l.session(u.Name+"_listCache"),b=[f],a=e!==n.originalValue&&e!==""?[f+":$"+gt+"$%js%"+r.serializer.serialize(e)]:[],y=ip(l,u,a),d=$.Event("populateexternalfilter.dataview.app");c.data("field",l._id+"_"+u.Name);d.externalFilter=y;$(document).trigger(d);y.forEach(function(n){var t;a.every(function(i){return i.startsWith(n.Name+":")&&(t=i),!t});t||a.splice(0,0,n.Name+":="+n.Value)});$(t.methods.lookup._getCopyFields(u)).each(function(){this.fromField!=="null"&&b.push(this.fromField)});s||l.session(u.Name+"_listCache",s={});var i={odp:!0,controller:p,view:u.ItemsDataView,sync:v[ht.Index]==e?v[u.Index]:null,lookupContext:{Controller:l._controller,View:l._viewId,FieldName:u.Name},_filter:a,sort:f,pageSize:u.tagged("lookup-fetch-all")?1e5:nh,fieldFilter:b,pageIndex:0,requiresRowCount:!0,externalFilter:y,distinct:u.is("lookup-distinct")},g=JSON.stringify(i),tt=s[g];tt?it(tt):(i.popupTimeout=t.methods.lookup._popupTimeout,t.methods.lookup._preventList(),t.methods.lookup._searchTimeout=i.searchTimeout=setTimeout(function(){r.execute(i).done(it).fail(ni)},gv||ik?200:100))}var u=n.field,l=u._dataView,k=u.ItemsDataController,ft=u.ItemsStyle,wt=ft==="DropDownList",et=ft==="AutoComplete",nt=ft==="Lookup",rt=u.ItemsTargetController,ut=!nt&&!et,bt,kt=this._getCopyFields(u),ot,st,dt=f.TypeToSearch,ht=l._allFields[u.AliasIndex],gt=ht.AutoCompleteAnywhere?"contains":"beginswith",g=gt==="contains",a=n.value,e=a==null?"":a,ct,c=t.popup(),h=n.input,lt=h.parent(),b=t.elementToButton(h),at,y,p,tt,o=[];if(ri(),lt.length){if(rt&&it(h,".app-control-before .app-focus").removeClass("app-focus"),ut)o=u.DynamicItems||u.Items;else{if(u.AllowAutoComplete!==!1)if(e||et){for(a=e,h.data("ignoreContextFields",!1),tt=ko(u),y=l.session(tt+a);!y&&a.length;)if(a=a.substring(0,a.length-1),y=l.session(tt+a),y&&y.length>=nh){y=null;break}while(y&&a.length){for(a=a.substring(0,a.length-1),p=l.session(tt+a);!p&&a.length;)if(a=a.substring(0,a.length-1),p=l.session(tt+a),p&&p.length>=nh){p=null;break}p&&p.length<nh&&(y=p)}y?o=o.concat(y):(o.push({text:vu,instruction:!0}),e&&o.push({text:e,selected:!0,command:"None"}),at=!0)}else o.push({value:null,text:dt,instruction:!0});nt&&(u._doSearch?(u._doSearch=!1,y=h.data("ignoreContextFields")?l.session(ko(u)):null,y?o=o.concat(y):(at=!0,o.splice(1,0,{value:null,text:vu,instruction:!0}))):e||o.push({text:f.ShowOptions,command:"ShowOptions"}),vt(),o.push({text:f.SeeAll,command:"SeeAll"}))}t.canCreateItems(u)&&(ut&&(o=o.slice(0)),vt(),o.push({text:ho.GenericNewToolTip,command:"New"}));!ut&&n.originalValue&&n.value&&(vt(),o.push({text:f.LookupClearAction,command:"Clear"}));o.length||o.push({text:eo,instruction:!0});yt(o);at&&(clearTimeout(u._showListTimeout),u.ItemsDataValueField||(st=k+"_"+u.ItemsDataView+"_DataValueField",u.ItemsDataValueField=r.cache[st]),u.ItemsDataTextField||(ot=k+"_"+u.ItemsDataView+"_DataTextField",u.ItemsDataTextField=r.cache[ot]),u.ItemsDataTextField&&u.ItemsDataValueField?n.keyCode!=null?u._showListTimeout=setTimeout(pt,300):pt():r.execute({controller:k,view:u.ItemsDataView,requiresData:!1}).done(function(n){u.ItemsDataValueField=n.primaryKey[0].Name;u.ItemsDataTextField=n.fields[0].Name;r.cache[st]=u.ItemsDataValueField;r.cache[ot]=u.ItemsDataTextField;pt()}).fail(ni))}},_itemToDetails:function(n,t){var e=[],f=2,o=n.Copy,i,s,u;if(o)while(s=r._fieldMapRegex.exec(o))i=n._dataView.findField(s[1]),i&&!i.Hidden&&!i.OnDemand&&i.Index==i.AliasIndex&&t&&t[f]!==undefined&&(u=t[f],u=u==null?u=sh:n.format(t[f]),e.push(u)),f++;return e.join("; ")},_rowToValues:function(n,t,i){var p=n._dataView._allFields[n.AliasIndex],y=n.Copy,o=n.ItemsDataValueField,s=n.ItemsDataTextField,e,u,c,h,l,a=null,v=null,f;if(o||$(t._allFields).each(function(){if(this.IsPrimaryKey)return o=this.Name,!1}),s||$(t._allFields).each(function(){var n=this;if(!n.Hidden&&!n.OnDemand)return s=n.Name,!1}),e=t.findField(o),u=t.findField(s),i&&(v=i[u.Index],a=i[e.Index]),e)if(u){if(n.ItemsTargetController&&u)e&&(f=[{name:e.Name,value:a}]),u&&f.push({name:u.Name,value:v});else if(f=[{name:n.Name,value:a}],n.Index!=n.AliasIndex&&f.push({name:p.Name,value:v}),y)while(c=r._fieldMapRegex.exec(y))l=c[2],h=t.findField(l),(h||l=="null")&&f.push({name:c[1],value:h&&i?i[h.Index]:null})}else r.alert("Invalid text field "+s);else r.alert("Invalid value field "+o);return f},_removeBasketItem:function(n,i){if(n.length){var e=it(n),o=t.elementToField(n),s=o._dataView,h=s.editRow(),u=r.csv.toArray(h[o.Index]),f;i?(f=n.next(),f.length||(f=n.prev())):(f=n.prev(),f.length||(f=n.next()));f.addClass("app-focus");u.splice(u.indexOf(n.attr("data-value")),1);u=r.csv.toString(u);u.length||(u=null);n.remove();e.toggleClass("app-null",u==null);fi({dataView:s,values:{field:o,value:u},skipDrawingInput:e});u||(e.find(".app-control-helper").hide(),t.methods.lookup.focus(e))}},_createItemFromText:function(i,u,f,e){function c(){n.lookup({field:i,create:!0,dataInput:u,value:f})}if(e!==!1){setTimeout(function(){t.barcode(":input")||t.methods.lookup._createItemFromText(i,u,f,!1)},32);return}var h=i.ItemsNewDataView,o=i.ItemsDataValueField,s=i.ItemsDataTextField;tp(i);!ft()&&f&&i.ItemsDataController&&(h&&o&&s&&!i.Copy?(t.popup("hide"),r.execute({odp:!0,controller:i.ItemsDataController,view:h,command:"Insert",values:[{field:o},{field:s,newValue:f}],done:function(r){if(r.rowsAffected&&!r.errors.length){var u=r[i.ItemsDataController],f=[u[o],u[s]];nt().removeData("restoreText");t.methods.lookup._useItemValue(i,f);n.notify(String.format(eh.Scopes.Form.Insert.Notify,f[1]))}else c()}})):c())},_useItemValue:function(n,i,u,f){var c=i[0],h=i[1]!=null?n.format(i[1]):"",p=n._dataView,w=p.editRow(),k=p._allFields[n.AliasIndex],o=nt(),e=o.length?it(o):y('[data-field="'+n.Name+'"]'),rt=e.find(".app-control-inner"),g,l,a,b,ft,v,ut;if(c==null){if(n.ItemsTargetController)return;if(w[n.Index]!=null&&(t.clearValue(n),ft=t.fieldToPlaceholder(n),o=nt(e).val("").removeData("original").removeData("restoreText"),t.fitContainer(e,o.closest(".app-data-input-container")),e.find(".app-data-input-placeholder").css("display",""),o.length))try{o[0].setSelectionRange(0,ft.length)}catch(ct){}}else{if(n.ItemsTargetController){if(b=r.csv.toArray(w[n.Index]),c!=null&&(c=c.toString()),$(b).each(function(n){if(c==this)return g=n,!1}),a=g==null,a&&(b.push(i[0]),g=b.length-1,l=r.csv.toString(b),l===""&&(l=null),e.toggleClass("app-null",l==null)),y('[data-input-container="'+p._id+'"] [data-control="field"][data-field="'+n.Name+'"]').each(function(){var u=$(this),r=u.find(".app-control-helper"),f,e;r.length&&(r.find("li").removeClass("app-focus"),a?(f=$("<li/>").text(h).attr("data-value",c).appendTo(r.show().find("ul")),n.is("lookup-distinct")&&t.addCount(i[i.length-1],f),t.drawing(u,!1),n.ItemsStyle!=="DropDownList"&&($(n.Items).each(function(){var n=this;if(n[0]==i[0])return e=!0,!1}),e||n.Items.push(i))):it(r.find('li:eq("'+g+'")').addClass("app-focus")).addClass("app-has-focus"),r.css("visibility",""))}),f==!1){w[n.Index]=l;return}if(h="",o.length){o.data({original:h,last:h}).val(h)[0].setSelectionRange(0,0);e.find(".app-data-input-placeholder").show();rt.text(t.fieldToPlaceholder(n));rt.css("width","");t.fitContainer(e,o.closest(".app-data-input-container").width(""));a||e.addClass("app-has-focus").find(".app-control-helper").focus();var et=e.offset(),ot=e.outerHeight(),tt=d(o),st=tt.height(),ht=tt.offset();et.top+ot>ht.top+st&&tt.scrollTop(tt.scrollTop()+(et.top+ot-(ht.top+st)+4))}return a&&fi({dataView:p,values:{field:n,value:l},skipDrawingInput:e}),a}o.length&&o.data({original:h,last:h}).val(h)[0].setSelectionRange(0,h.length);rt.text(h);o.length&&t.fitContainer(e,o.closest(".app-data-input-container").width(""));e.removeClass("app-null").find(".app-data-input-placeholder").hide();(w[n.Index]!=c||n.Index!==k.Index&&w[k.Index]!=h)&&(v=[{name:n.Name,value:c}],n.Index!==k.Index&&v.push({name:k.Name,value:h}),$(t.methods.lookup._getCopyFields(n)).each(function(n){v.push({name:this.toField,value:this.fromField==="null"?null:i[n+2]})}),fi({dataView:p,values:v,skipDrawingInput:e}),s||(ut=n.is("lookup-auto-advance"),ut&&v.length&&v[0].value!=null&&setTimeout(function(){t.move(e,"right",9,ut)})))}}},autocomplete:{render:function(n){t.methods.lookup.render(n)},focus:function(n){return t.methods.lookup.focus(n)},click:function(n){t.methods.lookup.click(n)},clickButton:function(n,i){return t.methods.lookup.clickButton(n,i)},blur:function(n){t.methods.lookup.blur(n)},setup:function(n){t.methods.lookup.setup(n)}},dropdownlist:{render:function(n){t.methods.lookup.render(n)},focus:function(n){return t.methods.lookup.focus(n)},click:function(n){t.methods.lookup.click(n)},clickButton:function(n,i){return t.methods.lookup.clickButton(n,i)},blur:function(n){t.methods.lookup.blur(n)},setup:function(n){t.methods.lookup.setup(n)}},radiobuttonlist:{render:function(n){t.methods.listbox.render(n)},focus:function(n){return t.methods.listbox.focus(n)},click:function(n){t.methods.listbox.click(n)},clickButton:function(n,i){return t.methods.listbox.clickButton(n,i)},blur:function(n){t.methods.listbox.blur(n)}},checkboxlist:{render:function(n){t.methods.listbox.render(n)},focus:function(n){return t.methods.listbox.focus(n)},click:function(n){t.methods.listbox.click(n)},clickButton:function(n,i){return t.methods.listbox.clickButton(n,i)},blur:function(n){t.methods.listbox.blur(n)}},listbox:{render:function(n){var ft=n.container,o=n.inner,et,i,y,u=n.field,h,nt,tt=u.ItemsStyle,ot=n.row,b,st=u.Columns,c,e=u.DynamicItems||u.Items,l,a,p,it,w,d,g,ut,ct;if(h=ot[u.Index],n.editing){if(b=t.canCreateItems(u,ot),a=e.length,st?c=Math.ceil((a+(b?1:0))/st):(c=u.Rows,c||(c=5)),ft.removeClass("app-null app-has-helper"),o.removeClass("app-collapsed"),it=o.find(".app-focus").text(),i=o.find(".app-data-list"),!i.length){o.empty();ht.height&&(et=$('<span class="app-data-list-outer"/>').appendTo(o));i=$('<span class="app-data-list" tabindex="0"/>').appendTo(et||o);ht.height&&i.css({"margin-bottom":-ht.height-v(i,"padding-bottom"),"overflow-x":"scroll"});p=$('<span class="app-hscrollbar2"><span class="app-hscrollbar-handle" data-draggable="hscrollbar"/><\/span>').toggleClass("app-scrollbar-wide",lf).appendTo(o).find(".app-hscrollbar-handle");i.on("scroll",function(){if(i.data("scrolling")===!1)i.removeData("scrolling");else{ka(i,p);var n=p.data("reveal-timeout"),t=p.parent();t.addClass("app-scrollbar-reveal");clearInterval(n);n=setInterval(function(){t.removeClass("app-scrollbar-reveal");clearInterval(n)},200);p.data("reveal-timeout",n)}})}a&&i.empty();i.removeClass("app-inner-shadow-right app-inner-shadow-left app-inner-shadow-left-right");tt==="CheckBoxList"&&h&&(l=r.csv.toArray(h.toString()));var lt=u.tagged("lookup-distinct"),s=u.is("lookup-top"),rt=e,k;if(s&&(s=parseInt(s),s)){if(e=e.slice(0),e.length&&e[0][0]==null&&tt.match(/^(RadioButtonList|ListBox)$/)&&(k=e[0],e.splice(0,1)),e=e.sort(pd),l||h==null||(l=[h.toString()]),l&&l.length){for(w=[],d=[],e.forEach(function(n){var t=n[0];t!=null&&l.indexOf(t)!==-1?w.push(n):d.push(n)}),g=0;g<d.length;g++){if(w.length>=s)break;w.push(d[g])}e=w.sort(pd)}e.splice(s);c=s;k&&(e.splice(0,0,k),c++)}$(e).each(function(n){n%c==0&&(y=$("<ul/>").appendTo(i));var f=this,r=$("<li>").appendTo(y),e=f[0],o=f[1];s&&(n=rt.indexOf(f));r.attr("data-index",n);o==null&&(o=fl);u.HtmlEncode?r.text(o):r.html(o);lt&&e!=null&&t.addCount(f[f.length-1],r);(l&&l.indexOf(e==null?"":e.toString())!==-1||h==e)&&r.addClass("app-selected");e==null&&o===fl&&r.addClass("app-null")});s&&rt.length>s&&$("<li>").appendTo(y).attr("data-index","more").text(rt.length-s-(k?1:0)+" "+ki);ut=i.find('[data-index="new"]');b?ut.length||((c&&a%c!=0||a<u.Rows)&&a||(y=$("<ul/>").appendTo(i)),$("<li>").appendTo(y).attr("data-index","new").text(ho.GenericNewToolTip)):ut.remove();this._scrollItemIntoView(i,!1);a||b&&i.find("li").length===1||i.children().addClass("app-hidden");it&&o.find("li").each(function(){var n=$(this);if(it===n.text())return n.addClass("app-focus"),!1});ct=i.next().show();a?ka(i):ct.hide();h!=null&&this._updateCollapsibleValue(u,ft)}else o.find(".app-data-list,.app-list-value").remove(),(tt==="CheckBoxList"||u.ItemsTargetController)&&h?(nt=u.text(h,!1),u.HtmlEncode?o.text(nt):o.html(nt)):(t.methods.text.render(n),u.ItemsDataController&&n.row[u.Index]!=null&&!u.tagged("lookup-details-hidden")&&$('<span class="app-field-object-ref app-feedback"/>').appendTo(o).attr("title",f.LookupViewAction));t.methods.text._createFooter(n)},focus:function(n){t.beforeFocus(n);var i=n.find(".app-data-list");return i.length||(i=n.closest(".app-data-list")),i.focus(),this._focusItem(i),this._scrollItemIntoView(i),!1},click:function(i){var b=$(i.target),u=b.closest("li"),e,k,f,v,h,c,l,y,o,p,w,a;if(t.cancel()&&!u.parent().is(".app-hidden"))if(ri(),u.length){if(e=u.closest(".app-data-list"),f=t.elementToField(u),h=f.ItemsStyle,f._dataView._busy()||u.parent().is(".app-hidden"))return;if(o=it(e),p=u.attr("data-index"),p==="new"){this._focusItem(u);n.lookup({field:f,create:!0,dataInput:o});i.preventDefault();return}if(p==="more"){i.preventDefault();t.editor({dataView:v,fieldName:f.Name});return}if(v=f._dataView,c=f.DynamicItems||f.Items,c.length)if(h==="CheckBoxList")u.toggleClass("app-selected"),l=[],e.find(".app-selected").each(function(){var t=parseInt($(this).attr("data-index")),i=c[t],n=i[0];l.push((n!=null?n:"").toString())}),y=f.ItemsTargetController||h==="CheckBoxList"?r.csv.toString(l):l.join(","),clearTimeout(e.data("timeout")),e.data("timeout",setTimeout(function(){fi({dataView:v,values:{field:f,value:y===""?null:y},skipDrawingInput:o})},250));else{if(u.is(".app-selected")){this._focusItem(e);t.methods.listbox._updateCollapsibleValue(f,o);return}e.find(".app-selected").removeClass("app-selected");u.addClass("app-selected");w=c[parseInt(u.attr("data-index"))];t.drawing(o,!1);clearTimeout(e.data("timeout"));e.data("timeout",setTimeout(function(){t.methods.listbox._useItemValue(f,w);t.methods.listbox._updateCollapsibleValue(f,o);!s&&f.is("lookup-auto-advance")&&w[0]!=null&&t.move(o,"right",9)},h==="RadioButtonList"?250:10))}k=d(e);k.height()>e.height()&&e.focus();this._scrollItemIntoView(u);this._focusItem(u);i.preventDefault()}else a=b.closest(".app-collapsed"),a.length&&(a.removeClass("app-collapsed"),u=a.find(".app-selected").first(),u.length&&(this._scrollItemIntoView(u),this._focusItem(u)))},blur:function(){},_updateCollapsibleValue:function(n,t){if(n.is("lookup-collapsible")){var i=t.find(".app-control-inner"),u=i.find(".app-list-value"),r,f;u.length||(u=$('<span class="app-list-value"/>').appendTo(i.addClass("app-has-list-value")),vt("material-icon-expand-more",i).attr("title",uh));r=[];i.find("ul:not(.app-hidden) .app-selected").each(function(){r.push($(this).html())});u.html(r.join(", "));f=r.length>0;i.addClass("app-collapsible").toggleClass("app-collapsed",f)}},_scrollItemIntoView:function(n,t){if(n.is(".app-selected,.app-focus")||(n=n.find(".app-selected,.app-focus").first()),n.length){var r=n.offset(),f=n.outerWidth(),i=n.closest(".app-data-list"),e=i.width(),o=Math.min(f*.2,e*.1),u=i.offset();r.left<u.left?i.data("scrolling",!1).scrollLeft(n.parent().prev().length?i.scrollLeft()+r.left-u.left-o:0):r.left+f>u.left+e&&i.data("scrolling",!1).scrollLeft(i.scrollLeft()+r.left-u.left-(e-f-o));t!=!1&&ka(i)}},_focusItem:function(n){if(!s){var t=n.closest(".app-data-list"),i=t.find("li").removeClass("app-focus");n.is("li")||(n=t.find(".app-selected").first());n.length||(n=i.first());n.addClass("app-focus")}},_useItemValue:function(n,t,i){var f=n._dataView,o,u=[{name:n.Name,value:t[0]}],s=n.Copy,h,c=n.Index!==n.AliasIndex,e;if(n.ItemsTargetController)o=f.editRow(),e=o[n.Index]||"",e&&(e+=","),e+=t[0].toString(),u[0].value=e;else if(c&&u.push({name:f._allFields[n.AliasIndex].Name,value:t[1]}),s)for(h=2;copyInfo=r._fieldMapRegex.exec(s);)copyToField=copyInfo[1],copyFromField=copyInfo[2],f.findField(copyToField)&&u.push({name:copyToField,value:copyFromField==="null"?null:t[h++]});i||(fi({dataView:f,values:u,skipPopulateField:n}),u.splice(0,c?2:1));u.length&&fi({dataView:f,values:u,populateDynamicLookups:!1,skipPopulateField:n})}}},of:function(n,t){n&&n.jquery||(n=$(n));var i=n.closest("[data-input]");return i.length||(i=n.find(".app-data-input").closest("[data-input]")),t?i.find(t):i},restoreLastPopup:function(){var n,e,r,u,f,i;rt||(n=this._lastInputBeforeScroll,n&&n.length&&!s&&(e=t.elementToButton(n),e.length&&(r=d(),u=r.offset(),f=n.offset(),u.top<f.top&&f.top+n.outerHeight()<u.top+r.height()&&(i=$.Event("keydown"),i.which=40,i.altKey=!0,nt().trigger(i)))))},reset:function(n){var i,t=n._dataView,u;typeof n=="string"&&(t=yt(),n=t.findField(n));u=n.ItemsStyle;i=n.Name;u&&(tp(n),u.match(/List/)&&r.execute({controller:t._controller,view:t._viewId,requiresData:!1,metadataFilter:["fields","items"],fieldFilter:[i]}).then(function(r){n.Items=r.map[i].Items.splice(0);u!=="DropDownList"&&fi({values:[{name:i,value:t.editRow()[n.Index]}],raiseCalculate:!1})}))},clearValue:function(n){var i=n._dataView,u,f,e,t;if(typeof n=="string"&&(i=yt(),n=i.findField(n)),u=[{name:n.Name,value:null}],f=n.Copy,n.Index!==n.AliasIndex&&u.push({name:i._allFields[n.AliasIndex].Name,value:null}),f)while(t=r._fieldMapRegex.exec(f))t=t[1],e=n._dataView.findField(t),(e&&e.ReadOnly||t==="null")&&u.push({name:t,value:null});fi({dataView:i,values:u,skipPopulateField:n});nt().data("original","")},fieldToPlaceholder:function(n){var t="",r=n.ItemsStyle,u=n.Watermark,i;return u?t=u:n.ItemsTargetController?t=ho.AddItem:!r||r.match(/^CheckBox/)||n.ItemsTargetController?n.AllowNulls||(t=ol.Required):(i=n.DynamicItems||n.Items,t=i&&i.length&&i[0][0]==null?i[0][1]:ho.SelectLink),t},eventToButton:function(n){return this.elementToButton(n.target)},elementToButton:function(n){return it(n,".app-data-input-button")},eventToMethod:function(n){return this.elementToMethod(n.target)},elementToMethod:function(n){var i=it(n);return t.methods[i.attr("data-input")]},eventToField:function(n){return this.elementToField($(n.target))},elementToField:function(n){var f=n.closest("[data-field]"),i=f.attr("data-field"),r=n.closest("[data-input-container]"),t,u;if(i&&r.length)return t=p(r.attr("data-input-container")),t&&(u=t.findField(i)),u},inputsOf:function(n){return n.find('[data-input]:not([data-input="none"])').filter(gi)},peersOf:function(n){var t=n.closest("[data-input-container]"),i,r;return t.length||(t=o),n.data("active",!0),r=t.find('[data-input]:not([data-input="none"]):not([data-read-only])').filter(gi).each(function(n){var t=$(this);if(t.data("active"))return i=n,t.removeData("active"),!1}),{list:r,index:i}},eventToDirection:function(n){function u(){return $(t).closest('[data-layout="form"]').length>0}var t=n.target,r,i=n.keyCode||n.which;if(i===9&&(r=n.shiftKey?"left":"right"),i!==37||this.selectionStart!==0||t.selectionEnd!==0||u()||(r="left"),i===39&&t.value&&t.selectionStart===t.value.length&&!u()&&(r="right"),(i!==38||n.ctrlKey)&&(i!==13||!n.shiftKey)||t.tagName==="TEXTAREA"&&t.selectionStart||t.tagName==="DIV"||(r="up"),i===40&&!n.ctrlKey||i===13&&!n.shiftKey){var f=t.tagName==="TEXTAREA",e=t.tagName==="INPUT",h=ng(t),o=t.selectionStart,s=t.value;h||(e||f)&&!e&&(!f||(i!==40||o!==s.length)&&(i!==13||o!==0||t.selectionEnd!==s.length))||(r="down")}return r},blur:function(n){this.move(n,"enter")},move:function(n,i,r,u){function tt(i){if(!t.valid()){ar().blur();return}var r=$(i),f=r.attr("data-input"),u=t.methods[f];u&&u.focus?r.is(n)&&l.length?(l.blur(),tf()):u.focus(r,n):f==="dataview"&&oi({fieldName:r.data("field")})}var a;t._refocus(!1);n.is("[data-input]")||(n=it(n));var l=nt(n),w=n.closest('[data-layout="form"]').length>0,e=typeof i=="string"?null:i,f,b=$.Event("datainputmove.app",{fromDataInput:n,textInput:l,direction:i,keyCode:r,containerType:u});if(ri(),i&&$(document).trigger(b),!b.isDefaultPrevented()){if(!e&&i){w&&(i==="down"&&(i="right"),i==="up"&&(i="left"));var s=t.peersOf(n),h=n.closest("[data-container]"),v=parseInt(h.attr("data-columns")),c,o;v>1&&(f=t.inputsOf(h),c=f.toArray().indexOf(n[0]));i==="left"?(v>1&&(o=h.prev(),o.is('[data-container="row"][data-columns]')?(f=t.inputsOf(o),f.length&&(e=f[c])):(o=h.nextAll('[data-container="row"][data-columns]').last(),o.length&&(f=t.inputsOf(o),f.length&&(e=f[c-1])))),e||(s.index?e=s.list[s.index-1]:r===9&&(f=t.find(n,"up"),f&&f.length&&(e=f[f.length-1])))):i==="right"?(v>1&&(o=h.next(),o.is('[data-container="row"][data-columns]')?(f=t.inputsOf(o),f.length&&(e=f[c],!e&&c&&(o=h.nextAll('[data-container="row"][data-columns]').last(),o.length&&(f=t.inputsOf(o),a=$(f[c-1]),a.length&&(s=t.peersOf(a),s.index===s.list.length-1?e=n:n=a))))):(o=h.prevAll('[data-container="row"][data-columns]').last(),o.length&&(f=t.inputsOf(o),f.length&&(e=f[c+1])))),e||(s.index<s.list.length-1?e=s.list.get(s.index+1):r===9&&(f=t.find(n,"down"),f&&f.length&&(e=f[0])))):(i==="up"||i==="down")&&(f=t.find(n,i),f&&(e=f[f.length>s.index?s.index:f.length-1]));w&&!e&&(e=n)}var k='[data-container="'+u+'"]',d=typeof u=="string",g=d&&l.closest(k).first().is($(e).closest(k).first()),y,p;(!d||g)&&(e&&!g&&i==="right"&&(p=$(e).closest("[data-container]").first(),y=p.find("[data-control][data-focus]").filter(gi),y.length&&!n.closest("[data-container]").first().is(p)&&(e=y.first())),e&&tt(e))}},find:function(n,t){var i,r,u;return n.is("[data-input-container]")||(n=n.closest("[data-input-container]")),i=n.data("active",!0).parent().find("[data-input-container]"),$(i).each(function(n){var t=$(this);if(t.data("active"))return r=n,t.removeData("active"),!1}),u=t==="up"?r?$(i.get(r-1)):null:r<i.length-1?$(i.get(r+1)):null,u?u.find('[data-input]:not([data-input="none"])'):null},popup:function(){var t=this,n=t._popup,i;if(arguments.length===1)if(arguments[0]==="hide")$(n).hide();else return $(n).is(arguments[0]);else return n||(n=t._popup=$('<div class="app-data-input-popup"><\/div>').hide().appendTo(o),i=$("<ul/>").appendTo(n),n.data("ul",i)),n},render:function(n){var i=n.container,r=n.inner,e=n&&n.dataView||p(i.closest("[data-input-container]").attr("data-input-container")),u=n.field,o=n.row,f=n.editing,s,c,l,a,v,y,h,w;if(e&&!u){if(i.is("[data-layout]")&&!i.data("prepared"))return;f=f!=null?f:e.extension().editing();i.attr("data-state",f?"write":"read");o||(o=e.commandRow());f?i.find('[data-control="field"]').each(function(){var i=$(this),u=i.data("node"),r,n;u.ready&&(r=i.attr("data-field"),n=e.findField(r),n&&n.Type!="DataView"&&t.render({container:i,dataView:e,field:n,editing:f,row:o}))}):i.find('[data-control="field"]').removeAttr("data-input")}else{if(h=i.data("node"),!h||!h.ready)return;if(!i.is(":visible")){h.dirty=!0;return}u&&(y=f&&i.attr("data-read-only")!="true"&&!u.isReadOnly()&&!u._inputReadOnly,w=u.is("input-type"),c=w?w:(u.ItemsStyle||(u.OnDemand?"blob":"text")).toLowerCase(),l=i.attr("data-input"),a=y?c:"none",i.attr("data-input",a),l&&l!=a&&(r||(r=i.find(".app-control-inner")),r.prevAll().remove(),r.nextAll().remove(),r.empty()),s=i.attr("data-placeholder"),s&&(u.Watermark=s=="$label"?u.HeaderText:s));v=t.methods[c];v&&(r||(r=i.find(".app-control-inner")),r.length?r.addClass("app-field-data"):r=i,v.render({container:i,inner:r,dataView:e,field:u,row:o,editing:y}))}},createContainer:function(n){var i=n.children(),t=$('<div class="app-data-input-container"><\/div>').appendTo(n);return i.each(function(){var n=this;n.className.match(/\b(app-control-(helper|toolbar|frame))\b/)||(n.style.visibility="hidden")}),this.fitContainer(n,t),t},fitContainer:function(n,i,r){var e=n.find(".app-data-input-button"),c=n.is(".app-has-helper"),l=n.attr("data-size")==="auto"||e.length,o,u,h,f,s,a,y,p,w,b;i||(i=n.find(".app-data-input-container"));c&&(f=n.find(".app-control-inner"),f.length&&i.css({left:f.offset().left-n.offset().left,top:f.offset().top-n.offset().top}));i&&(l&&!i.is(".app-data-input")&&(i=n.find(".app-data-input")),i&&i.is(".app-data-input")&&(o=i,i=o.closest(".app-data-input-container"),l&&(arguments.length<3&&(r=o.val()),u=n.find(".app-control-inner"),y=u.offset().top,h=u.text(),h!==r&&r.length&&h.length<=r.length+2&&(a=o.data("restoreText"),a||o.data("restoreText",h),u.addClass("app-control-inner-trailer").text(r)),i.width(""),y!==u.offset().top&&pr())));p=n.is(".app-has-helper");e.length&&(u||(u=n.find(".app-control-inner")),w=(u.length?u:n)[0].getBoundingClientRect().height,e.css("visibility",""),i.css({height:w,width:p?u.outerWidth():Math.ceil(e.position().left)-v(i,"padding-left")*2+3}),c&&f.length&&i.length&&(b=i.offset().top,i.css({left:f.offset().left-n.offset().left,top:f.offset().top-n.offset().top}),s=i.offset(),b!==s.top&&t.popup(":visible")&&t.popup().css({left:s.left,top:e.is(".app-caret-u")?s.top-t.popup().outerHeight():s.top+i.outerHeight()})))},execute:function(i){var ft,et,g,ot,ht,h,tt;(Array.isArray(i)||!i.values)&&(i={values:i});var u=i.dataView,f=i.values,st,d=i.populateDynamicLookups,l=i.skipPopulateField,it=i.skipDrawingInput,a,ct={},v,c,o,w,s,rt,e,b,k,ut;if(!Array.isArray(f))if(("name"in f||"field"in f)&&"value"in f)f=[f];else{ft=[];for(et in f)ft.push({name:et,value:f[et]});f=ft}if(f.forEach(function(n){var t=n.field;t!=null&&(n.name=typeof t=="string"?t:t.Name)}),st=f.length,it&&(t.drawing(it,!1),l||(l=u.findField(it.attr("data-field")))),l&&(l.skipPopulate=!0),typeof u=="string"?u=p(u):u||(u=n.pageInfo().dataView),u._ignoreUnsavedChanges=!1,a=i.container||y('[data-input-container="'+u._id+'"]'),s=u.editRow(),d!==!1&&f.forEach(function(n){var t=u.findField(n.name||n.Name);t&&u._enumerateContextFieldValues(t,f,ct,s)}),d!==!1&&f.forEach(function(n){var i=n.name||n.Name,t=u.findField(i);t&&(t.CausesCalculate&&!v&&(v=t),s[t.Index]=n.name?n.value:n.NewValue)}),d!==!1&&(c={dataView:u,row:s,fields:[],container:a,resize:!0},t.evaluate(c)),c&&c.fields.length?(o=f.slice(),o.forEach(function(n){var i=u.findField(n.name||n.Name),t=c.fields.indexOf(i);t!==-1&&c.fields.splice(t,1)}),c.fields.forEach(function(n){o.push({name:n.Name})})):o=f,o.forEach(function(n){var o=n.name||n.Name,f=u.findField(o),c=u.editing(),l=$(a).find('[data-control][data-field="'+o+'"]'),h;f&&(l.each(function(){function d(){of(o);o.sync()}var h=$(this),g=h.attr("data-control"),b,tt=f.Name,k=f.Tag,a,o,v,l,y;g!=="label"&&(b=c&&h.attr("data-read-only")!=="true"&&!f.isReadOnly(),f.Type==="DataView"?(w||(w=[]),w.push(n),o=p(f._dataViewId),b&&n.Modified?(v=[],l=n.NewValue,l==="null"?o._totalRowCount>0&&v.push(r.execute({command:"Delete",controller:o._controller,view:o._viewId,values:[{field:o._externalFilter[0].Name,value:o._externalFilter[0].Value}]})):l!=null&&Array.isArray(l)&&l.forEach(function(n){var t={command:"Insert",controller:o._controller,view:o._viewId,values:[]};for(var i in n)t.values.push({field:i,newValue:n[i]});v.push(r.execute(t))}),$.when.apply($,v).then(d)):d()):(h.is(".app-has-focus")&&s[f.Index]!=null&&(y=nt(),y.length&&(rt=tt,y.data("original",y.val()),ar().blur())),t.drawing(h)?t.render({container:h,inner:h.find(".app-control-inner").removeData("last-smart-text"),dataView:u,field:f,row:s,editing:b}):t.drawing(h,!0),k&&(a=k.match(rk),a&&i.autoFill!==!1&&(e=ad(u,a[1]),e[a[4]].changed=!0))))}),h=f._persist,h&&(k||(ut=h==="user"?kt:dut,k=ut("persistVars")||{}),k[o]="Name"in n?n.Value:n.value))}),k&&ut("persistVars",k),$(document).trigger($.Event("datainputbroadcast.app",{dataView:u,values:o})),w&&w.forEach(function(n){f.splice(f.indexOf(n),1)}),v&&i.raiseCalculate!==!1&&u._raiseCalculate(v,v),d!==!1&&st!==f.length&&(u._busy()?u._pendingPopulate=!0:u._raisePopulateDynamicLookups()),u._showClearAll&&(u._showClearAll=!1,a.find(".app-has-clear-all").addClass("app-form-clear-all-visible")),pr(a.closest(".app-wrapper"),!0),l&&(l.skipPopulate=!1),u.tagged("modal-auto-grow")&&ci(),e){g={components:{},_reset:!0};ot=0;b=!0;for(h in e)h.match(/^_/)||(autoFillInfo=e[h],tt=s[autoFillInfo.index],autoFillInfo.trigger?tt!=null&&tt.length||(b=!1,o.forEach(function(n){n.name===autoFillInfo.field&&(ht=!0)})):tt==null?o.forEach(function(n){n.name===autoFillInfo.field&&(b=!1)}):(h=h.toLowerCase(),h.match(/^component/i)?g.components[h.substring(9)]=null:g[h]=null,ot++),autoFillInfo.changed=!1);ot&&!b&&ht&&(e._canceled&&(e._canceled=!1),vy({config:e,dataView:u,data:g}));b&&ld(u,s,e,a)}rt&&(t._refocusTimeout=setTimeout(t._refocus,0,{fieldName:rt}))},_refocus:function(n){if(n)ar().closest("[data-field]").length||oi(n);else{var i=t._refocusTimeout;i&&(clearTimeout(i),t._refocusTimeout=null)}},evaluate:function(t){var i=t.dataView,u=t.row,f=t.scope,s=t.fields,r=t.container,h,c=[],o=[],a=[],v,y,p,it;if($(i._expressions).each(function(){var e=this,w=e.Scope,k,b,g,nt="",tt,l;e.Type===1&&(w===5&&(!f||f.readOnly)?(k=i.findField(e.Target),k&&(b=!!i._evaluateJavaScriptExpressions([e],u,!1),g=k._inputReadOnly!==b,k._inputReadOnlyChanged=g,k._inputReadOnly=b,g&&s&&s.indexOf(k)===-1&&s.push(k))):(w===3||w===2||w===7)&&r&&(!f||f.visibility)?(b=!!i._evaluateJavaScriptExpressions([e],u,!1),g=e._visChanged!==b,e._visChanged=b,g&&(y||(p=d(r),n.stub("put",p),y=!0),t.visibilityChanged=!0,w===3?nt="f:":w===2?(nt="c:",h=!0):w===7&&(nt="v:"),tt=r.find('[data-visibility="'+nt+e.Target+'"]').css("display",b?"":"none"),b?$(tt).each(function(){var n=$(this).data("node");n&&c.push(n)}):w===3&&(l=i.findField(e.Target),l&&u[l.Index]!=null&&l.is("clear-on-hide")?(o.push({name:l.Name}),l.Index!==l.AliasIndex&&o.push({name:i._allFields[l.AliasIndex].Name})):l._dataViewId&&(v=!0,wf(l._dataViewId))))):w===1&&(!f||f.readOnly)&&a.push(e))}),a.length&&r&&ns(i,u,r,a),!t.ignoreFormButtons&&(i.isDynamicAction("Custom")||i.isDynamicAction("Form"))&&r.find("[data-action]").each(function(){var t=$(this),r=t.attr("data-action"),n;i.isDynamicAction(r)&&(n=i.findAction(r),n&&(i._clonedRow=u,t.toggleClass("app-disabled",!i._isActionAvailable(n)),i._clonedRow=null))}),h&&i._isWizard&&bf("status"),c.length&&(tc({controls:$(c)}),v=!0),h&&df(),!t.ignoreDynamicButtons&&i.isDynamicAction("Form")){var b=r.closest(".ui-page").find(".app-bar-buttons"),tt,e,k=[],g=[],rt=[],nt=[];b.length&&b.first().find(".ui-btn").each(function(){k.push($(this).attr("data-action-path"))});i._clonedRow=u;i.extension().context(nt);$(nt).each(function(){var n=this;n.uiScope==="Form"&&g.push(n.path);n.icon&&rt.push(n.icon)});k.length?k.join()!==g.join()&&(tt=!0,e=!w(i).isModal):(n._toolbarButtons.each(function(){var t=this,n;if(t.style.display!=="none"&&(it=!0,n=$(t).data("action-path"),n&&g.indexOf(n)===-1))return e=!0,!1}),it||(e=!0));(tt||e)&&n.refreshAppButtons(nt,{buttonBars:b,layout:r,toolbar:e,dataView:i});i._clonedRow=null}o.length&&fi({dataView:i,values:o});t.visibilityChanged&&t.resize?(clearTimeout(l._visibilityChangeTimeout),l._visibilityChangeTimeout=setTimeout(function(){br()},10)):v&&pr();y&&n.stub("trim",p)},valid:function(n){if(arguments.length)this._valid=n!==!1;else return this._valid!==!1},cancel:function(n){return t._canceled=n===!1,vrt(),t._canceled=!1,t.valid()},triggerSetValue:function(n,t,i){this.valid(!0);typeof t=="string"&&(t=t.trim());var r=$.Event("setvalue.input.app",{inputValue:t,inputOriginalValue:i,inputElement:n[0],inputValid:!0,inputError:null});return n.trigger(r),r.inputElement=null,this.valid(r.inputValid),r},drawing:function(n,t){if(arguments.length===1)return n.data("redraw")!==!1;t?n.removeData("redraw"):n.data("redraw",!1)},addCount:function(n,t){var i="";return n!=null&&(i='<span class="app-muted">'+(n>999?String.format("{0:N0}",n):n)+"<\/span>",t&&$(i).appendTo(t)),i},editor:function(t){function v(r){var f=r.rules.dataView(),c=f.survey(),h=f.data(),o=r.type;n.pageInfo(f)._canceled=!0;o==="submit"&&(be(!1),e("ui.transitions.style","none"));vi(function(){o==="submit"&&(fi({dataView:u,values:{name:l,value:h.Field}}),be(!0));s||oi({field:i});r.type==="submit"?t.submit&&t.submit(r):t.cancel&&t.cancel(r)})}var u=t.dataView,l=t.fieldName,i,a,f,o,h,c;typeof u=="string"?u=p(u):u||(u=n.pageInfo().dataView);i=u.findField(l);o=i.ItemsStyle;f={name:"Field",required:!i.AllowNulls,columns:i.Columns,rows:i.Row,options:{}};t=f.options;o&&(h=[],c=i.is("lookup-distinct"),$(i.DynamicItems||i.Items).each(function(){var n=this,t={value:n[0],text:n[1]};c&&(t.count=n[2]);h.push(t)}),f.items={style:o,list:h},t.lookup={distinct:c});a=u.row();f.value=a[i.Index];r.survey({text:i.HeaderText,parent:u._id,controller:u._id+"-editor",context:{},questions:[f],layout:'<div data-layout="form" data-layout-size="tn"><div data-container="row"><span data-control="field" data-field="Field" data-size="fit"/><\/div><\/div>',options:{modal:{fitContent:!0,always:!0},materialIcon:"edit",discardChangesPrompt:!1,contentStub:!1},submitText:"OK",submit:v,cancel:v})},blurDataView:function(){},canFocus:function(){return!pu()&&(!si()||y().prevAll(".app-kiosk").length)},beforeFocus:function(n){var i=yt(),t;ut&&(t=ut.data(),t.message!=null&&n.is(".app-field-"+t.fieldName)||ut.removeData().hide());i._inlineEditor||(y().find('.app-focus[data-input="dataview"]').removeClass("app-focus"),tt.detach(!0))},visible:function(n){var t=!0;return y('[data-layout][data-state="write"]').find('[data-field="'+n.Name+'"][data-control="field"]').closest("[data-visibility]").each(function(){if($(this).css("display")==="none")return t=!1}),t},focus:function(i){var s,f;if(!rt){i||(i={});f=i.field;f&&(i.fieldName=typeof f=="string"?f:f.Name);var r=$(i.container||y('[data-layout][data-state="write"]')),e=i.lastFocused,h=r.closest(".ui-page"),u=e?h.data("last-focused-field"):i.fieldName||r.find('[data-focus="true"]').attr("data-field"),c=u?'[data-field="'+u+'"]':"",a=r.find("[data-control]"+c+':not([data-input="none"])'),o=i.message,l=i.scrollIntoView;if(i.lastFocused&&i.container&&h.removeData("last-focused-field"),e&&e!=="auto"&&!u)return;a.each(function(){var f=$(this),k=f.offset(),g=t.methods[f.attr("data-input")],h,a=f.closest('[data-container="tab"]'),w=f.closest('[data-container="wizard"]'),it=f.data("input")==="dataview",v,rt,ft,b,y,ht,ct,et,lt,st;if((it&&(!f.is(".app-focus")||pu()||e)||g&&g.focus)&&(c||!a.length||a.is(".app-tab-active"))&&(!w.length||bf("visible",{step:w,container:r}))){if(it&&(nt().blur(),!t.valid()))return;if(w.length&&bf("show",{step:w,container:r}),f.closest('[data-container="collapsible"].app-container-collapsed').each(function(){var n=$(this);n.removeClass("app-container-collapsed").find(".app-icon-carat").attr("data-title",el);fc($(n.children()[1]),!0)}),a.length&&!a.is(".app-tab-active")){a.closest('[data-container="tabset"]').first().find(".app-tabs").first().find(".ui-btn").filter(function(){return $(this).text()===a.attr("data-tab-text")}).trigger("vclick");setTimeout(function(){oi(i)},100);return}return re(r).hide(),it?(v=d(),rt=ar(),!v.is(rt)&&t.canFocus()&&(rt.blur(),hi(v)),va(v).removeClass("app-focus"),u&&(f.addClass("app-focus"),ft=ot(f).removeData("skip-item-focus"),b=ft.attr("data-for"),tt._dataViewId!==b&&(tt.detach(!0),tt._dataViewId=p(b).inlineEditing()?b:null),e||(ta(u,ts(v)),y=ft.find(".dv-item .app-selected"),l!==!1&&gl(y.length?y:f,v,null,null,.25),y.length&&y.closest(".app-listview-inlineediting").length&&tt.sync({elem:y,scrollIntoView:l})))):(n.lastTouch(!1),ht=$.Event("datainputmove.app",{direction:f}),$(document).trigger(ht),n.lastTouch(!0),t.canFocus()&&g.focus(f)),s=!0,o&&(t.popup("hide"),ct=t.elementToField(f),ct.ItemsStyle==="Lookup"&&(et=t.elementToButton(f),et.addClass("app-caret-r"),et.removeClass("app-caret-u app-caret-d")),h=f.find(".app-data-input,.app-data-list,.app-drop-box"),h.is(".app-drop-box")&&(h=h.prev()),h.length&&(k=h.offset(),setTimeout(function(){kc(k.left+1,k.top+f.outerHeight(),o,null,!0);ut.data({fieldName:u,message:o})},32))),lt=t._buffer,t._buffer=null,lt==="Backspace"&&(st=yt(),st&&st._inlineEditor?setTimeout(function(){t.clearValue(f.attr("data-field"))}):t.clearValue(f.attr("data-field"))),!1}})}return s},focusCopyMaster:function(n){var t,i=new RegExp("\\b"+n.Name+"\\s*=\\s*.+\\b");$(n._dataView._fields).each(function(){var n=this,r=n.Copy;if(r&&i.exec(r))return t=n.Name,!1});t&&oi({fieldName:t})},canCreateItems:function(n,t){t||(t=n._dataView.editRow());var i=!!n.ItemsNewDataView,f=n.ContextFields,u,e;if(i&&f)while(e=r._fieldMapRegex.exec(f))u=n._dataView.findField(e[2]),u&&t[u.Index]==null&&(i=!1);return i},barcode:function(n){var t=arguments,r=b.queue,i;if(t.length)if(n=t[0],typeof n=="boolean")b.ready=n;else{if(n===":input")return b.input;if(n===":always")if(t.length===2)b.always=!!t[1];else return b.always;else{if(n===":peek")return r.length?r[0]:null;for(i=0;i<t.length;i++)b.queue.push(t[i]);b.active||kv()}}return r}};fi=t.execute;oi=t.focus;gu.on("keydown",bht).on("keyup",wht).on("getvalue.input.app",function(n){var i=t.eventToField(n),e=t.eventToMethod(n),u,f,o,r,s;i&&(f=i._dataView,u=f._allFields[i.AliasIndex],i.Index===u.AliasIndex||i.ItemsStyle||(u=i),s=f.editRow(),r=s[i.Index],i.ItemsTargetController?r=null:i.ItemsStyle&&i.ItemsStyle!=="Lookup"&&i.ItemsStyle!=="AutoComplete"&&(o=f._findItemByValue(i,r),o&&(r!=null||!i.tagged("lookup-null-value-none")&&i.AllowNulls)&&(r=o[1])),n.inputValue=r!=null?i.format(r):"",n.inputValueRaw=r,n.inputDataType=i.Type,u.Len&&(n.inputMaxLength=u.Len),i.Index!==u.Index&&(r=s[u.Index],n.inputAltValue=r!=null?u.format(r):""),i.ItemsStyle||(n.inputRows=i.Rows,i.TextMode===2&&(n.rtf=!0)),n.inputIsPassword=i.TextMode===1,n.placeholder=t.fieldToPlaceholder(i),e&&e.setup&&e.setup(n),i.is("spell-check-none")&&(n.spellCheck=!1),i.is("select-on-focus-none")&&(n.selectOnFocus=!1))}).on("setvalue.input.app",function(n){var i=t.eventToField(n),u,r=n.inputValue,e,o,f;!i||(i.isReadOnly()||i.ItemsStyle||i.OnDemand)&&(!i.is("lookup-accept-any-value")||i.ItemsTargetController)||(u=i._dataView,o=u.editRow(),o&&(String.isBlank(r)?r=null:(e={NewValue:r},f=u._validateFieldValueFormat(i,e,!0),f||(r=e.NewValue)),f?(n.inputError=f,n.inputValid=!1):(i.Index!==i.AliasIndex&&(i.AliasIndex=i.Index),fi({dataView:u,values:{field:i,value:r}}))))}).on("vclick",'[data-control="action"]',function(n){var r=$(n.target),u=r.closest("[data-control]"),f=u.closest("[data-input-container]"),i=p(f.attr("data-input-container")),t;if(i)return ri(),t=i.findAction(u.attr("data-action")),t&&i._isActionAvailable(t)&&st(r.closest(".app-action-column-button"),function(){var n=i.extension();n.command(n.commandRow(),t.CommandName,t.CommandArgument,t.CausesValidation,t.Path)}),!1}).on("vclick",'[data-control="label"]',function(){var i=$(this),e=i.closest("[data-input-container]"),o=p(e.attr("data-input-container")),h=i.attr("data-field"),c,n,l,a,r,u,f;return o&&(s||!ntt())&&(u=o.findField(h),u&&(i.data("active",!0),e.find("[data-control]").each(function(){var t=$(this),i=t.attr("data-control"),r=t.attr("data-field");if(i==="label")t.data("active")&&(l=!0);else if(r===h)if(l){if(n)return!1;n=t}else c=t}),i.removeData("active"),n||(n=c),n.filter(gi).length||(f=n.nextAll("[data-input]").filter(gi).first(),n=f.length?f:n.prevAll("[data-input]").filter(gi).first()),n&&n.length&&(a=n.attr("data-input"),r=t.methods[a],r&&(r.focus?r.focus(n,i):t.focusCopyMaster(u))))),!1}).on("vclick mousedown touchend","[data-input]",function(n){var f=$(n.target),r=n.type,i,u;if(!f.closest(".app-data-input-button").length){if(r==="mousedown"&&n.which!==3)return;if(nt(this).length&&!f.closest(".app-control-helper").length)return}if(!uu&&(i=t.eventToMethod(n),i)){if(i.click&&i.click(n),n.isDefaultPrevented())return!1;if(i.focus&&r!=="touchend")i.focus(f)&&(n.cancelable&&n.preventDefault(),r==="mousedown"&&$(this).find(".app-data-input-placeholder").css("display","none"));else if(r==="vclick"&&(s||!ntt())&&(u=t.eventToField(n),u&&!oi({fieldName:u.Name})))return t.focusCopyMaster(u),!1}}).on("blur",".app-data-input",function(n){function v(n,t){clearTimeout(l._focusTextInputTimeout);clearTimeout(l._focusTooltipTimeout);l._focusTextInputTimeout=setTimeout(function(){i.focus();n&&(i.attr("title",n),l._focusTooltipTimeout=setTimeout(function(){kc(i.offset().left+1,i.offset().top+i.outerHeight()+1,n,null,!0)},120));t&&t(r)},10)}function f(n){var e,u,f;t.valid(!0);e=$.Event("remove.input.app",{input:i});o.is(".app-has-rtf")&&h.handlers(i,!1);i.trigger(e);i.attr("title")&&ri();r.find(".app-data-input-focus").remove();r.find(".app-control-helper .app-focus").length||r.removeClass("app-has-focus");y.contents().css("visibility","");u=r.find(".app-control-inner").removeClass("app-control-inner-trailer");f=u.data("last-smart-text");f&&(r.is(".app-null")||u.text(f),u.removeData("last-smart-text"));o.remove().empty();t._lastInputBeforeScroll=null;n&&n(r)}function s(n){var t;return n=n.split(/,/),n.length===1?t=p.closest(n[0]).is(i.closest(n[0])):$(n).each(function(){return t=s(this),t?!1:void 0}),t}var i=$(n.target),e=t.eventToMethod(n),r=it(i),c=i.data("original"),a=ia(i),o=i.parent(),y=o.parent(),p=$(n.relatedTarget),u;if(t._canceled){clearTimeout(l._focusTextInputTimeout);f();return}if(s(".app-data-input-popup,.app-data-input-helper,.app-data-input-button"))return!1;if(i.data("keepFocus"))return i.removeData("keepFocus"),!1;(e&&e.blur&&e.blur(n),n.isDefaultPrevented())||(s(".app-data-input-container,.app-data-input-placeholder")?(n.preventDefault(),v()):a===c?f():(u=t.triggerSetValue(i,a,c),t._refocus(!1),u.inputValid?f(u.inputValidCallback):t.ignoreErrors?f():(n.preventDefault(),v(u.inputError,u.inputErrorCallback))))}).on("keydown",".app-data-input,.app-drop-box",function(i){var ni,ct,bt,lt,d,v,at,et,vt,p,w,ci,kt,li,yt;os();var s=this,a=s.value,g,b=i.ctrlKey||i.metaKey,nt=i.altKey,ot=i.shiftKey,r=i.keyCode||i.which,y,pt,f=$(s),l=it(f),st,ai=f.closest('[data-layout="form"]').length>0,ht,e,ut,dt=ng(s),o,u,tt,c;if(!dc()){if(bo(i,!1,!1))return!1;if(a==null&&(a=""),g=!a.length,!b&&(r===38||r===8||r===37)){var ft=it(s,".app-control-before"),wt=ft.find("li"),rt=ft.find(".app-focus"),gt;if(wt.length&&!rt.length&&g&&!t.popup(":visible"))return rt=wt.last(),(r===38||r===37)&&(gt=rt.offset(),$(s).offset().top>ft.offset().top+ft.outerHeight()&&wt.each(function(){var n=$(this),t=n.offset();if(t.top===gt.top)return rt=n,!1})),rt.addClass("app-focus"),setTimeout(function(){ft.focus().addClass("app-has-focus");bd(rt)}),!1}if(r===27)return t.popup(":visible")?(lp(),!1):f.is(".app-data-input")?(ut=f.data("change"),y=f.data("original"),pt=ia(f)!==y,!pt&&(ni=l.closest(".app-page-modal"),ni.length&&!t.popup(":visible")))?void 0:(i.stopPropagation(),i.preventDefault(),y!=null&&l.find(".app-data-input-placeholder").hide(),ut?(f.val(y),t.fitContainer(l),setTimeout(function(){t.move(l,t.popup(":visible")?l.data("autoComplete",!1):null);oi({fieldName:l.data("field")});y&&y.length&&$(".app-data-input").select().trigger($.Event("keydown",{which:40,altKey:!0}))})):(ct=$.Event("cancel.input.app",{inputElement:f}),l.trigger(ct),ct.inputElement=null,ct.isDefaultPrevented()||(f.is("iframe")?h.document("blur"):pt?(ri(),f.val(y).select(),t.triggerSetValue(f,y,y)):(t.blur(l),hi()))),!1):(f.blur(),hi(),!1);if((r===13&&!nt||r===9)&&t.popup(":visible"))if(u=t.popup().find(".app-selected"),o=t.elementToField(f),u.length){if(r===9&&o.ItemsTargetController&&(r=13),(!u.is("[data-command]")||r===13)&&(u.trigger("vclick",{feedback:!1}),r===13))return!1}else if(bt=f.val(),r===13&&o.AllowAutoComplete!==!1&&rg(o)&&bt.length)return t.methods.lookup._createItemFromText(o,it(f),bt),!1;if((r===13&&nt||r===39&&s.selectionStart===s.selectionEnd&&(g||a.length===s.selectionEnd))&&(lt=t.eventToButton(i),lt.length&&t.elementToField(lt).ItemsStyle==="Lookup"&&lt.is(":visible")&&(st=t.eventToMethod(i),st&&st.clickButton)))return t.popup(":visible")?t.popup().find('[data-command="SeeAll"].app-selected').trigger("vclick"):(i.stopPropagation(),i.preventDefault(),st.clickButton(i)),!1;if(b&&r===13)return setTimeout(hd),!1;if((b&&!ot&&r>=37&&r<=40||r===32)&&(o=t.eventToField(i),o.Type.match(/^Date/))){var ti,k,ii={NewValue:a},ui=r<37,ei=n.calendar(":visible")?7:1,vi=r===38?-ei:r===40?ei:r===37?-1:1,si=!s.selectionStart&&s.selectionEnd===a.length;if(!ui||g||si)return g?k=new Date:si?ui?k="":(ti=o._dataView._validateFieldValueFormat(o,ii,!0),ti||(k=ii.NewValue,k.setDate(k.getDate()+vi))):ar().select(),k!==null&&setTimeout(function(){n.calendar("keepOpen");fi({field:o,value:k})}),!1}if(!nt&&(r===38||r===40))if(o=t.eventToField(i),d=o.DynamicItems||o.Items,v=-1,o.ItemsStyle!=="DropDownList"||t.popup(":visible")||o.ItemsTargetController){if(l.data("notify")&&(et=l.closest("[data-container]").next("[data-container]").find("li[data-text]"),u=et.filter(function(){return $(this).is(".app-selected")}).removeClass("app-selected"),et.length))return u=u.length?r===40?u.next("[data-text]"):u.prev("[data-text]"):$(et[r===40?0:et.length-1]),u.addClass("app-selected"),!1}else return o.is("lookup-auto-advance")||o.is("lookup-open-on-tap")?t.eventToMethod(i).clickButton(i):($(d).each(function(n){if(this[1]===a)return v=n,!1}),v!==-1?(r===38&&v>(!o.AllowNulls&&d[0][0]==null?1:0)&&v--,r===40&&v<d.length-1&&v++):(v=0,!g&&r===40&&d.length&&d[0][0]==null&&v++),at=d[v],at&&($(s).data("last",at[1]),setTimeout(function(){t.methods.lookup._useItemValue(o,at,!0)}))),!1;if(ht=t.eventToDirection(i),r===32&&!(b||ot||nt)&&!dt&&!a.trim().length)return!1;if(r===40&&nt||r===32&&b){if(ut=f.data("change"),ut)return t.popup(":visible")||(i.stopPropagation(),i.preventDefault(),setTimeout(ut,0,{input:f,value:f.val(),lastValue:f.data("last"),force:!0})),!1;if(vt=$.Event("help.input.app",{inputElement:f}),l.trigger(vt),vt.inputElement=null,vt.isDefaultPrevented()||r===32)return!1}if(f.data("autoComplete",!((r===8||r===46)&&s.selectionStart>0&&s.selectionStart<s.selectionEnd&&t.popup(":visible"))),f.data("keyCode",r),(r===33||r===34)&&t.popup(":visible")){if(e=t.popup(),u=e.find(".app-selected"),u.length){for(c=u.removeClass("app-selected"),e.scrollTop(e.scrollTop()+(r===33?-1:1)*e.height());c.length;){if(r===33){if(c.offset().top<e.offset().top)break}else if(c.offset().top+c.outerHeight()-1>e.offset().top+e.height())break;c.is(".app-instruction")||(u=c);c=r===33?c.prev():c.next()}u.addClass("app-selected")}else u=e.find("li:not(.app-instruction)").first().addClass("app-selected");return!1}if((r===38||r===40)&&!(b||ot||nt)&&t.popup(":visible")){if(i.preventDefault,i.stopPropagation(),e=t.popup(),u=e.find(".app-selected").removeClass("app-selected"),tt=e.find("li:not(.app-instruction)"),u.length)for(c=u;c.length;){if(c=r===38?c.prev():c.next(),c.length&&!c.is(".app-instruction")){u=c;break}c.length||tt.filter(":not([data-command])").length||(u=[])}else u=r===38?tt.last():tt.first();if(u.length)return u.addClass("app-selected"),r===38&&u.prev().is(".app-instruction")&&(u=u.prev()),r===40&&u.next().is(".app-instruction")&&(u=u.next()),p=u.offset(),w=e.offset(),r===38?p.top<w.top?e.scrollTop(p.top-w.top+e.scrollTop()-1):p.top>=w.top+e.height()&&e.scrollTop(p.top-w.top+e.scrollTop()-(e.height()-u.outerHeight())-1):r===40&&(p.top+u.outerHeight()>=w.top+e.height()?e.scrollTop(p.top-w.top+e.scrollTop()-(e.height()-u.outerHeight())-1):p.top<w.top&&e.scrollTop(p.top-w.top+e.scrollTop()-1)),!1;if(l.closest(".app-page-inlineeditor").length)return u=r===38?tt.first():tt.last(),u.addClass("app-selected"),!1}if(ht&&l.is('[data-input-tab-stop="false"]'))return(r===13||r===9)&&(t.blur(l),i.stopPropagation()),!1;if(ht){if(ai&&r===13){if(!t.popup(":visible")&&(o=t.elementToField(f),rg(o)&&a!==f.data("original")))return t.methods.lookup._createItemFromText(o,it(f),a),!1;i.stopPropagation()}return setTimeout(function(){t.move(l,ht,r)}),!1}return r===113?(selectionStart=s.selectionStart,selectionEnd=s.selectionEnd,selectionStart||selectionEnd!==a.length?(s.selectionStart=0,s.selectionEnd=s.value.length):s.selectionStart=selectionEnd,!1):r===90&&b&&!dt?(ci=f.val(),kt=l.data("redo"),clearTimeout(t._undoTimeout),t._undoTimeout=setTimeout(function(){yt=f.val();ci===yt&&(ot?kt!=null&&f.val(kt).trigger("input"):(li=l.data("original"),f.val(li),l.data("redo",yt),af(yt)&&hd()),f.trigger("input"))},100),!1):void 0}}).on("vclick contextmenu taphold",".app-map-placeholder",function(n){var t=$(this),i=t.attr("title")||t.data("title"),r=t.data("r"),u;return i&&r&&(u={address:i,zoom:r.zoom},n.type==="vclick"?$(".ui-popup-active").length||dl(u):pi({anchor:$(this),x:rr(),y:yf()+16,items:[{text:f.Map,icon:"material-icon-location-on",context:u,callback:dl},{text:f.Directions,icon:"material-icon-directions",context:{address:i,zoom:r.zoom,api:"dir"},callback:dl}]})),!1}).on("input",".app-data-input",function(n){var a=this,v=n.keyCode||n.which,i=$(a),u=i.data("placeholder"),e,h=i.data("change"),o,r=ia(i),f,s,c,l=r.trim();if(dc())return!1;l.length||(r=l);u&&(e=r?"none":"",u=u[0],u.style.display!==e&&(u.style.display=e));o=i.data("last");f=r!==o;f&&t.fitContainer(it(i),i);h?f&&(i.data("last",r),h({input:i,value:r,lastValue:o,keyCode:v,keyboard:!0})):f&&!r.length&&(s=i.data("original"),s.length&&(c=t.triggerSetValue(i,r,s),c.inputValid&&i.data("original","")))}).on("cut paste",".app-data-input",function(){var n=$(this);setTimeout(function(){n.trigger("keyup")})}).on("contextmenu",".app-data-input",function(){$(this).data("keepFocus",!0)}).on("mousedown contextmenu",".app-data-input-placeholder",function(n){n.which===3&&$(this).css("display","none")}).on("vclick mousedown",".app-data-input-popup",function(i){function l(){if(e)if(s=t.elementToMethod(r),e==="SeeAll")i.target=r,setTimeout(function(){t.popup("hide");s&&s.clickButton&&s.clickButton(i,!1)},ai);else if(e==="Clear")setTimeout(function(){r.blur();t.clearValue(u);t.fitContainer(o,null,t.fieldToPlaceholder(u));setTimeout(function(){t.methods.lookup.focus(o)},100)},ai);else if(e==="New"){var l=r.val();r.blur();n.lookup({field:u,create:!0,dataInput:o,value:l})}else e==="ShowOptions"?setTimeout(function(){u._doSearch=!0;t.methods.lookup._showList({field:u,value:null,input:r})},ai):e==="SelectAll"?(t.popup("hide"),c=t.popup().find("li[data-index]"),c.each(function(n){t.methods.lookup._useItemValue(u,h[parseInt($(this).attr("data-index"))],null,n===c.length-1)})):e==="None"&&t.popup("hide");else t.popup("hide"),h&&u&&(r.removeData("restoreText"),t.methods.lookup._buttonUp(r),o.find(".app-control-helper").data("focus",!1),t.methods.lookup._useItemValue(u,h[parseInt(f.attr("data-index"))]))}var f=$(i.target).closest("li"),e=f.attr("data-command"),h=t.popup().data("list"),r=nt(),o=it(r),u=t.elementToField(r),c,s;return!f.length||f.is(".app-instruction")||f.data("selected")||(f.parent().find(".app-selected").removeClass("app-selected"),f.addClass("app-selected").attr("data-selected","true"),r.focus(),arguments.length!==2||arguments[1].feedback?setTimeout(l,ai):l()),!1}).on("keydown",".app-checkbox-container",function(n){if(!dc()&&!bo(n)){var r=n.keyCode||n.which,i=$(this),u;return u=r===32||r===39&&!i.is(".app-checkbox-on")||r===37&&i.is(".app-checkbox-on")?"toggle":t.eventToDirection(n),u?(u==="toggle"?t.elementToMethod(i)._toggleState(i):t.move(i,u,r),!1):void 0}}).on("keydown",".app-data-list",function(n){if(!dc()&&!bo(n)){var f=n.keyCode||n.which,e=$(this),i,u,r;return(f===32?i="vclick":f===8||f===46?i="clear":n.ctrlKey||(f===38?i="up":f===40?i="down":f===37?i="left":f===39?i="right":f===36?i="home":f===35&&(i="end")),i)?(u=e.find(".app-focus"),u.length?i==="up"?(r=u.prev(),r.length||(r=u.parent().prev().find("li").last())):i==="down"?(r=u.next(),r.length||(r=u.parent().next().find("li").first())):i==="right"?(r=u.parent().next().find("li:eq("+u.index()+")"),r.length||(r=u.parent().next().find("li").last())):i==="left"?r=u.parent().prev().find("li:eq("+u.index()+")"):i==="home"?r=e.find("ul").first().find("li").first():i==="end"?r=e.find("ul").last().find("li").last():i==="vclick"?(r=null,u.trigger("vclick")):i!=="clear"||e.closest("[data-control]").is('[data-input="checkboxlist"]')||(r=null,e.find("ul").first().find("li").first().trigger("vclick")):t.methods.listbox._scrollItemIntoView(e.find(".app-selected").first().addClass("app-focus")),r&&r.length&&(t.methods.listbox._focusItem(r),t.methods.listbox._scrollItemIntoView(r)),!1):(i=t.eventToDirection(n),i)?(t.move(e,i,f),!1):void 0}}).on("keydown",".app-control-helper",function(n){function l(){setTimeout(function(){c.data("focus",!1);t.methods.lookup.focus(it(i))})}var c=$(this),r=n.keyCode||n.which,s=c.find("li"),i=c.find(".app-focus"),a=i,o;if(s.length&&i.length){if(o=i.offset(),r===32||r===40&&(n.altKey||n.metaKey))return i.trigger("vclick"),!1;if(r===46||r===8)return t.methods.lookup._removeBasketItem(i,r!==8),!1;if(r===9||r===13||r===27)return setTimeout(function(){var u=it(i);n.shiftKey&&r!==27?t.move(u,"up",r):(c.data("focus",!1),t.methods.lookup.focus(u))}),!1;if(r===36)i=s.first();else if(r===35)i=s.last();else if(r===38){var f=o.left,u=f+i.outerWidth()-1,e=0,h=o.top-1;$(s.get().reverse()).each(function(){var o=$(this),r=o.offset(),n=r.left,t=n+o.outerWidth()-1,s;if(!e&&r.top<h||e>0&&r.top===h)t<f||n>u||(s=n>=f&&t<=u?t-n+1:n<f&&t<=u?t-f+1:n<u&&t>=u?u-n+1:u-f+1,s>e&&(i=o,e=s,h=r.top));else if(e)return!1})}else if(r===40){var f=o.left,u=f+i.outerWidth()-1,e=0,h=o.top+1;s.each(function(){var o=$(this),r=o.offset(),n=r.left,t=n+o.outerWidth()-1,s;if(e==0&&r.top>h||e>0&&r.top==h)t<f||n>u||(s=n>=f&&t<=u?t-n+1:n<f&&t<=u?t-f+1:n<u&&t>=u?u-n+1:u-f+1,s>e&&(i=o,e=s,h=r.top));else if(e)return!1})}else if(r===39||r===37)s.each(function(){var t=$(this),n=t.offset();if(r===39&&n.top===o.top&&n.left>o.left)return i=t,!1;r===37&&n.top===o.top&&n.left<o.left&&(i=t)});else return;if(i===a){if(r===39&&(i.next().length?i=i.next():l()),r===37&&i.prev().length&&(i=i.prev()),r===38)return setTimeout(function(){t.move(it(i),"up",9)}),!1;if(r===40)return l(),!1}return s.removeClass("app-focus"),i.addClass("app-focus"),bd(i),!1}}).on("blur",".app-data-list,.app-control-helper,.app-checkbox-container,.app-drop-box",function(){var n=$(this);n.find(".app-focus").removeClass("app-focus");n.parent().removeClass("app-has-focus")}).on("keydown",".ui-panel-inner",function(n){var r=n.keyCode||n.which,e=$(this),f,c=e.offset(),i,t,u,o,s,h;if(r===37?i="left":r===39?i="right":r!==40&&(r!==9||n.shiftKey)?r===38||r===9&&n.shiftKey?i="up":r===36?i="home":r===35?i="end":(r===13||r===32)&&(i="select"):i="down",r===9&&e.closest(".app-sidebar").length)return hi(),d().find(".app-selected").addClass("ui-btn-active"),!1;if(i){if(e.find("ul").each(function(){var n=$(this),t=n.offset();if(t.left>=c.left&&t.left<c.left+10)return f=n,!1}),!f)return!1;if(u=f.find(".ui-btn").filter(function(){return!$(this).parent().is(".ui-disabled")}),t=f.find(".app-focus"),t.length&&(i==="right"&&(i=t.find(".material-icon-chevron-right").length?"select":"down"),i==="left"&&(i=t.find(".material-icon-chevron-left").length?"select":"up"),i==="select")){if(t.length)return(o=t.data("data-context")||t.data("context-action"),r===32&&(!o||!o.keepOpen))?!1:(wi(),t.trigger("vclick"),!1);i="down"}t.length?i==="down"?$(u).each(function(n){if(t.is(this))return t=$(u.get(n<u.length-1?n+1:0)),!1}):i==="up"?$(u).each(function(n){if(t.is(this))return t=$(u.get(n>0?n-1:u.length-1)),!1}):i==="home"?t=u.first():i==="end"&&(t=u.last()):(t=u.first(),(i==="up"||i==="end")&&(t=u.last()),t.addClass("app-focus"));f.find(".ui-btn-active, .app-focus").removeClass("ui-btn-active app-focus");t.addClass("app-focus ui-btn-active");stt(t,e);ri();s=t.attr("title");s&&(h=t[0].getBoundingClientRect(),kc(h.left,h.top,s,t));event.preventDefault()}}).on("keydown",".app-drop-box",function(n){var i=n.keyCode||n.which,r=$(this),t;return i===32?t="vclick":(i===8||i===46)&&(t="clear"),t?(t==="vclick"?r.trigger(t):t==="clear"&&r.parent().find(".app-clear").trigger("vclick"),!1):void 0}).on("keydown",".app-wrapper",function(i){var nt,ut;if(!b.input&&!si()){if(rt||ft())return!1;var d=this,et=i.keyCode||i.which,g,l=i.ctrlKey,p,e,o,a,s,ot,r;switch(et){case 35:r="end";break;case 36:r="home";break;case 39:r="right";break;case 40:r="down";l&&(setTimeout(hit,0,d,r),r=null);break;case 37:r="left";break;case 38:r="up";l&&(setTimeout(hit,0,d,r),r=null);break;case 13:if($(i.target).is("textarea"))return;r="enter";break;case 113:r="edit";break;case 9:r="tab";break;case 32:r="space";break;case 33:r="pageup";break;case 34:r="pagedown"}if(r&&$(".ui-panel-dismiss,.app-popup").filter(gi).length)return i.preventDefault(),!1;if(r&&(nt=$.Event("keyboardnavigation.app",{originalEvent:i,direction:r}),$(document).trigger(nt),nt.isDefaultPrevented()))return!1;if(r&&(g=$(i.target),r&&!l&&!g.is(":input")&&g.closest(".ui-page-active").length&&!r.match(/pageup|pagedown/))){if(p=$(d),r.match(/left|right/)&&p.find('[data-layout="form"][data-state="read"]').length&&gut(r))return!1;if(e=p.children(".app-listview"),r==="tab")if(tt.frame(":visible"))r=i.shiftKey?"up":"down";else if(n._menuButton.is(".ui-icon-bars")&&!y().is(".app-page-modal")&&c.left.visible)return bt(!0),bt(!1,0),e.find(".ui-btn-active").removeClass("ui-btn-active"),c.left.inner.focus().find(".ui-btn").first().addClass("app-focus ui-btn-active"),!1;if(e.length&&e.is(":visible")){if(r.match(/left|right|home|end/)&&e.is(".app-grid")){s=yt();var it=s.session("grid-avail-width"),st=e.find(".dv-item").first(),w=st.length&&Math.ceil(it-it*(st.width()/it)),u=s.session("scroll-left")||0,v;w&&(r==="right"&&u<w?(u=Math.min(u+32,w),v=!0):r==="left"&&u>0?(u=Math.max(u-32,0),v=!0):r==="home"?(u=0,v=!0):r==="end"&&(u=w,v=!0));v&&(s.session("scroll-left",u),ys(s,-u));i.preventDefault();return}if(o=e.find(".dv-item .app-selected"),o.length||(o=e.find(".dv-item").first().find("a"),r="none"),o.length){var h=o.parent(),f=h,k=o;if(s=yt(),ot=s.extension(),r==="enter"&&tt.frame(":active")&&!l&&(i.shiftKey?r="up":l||(r="down")),r==="right"?r="down":r==="left"&&(r="up"),r==="down"?(f=h.next(),f.is(".app-group")&&(f=f.next())):r==="up"&&(f=h.prev(),f.is(".app-group")&&(f=f.prev())),k=f.find("a"),a=k.data("data-context"),a)h=f,o=k;else{if(k.is(".dv-load-at-top,.dv-load-at-bottom")){ue(50);return}a=o.data("data-context")}a&&!h.is(".dv-load-at-top-parent,.dv-load-at-bottom-parent,.app-calculated")&&(e.find(".ui-btn.app-selected").removeClass("app-selected ui-btn-active"),n.lastTouch(!1),ot.tap(a,r==="enter"?null:"none"),n.lastTouch(!0),wf(s),o.addClass("app-selected ui-btn-active"),i.preventDefault(),r.match(/up|down/)&&gl(h,p,h))}}else ut=va(),ut.length&&(t.move(ut,et===9?i.shiftKey?"up":"down":r),i.preventDefault())}i.isDefaultPrevented()||$(document).trigger($.Event("keyboardpreview.app",{originalEvent:i}))}}).on("keydown",function(i){var u,e,f,o,h;if(!i.isDefaultPrevented()){if(os(),u=i.keyCode||i.which,u===27){if(k||ni){$(document).trigger($.Event("dragcancel.app",{drag:ni||k}));i.preventDefault();return}if(!ft()&&!t.popup(":visible")){if(e=$(".app-calendar-plugin-container"),e.length&&e.is(":visible"))return n.CalendarInput("escape"),!1;if(vf(!1))return i.preventDefault(),!1;if(tt.frame(":active")&&(f=tt.fieldElem(),f.closest(".dv-item-new").length&&f.closest(".ui-btn").trigger($.Event("vclick",{ctrlKey:!0})),tt.detach(!0),ot(f).data("skip-item-focus",!0),!si())||(o=va(),o.length&&(o.removeClass("app-focus"),!si())))return!1;if(y().is(".app-page-modal"))return setTimeout(yr),i.preventDefault(),!1}}if(u===70&&(i.ctrlKey||i.metaKey))return r.search("enumerate"),!1;if(!bo(i)&&u===121&&t.valid()){i.preventDefault();var c=i.shiftKey,l=i.ctrlKey,s=c?n._contextButton:n._menuButton,a=$(".ui-panel-open");return $(".ui-popup-active").length?ve(!0):c||l||s.is(".ui-icon-bars")&&!y().is(".app-page-modal")&&!a.length?(h=$.Event("showcontextmenu.app",{originalEvent:i}),$(document).trigger(h),h.isDefaultPrevented()||l||setTimeout(function(){wi();var n=va();n.length&&(s=ot(n).find(".app-echo-toolbar .app-btn-more"));s.trigger("vclick")})):vf(),!1}}}).on("mousedown",".app-hscrollbar2",function(t){if(!s){var r=$(this),e=r.find(".app-hscrollbar-handle").offset(),u=p(r.attr("data-view")),o,f,i;return u?(f=(u.session("scroll-left")||0)+(t.pageX<e.left?-1:1)*r.outerWidth(!0),o=u.session("grid-avail-width"),f=f<0?0:Math.min(f,o-r.outerWidth(!0)),n.scrollGrid(u,f),tt.sync({dataView:u,scrollIntoView:!1})):(i=r.prev(),i.attr("class").match(/-outer/)&&(i=i.children().first()),i.scrollLeft(i.scrollLeft()+(t.pageX<e.left?-1:1)*rf(i))),!1}}).on("mousedown",".app-vscrollbar",function(n){if(!s){var i=$(this),t;t=i.prev();t.attr("class").match(/-outer/)&&(t=t.children().first());t.scrollTop(t.scrollTop()+(n.pageY<i.find(".app-vscrollbar-handle").offset().top?-1:1)*t.height())}}).on("transitionend",".app-hidden",function(){var t=$(this).parent(),i,n;t.is(".app-data-list")&&(n=t.find('[data-index="new"]'),n.length&&(i=t.data("revealTimeout"),clearTimeout(i),t.data("revealTimeout",setTimeout(function(){n.parent().prevAll().remove();n.prevAll().remove();n.parent().removeClass("app-hidden")},50))))}).on("vclick",'[data-container="toggle"]',function(){var t=$(this),r=d(t),i,u;return t.addClass("ui-btn-active"),setTimeout(function(){t.removeClass("ui-btn-active");setTimeout(function(){n.stub("put",r);i=t.parent().toggleClass("app-container-collapsed").is(".app-container-collapsed");u=t.find(".app-collapsible-toggle-button");n.toggleTooltip(u,!i);t.parent().find('[data-control="dataview"]').each(function(){ot($(this).attr("id")).css("display",i?"none":"")});i||tc({controls:t.closest('[data-container="collapsible"]').data("node").children});br();tt.sync();n.stub("trim",r)})},ai),kf(),ri(),!1}).on("vclick",".app-field-object-ref",function(){var t=$(this),u=t.closest("[data-control]"),f=t.closest("[data-input-container]"),i,r;return i=p(f.attr("data-input-container")),i&&(r=i.findField(u.attr("data-field")),r&&st(t,function(){n.details({field:r})})),!1}).on("vclick",".app-echo-see-all",function(){var t=$(this).addClass("ui-btn-active");return ke(t,!1),setTimeout(function(){t.removeClass("ui-btn-active");ly=!0;n.seeAll(t.closest(".app-echo").attr("data-for"))},ai),!1}).on("vclick",".app-echo-toolbar a",function(t){var i=$(t.target),r=i.closest(".app-echo").attr("data-for");return te(i)&&!ft()&&i.is(".ui-icon-dots")&&(ke(i,!1),st(i,function(){n.showContextMenu({scope:r})})),!1}).on("vclick",".app-sidebar ul",function(n){if(ru||!te(n.target))return!1;var t=$(n.target).closest("a"),i=t.data("context-action");if(t.length){if(i)return ft()||st(t,function(){bu(i,t)}),!1;yi(t,!1)}}).on("vclick",".app-bar-buttons",function(n){var t=rr(n.clientX);return hi(),$(this).find(".ui-btn").each(function(){var n=$(this),i=n.offset();if(n.is(":visible")&&t>=i.left-8&&t<=i.left+n.outerWidth()+8)return setTimeout(function(){n.trigger("vclick")}),!1}),!1}).on("vclick",".app-page-modal-title",function(t){var i,u=rr(t.clientX);return hi(),i=$(t.target),i.is(".app-btn")||(i=null,$(this).find(".app-btn").each(function(){var n=$(this),t=n.offset();if(n.is(":visible")&&u>=t.left-8&&u<=t.left+n.outerWidth()+8){i=n;return}})),i&&st(i,function(){if(i.is(".ui-icon-dots"))n.showContextMenu();else if(i.is(".app-btn-search"))r.search();else if(i.is(".app-btn-close"))yr();else if(i.is(".app-btn-fullscreen")){var t=!i.is(".app-btn-fullscreen-exit"),u=y().data("last-focused-field");i.removeData("title").toggleClass("app-btn-fullscreen-exit",t).attr("title",f[(t?"Exit":"")+"Fullscreen"]).closest(".ui-page").toggleClass("app-page-modal-fullscreen",t);br(!0);u&&tf()}}),!1}).on("dblclick",".app-page-modal-title",function(){return $(this).find(".app-btn-fullscreen,.app-btn-fullscreen-exit").trigger("vclick"),!1}).on("dblclick",".app-page-header",function(){return $(this).prev().trigger("dblclick"),!1}).on("vclick",".app-btn-menu",uht).on("vclick",".app-back-text",function(){return n._menuButton.trigger("vclick"),!1}).on("vclick contextmenu",".app-menu-strip ul",function(n){var t=$(n.target).closest(".ui-btn"),r=$(this).parent(),i=t.data("data-node"),u,f=i&&i.url&&!i.children;if(!t.length||t.data("selected"))return hi(),!1;if(f){if(n.type==="contextmenu")return!1;u=r.find(".app-selected").removeClass("app-selected");t.addClass("app-selected")}return st(t,function(){if(f)bs(i)||(t.removeClass("app-selected"),u.addClass("app-selected"));else{if(t.data("selected"))return;var e=[],n=[];i?n.push(i):(depth=0,i={children:[]},r.find("li:hidden a").each(function(){n.push($(this).data("data-node"))}));n.length!==1||n[0].url||(n=n[0].children);cu(e,!0,n,1);pi({anchor:t.data("selected",!0),items:e,afteropen:function(n){var t=n.addClass("app-popup-menu").find(".ui-panel-inner"),i=t.find(".app-item-selected");i.length&&t.offset().top+t.height()<i.offset().top+i.outerHeight()&&t.scrollTop(i.offset().top-t.offset().top-(t.height()-i.outerHeight())/2)},afterclose:function(){t.removeData("selected")}})}}),!1}).on("vclick",".app-bar-toolbar",bft).on("vclick",".StatusBar .Segment",function(){var n=$(this).text();return setTimeout(function(){bf("select",{text:n})}),!1}).on("vclick",".app-page-modal-glass-pane-partial",function(){return setTimeout(yr),!1}).on("vclick",".app-page-modal-glass-pane,.app-page-modal-background",function(){var u,i,r,o;if(hi(),u=n.pageInfo(),i=u.dataView,i&&i._inlineEditor){var s=this,f=lr,e=$(".app-page-modal-glass-pane,.app-page-modal-background"),t;if(e.css("visibility","hidden"),t=$(document.elementFromPoint(f.x,f.y)),e.css("visibility",""),t.length){if(t.is(".app-btn-more")&&t.closest(".app-selected").length||t.is(".app-btn-context"))return ts().find(".app-icon.app-btn-more").trigger("vclick"),!1;if(r=$.Event("datainputmove.app",{direction:t}),$(document).trigger(r),r.isDefaultPrevented())return}}i&&i.tagged("modal-tap-out")?yr():(o=y().toggleClass("app-page-modal-centered"),setTimeout(function(){o.toggleClass("app-page-modal-centered")},100))}).on("touchmove pointermove",uk,function(n){return n.preventDefault(),!1}).on("vclick",".app-sidebar .app-bar-toolbar-bottom .ui-btn",function(n){var t=$(n.target).closest(".ui-btn");return t.is(".app-selected")||(t.is(".app-btn-page")&&t.closest(".app-bar-toolbar-bottom").find(".ui-btn").removeClass("app-selected"),st(t,function(){var n=t.data("context");n?(t.addClass("app-selected"),bs(n)):t.is(".app-btn-apps")?bv():t.is(".app-btn-settings")&&lv("left")})),!1}).on("focusout",".app-sidebar .ui-panel-inner",function(){$(this).find(".app-focus").removeClass("app-focus ui-btn-active")}).on("vclick",".app-bar-search",function(){var f=$(this),t,u,i;return($(this).find(".app-icon").each(function(){var n=$(this),i=rr(),r=n.offset();if(r.left<=i&&i<r.left+n.outerWidth())return t=n,!1}),t)?(u=n.contextDataView(),i=u.survey().context.id,st(t,function(){t.is(".material-icon-cancel")?(nt().blur(),t.closest(".app-bar-search").addClass("app-null"),fi({QuickFind:null}),oi(),r.search("autoComplete",{id:i,dataInput:f.find('[data-field="QuickFind"]')})):t.is(".material-icon-search")?r.action({path:"form/submit"}):t.is(".material-icon-more")&&r.search("toggle",i)}),!1):nt().length?void 0:(oi(),!1)}).on("mousedown pointerdown touchstart",".app-control-toolbar",function(){h.range("save");h.focus();nt().data("keepFocus",!0)}).on("vclick",".app-control-toolbar",function(n){var r=$(n.target),u,l=rr(n.clientX),c,e,o,a;if(r.is(".app-has-droparrow"))e=nt().data("keepFocus",!0).blur(),c=t.elementToField(e),r.addClass("app-selected"),e.data("keepFocus",!0),h.range("restore",{force:!0}),setTimeout(function(){function t(){pi({anchor:r,items:n,y:r.offset().top+r.outerHeight(),afterclose:function(){r.removeClass("app-selected");h.focus()}})}var i=r.data("group"),n=[];i.list.forEach(function(t){var i=t.command,u=t.argument,r=t.icon,f;h.allow(c,t)&&i&&(f=h.toText(i,u),n.push({text:f,icon:r?"material-icon-"+r:r,context:{c:i,a:u},callback:h.exec}))});s?setTimeout(t,200):t()},ai);else{if(r.is(".app-control-toolbar-more"))return e=nt().data("keepFocus",!0).blur(),o=[],u=r,it(e,".app-control-toolbar").find(".app-has-droparrow,i,.app-divider").each(function(){var n=$(this),t=n.data("group"),r=n.data("command"),i=n.data("icon");t?o.push({text:t.text,icon:!1,transition:!0,callback:function(){var n=[{text:f.Back,icon:wt,callback:function(){at(o,"#app-rtf",a)}},{}];t.list.forEach(function(t){var i=t.command,r=t.argument,u=t.icon;i&&h.allow(c,t)&&n.push({text:h.toText(i,r),icon:u?"material-icon-"+u:!1,context:{c:i,a:r},callback:h.exec})});at(n,"#app-rtf-1",{close:h.focus})}}):r?o.push({text:n.data("text"),shortcut:n.data("shortcut"),icon:i?"material-icon-"+i:!1,context:{c:n.data("command"),a:n.data("argument")},callback:h.exec,disabled:n.is(".app-disabled"),state:n.is(".app-selected")}):o.push({})}),r.addClass("app-active"),e.data("keepFocus",!0),h.range("restore",{force:!0}),setTimeout(function(){r.removeClass("app-active");var n=h.range(),t=n?i.width-325>e.offset().left+n.getBoundingClientRect().right?"right":"left":"right";at(o,"#app-rtf",{position:t,close:h.focus})},ai),!1;r.is(".app-shim-more")||$(this).find("i").each(function(){var n=$(this),t=n.offset();if(l>=t.left-4&&l<=t.left+n.outerWidth()+4)return u=n,!1})}return u&&u.length&&!u.is(".app-disabled")&&(kr||nt().data("keepFocus",!0).blur(),u.addClass("app-active"),setTimeout(function(){u.removeClass("app-active");h.range("restore");h.focus();h.range("exec",{command:u.data("command"),argument:u.data("argument")})},ai)),!1}).on("mousedown pointerdown touchstart",".app-has-rtf",function(n){if($(n.target).is(".app-has-rtf,.app-data-input-placeholder"))return!1}).on("rtfeditorsubmit.dataview.app",function(n){h.document("blur");var t=n.dataView,i=t.data(),r=n.survey.context.field;t.discard();vi(function(){fi({name:r,value:i.text})})}).on("touchstart pointerdown mousedown",".app-glass-pane",function(n){$(this).addClass("app-glass-pane-reject");go(n);n.preventDefault();n.stopPropagation()}).on("mouseenter",".app-menu-strip .ui-btn",function(){if(!s){var n=$(this);clearTimeout(ay);ay=setTimeout(function(){n.is(".app-has-children")?n.trigger("vclick"):n.closest(".app-menu-strip").length&&ve(!0,".app-popup-menu")},$(".ui-popup-active .app-popup-menu").length?100:350)}}).on("mouseleave",".app-menu-strip .ui-btn",function(){if(!s){clearTimeout(ay);var n=$(this);n.data("selected")||ve(!0,".app-popup-menu")}}).on("mousedown",".ui-popup-screen,.app-menu-strip,.app-logo,.app-bar-toolbar",function(n){var t=n.pageX,i=n.pageY,r,u=$(".ui-popup-active");if(!s&&u.length&&!n.button)return r=!$(n.target).closest(".app-bar-toolbar").length&&!u.find(".app-popup-panel").length,ve(!0),r&&setTimeout(function(){var n=$.Event("vclick");n.pageX=n.clientX=t;n.pageY=n.clientY=i;$(document.elementFromPoint(t,i)).trigger(n)},75),!1}).on("vclick",".app-bar-tabs li",function(){var t=$(this),n=t.data("item");return n?bs(n.context):bv("right",!1,!0),!1}).on("mousedown touchstart pointerdown",".ui-panel-dismiss",function(){return setTimeout(function(){po($(".ui-panel-open"))}),!1}).on("vclick",".ui-panel",function(n){var u=$(this),t=$(n.target).closest("a"),r=t.closest("li").attr("data-icon"),i;if(ru||!t.length||!te(t))return!1;if(i=t.data("context-action"),i&&!pk){if(i.dataRel)return!0;i.feedback===!1?(yi(),i.keepOpen===!0||i.transition?(bu(i,t,!0),gp(t)):(po(u,r!=="dots"&&r!==wt),he=function(){setTimeout(function(){bu(i,t)},10)})):i.keepOpen===!0||i.transition?st(t,function(){bu(i,t,!0);gp(t)}):st(t,function(){var n,f,o,e;i.icon===wt&&(n=t.closest(".ui-panel-inner").find("ul"),f=n.first());n&&n.length>1?(tu(!1),o=f.parent().addClass("app-list-container-reverse").css({transition:"",transform:"translate3d("+-(-v(f,"margin-right")+f.closest(".ui-panel").outerWidth()*(n.length-2))+"px,0,0)"}).one("transitionend",function(){setTimeout(function(){n.last().remove();o.removeClass("app-list-container-reverse");stt($(n[n.length-2]).find(".app-focus"));tu(!0)})})):(e=t.attr("href"),e?l.location.href=e:(po(u,r!=="dots"&&r!==wt),he=function(){setTimeout(function(){bu(i,t)},wa()?10:ai)}))})}return pk=!1,!1}).on("vclick",".app-virtual-screen",function(){return vf(),!1});h={list:[],groups:[{list:[{command:"undo",key:"Ctrl+Z",metaKey:!0,icon:"undo",toolbar:!1},{command:"redo",key:"Ctrl+Y",icon:"redo",toolbar:!1},{command:"redo",key:"Meta+Shift+Z",toolbar:!1,hidden:!0}]},{text:cl.Format,list:[{command:"formatBlock",argument:"p",icon:"short-text"},{command:"formatBlock",argument:"blockquote",icon:"format-quote"},{command:"formatBlock",argument:"h1",icon:"title"},{command:"formatBlock",argument:"h2"},{command:"formatBlock",argument:"h3"},{command:"formatBlock",argument:"h4"},{command:"formatBlock",argument:"h5"},{command:"formatBlock",argument:"h6"}]},{list:[{command:"bold",key:"Ctrl+B",metaKey:!0,icon:"format-bold"},{command:"italic",key:"Ctrl+I",metaKey:!0,icon:"format-italic"},{command:"underline",key:"Ctrl+U",metaKey:!0,icon:"format-underlined"},{command:"strikethrough",key:"Alt+Shift+5",metaKey:!0,icon:"strikethrough-s"}]},{list:[{command:"insertUnorderedList",icon:"format-list-bulleted"},{command:"insertOrderedList",icon:"format-list-numbered"}]},{list:[{command:"justifyLeft",key:"Ctrl+L",metaKey:!0,icon:"format-align-left"},{command:"justifyCenter",key:"Ctrl+E",metaKey:!0,icon:"format-align-center"},{command:"justifyRight",key:"Ctrl+R",metaKey:!0,icon:"format-align-right"},{command:"justifyFull",key:"Ctrl+J",metaKey:!0,icon:"format-align-justify"}]},{list:[{command:"indent",icon:"format-indent-increase",key:"Ctrl+]",which:221},{command:"outdent",icon:"format-indent-decrease",key:"Ctrl+[",which:219}]},{list:[{command:"removeFormat",icon:"format-clear"},{command:"rtf",argument:"editor",icon:"fullscreen",key:"F11"}]}],status:{undo:!0,redo:!0,indent:!0,outdent:!0},init:function(){h.groups.forEach(function(n){n.list.forEach(function(n){h.list.push(n)})})},allow:function(n,i){if(!n&&(n=t.elementToField(nt()),!n))return!1;var f=n.Tag,r,e=i.command,u=i.argument;return e==="rtf"&&u==="editor"&&n._dataView._controller==="rtfeditor_sys"?!1:!f||!f.match(/\brtf\-command\-/)?!0:(r=e,u&&(r+="-"+u),n.is("rtf-command-"+r))},document:function(n){var t=nt(),i=t.is("iframe")?t[0].contentDocument:null,r,u;return i&&(n==="focus"?i.body.focus():n==="blur"&&(r=t.offset(),u=$("<input/>").css({borderWidth:0,position:"absolute",left:r.left,top:r.top}).appendTo(t.parent()).focus(),t.blur(),u.remove(),hi())),i},window:function(n){var i=nt(),t=i.is("iframe")?i[0].contentWindow:null;return t&&n==="selection"&&(t=t.getSelection()),t},toText:function(n,t){var i=cl[n.substring(0,1).toUpperCase()+n.substring(1)];return typeof i!="string"&&(i=i[t]),i},range:function(n,t){var u,r,i,e,g,a,b,f,s,tt,c,l,rt,ut;if(n||(n="get"),n==="save"){h._range=h.range();return}if(n==="clear"){h._range=null;return}if(u=h.window("selection"),n==="get")return u&&u.getRangeAt&&u.rangeCount?u.getRangeAt(0):null;if(r=h.document(),i=h._range,n==="restore"){if(t&&t.force){if(i&&i.startOffset===i.endOffset){var d=i.getBoundingClientRect(),ft=nt(),et=ft.offset();e=$('<span class="app-rtf-cursor"/>').appendTo(o).css({left:et.left+d.left,top:et.top+d.top+v(ft,"padding-top"),height:d.height}).data("blink",setInterval(function(){e.css("display",e.css("display")!=="none"?"none":"")},500))}}else e=$(".app-rtf-cursor"),clearInterval(e.data("blink")),e.remove();if(i&&u){try{u.removeAllRanges()}catch(ot){r.body.createTextRange().select();r.selection.empty()}try{u.addRange(i)}catch(ot){h._range=null}}}else if(n==="insert"){if(g=!0,a=t&&t.tag,a)return a==="br"?(b=r.createElement(a),i.deleteContents(),i.insertNode(b),i.setStartAfter(b),i.setEndAfter(b),i.collapse(!1),u.removeAllRanges(),u.addRange(i),g=!1):r.execCommand("formatBlock",!1,a),nt().trigger("rtfchanged"),g}else if(n==="exec"&&t){if(f=t.command,s=t.argument,f==="rtf"){h.allow(null,t)&&(h.range("restore"),h[s]());return}if(t.validate&&f&&!f.match(/^(undo|redo)$/)&&!h.allow(null,t))return;h.range("restore");f==="formatBlock"&&s?r.execCommand(f,0,s)||r.execCommand(f,0,"<"+s+">"):r.execCommand(f,0,s);r.body.focus();h.range("status");nt().trigger("rtfchanged")}else if(n==="focus")h.range("restore"),nt().focus(),h.document("focus");else if(n==="status")it(nt(),".app-control-toolbar i").each(function(){var t=$(this),n=t.data("command");if(n&&n!=="rtf")try{t.toggleClass("app-selected",r.queryCommandState(n));h.status[n]?t.toggleClass("app-disabled",!r.queryCommandEnabled(n)):t.toggleClass("app-selected",r.queryCommandState(n))}catch(i){}});else if(n==="select"){var y=t.x,k=t.y,p=t.x2,w=t.y2;if(y==null)return null;try{return p==null&&(p=y),w==null&&(w=k),tt=h.window(),i=null,typeof r.caretPositionFromPoint!="undefined"?(c=r.caretPositionFromPoint(y,k),l=r.caretPositionFromPoint(p,w),i=r.createRange(),i.setStart(c.offsetNode,c.offset),i.setEnd(l.offsetNode,l.offset)):typeof r.caretRangeFromPoint!="undefined"&&(c=r.caretRangeFromPoint(y,k),l=r.caretRangeFromPoint(p,w),i=r.createRange(),i.setStart(c.startContainer,c.startOffset),i.setEnd(l.startContainer,l.startOffset)),i!==null&&typeof tt.getSelection!="undefined"?(rt=tt.getSelection(),rt.removeAllRanges(),rt.addRange(i)):typeof r.body.createTextRange!="undefined"&&(i=r.body.createTextRange(),i.moveToPoint(y,k),ut=i.duplicate(),ut.moveToPoint(p,w),i.setEndPoint("EndToEnd",ut),i.select()),i}catch(ot){return null}}},exec:function(n){h.range("exec",{command:n.c,argument:n.a})},focus:function(){h.range("focus")},editor:function(n){var u,f,c,e,o,s=[],l,a;if(n?(u=yt().findField(n.field),e=n.type):u=t.elementToField(it(nt())),o=u.Tag,o)for(l=/\brtf\-command\-(.+?)(\s|$)/g;a=l.exec(o);)s.push(a[0]);f=u.Name;h.document("blur");c=u._dataView.data();ta(e?null:f);r.survey({controller:"rtfeditor_sys",context:{field:f},text:u.HeaderText,text2:eh.Scopes.Form.Edit.HeaderText,questions:[{name:"text",rows:5,mode:"rtf",value:c[f],tags:s.length?s.join(" "):null}],layout:'<div data-container="simple" data-wrap="true" class="app-rtf-editor"><div data-container="row"><span data-control="field" data-field="text"/><\/div><\/div>',options:{modal:{fullscreen:e?e==="fullscreen":i.width<=ti("xl")},materialIcon:"edit"},submit:"rtfeditorsubmit.dataview.app",submitKey:"Ctrl+Enter",submitText:ul.SaveButton})},scrolled:function(){h.toolbar("position")},blur:function(n){var t=nt(it(n.target));!t.is("iframe")||t.is(n.target)||ru||sr||t.blur()},autoSize:function(){if(h.document()){var i=nt(),u=it(i),r=u.find(".app-control-inner"),f,n=ia(i),e=r.html(),o;e!==n&&(o=r.height(),r.html(n.length?n:t.fieldToPlaceholder(t.elementToField(i))||"&nbsp;"),e=n,o!==r.height()&&(i.parent().scrollTop(0),pr(),h.range("save")),f=u.find(".app-data-input-placeholder"),f.css("display",n.length?"none":""))}},handlers:function(i,r){var u=i[0].contentDocument,f=$(u);if(r){i.on("rtfchanged",h.autoSize);$(document).one("focusin touchend",h.blur);$(document).on("scroll.app scrollstop.app resized.app",h.scrolled);f.on("keydown","body",function(r){var u,e,f;if(os(),u=r.originalEvent.key,u==="Enter"&&(e=h.range("insert",{tag:r.shiftKey?"br":"p"}),!e))return!1;if(u==="Tab")return t.move(nt(),r.shiftKey?"up":"down"),!1;if(u==="F10")return r.shiftKey?n.showContextMenu():it(i,".app-control-toolbar-more").trigger("vclick"),!1;if(u&&u.match(/^Esc/))return f=$.Event("keydown"),f.which=27,i.trigger(f),!1;bo(r,!0)&&h.autoSize()}).on("mouseup keyup mouseout","body",function(){h.range("save");h.range("status")}).on("touchend","body",function(){setTimeout(function(){h.range("save");h.range("status")},100)}).on("paste","body",function(n){if(n.originalEvent&&n.originalEvent.clipboardData&&n.originalEvent.clipboardData.getData){n.preventDefault();var t=n.originalEvent.clipboardData.getData("text/plain");u.execCommand("insertText",!1,t)}else n.clipboardData&&n.clipboardData.getData?(n.preventDefault(),t=n.clipboardData.getData("text/plain"),u.execCommand("insertText",!1,t)):l.clipboardData&&l.clipboardData.getData&&(l._rtfLock||(l._rtfLock=!0,n.preventDefault(),u.execCommand("ms-pasteTextOnly",!1)),l._rtfLock=!1);h.autoSize()}).on("keyup","body",h.autoSize)}else h.range("clear"),f.off(),i.off("rtfchanged"),$(document).off("scroll.app scrollstop.app resized.app",h.scrolled)},toolbar:function(n,i){function c(){if(r=i.find(".app-control-toolbar"),!r.length){o=i.find(".app-control-inner");f=t.elementToField(i);f.is("rtf-frame")&&(u=$('<\/div><div class="app-control-frame app-hidden"><\/div>').insertBefore(o));r=$('<div class="app-control-toolbar app-hidden"><\/div>');u||r.addClass("app-control-toolbar-noframe");h.groups.forEach(function(n){var t,u=n.list,i=n.text;i?$(u).filter(function(){return h.allow(f,this)}).length&&(t=$('<span class="app-has-droparrow"/>').text(i).attr("title",i).data("group",n).appendTo(r)):u.forEach(function(n){var e=n.command,c=n.argument,l=n.toolbar!==!1,o=n.icon,s,u,i;!n.hidden&&e&&h.allow(f,n)&&(s=h.toText(e,c),u=n.key,o?(i=vt("material-icon-"+o,r).attr("title",s+(u?" ("+u+")":"")),l||i.addClass("app-hidden")):i=$('<i class="app-hidden"/>').appendTo(r),i.data({command:e,argument:c,icon:o,text:s,shortcut:u}),t=i)});t&&(button=$('<span class="app-divider"/>').appendTo(r),t.is(".app-hidden")&&button.addClass("app-hidden"))});f.is("rtf-more-none")||($('<span class="app-shim-more"/>').appendTo(r),vt("material-icon-more-"+(kr?"vert":"horiz"),r).addClass("app-control-toolbar-more").attr("title",ki+" (F10)"));var c=f.is("rtf-toolbar-location")==="bottom"?"bottom":kr?"bottom":"top",n={bar:r,frame:u,location:c,defaultLocation:c};n.defaultLocation=n.location;i.data("toolbar",n);e();s(i);setTimeout(function(){u&&u.removeClass("app-hidden");r.removeClass("app-hidden")})}}function e(){var f=i.find(".app-control-inner"),u=i.data("toolbar"),t=u.bar,r=u.frame,n;t.insertBefore(f);n=t.outerHeight();u.location==="top"?(n=-n,r&&r.css({top:n,bottom:""})):(t.insertAfter(f),r&&r.css({top:"",bottom:-n}),n=0);t.css("margin-top",n)}function s(n,t){n||(n=it(nt()));var f=d(),o=f.offset(),i=n.data("toolbar"),r,u;i&&(t&&(i.location=i.defaultLocation,e()),r=i.bar,u=r.offset(),(u.top<o.top||u.top+r.outerHeight()>o.top+f.height())&&(i.location=i.location==="bottom"?"top":"bottom",e()))}function l(){r=i.data("toolbar");r&&(r.bar.find("i,.app-has-droparrow").removeData(),r.bar.remove(),u=r.frame,u&&u.remove(),i.removeData("toolbar"))}var o,f,r,u;i||(i=it(nt()));n==="create"?c(i):n==="position"?s(i,!0):l(i)}};fo.registerClass("Web.DataView.MobileGrid",th);ih.registerClass("Web.DataView.MobileForm",th)})();